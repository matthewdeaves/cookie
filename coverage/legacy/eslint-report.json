[{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/ai-error.js","messages":[{"ruleId":"complexity","severity":1,"message":"Function 'handleError' has a complexity of 16. Maximum allowed is 15.","line":16,"column":5,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":58,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AI Error Handler (ES5, iOS 9 compatible)\n * Provides user-friendly error handling for AI features with actionable guidance\n */\nvar Cookie = Cookie || {};\n\nCookie.aiError = (function() {\n    'use strict';\n\n    /**\n     * Handle AI-related errors with actionable guidance\n     * @param {Error} err - Error object from ajax callback\n     * @param {string} defaultMessage - Default error message to show\n     * @returns {Object} - { message: string, action: string|null }\n     */\n    function handleError(err, defaultMessage) {\n        var result = {\n            message: defaultMessage || 'An error occurred',\n            action: null\n        };\n\n        if (!err) {\n            return result;\n        }\n\n        // Get error data from parsed response\n        var data = err.data || {};\n        var status = err.status;\n\n        // Use server-provided message if available\n        if (data.message) {\n            result.message = data.message;\n        }\n\n        // Use server-provided action if available\n        if (data.action) {\n            result.action = data.action;\n        }\n\n        // Provide default actions based on status/error codes\n        if (!result.action) {\n            if (status === 503 || data.error === 'ai_unavailable') {\n                result.action = 'configure_key';\n                result.message = result.message || 'AI features are not available. Please configure your API key in Settings.';\n            } else if (status === 401) {\n                result.action = 'update_key';\n                result.message = result.message || 'Your API key appears to be invalid. Please update it in Settings.';\n            } else if (status === 429) {\n                result.action = 'retry';\n                result.message = result.message || 'Too many requests. Please wait a moment and try again.';\n            } else if (status === 402) {\n                result.action = 'add_credits';\n                result.message = result.message || 'Your OpenRouter account may need credits. Please check your account.';\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Show error toast with appropriate guidance\n     * @param {Error} err - Error object from ajax callback\n     * @param {string} defaultMessage - Default error message to show\n     */\n    function showError(err, defaultMessage) {\n        var result = handleError(err, defaultMessage);\n\n        // Add guidance text based on action\n        var fullMessage = result.message;\n        if (result.action === 'configure_key') {\n            fullMessage = result.message + ' Go to Settings to configure.';\n        } else if (result.action === 'update_key') {\n            fullMessage = result.message + ' Go to Settings to update.';\n        } else if (result.action === 'retry') {\n            fullMessage = result.message;\n        } else if (result.action === 'add_credits') {\n            fullMessage = result.message;\n        }\n\n        Cookie.toast.error(fullMessage);\n        return result;\n    }\n\n    /**\n     * Check if AI features should be hidden based on error\n     * @param {Error} err - Error object from ajax callback\n     * @returns {boolean} - True if AI features should be hidden\n     */\n    function shouldHideFeatures(err) {\n        if (!err) return false;\n\n        var status = err.status;\n        var data = err.data || {};\n\n        // Hide features for 503 (unavailable) or 401 (invalid key)\n        return status === 503 || status === 401 || data.error === 'ai_unavailable';\n    }\n\n    /**\n     * Hide AI feature elements on the page\n     */\n    function hideAIFeatures() {\n        var aiFeatures = document.querySelectorAll('[data-ai-feature]');\n        for (var i = 0; i < aiFeatures.length; i++) {\n            aiFeatures[i].classList.add('hidden');\n        }\n    }\n\n    return {\n        handleError: handleError,\n        showError: showError,\n        shouldHideFeatures: shouldHideFeatures,\n        hideAIFeatures: hideAIFeatures\n    };\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/ajax.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/app.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/collection-detail.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/collections.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/detail.js","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'setupEventListeners' has too many lines (159). Maximum allowed is 100.","line":70,"column":5,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":228,"endColumn":6},{"ruleId":"complexity","severity":1,"message":"Function 'setupEventListeners' has a complexity of 24. Maximum allowed is 15.","line":70,"column":5,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":228,"endColumn":6},{"ruleId":"no-unused-vars","severity":1,"message":"'originalText' is assigned a value but never used.","line":759,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":759,"endColumn":37},{"ruleId":"no-shadow","severity":1,"message":"'profileId' is already declared in the upper scope on line 11 column 9.","line":1040,"column":13,"nodeType":"Identifier","messageId":"noShadow","endLine":1040,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Recipe Detail page (ES5, iOS 9 compatible)\n */\nvar Cookie = Cookie || {};\nCookie.pages = Cookie.pages || {};\n\nCookie.pages.detail = (function() {\n    'use strict';\n\n    var recipeId;\n    var profileId;\n    var currentServings;\n    var originalServings;\n    var selectedRemixSuggestion = null;\n    var remixSuggestions = [];\n    var isCreatingRemix = false;\n    var isScaling = false;\n    var isGeneratingTips = false;\n    var scaledIngredients = null;\n    var scaledInstructions = null;\n    var scalingNotes = [];\n    var adjustedTimes = null;  // {prep: int|null, cook: int|null, total: int|null}\n\n    // Tips polling state\n    var tipsPollingState = {\n        isPolling: false,\n        pollInterval: null,\n        pollStartTime: null\n    };\n    var TIPS_POLL_INTERVAL = 3000;  // 3 seconds\n    var TIPS_MAX_POLL_DURATION = 30000;  // 30 seconds\n    var TIPS_RECENT_THRESHOLD = 60000;  // 60 seconds\n\n    /**\n     * Initialize the page\n     */\n    function init() {\n        var pageEl = document.querySelector('[data-page=\"recipe-detail\"]');\n        if (!pageEl) return;\n\n        recipeId = parseInt(pageEl.getAttribute('data-recipe-id'), 10);\n        profileId = parseInt(pageEl.getAttribute('data-profile-id'), 10);\n\n        setupEventListeners();\n\n        // Check if we should poll for tips (recently imported recipe with no tips)\n        var scrapedAt = pageEl.getAttribute('data-scraped-at');\n        var hasTips = pageEl.getAttribute('data-has-tips') === 'true';\n\n        if (scrapedAt && !hasTips) {\n            // iOS 9 Safari compatible date parsing\n            // Convert \"2026-01-09T09:18:29.135626+00:00\" to Safari-parseable format\n            var scrapedDate = new Date(scrapedAt\n                .replace('T', ' ')              // Replace T with space\n                .replace(/\\.\\d+/, '')           // Remove microseconds (.135626)\n                .replace(/[+-]\\d{2}:\\d{2}$/, '') // Remove timezone (+00:00 or -05:00)\n                .replace('Z', '')               // Remove Z suffix if present\n                .replace(/-/g, '/'));           // Convert dashes to slashes for Safari\n            var recipeAge = Date.now() - scrapedDate.getTime();\n\n            if (!isNaN(recipeAge) && recipeAge < TIPS_RECENT_THRESHOLD) {\n                startTipsPolling();\n            }\n        }\n    }\n\n    /**\n     * Setup event listeners\n     */\n    function setupEventListeners() {\n        // Back button\n        var backBtn = document.getElementById('back-btn');\n        if (backBtn) {\n            backBtn.addEventListener('click', handleBack);\n        }\n\n        // Meta section toggle\n        var metaToggle = document.getElementById('meta-toggle');\n        if (metaToggle) {\n            metaToggle.addEventListener('click', handleMetaToggle);\n        }\n\n        // Tab buttons\n        var tabs = document.querySelectorAll('.tab');\n        for (var i = 0; i < tabs.length; i++) {\n            tabs[i].addEventListener('click', handleTabClick);\n        }\n\n        // Favorite button\n        var favoriteBtn = document.getElementById('favorite-btn');\n        if (favoriteBtn) {\n            favoriteBtn.addEventListener('click', handleFavoriteClick);\n        }\n\n        // Collection button\n        var collectionBtn = document.getElementById('collection-btn');\n        if (collectionBtn) {\n            collectionBtn.addEventListener('click', handleCollectionClick);\n        }\n\n        // Cook button\n        var cookBtn = document.getElementById('cook-btn');\n        if (cookBtn) {\n            cookBtn.addEventListener('click', handleCookClick);\n        }\n\n        // Collection modal close\n        var modalClose = document.getElementById('modal-close');\n        if (modalClose) {\n            modalClose.addEventListener('click', closeCollectionModal);\n        }\n\n        // Create collection button\n        var createCollectionBtn = document.getElementById('create-collection-btn');\n        if (createCollectionBtn) {\n            createCollectionBtn.addEventListener('click', openCreateCollectionModal);\n        }\n\n        // Create collection modal close\n        var createModalClose = document.getElementById('create-modal-close');\n        if (createModalClose) {\n            createModalClose.addEventListener('click', closeCreateCollectionModal);\n        }\n\n        // Collection options\n        var collectionOptions = document.querySelectorAll('.collection-option');\n        for (var j = 0; j < collectionOptions.length; j++) {\n            collectionOptions[j].addEventListener('click', handleCollectionOptionClick);\n        }\n\n        // Create collection form\n        var createForm = document.getElementById('create-collection-form');\n        if (createForm) {\n            createForm.addEventListener('submit', handleCreateCollection);\n        }\n\n        // Modal overlay click to close\n        var collectionModal = document.getElementById('collection-modal');\n        if (collectionModal) {\n            collectionModal.addEventListener('click', function(e) {\n                if (e.target === collectionModal) {\n                    closeCollectionModal();\n                }\n            });\n        }\n\n        var createCollectionModal = document.getElementById('create-collection-modal');\n        if (createCollectionModal) {\n            createCollectionModal.addEventListener('click', function(e) {\n                if (e.target === createCollectionModal) {\n                    closeCreateCollectionModal();\n                }\n            });\n        }\n\n        // Serving adjuster\n        var servingAdjuster = document.querySelector('.serving-adjuster');\n        if (servingAdjuster) {\n            originalServings = parseInt(servingAdjuster.getAttribute('data-original-servings'), 10);\n            currentServings = originalServings;\n\n            var decreaseBtn = servingAdjuster.querySelector('.serving-decrease');\n            var increaseBtn = servingAdjuster.querySelector('.serving-increase');\n\n            if (decreaseBtn) {\n                decreaseBtn.addEventListener('click', function() {\n                    adjustServings(-1);\n                });\n            }\n            if (increaseBtn) {\n                increaseBtn.addEventListener('click', function() {\n                    adjustServings(1);\n                });\n            }\n\n            updateServingButtons();\n        }\n\n        // Remix button\n        var remixBtn = document.getElementById('remix-btn');\n        if (remixBtn) {\n            remixBtn.addEventListener('click', handleRemixClick);\n        }\n\n        // Remix modal close\n        var remixModalClose = document.getElementById('remix-modal-close');\n        if (remixModalClose) {\n            remixModalClose.addEventListener('click', closeRemixModal);\n        }\n\n        // Remix modal overlay click to close\n        var remixModal = document.getElementById('remix-modal');\n        if (remixModal) {\n            remixModal.addEventListener('click', function(e) {\n                if (e.target === remixModal) {\n                    closeRemixModal();\n                }\n            });\n        }\n\n        // Remix custom input\n        var remixCustomInput = document.getElementById('remix-custom-input');\n        if (remixCustomInput) {\n            remixCustomInput.addEventListener('input', handleRemixCustomInput);\n        }\n\n        // Remix create button\n        var remixCreateBtn = document.getElementById('remix-create-btn');\n        if (remixCreateBtn) {\n            remixCreateBtn.addEventListener('click', handleRemixCreate);\n        }\n\n        // Generate tips button\n        var generateTipsBtn = document.getElementById('generate-tips-btn');\n        if (generateTipsBtn) {\n            generateTipsBtn.addEventListener('click', function() {\n                handleGenerateTips(false);\n            });\n        }\n\n        // Regenerate tips button\n        var regenerateTipsBtn = document.getElementById('regenerate-tips-btn');\n        if (regenerateTipsBtn) {\n            regenerateTipsBtn.addEventListener('click', function() {\n                handleGenerateTips(true);\n            });\n        }\n    }\n\n    /**\n     * Handle back button click\n     */\n    function handleBack() {\n        // Go back to previous page, or home if no history\n        if (window.history.length > 1) {\n            window.history.back();\n        } else {\n            window.location.href = '/legacy/home/';\n        }\n    }\n\n    /**\n     * Handle meta section toggle\n     */\n    function handleMetaToggle() {\n        var toggle = document.getElementById('meta-toggle');\n        var content = document.getElementById('meta-content');\n        var chevron = document.getElementById('meta-chevron');\n\n        if (content.classList.contains('hidden')) {\n            content.classList.remove('hidden');\n            toggle.classList.remove('collapsed');\n            chevron.style.transform = 'rotate(0deg)';\n        } else {\n            content.classList.add('hidden');\n            toggle.classList.add('collapsed');\n            chevron.style.transform = 'rotate(180deg)';\n        }\n    }\n\n    /**\n     * Handle tab click\n     */\n    function handleTabClick(e) {\n        var btn = e.currentTarget;\n        var tabName = btn.getAttribute('data-tab');\n\n        // Update button states\n        var allTabs = document.querySelectorAll('.tab');\n        for (var i = 0; i < allTabs.length; i++) {\n            allTabs[i].classList.remove('active');\n        }\n        btn.classList.add('active');\n\n        // Update tab content visibility\n        var allContents = document.querySelectorAll('.tab-content');\n        for (var j = 0; j < allContents.length; j++) {\n            allContents[j].classList.add('hidden');\n        }\n\n        var targetContent = document.getElementById('tab-' + tabName);\n        if (targetContent) {\n            targetContent.classList.remove('hidden');\n        }\n\n        // QA-046: Auto-generate tips when viewing Tips tab for old recipes without tips\n        if (tabName === 'tips') {\n            var pageEl = document.querySelector('[data-page=\"recipe-detail\"]');\n            var aiAvailable = pageEl && pageEl.getAttribute('data-ai-available') === 'true';\n            var hasTips = document.querySelectorAll('.tips-list .tip-item').length > 0;\n\n            if (aiAvailable && !hasTips && !isGeneratingTips && !tipsPollingState.isPolling) {\n                handleGenerateTips(false);\n            }\n        }\n    }\n\n    /**\n     * Handle favorite button click\n     */\n    function handleFavoriteClick() {\n        var btn = document.getElementById('favorite-btn');\n        var isActive = btn.classList.contains('active');\n\n        if (isActive) {\n            removeFavorite(btn);\n        } else {\n            addFavorite(btn);\n        }\n    }\n\n    /**\n     * Add to favorites\n     */\n    function addFavorite(btn) {\n        Cookie.ajax.post('/api/favorites/', { recipe_id: recipeId }, function(err) {\n            if (err) {\n                Cookie.toast.error('Failed to add to favorites');\n                return;\n            }\n            btn.classList.add('active');\n            var svg = btn.querySelector('svg');\n            if (svg) {\n                svg.setAttribute('fill', 'currentColor');\n            }\n            btn.setAttribute('title', 'Remove from favorites');\n            Cookie.toast.success('Added to favorites');\n        });\n    }\n\n    /**\n     * Remove from favorites\n     */\n    function removeFavorite(btn) {\n        Cookie.ajax.delete('/api/favorites/' + recipeId + '/', function(err) {\n            if (err) {\n                Cookie.toast.error('Failed to remove from favorites');\n                return;\n            }\n            btn.classList.remove('active');\n            var svg = btn.querySelector('svg');\n            if (svg) {\n                svg.setAttribute('fill', 'none');\n            }\n            btn.setAttribute('title', 'Add to favorites');\n            Cookie.toast.success('Removed from favorites');\n        });\n    }\n\n    /**\n     * Handle collection button click\n     */\n    function handleCollectionClick() {\n        var modal = document.getElementById('collection-modal');\n        if (modal) {\n            modal.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Close collection modal\n     */\n    function closeCollectionModal() {\n        var modal = document.getElementById('collection-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Open create collection modal\n     */\n    function openCreateCollectionModal() {\n        closeCollectionModal();\n        var modal = document.getElementById('create-collection-modal');\n        if (modal) {\n            modal.classList.remove('hidden');\n            var nameInput = document.getElementById('collection-name');\n            if (nameInput) {\n                nameInput.value = '';\n                nameInput.focus();\n            }\n        }\n    }\n\n    /**\n     * Close create collection modal\n     */\n    function closeCreateCollectionModal() {\n        var modal = document.getElementById('create-collection-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Handle collection option click\n     */\n    function handleCollectionOptionClick(e) {\n        var btn = e.currentTarget;\n        var collectionId = parseInt(btn.getAttribute('data-collection-id'), 10);\n\n        addToCollection(collectionId);\n    }\n\n    /**\n     * Add recipe to collection\n     */\n    function addToCollection(collectionId) {\n        Cookie.ajax.post('/api/collections/' + collectionId + '/recipes/', { recipe_id: recipeId }, function(err) {\n            if (err) {\n                if (err.message && err.message.indexOf('already') !== -1) {\n                    Cookie.toast.error('Recipe already in collection');\n                } else {\n                    Cookie.toast.error('Failed to add to collection');\n                }\n                return;\n            }\n            closeCollectionModal();\n            Cookie.toast.success('Added to collection');\n        });\n    }\n\n    /**\n     * Handle create collection form submit\n     */\n    function handleCreateCollection(e) {\n        e.preventDefault();\n\n        var nameInput = document.getElementById('collection-name');\n        var name = nameInput ? nameInput.value.trim() : '';\n\n        if (!name) {\n            Cookie.toast.error('Please enter a collection name');\n            return;\n        }\n\n        // Create collection then add recipe\n        Cookie.ajax.post('/api/collections/', { name: name }, function(err, collection) {\n            if (err) {\n                Cookie.toast.error('Failed to create collection');\n                return;\n            }\n\n            // Add recipe to new collection\n            Cookie.ajax.post('/api/collections/' + collection.id + '/recipes/', { recipe_id: recipeId }, function(err2) {\n                if (err2) {\n                    Cookie.toast.error('Collection created but failed to add recipe');\n                    closeCreateCollectionModal();\n                    return;\n                }\n\n                closeCreateCollectionModal();\n                Cookie.toast.success('Created collection and added recipe');\n\n                // Add new collection to the list in the modal\n                var collectionList = document.querySelector('.collection-list');\n                if (collectionList) {\n                    var newBtn = document.createElement('button');\n                    newBtn.type = 'button';\n                    newBtn.className = 'collection-option';\n                    newBtn.setAttribute('data-collection-id', collection.id);\n                    newBtn.textContent = collection.name;\n                    newBtn.addEventListener('click', handleCollectionOptionClick);\n                    collectionList.appendChild(newBtn);\n                }\n            });\n        });\n    }\n\n    /**\n     * Handle cook button click\n     */\n    function handleCookClick() {\n        // Navigate to play mode (to be implemented in Session B)\n        window.location.href = '/legacy/recipe/' + recipeId + '/play/';\n    }\n\n    /**\n     * Adjust servings\n     */\n    function adjustServings(delta) {\n        if (isScaling) return;\n\n        var newServings = Math.max(1, currentServings + delta);\n        if (newServings === currentServings) return;\n\n        currentServings = newServings;\n        updateServingDisplay();\n        updateServingButtons();\n\n        // If returning to original, reset scaled data\n        if (newServings === originalServings) {\n            scaledIngredients = null;\n            scaledInstructions = null;\n            scalingNotes = [];\n            adjustedTimes = null;\n            renderOriginalIngredients();\n            renderOriginalTimes();\n            return;\n        }\n\n        // Call AI API to scale ingredients\n        scaleIngredients(newServings);\n    }\n\n    /**\n     * Scale ingredients via AI API\n     */\n    function scaleIngredients(targetServings) {\n        if (!profileId) {\n            Cookie.toast.error('Profile not found');\n            return;\n        }\n\n        isScaling = true;\n        updateServingButtons();\n        updateServingDisplay();\n\n        Cookie.ajax.post('/api/ai/scale', {\n            recipe_id: recipeId,\n            target_servings: targetServings,\n            profile_id: profileId,\n            unit_system: 'metric'\n        }, function(err, response) {\n            isScaling = false;\n            updateServingButtons();\n            updateServingDisplay();\n\n            if (err) {\n                Cookie.aiError.showError(err, 'Failed to scale ingredients');\n                if (Cookie.aiError.shouldHideFeatures(err)) {\n                    // Hide AI features if unavailable\n                    Cookie.aiError.hideAIFeatures();\n                }\n                // Revert to original\n                currentServings = originalServings;\n                updateServingDisplay();\n                return;\n            }\n\n            scaledIngredients = response.ingredients;\n            scaledInstructions = response.instructions || [];\n            scalingNotes = response.notes || [];\n            adjustedTimes = {\n                prep: response.prep_time_adjusted,\n                cook: response.cook_time_adjusted,\n                total: response.total_time_adjusted\n            };\n            renderScaledIngredients();\n            renderScaledInstructions();\n            renderAdjustedTimes();\n\n            if (scalingNotes.length > 0) {\n                Cookie.toast.info(scalingNotes[0]);\n            }\n        });\n    }\n\n    /**\n     * Render original ingredients\n     */\n    function renderOriginalIngredients() {\n        // Hide scaling notes in tips tab\n        var notesContainer = document.getElementById('scaling-notes');\n        if (notesContainer) {\n            notesContainer.classList.add('hidden');\n        }\n\n        // Show original ingredients by removing scaled class\n        var ingredientItems = document.querySelectorAll('.ingredient-item');\n        for (var i = 0; i < ingredientItems.length; i++) {\n            ingredientItems[i].classList.remove('scaled');\n        }\n\n        // Show original text, hide scaled text\n        var originalTexts = document.querySelectorAll('.ingredient-text-original');\n        var scaledTexts = document.querySelectorAll('.ingredient-text-scaled');\n\n        for (var j = 0; j < originalTexts.length; j++) {\n            originalTexts[j].classList.remove('hidden');\n        }\n        for (var k = 0; k < scaledTexts.length; k++) {\n            scaledTexts[k].classList.add('hidden');\n        }\n\n        // Also reset instructions\n        renderOriginalInstructions();\n    }\n\n    /**\n     * Render original instructions (reset from scaled)\n     */\n    function renderOriginalInstructions() {\n        var instructionItems = document.querySelectorAll('.instruction-item');\n        for (var i = 0; i < instructionItems.length; i++) {\n            instructionItems[i].classList.remove('scaled');\n        }\n\n        // Show original text, hide scaled text\n        var originalTexts = document.querySelectorAll('.instruction-text-original');\n        var scaledTexts = document.querySelectorAll('.instruction-text-scaled');\n\n        for (var j = 0; j < originalTexts.length; j++) {\n            originalTexts[j].classList.remove('hidden');\n        }\n        for (var k = 0; k < scaledTexts.length; k++) {\n            scaledTexts[k].classList.add('hidden');\n        }\n\n        // Hide scaled indicator\n        var indicator = document.querySelector('.instructions-scaled-indicator');\n        if (indicator) {\n            indicator.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Render scaled instructions\n     */\n    function renderScaledInstructions() {\n        if (!scaledInstructions || scaledInstructions.length === 0) return;\n\n        var instructionItems = document.querySelectorAll('.instruction-item');\n\n        for (var i = 0; i < instructionItems.length && i < scaledInstructions.length; i++) {\n            var item = instructionItems[i];\n            var textEl = item.querySelector('.instruction-text');\n\n            if (textEl) {\n                // Store original if not already stored\n                if (!textEl.classList.contains('has-scaled')) {\n                    textEl.classList.add('has-scaled', 'instruction-text-original');\n\n                    // Create scaled text element\n                    var scaledEl = document.createElement('p');\n                    scaledEl.className = 'instruction-text instruction-text-scaled hidden';\n                    textEl.parentNode.insertBefore(scaledEl, textEl.nextSibling);\n                }\n\n                // Update scaled text\n                var scaledTextEl = item.querySelector('.instruction-text-scaled');\n                if (scaledTextEl) {\n                    scaledTextEl.textContent = scaledInstructions[i];\n                    scaledTextEl.classList.remove('hidden');\n                }\n\n                // Hide original\n                var origTextEl = item.querySelector('.instruction-text-original');\n                if (origTextEl) {\n                    origTextEl.classList.add('hidden');\n                }\n\n                item.classList.add('scaled');\n            }\n        }\n\n        // Show scaled indicator\n        var tabContent = document.getElementById('tab-instructions');\n        if (tabContent) {\n            var indicator = tabContent.querySelector('.instructions-scaled-indicator');\n            if (!indicator) {\n                indicator = document.createElement('p');\n                indicator.className = 'instructions-scaled-indicator scaled-notice';\n                indicator.textContent = 'Instructions adjusted for ' + currentServings + ' servings';\n                tabContent.insertBefore(indicator, tabContent.firstChild);\n            } else {\n                indicator.textContent = 'Instructions adjusted for ' + currentServings + ' servings';\n                indicator.classList.remove('hidden');\n            }\n        }\n    }\n\n    /**\n     * Format minutes as readable time\n     */\n    function formatTime(minutes) {\n        if (!minutes) return null;\n        if (minutes < 60) return minutes + ' min';\n        var hours = Math.floor(minutes / 60);\n        var mins = minutes % 60;\n        return mins > 0 ? hours + 'h ' + mins + 'm' : hours + 'h';\n    }\n\n    /**\n     * Render adjusted cooking times\n     */\n    function renderAdjustedTimes() {\n        if (!adjustedTimes) return;\n\n        var timeTypes = ['prep', 'cook', 'total'];\n        for (var i = 0; i < timeTypes.length; i++) {\n            var type = timeTypes[i];\n            var adjusted = adjustedTimes[type];\n            if (!adjusted) continue;\n\n            var el = document.querySelector('[data-time-type=\"' + type + '\"]');\n            if (el) {\n                var valueEl = el.querySelector('.time-value');\n                if (valueEl) {\n                    // Get original minutes from data attribute (set in template)\n                    var originalMinutesAttr = el.getAttribute('data-original-minutes');\n                    var originalMinutes = originalMinutesAttr ? parseInt(originalMinutesAttr, 10) : null;\n                    var adjustedMinutes = parseInt(adjusted, 10);\n                    var adjustedFormatted = formatTime(adjustedMinutes);\n\n                    // Only show \"(was X)\" if time actually changed\n                    // Compare integers if we have original minutes, otherwise times are equal (no attr = stale cache)\n                    var timeChanged = (originalMinutes !== null) && (adjustedMinutes !== originalMinutes);\n\n                    if (timeChanged) {\n                        var originalFormatted = formatTime(originalMinutes);\n                        valueEl.innerHTML = adjustedFormatted + ' <span class=\"time-was\">(was ' + originalFormatted + ')</span>';\n                        valueEl.classList.add('time-adjusted');\n                    } else {\n                        // Time unchanged - just show the value, no \"(was X)\"\n                        valueEl.textContent = adjustedFormatted;\n                        valueEl.classList.remove('time-adjusted');\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Render original cooking times\n     */\n    function renderOriginalTimes() {\n        var timeTypes = ['prep', 'cook', 'total'];\n        for (var i = 0; i < timeTypes.length; i++) {\n            var type = timeTypes[i];\n            var el = document.querySelector('[data-time-type=\"' + type + '\"]');\n            if (el) {\n                var valueEl = el.querySelector('.time-value');\n                if (valueEl && valueEl.getAttribute('data-original')) {\n                    valueEl.textContent = valueEl.getAttribute('data-original');\n                    valueEl.classList.remove('time-adjusted');\n                }\n            }\n        }\n    }\n\n    /**\n     * Render scaled ingredients\n     */\n    function renderScaledIngredients() {\n        if (!scaledIngredients) return;\n\n        // Get ingredient list (flat list, not groups for now)\n        var ingredientItems = document.querySelectorAll('.ingredient-item');\n\n        for (var i = 0; i < ingredientItems.length && i < scaledIngredients.length; i++) {\n            var item = ingredientItems[i];\n            var textEl = item.querySelector('.ingredient-text');\n\n            if (textEl) {\n                // Store original if not already stored\n                if (!textEl.classList.contains('has-scaled')) {\n                    var originalText = textEl.textContent;\n                    textEl.classList.add('has-scaled', 'ingredient-text-original');\n\n                    // Create scaled text element\n                    var scaledEl = document.createElement('span');\n                    scaledEl.className = 'ingredient-text-scaled hidden';\n                    textEl.parentNode.insertBefore(scaledEl, textEl.nextSibling);\n                }\n\n                // Update scaled text\n                var scaledTextEl = item.querySelector('.ingredient-text-scaled');\n                if (scaledTextEl) {\n                    scaledTextEl.textContent = scaledIngredients[i];\n                    scaledTextEl.classList.remove('hidden');\n                }\n\n                // Hide original\n                var origTextEl = item.querySelector('.ingredient-text-original');\n                if (origTextEl) {\n                    origTextEl.classList.add('hidden');\n                }\n\n                item.classList.add('scaled');\n            }\n        }\n\n        // Show scaling notes in tips tab\n        renderScalingNotes();\n    }\n\n    /**\n     * Render scaling notes in tips tab\n     */\n    function renderScalingNotes() {\n        var notesContainer = document.getElementById('scaling-notes');\n        var tabTips = document.getElementById('tab-tips');\n\n        if (!tabTips) return;\n\n        // Create or update notes container in tips tab\n        if (!notesContainer) {\n            notesContainer = document.createElement('div');\n            notesContainer.id = 'scaling-notes';\n            notesContainer.className = 'scaling-notes';\n            // Insert at the beginning of tips content\n            var tipsContent = document.getElementById('tips-content');\n            if (tipsContent) {\n                tipsContent.insertBefore(notesContainer, tipsContent.firstChild);\n            }\n        }\n\n        if (scalingNotes.length > 0) {\n            var notesHtml = '<h4 class=\"scaling-notes-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z\"></path></svg> Scaling Notes</h4><ul class=\"scaling-notes-list\">';\n            for (var j = 0; j < scalingNotes.length; j++) {\n                notesHtml += '<li>' + escapeHtml(scalingNotes[j]) + '</li>';\n            }\n            notesHtml += '</ul>';\n            notesContainer.innerHTML = notesHtml;\n            notesContainer.classList.remove('hidden');\n        } else {\n            notesContainer.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Update serving display\n     */\n    function updateServingDisplay() {\n        var valueEl = document.querySelector('.serving-value');\n        if (valueEl) {\n            if (isScaling) {\n                valueEl.textContent = '...';\n            } else {\n                valueEl.textContent = currentServings;\n            }\n        }\n\n        // Show scaled indicator\n        var adjuster = document.querySelector('.serving-adjuster');\n        if (adjuster) {\n            if (scaledIngredients && currentServings !== originalServings) {\n                if (!adjuster.querySelector('.serving-scaled-indicator')) {\n                    var indicator = document.createElement('span');\n                    indicator.className = 'serving-scaled-indicator';\n                    indicator.textContent = '(scaled from ' + originalServings + ')';\n                    adjuster.appendChild(indicator);\n                }\n            } else {\n                var existingIndicator = adjuster.querySelector('.serving-scaled-indicator');\n                if (existingIndicator) {\n                    existingIndicator.remove();\n                }\n            }\n        }\n    }\n\n    /**\n     * Update serving buttons (enable/disable)\n     */\n    function updateServingButtons() {\n        var decreaseBtn = document.querySelector('.serving-decrease');\n        var increaseBtn = document.querySelector('.serving-increase');\n\n        if (decreaseBtn) {\n            decreaseBtn.disabled = currentServings <= 1 || isScaling;\n        }\n        if (increaseBtn) {\n            increaseBtn.disabled = isScaling;\n        }\n    }\n\n    /**\n     * Handle remix button click\n     */\n    function handleRemixClick() {\n        var modal = document.getElementById('remix-modal');\n        if (modal) {\n            modal.classList.remove('hidden');\n            resetRemixModal();\n            loadRemixSuggestions();\n        }\n    }\n\n    /**\n     * Close remix modal\n     */\n    function closeRemixModal() {\n        if (isCreatingRemix) return;\n\n        var modal = document.getElementById('remix-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Reset remix modal state\n     */\n    function resetRemixModal() {\n        selectedRemixSuggestion = null;\n        remixSuggestions = [];\n        isCreatingRemix = false;\n\n        var customInput = document.getElementById('remix-custom-input');\n        if (customInput) {\n            customInput.value = '';\n        }\n\n        updateRemixCreateButton();\n    }\n\n    /**\n     * Load remix suggestions from API\n     */\n    function loadRemixSuggestions() {\n        var suggestionsContainer = document.getElementById('remix-suggestions');\n        if (!suggestionsContainer) return;\n\n        // Show loading state\n        suggestionsContainer.innerHTML = '<div class=\"remix-loading\"><div class=\"spinner\"></div><span>Generating suggestions...</span></div>';\n\n        Cookie.ajax.post('/api/ai/remix-suggestions', { recipe_id: recipeId }, function(err, response) {\n            if (err) {\n                var errorInfo = Cookie.aiError.handleError(err, 'Failed to load suggestions');\n                suggestionsContainer.innerHTML = '<p class=\"remix-error\">' + errorInfo.message + '</p>';\n                Cookie.aiError.showError(err, 'Failed to load suggestions');\n                if (Cookie.aiError.shouldHideFeatures(err)) {\n                    closeRemixModal();\n                    Cookie.aiError.hideAIFeatures();\n                }\n                return;\n            }\n\n            remixSuggestions = response.suggestions || [];\n            renderRemixSuggestions();\n        });\n    }\n\n    /**\n     * Render remix suggestions as chips\n     */\n    function renderRemixSuggestions() {\n        var suggestionsContainer = document.getElementById('remix-suggestions');\n        if (!suggestionsContainer) return;\n\n        if (remixSuggestions.length === 0) {\n            suggestionsContainer.innerHTML = '<p class=\"remix-error\">No suggestions available</p>';\n            return;\n        }\n\n        var html = '';\n        for (var i = 0; i < remixSuggestions.length; i++) {\n            var suggestion = remixSuggestions[i];\n            html += '<button type=\"button\" class=\"remix-chip\" data-suggestion=\"' + escapeHtml(suggestion) + '\">' + escapeHtml(suggestion) + '</button>';\n        }\n        suggestionsContainer.innerHTML = html;\n\n        // Add click listeners\n        var chips = suggestionsContainer.querySelectorAll('.remix-chip');\n        for (var j = 0; j < chips.length; j++) {\n            chips[j].addEventListener('click', handleRemixChipClick);\n        }\n    }\n\n    /**\n     * Handle remix chip click\n     */\n    function handleRemixChipClick(e) {\n        var chip = e.currentTarget;\n        var suggestion = chip.getAttribute('data-suggestion');\n\n        // Toggle selection\n        if (selectedRemixSuggestion === suggestion) {\n            selectedRemixSuggestion = null;\n            chip.classList.remove('active');\n        } else {\n            // Deselect previous\n            var prevActive = document.querySelector('.remix-chip.active');\n            if (prevActive) {\n                prevActive.classList.remove('active');\n            }\n\n            selectedRemixSuggestion = suggestion;\n            chip.classList.add('active');\n\n            // Clear custom input when selecting a chip\n            var customInput = document.getElementById('remix-custom-input');\n            if (customInput) {\n                customInput.value = '';\n            }\n        }\n\n        updateRemixCreateButton();\n    }\n\n    /**\n     * Handle remix custom input change\n     */\n    function handleRemixCustomInput() {\n        var customInput = document.getElementById('remix-custom-input');\n        if (customInput && customInput.value.trim()) {\n            // Deselect any chip\n            selectedRemixSuggestion = null;\n            var activeChip = document.querySelector('.remix-chip.active');\n            if (activeChip) {\n                activeChip.classList.remove('active');\n            }\n        }\n        updateRemixCreateButton();\n    }\n\n    /**\n     * Get current remix modification\n     */\n    function getRemixModification() {\n        var customInput = document.getElementById('remix-custom-input');\n        if (customInput && customInput.value.trim()) {\n            return customInput.value.trim();\n        }\n        return selectedRemixSuggestion;\n    }\n\n    /**\n     * Update remix create button state\n     */\n    function updateRemixCreateButton() {\n        var createBtn = document.getElementById('remix-create-btn');\n        if (createBtn) {\n            var modification = getRemixModification();\n            createBtn.disabled = !modification || isCreatingRemix;\n        }\n    }\n\n    /**\n     * Handle remix create button click\n     */\n    function handleRemixCreate() {\n        var modification = getRemixModification();\n        if (!modification || isCreatingRemix) return;\n\n        var modal = document.getElementById('remix-modal');\n        var profileId = modal ? parseInt(modal.getAttribute('data-profile-id'), 10) : null;\n        if (!profileId) {\n            Cookie.toast.error('Profile not found');\n            return;\n        }\n\n        isCreatingRemix = true;\n        updateRemixCreateButton();\n\n        // Update button text\n        var btnText = document.getElementById('remix-btn-text');\n        if (btnText) {\n            btnText.textContent = 'Creating Remix...';\n        }\n\n        Cookie.ajax.post('/api/ai/remix', {\n            recipe_id: recipeId,\n            modification: modification,\n            profile_id: profileId\n        }, function(err, response) {\n            isCreatingRemix = false;\n\n            if (err) {\n                updateRemixCreateButton();\n                if (btnText) {\n                    btnText.textContent = 'Create Remix';\n                }\n                Cookie.aiError.showError(err, 'Failed to create remix');\n                if (Cookie.aiError.shouldHideFeatures(err)) {\n                    closeRemixModal();\n                    Cookie.aiError.hideAIFeatures();\n                }\n                return;\n            }\n\n            Cookie.toast.success('Created \"' + response.title + '\"');\n            closeRemixModal();\n\n            // Navigate to new recipe\n            window.location.href = '/legacy/recipe/' + response.id + '/';\n        });\n    }\n\n    /**\n     * Escape HTML characters\n     */\n    function escapeHtml(text) {\n        var div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Start polling for tips (for recently imported recipes)\n     */\n    function startTipsPolling() {\n        if (tipsPollingState.isPolling) return;\n\n        tipsPollingState.isPolling = true;\n        tipsPollingState.pollStartTime = Date.now();\n\n        // Show loading state with polling message\n        var tipsContent = document.getElementById('tips-content');\n        var tipsLoading = document.getElementById('tips-loading');\n        var tipsSubtext = document.getElementById('tips-loading-subtext');\n\n        if (tipsContent) {\n            tipsContent.classList.add('hidden');\n        }\n        if (tipsLoading) {\n            tipsLoading.classList.remove('hidden');\n        }\n        if (tipsSubtext) {\n            tipsSubtext.classList.remove('hidden');\n        }\n\n        // Start polling interval\n        tipsPollingState.pollInterval = setInterval(function() {\n            var elapsed = Date.now() - tipsPollingState.pollStartTime;\n\n            // Stop if we've been polling too long\n            if (elapsed > TIPS_MAX_POLL_DURATION) {\n                stopTipsPolling(true);\n                return;\n            }\n\n            // Poll for recipe data\n            Cookie.ajax.get('/api/recipes/' + recipeId + '/', function(error, data) {\n                if (error) {\n                    // Ignore errors, will retry on next interval\n                    return;\n                }\n\n                if (data && data.ai_tips && data.ai_tips.length > 0) {\n                    // Tips are ready! Render them\n                    renderTips(data.ai_tips);\n                    stopTipsPolling(false);\n                }\n            });\n        }, TIPS_POLL_INTERVAL);\n    }\n\n    /**\n     * Stop polling for tips\n     */\n    function stopTipsPolling(showEmptyState) {\n        if (tipsPollingState.pollInterval) {\n            clearInterval(tipsPollingState.pollInterval);\n            tipsPollingState.pollInterval = null;\n        }\n        tipsPollingState.isPolling = false;\n\n        var tipsLoading = document.getElementById('tips-loading');\n        var tipsSubtext = document.getElementById('tips-loading-subtext');\n\n        if (tipsLoading) {\n            tipsLoading.classList.add('hidden');\n        }\n        if (tipsSubtext) {\n            tipsSubtext.classList.add('hidden');\n        }\n\n        // If timed out, show the empty state\n        if (showEmptyState) {\n            var tipsContent = document.getElementById('tips-content');\n            if (tipsContent) {\n                tipsContent.classList.remove('hidden');\n            }\n        }\n    }\n\n    /**\n     * Handle generate/regenerate tips button click\n     */\n    function handleGenerateTips(regenerate) {\n        if (isGeneratingTips) return;\n\n        isGeneratingTips = true;\n\n        // Show loading state\n        var tipsContent = document.getElementById('tips-content');\n        var tipsLoading = document.getElementById('tips-loading');\n\n        if (tipsContent) {\n            tipsContent.classList.add('hidden');\n        }\n        if (tipsLoading) {\n            tipsLoading.classList.remove('hidden');\n        }\n\n        Cookie.ajax.post('/api/ai/tips', {\n            recipe_id: recipeId,\n            regenerate: regenerate || false\n        }, function(err, response) {\n            isGeneratingTips = false;\n\n            if (err) {\n                // Show content again on error\n                if (tipsContent) {\n                    tipsContent.classList.remove('hidden');\n                }\n                if (tipsLoading) {\n                    tipsLoading.classList.add('hidden');\n                }\n                Cookie.aiError.showError(err, 'Failed to generate tips');\n                if (Cookie.aiError.shouldHideFeatures(err)) {\n                    Cookie.aiError.hideAIFeatures();\n                }\n                return;\n            }\n\n            // Render tips\n            renderTips(response.tips);\n\n            Cookie.toast.success(regenerate ? 'Tips regenerated!' : 'Tips generated!');\n        });\n    }\n\n    /**\n     * Render tips list\n     */\n    function renderTips(tips) {\n        var tipsContent = document.getElementById('tips-content');\n        var tipsLoading = document.getElementById('tips-loading');\n\n        if (tipsLoading) {\n            tipsLoading.classList.add('hidden');\n        }\n\n        if (!tipsContent) return;\n\n        if (!tips || tips.length === 0) {\n            tipsContent.innerHTML = '<p class=\"empty-text\">No tips available for this recipe.</p>';\n            tipsContent.classList.remove('hidden');\n            return;\n        }\n\n        var html = '<ol class=\"tips-list\">';\n        for (var i = 0; i < tips.length; i++) {\n            html += '<li class=\"tip-item\">';\n            html += '<span class=\"tip-number\">' + (i + 1) + '</span>';\n            html += '<p class=\"tip-text\">' + escapeHtml(tips[i]) + '</p>';\n            html += '</li>';\n        }\n        html += '</ol>';\n\n        // Add regenerate button\n        html += '<div class=\"tips-regenerate\">';\n        html += '<button type=\"button\" id=\"regenerate-tips-btn\" class=\"btn btn-secondary\">Regenerate Tips</button>';\n        html += '</div>';\n\n        tipsContent.innerHTML = html;\n        tipsContent.classList.remove('hidden');\n\n        // Re-bind regenerate button event listener\n        var regenerateBtn = document.getElementById('regenerate-tips-btn');\n        if (regenerateBtn) {\n            regenerateBtn.addEventListener('click', function() {\n                handleGenerateTips(true);\n            });\n        }\n    }\n\n    return {\n        init: init\n    };\n})();\n\n// Auto-init on page load\n(function() {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', Cookie.pages.detail.init);\n    } else {\n        Cookie.pages.detail.init();\n    }\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/favorites.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/home.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/play.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/profile-selector.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/search.js","messages":[{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":280,"column":22,"nodeType":"Identifier","messageId":"redeclared","endLine":280,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Search page (ES5, iOS 9 compatible)\n */\nvar Cookie = Cookie || {};\nCookie.pages = Cookie.pages || {};\n\nCookie.pages.search = (function() {\n    'use strict';\n\n    // State\n    var state = {\n        query: '',\n        isUrl: false,\n        results: [],\n        sites: {},\n        total: 0,\n        page: 1,\n        hasMore: false,\n        selectedSource: null,\n        loading: false,\n        importing: null\n    };\n\n    // Image polling state (progressive loading)\n    var imagePollingState = {\n        isPolling: false,\n        pendingUrls: {},  // Map of recipe_url -> {image_url, needs_cache}\n        pollInterval: null,\n        pollStartTime: null,\n        currentQuery: null,\n        loadedPages: []  // Track all pages that have been loaded\n    };\n\n    // DOM elements\n    var elements = {\n        loading: null,\n        resultsGrid: null,\n        emptyState: null,\n        pagination: null,\n        endOfResults: null,\n        loadMoreBtn: null,\n        sourceFilters: null,\n        searchCount: null,\n        importUrlBtn: null,\n        urlImportCard: null\n    };\n\n    /**\n     * Initialize the page\n     */\n    function init() {\n        // Get state from window\n        state.query = window.searchQuery || '';\n        state.isUrl = window.isUrlSearch || false;\n\n        // Get DOM elements\n        elements.loading = document.getElementById('loading');\n        elements.resultsGrid = document.getElementById('results-grid');\n        elements.emptyState = document.getElementById('empty-state');\n        elements.pagination = document.getElementById('pagination');\n        elements.endOfResults = document.getElementById('end-of-results');\n        elements.loadMoreBtn = document.getElementById('load-more-btn');\n        elements.sourceFilters = document.getElementById('source-filters');\n        elements.searchCount = document.getElementById('search-count');\n        elements.importUrlBtn = document.getElementById('import-url-btn');\n        elements.urlImportCard = document.getElementById('url-import-card');\n\n        setupEventListeners();\n\n        // Start search if not a URL\n        if (!state.isUrl && state.query) {\n            searchRecipes(1, true);\n        } else if (state.isUrl) {\n            hideElement(elements.loading);\n        }\n    }\n\n    /**\n     * Setup event listeners\n     */\n    function setupEventListeners() {\n        // Back button\n        var backBtn = document.getElementById('back-btn');\n        if (backBtn) {\n            backBtn.addEventListener('click', function() {\n                window.location.href = '/legacy/home/';\n            });\n        }\n\n        // Load more button\n        if (elements.loadMoreBtn) {\n            elements.loadMoreBtn.addEventListener('click', function() {\n                if (!state.loading && state.hasMore) {\n                    searchRecipes(state.page + 1, false);\n                }\n            });\n        }\n\n        // URL import button\n        if (elements.importUrlBtn) {\n            elements.importUrlBtn.addEventListener('click', function() {\n                var url = this.getAttribute('data-url');\n                if (url) {\n                    importRecipe(url, this);\n                }\n            });\n        }\n\n        // Delegate import button clicks in results\n        if (elements.resultsGrid) {\n            elements.resultsGrid.addEventListener('click', function(e) {\n                var btn = e.target.closest('.btn-import');\n                if (btn && !btn.disabled) {\n                    var url = btn.getAttribute('data-url');\n                    if (url) {\n                        importRecipe(url, btn);\n                    }\n                }\n            });\n        }\n    }\n\n    /**\n     * Search for recipes\n     */\n    function searchRecipes(page, reset) {\n        if (state.loading) return;\n\n        state.loading = true;\n        state.page = page;\n\n        if (reset) {\n            state.results = [];\n            state.sites = {};\n            showElement(elements.loading);\n            hideElement(elements.resultsGrid);\n            hideElement(elements.emptyState);\n            hideElement(elements.pagination);\n            hideElement(elements.endOfResults);\n        } else {\n            // Show loading state on button\n            if (elements.loadMoreBtn) {\n                elements.loadMoreBtn.textContent = 'Loading...';\n                elements.loadMoreBtn.disabled = true;\n            }\n        }\n\n        // Build URL\n        var url = '/api/recipes/search/?q=' + encodeURIComponent(state.query);\n        url += '&page=' + page;\n        if (state.selectedSource) {\n            url += '&sources=' + encodeURIComponent(state.selectedSource);\n        }\n\n        Cookie.ajax.get(url, function(error, response) {\n            state.loading = false;\n\n            if (error) {\n                hideElement(elements.loading);\n                Cookie.toast.error('Search failed. Please try again.');\n                return;\n            }\n\n            var previousCount = state.results.length;\n\n            if (reset) {\n                // Stop previous polling\n                stopImagePolling();\n                imagePollingState.pendingUrls = {};\n                imagePollingState.loadedPages = [];\n\n                state.results = response.results;\n                state.sites = response.sites;\n                renderSourceFilters();\n            } else {\n                // Append results\n                state.results = state.results.concat(response.results);\n            }\n\n            state.total = response.total;\n            state.hasMore = response.has_more;\n\n            renderResults(reset, previousCount);\n            updateSearchCount();\n\n            // Start image polling for uncached images\n            startImagePolling(response.results, state.query, page);\n        });\n    }\n\n    /**\n     * Render source filter chips\n     */\n    function renderSourceFilters() {\n        if (!elements.sourceFilters) return;\n\n        var sites = state.sites;\n        var sortedSites = Object.keys(sites).sort(function(a, b) {\n            return sites[b] - sites[a];\n        });\n\n        if (sortedSites.length === 0) {\n            elements.sourceFilters.innerHTML = '';\n            return;\n        }\n\n        // Calculate total\n        var total = 0;\n        for (var key in sites) {\n            if (sites.hasOwnProperty(key)) {\n                total += sites[key];\n            }\n        }\n\n        var html = '';\n\n        // All sources chip\n        var allActive = state.selectedSource === null ? ' active' : '';\n        html += '<button type=\"button\" class=\"chip' + allActive + '\" data-source=\"\">';\n        html += 'All Sources (' + total + ')';\n        html += '</button>';\n\n        // Individual source chips\n        for (var i = 0; i < sortedSites.length; i++) {\n            var site = sortedSites[i];\n            var count = sites[site];\n            var isActive = state.selectedSource === site ? ' active' : '';\n            html += '<button type=\"button\" class=\"chip' + isActive + '\" data-source=\"' + escapeHtml(site) + '\">';\n            html += escapeHtml(site) + ' (' + count + ')';\n            html += '</button>';\n        }\n\n        elements.sourceFilters.innerHTML = html;\n\n        // Add click handlers\n        var chips = elements.sourceFilters.querySelectorAll('.chip');\n        for (var j = 0; j < chips.length; j++) {\n            chips[j].addEventListener('click', handleSourceClick);\n        }\n    }\n\n    /**\n     * Handle source filter click\n     */\n    function handleSourceClick(e) {\n        var source = e.target.getAttribute('data-source');\n        state.selectedSource = source || null;\n\n        // Re-search with filter\n        searchRecipes(1, true);\n    }\n\n    /**\n     * Render search results\n     */\n    function renderResults(reset, previousCount) {\n        hideElement(elements.loading);\n\n        if (state.results.length === 0) {\n            hideElement(elements.resultsGrid);\n            showElement(elements.emptyState);\n            hideElement(elements.pagination);\n            hideElement(elements.endOfResults);\n            return;\n        }\n\n        hideElement(elements.emptyState);\n        showElement(elements.resultsGrid);\n\n        // Render cards\n        var html = '';\n        if (reset) {\n            // Render all results\n            for (var i = 0; i < state.results.length; i++) {\n                html += renderSearchResultCard(state.results[i]);\n            }\n            elements.resultsGrid.innerHTML = html;\n        } else {\n            // Only render NEW results (from previousCount onwards)\n            for (var i = previousCount; i < state.results.length; i++) {\n                html += renderSearchResultCard(state.results[i]);\n            }\n            elements.resultsGrid.innerHTML += html;\n        }\n\n        // Update pagination\n        if (state.hasMore) {\n            showElement(elements.pagination);\n            hideElement(elements.endOfResults);\n            if (elements.loadMoreBtn) {\n                elements.loadMoreBtn.textContent = 'Load More';\n                elements.loadMoreBtn.disabled = false;\n            }\n        } else {\n            hideElement(elements.pagination);\n            showElement(elements.endOfResults);\n        }\n    }\n\n    /**\n     * Render a single search result card\n     */\n    function renderSearchResultCard(result) {\n        var imageHtml = '';\n        // Prefer cached image, fallback to external URL\n        var imageUrl = result.cached_image_url || result.image_url;\n        if (imageUrl) {\n            imageHtml = '<img src=\"' + escapeHtml(imageUrl) + '\" alt=\"' + escapeHtml(result.title) + '\" loading=\"lazy\">';\n        } else {\n            imageHtml = '<div class=\"search-result-no-image\"><span>No image</span></div>';\n        }\n\n        var descriptionHtml = '';\n        if (result.description) {\n            descriptionHtml = '<p class=\"search-result-description\">' + escapeHtml(truncate(result.description, 100)) + '</p>';\n        }\n\n        // Build host line with optional rating count\n        var hostHtml = escapeHtml(result.host);\n        if (result.rating_count) {\n            hostHtml += '  ' + formatNumber(result.rating_count) + ' Ratings';\n        }\n\n        return '<div class=\"search-result-card\" data-url=\"' + escapeHtml(result.url) + '\">' +\n            '<div class=\"search-result-image\">' + imageHtml + '</div>' +\n            '<div class=\"search-result-content\">' +\n                '<h3 class=\"search-result-title\">' + escapeHtml(result.title) + '</h3>' +\n                '<p class=\"search-result-host\">' + hostHtml + '</p>' +\n                descriptionHtml +\n                '<button type=\"button\" class=\"btn-import\" data-url=\"' + escapeHtml(result.url) + '\">Import</button>' +\n            '</div>' +\n        '</div>';\n    }\n\n    /**\n     * Update search count display\n     */\n    function updateSearchCount() {\n        if (!elements.searchCount) return;\n\n        if (state.total === 0) {\n            elements.searchCount.textContent = '';\n        } else if (state.total === 1) {\n            elements.searchCount.textContent = '1 result found';\n        } else {\n            elements.searchCount.textContent = state.total + ' results found';\n        }\n    }\n\n    /**\n     * Import a recipe from URL\n     */\n    function importRecipe(url, button) {\n        if (state.importing) return;\n\n        state.importing = url;\n\n        // Update button state\n        var originalText = button.textContent;\n        button.textContent = 'Importing...';\n        button.disabled = true;\n\n        Cookie.ajax.post('/api/recipes/scrape/', { url: url }, function(error, response) {\n            state.importing = null;\n\n            if (error) {\n                button.textContent = originalText;\n                button.disabled = false;\n                Cookie.toast.error(error.message || 'Failed to import recipe');\n                return;\n            }\n\n            // Success - show toast and redirect to recipe detail\n            Cookie.toast.success('Recipe imported!');\n\n            // Redirect to recipe detail page\n            // The detail page will record the view in history\n            setTimeout(function() {\n                window.location.href = '/legacy/recipe/' + response.id + '/';\n            }, 1000);\n        });\n    }\n\n    /**\n     * Helper: Escape HTML\n     */\n    function escapeHtml(str) {\n        if (!str) return '';\n        var div = document.createElement('div');\n        div.textContent = str;\n        return div.innerHTML;\n    }\n\n    /**\n     * Helper: Truncate string\n     */\n    function truncate(str, length) {\n        if (!str) return '';\n        if (str.length <= length) return str;\n        return str.substring(0, length) + '...';\n    }\n\n    /**\n     * Helper: Format number with commas (ES5 compatible)\n     */\n    function formatNumber(num) {\n        if (!num) return '';\n        return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n    }\n\n    /**\n     * Helper: Show element\n     */\n    function showElement(el) {\n        if (el) {\n            el.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Helper: Hide element\n     */\n    function hideElement(el) {\n        if (el) {\n            el.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Helper: Escape CSS selector\n     * Escapes special characters for use in CSS attribute selectors\n     */\n    function escapeSelector(str) {\n        if (!str) return '';\n        // Escape all special CSS characters: !\"#$%&'()*+,./:;<=>?@[\\]^`{|}~\n        // Keep alphanumeric, hyphen, and underscore unescaped\n        return str.replace(/([!\"#$%&'()*+,.\\/:;<=>?@\\[\\\\\\]^`{|}~])/g, '\\\\$1');\n    }\n\n    /**\n     * Start image polling for progressive loading\n     */\n    function startImagePolling(results, query, page) {\n        // Track which images need caching\n        for (var i = 0; i < results.length; i++) {\n            var result = results[i];\n            if (result.image_url && !result.cached_image_url) {\n                imagePollingState.pendingUrls[result.url] = {\n                    imageUrl: result.image_url,\n                    needsCache: true\n                };\n\n                // Show loading spinner on image placeholder\n                showImageLoadingSpinner(result.url);\n            }\n        }\n\n        // Add page to loaded pages if not already tracked\n        if (imagePollingState.loadedPages.indexOf(page) === -1) {\n            imagePollingState.loadedPages.push(page);\n        }\n\n        // Start polling if not already running\n        var hasPending = Object.keys(imagePollingState.pendingUrls).length > 0;\n        if (!imagePollingState.isPolling && hasPending) {\n            imagePollingState.isPolling = true;\n            imagePollingState.pollStartTime = Date.now();\n            imagePollingState.currentQuery = query;\n\n            pollForCachedImages();\n        }\n        // If polling already running, extend the duration for new images\n        else if (imagePollingState.isPolling && hasPending) {\n            // Reset timer to give new images time to cache\n            imagePollingState.pollStartTime = Date.now();\n        }\n    }\n\n    /**\n     * Poll for cached images\n     */\n    function pollForCachedImages() {\n        var MAX_POLL_DURATION = 20000; // 20 seconds\n        var POLL_INTERVAL = 4000; // 4 seconds\n\n        imagePollingState.pollInterval = setInterval(function() {\n            var elapsed = Date.now() - imagePollingState.pollStartTime;\n            var hasPendingImages = Object.keys(imagePollingState.pendingUrls).length > 0;\n\n            // Stop conditions\n            if (elapsed > MAX_POLL_DURATION || !hasPendingImages) {\n                stopImagePolling();\n                return;\n            }\n\n            // Poll ALL loaded pages to detect cached images\n            for (var i = 0; i < imagePollingState.loadedPages.length; i++) {\n                var page = imagePollingState.loadedPages[i];\n                var url = '/api/recipes/search/?q=' + encodeURIComponent(imagePollingState.currentQuery);\n                url += '&page=' + page;\n                if (state.selectedSource) {\n                    url += '&sources=' + encodeURIComponent(state.selectedSource);\n                }\n\n                Cookie.ajax.get(url, function(error, response) {\n                    if (!error && response && response.results) {\n                        updateCachedImages(response.results);\n                    }\n                });\n            }\n        }, POLL_INTERVAL);\n    }\n\n    /**\n     * Update cached images in displayed results\n     */\n    function updateCachedImages(results) {\n        for (var i = 0; i < results.length; i++) {\n            var result = results[i];\n\n            // Early exit if URL not pending (optimization: skip DOM query)\n            if (!imagePollingState.pendingUrls[result.url]) {\n                continue;\n            }\n\n            // Check if this result has a pending image that's now cached\n            if (result.cached_image_url) {\n                var card = document.querySelector('[data-url=\"' + escapeSelector(result.url) + '\"]');\n                if (card) {\n                    var imgContainer = card.querySelector('.search-result-image');\n                    if (imgContainer) {\n                        // Replace loading spinner with actual image\n                        imgContainer.innerHTML = '<img src=\"' + escapeHtml(result.cached_image_url) +\n                                                '\" alt=\"' + escapeHtml(result.title) + '\" loading=\"lazy\">';\n                    }\n                }\n\n                // Remove from pending list\n                delete imagePollingState.pendingUrls[result.url];\n            }\n        }\n\n        // Stop polling immediately if all images cached (optimization: no waiting for next interval)\n        if (Object.keys(imagePollingState.pendingUrls).length === 0) {\n            stopImagePolling();\n        }\n    }\n\n    /**\n     * Stop image polling\n     */\n    function stopImagePolling() {\n        if (imagePollingState.pollInterval) {\n            clearInterval(imagePollingState.pollInterval);\n            imagePollingState.pollInterval = null;\n            imagePollingState.isPolling = false;\n\n            // Hide any remaining loading spinners\n            hideAllLoadingSpinners();\n        }\n    }\n\n    /**\n     * Show loading spinner for image\n     */\n    function showImageLoadingSpinner(recipeUrl) {\n        var card = document.querySelector('[data-url=\"' + escapeSelector(recipeUrl) + '\"]');\n        if (card) {\n            var imgContainer = card.querySelector('.search-result-image');\n            if (imgContainer) {\n                var existingImg = imgContainer.querySelector('img');\n                // Show spinner if no img exists, OR if img is using external URL (not cached)\n                if (!existingImg || (existingImg && !existingImg.src.includes('/media/search_images/'))) {\n                    imgContainer.innerHTML = '<div class=\"image-loading-spinner\"></div>';\n                }\n            }\n        }\n    }\n\n    /**\n     * Hide all loading spinners\n     */\n    function hideAllLoadingSpinners() {\n        var spinners = document.querySelectorAll('.image-loading-spinner');\n        for (var i = 0; i < spinners.length; i++) {\n            // Replace with \"No image\" placeholder\n            spinners[i].parentElement.innerHTML = '<div class=\"search-result-no-image\"><span>No image</span></div>';\n        }\n    }\n\n    return {\n        init: init\n    };\n})();\n\n// Auto-init on page load\n(function() {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', Cookie.pages.search.init);\n    } else {\n        Cookie.pages.search.init();\n    }\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/pages/settings.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'resetPreview' is assigned a value but never used.","line":59,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":21},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'setupPromptCard' has too many lines (129). Maximum allowed is 100.","line":267,"column":5,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":395,"endColumn":6},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":471,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":471,"endColumn":19},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":596,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":596,"endColumn":19},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":601,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":601,"endColumn":19},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":606,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":606,"endColumn":19},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":611,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":611,"endColumn":19},{"ruleId":"no-redeclare","severity":1,"message":"'i' is already defined.","line":847,"column":18,"nodeType":"Identifier","messageId":"redeclared","endLine":847,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Settings page (ES5, iOS 9 compatible)\n */\nvar Cookie = Cookie || {};\nCookie.pages = Cookie.pages || {};\n\nCookie.pages.settings = (function() {\n    'use strict';\n\n    // DOM Elements - General tab\n    var apiKeyInput;\n    var testKeyBtn;\n    var saveKeyBtn;\n    var testKeyText;\n    var saveKeyText;\n\n    // DOM Elements - Tabs\n    var tabBtns;\n    var tabGeneral;\n    var tabPrompts;\n    var tabSources;\n    var tabSelectors;\n\n    // DOM Elements - Sources tab\n    var sourcesCounter;\n    var sourcesList;\n    var enableAllBtn;\n    var disableAllBtn;\n\n    // DOM Elements - Selectors tab\n    var selectorsList;\n    var testAllBtn;\n    var testAllText;\n\n    // DOM Elements - Users tab\n    var tabUsers;\n    var profilesList;\n    var profileCount;\n    var deleteModal;\n    var deleteProfileInfo;\n    var deleteDataSummary;\n    var confirmDeleteBtn;\n    var deleteBtnText;\n\n    // DOM Elements - Danger Zone tab\n    var tabDanger;\n    var resetModalStep1;\n    var resetModalStep2;\n    var resetDataSummary;\n    var resetConfirmInput;\n    var confirmResetBtn;\n    var resetBtnText;\n\n    // Data\n    var sources = [];\n    var profiles = [];\n    var currentProfileId = null;\n    var pendingDeleteId = null;\n    var resetPreview = null;\n\n    /**\n     * Initialize the page\n     */\n    function init() {\n        // General tab elements\n        apiKeyInput = document.getElementById('api-key-input');\n        testKeyBtn = document.getElementById('test-key-btn');\n        saveKeyBtn = document.getElementById('save-key-btn');\n        testKeyText = document.getElementById('test-key-text');\n        saveKeyText = document.getElementById('save-key-text');\n\n        // Tab elements\n        tabBtns = document.querySelectorAll('.tab-toggle-btn');\n        tabGeneral = document.getElementById('tab-general');\n        tabPrompts = document.getElementById('tab-prompts');\n        tabSources = document.getElementById('tab-sources');\n        tabSelectors = document.getElementById('tab-selectors');\n\n        // Sources tab elements\n        sourcesCounter = document.getElementById('sources-counter');\n        sourcesList = document.getElementById('sources-list');\n        enableAllBtn = document.getElementById('enable-all-btn');\n        disableAllBtn = document.getElementById('disable-all-btn');\n\n        // Selectors tab elements\n        selectorsList = document.getElementById('selectors-list');\n        testAllBtn = document.getElementById('test-all-btn');\n        testAllText = document.getElementById('test-all-text');\n\n        // Users tab elements\n        tabUsers = document.getElementById('tab-users');\n        profilesList = document.getElementById('profiles-list');\n        profileCount = document.getElementById('profile-count');\n        deleteModal = document.getElementById('delete-profile-modal');\n        deleteProfileInfo = document.getElementById('delete-profile-info');\n        deleteDataSummary = document.getElementById('delete-data-summary');\n        confirmDeleteBtn = document.getElementById('confirm-delete-btn');\n        deleteBtnText = document.getElementById('delete-btn-text');\n\n        // Danger Zone tab elements\n        tabDanger = document.getElementById('tab-danger');\n        resetModalStep1 = document.getElementById('reset-modal-step1');\n        resetModalStep2 = document.getElementById('reset-modal-step2');\n        resetDataSummary = document.getElementById('reset-data-summary');\n        resetConfirmInput = document.getElementById('reset-confirm-input');\n        confirmResetBtn = document.getElementById('confirm-reset-btn');\n        resetBtnText = document.getElementById('reset-btn-text');\n\n        // Get current profile ID from session (passed via data attribute)\n        var pageElement = document.querySelector('[data-page=\"settings\"]');\n        if (pageElement && pageElement.getAttribute('data-profile-id')) {\n            currentProfileId = parseInt(pageElement.getAttribute('data-profile-id'), 10);\n        }\n\n        setupTabSwitching();\n        setupApiKeyHandlers();\n        setupPromptCards();\n        setupSourcesTab();\n        setupSelectorsTab();\n        setupDangerZoneTab();\n\n        // Load sources data\n        loadSources();\n    }\n\n    /**\n     * Setup tab switching\n     */\n    function setupTabSwitching() {\n        for (var i = 0; i < tabBtns.length; i++) {\n            tabBtns[i].addEventListener('click', handleTabClick);\n        }\n    }\n\n    /**\n     * Handle tab click\n     */\n    function handleTabClick(e) {\n        var btn = e.currentTarget;\n        var tab = btn.getAttribute('data-tab');\n\n        // Update active tab button\n        for (var i = 0; i < tabBtns.length; i++) {\n            tabBtns[i].classList.remove('active');\n        }\n        btn.classList.add('active');\n\n        // Hide all tabs\n        tabGeneral.classList.add('hidden');\n        tabPrompts.classList.add('hidden');\n        tabSources.classList.add('hidden');\n        tabSelectors.classList.add('hidden');\n        tabUsers.classList.add('hidden');\n        tabDanger.classList.add('hidden');\n\n        // Show selected tab\n        if (tab === 'general') {\n            tabGeneral.classList.remove('hidden');\n        } else if (tab === 'prompts') {\n            tabPrompts.classList.remove('hidden');\n        } else if (tab === 'sources') {\n            tabSources.classList.remove('hidden');\n        } else if (tab === 'selectors') {\n            tabSelectors.classList.remove('hidden');\n        } else if (tab === 'users') {\n            tabUsers.classList.remove('hidden');\n            // Load profiles when users tab is shown\n            if (profiles.length === 0) {\n                loadProfiles();\n            }\n        } else if (tab === 'danger') {\n            tabDanger.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Setup API key handlers\n     */\n    function setupApiKeyHandlers() {\n        apiKeyInput.addEventListener('input', updateApiKeyButtons);\n        testKeyBtn.addEventListener('click', handleTestKey);\n        saveKeyBtn.addEventListener('click', handleSaveKey);\n    }\n\n    /**\n     * Enable/disable API key buttons based on input\n     */\n    function updateApiKeyButtons() {\n        var hasValue = apiKeyInput.value.trim().length > 0;\n        testKeyBtn.disabled = !hasValue;\n        saveKeyBtn.disabled = !hasValue;\n    }\n\n    /**\n     * Handle test API key button click\n     */\n    function handleTestKey() {\n        var apiKey = apiKeyInput.value.trim();\n        if (!apiKey) return;\n\n        testKeyBtn.disabled = true;\n        testKeyText.textContent = 'Testing...';\n\n        Cookie.ajax.post('/api/ai/test-api-key', { api_key: apiKey }, function(err, result) {\n            testKeyBtn.disabled = false;\n            testKeyText.textContent = 'Test Key';\n\n            if (err) {\n                Cookie.toast.error('Failed to test API key');\n                return;\n            }\n\n            if (result.success) {\n                Cookie.toast.success(result.message);\n            } else {\n                Cookie.toast.error(result.message);\n            }\n        });\n    }\n\n    /**\n     * Handle save API key button click\n     */\n    function handleSaveKey() {\n        var apiKey = apiKeyInput.value.trim();\n        if (!apiKey) return;\n\n        saveKeyBtn.disabled = true;\n        saveKeyText.textContent = 'Saving...';\n\n        Cookie.ajax.post('/api/ai/save-api-key', { api_key: apiKey }, function(err, result) {\n            saveKeyBtn.disabled = false;\n            saveKeyText.textContent = 'Save Key';\n\n            if (err) {\n                Cookie.toast.error('Failed to save API key');\n                return;\n            }\n\n            if (result.success) {\n                Cookie.toast.success(result.message);\n                apiKeyInput.value = '';\n                // Reload page to update status\n                setTimeout(function() {\n                    window.location.reload();\n                }, 1000);\n            } else {\n                Cookie.toast.error(result.message);\n            }\n        });\n    }\n\n    /**\n     * Setup prompt card handlers\n     */\n    function setupPromptCards() {\n        var promptCards = document.querySelectorAll('.prompt-card');\n\n        for (var i = 0; i < promptCards.length; i++) {\n            setupPromptCard(promptCards[i]);\n        }\n    }\n\n    /**\n     * Setup a single prompt card\n     */\n    function setupPromptCard(card) {\n        var promptType = card.getAttribute('data-prompt-type');\n        var content = card.querySelector('.prompt-content');\n        var editForm = card.querySelector('.prompt-edit-form');\n        var expandBtn = card.querySelector('[data-action=\"toggle-expand\"]');\n        var editBtn = card.querySelector('[data-action=\"edit\"]');\n        var cancelBtn = card.querySelector('[data-action=\"cancel\"]');\n        var saveBtn = card.querySelector('[data-action=\"save\"]');\n        var iconExpand = card.querySelector('.icon-expand');\n        var iconCollapse = card.querySelector('.icon-collapse');\n        var statusBtn = card.querySelector('.btn-status');\n\n        var isExpanded = false;\n        var isEditing = false;\n\n        // Toggle expand\n        expandBtn.addEventListener('click', function() {\n            if (isEditing) return;\n\n            isExpanded = !isExpanded;\n            if (isExpanded) {\n                content.classList.remove('hidden');\n                iconExpand.classList.add('hidden');\n                iconCollapse.classList.remove('hidden');\n            } else {\n                content.classList.add('hidden');\n                iconExpand.classList.remove('hidden');\n                iconCollapse.classList.add('hidden');\n            }\n        });\n\n        // Edit button\n        editBtn.addEventListener('click', function() {\n            isEditing = true;\n            content.classList.add('hidden');\n            editForm.classList.remove('hidden');\n            expandBtn.classList.add('hidden');\n            editBtn.classList.add('hidden');\n        });\n\n        // Cancel edit\n        cancelBtn.addEventListener('click', function() {\n            isEditing = false;\n            editForm.classList.add('hidden');\n            expandBtn.classList.remove('hidden');\n            editBtn.classList.remove('hidden');\n            if (isExpanded) {\n                content.classList.remove('hidden');\n            }\n        });\n\n        // Status toggle\n        statusBtn.addEventListener('click', function() {\n            var currentValue = statusBtn.getAttribute('data-value') === 'true';\n            var newValue = !currentValue;\n\n            statusBtn.setAttribute('data-value', newValue ? 'true' : 'false');\n            statusBtn.textContent = newValue ? 'Active' : 'Disabled';\n\n            if (newValue) {\n                statusBtn.classList.remove('btn-status-disabled');\n                statusBtn.classList.add('btn-status-active');\n            } else {\n                statusBtn.classList.remove('btn-status-active');\n                statusBtn.classList.add('btn-status-disabled');\n            }\n        });\n\n        // Save prompt\n        saveBtn.addEventListener('click', function() {\n            var systemPrompt = card.querySelector('[data-field=\"system_prompt\"]').value;\n            var userPromptTemplate = card.querySelector('[data-field=\"user_prompt_template\"]').value;\n            var model = card.querySelector('[data-field=\"model\"]').value;\n            var isActive = statusBtn.getAttribute('data-value') === 'true';\n\n            var saveBtnText = saveBtn.querySelector('.save-btn-text');\n            saveBtn.disabled = true;\n            saveBtnText.textContent = 'Saving...';\n\n            Cookie.ajax.put('/api/ai/prompts/' + promptType, {\n                system_prompt: systemPrompt,\n                user_prompt_template: userPromptTemplate,\n                model: model,\n                is_active: isActive\n            }, function(err, result) {\n                saveBtn.disabled = false;\n                saveBtnText.textContent = 'Save Changes';\n\n                if (err) {\n                    Cookie.toast.error('Failed to save prompt');\n                    return;\n                }\n\n                Cookie.toast.success('Prompt saved successfully');\n\n                // Update the read-only view\n                var promptTexts = content.querySelectorAll('.prompt-text');\n                if (promptTexts[0]) promptTexts[0].textContent = systemPrompt;\n                if (promptTexts[1]) promptTexts[1].textContent = userPromptTemplate;\n\n                // Update the model badge\n                var modelBadge = card.querySelector('.model-badge');\n                if (modelBadge) modelBadge.textContent = model;\n\n                // Update the disabled badge\n                var promptName = card.querySelector('.prompt-name');\n                var disabledBadge = card.querySelector('.prompt-disabled-badge');\n                if (isActive) {\n                    if (disabledBadge) disabledBadge.remove();\n                } else {\n                    if (!disabledBadge) {\n                        var badge = document.createElement('span');\n                        badge.className = 'prompt-disabled-badge';\n                        badge.textContent = 'Disabled';\n                        promptName.appendChild(badge);\n                    }\n                }\n\n                // Close edit form\n                isEditing = false;\n                editForm.classList.add('hidden');\n                expandBtn.classList.remove('hidden');\n                editBtn.classList.remove('hidden');\n                if (isExpanded) {\n                    content.classList.remove('hidden');\n                }\n            });\n        });\n    }\n\n    /**\n     * Setup sources tab handlers\n     */\n    function setupSourcesTab() {\n        enableAllBtn.addEventListener('click', function() {\n            bulkToggleSources(true);\n        });\n\n        disableAllBtn.addEventListener('click', function() {\n            bulkToggleSources(false);\n        });\n    }\n\n    /**\n     * Load sources from API\n     */\n    function loadSources() {\n        Cookie.ajax.get('/api/sources/', function(err, result) {\n            if (err) {\n                sourcesList.innerHTML = '<div class=\"error-placeholder\">Failed to load sources</div>';\n                selectorsList.innerHTML = '<div class=\"error-placeholder\">Failed to load sources</div>';\n                return;\n            }\n\n            sources = result;\n            renderSources();\n            renderSelectors();\n            updateSourcesCounter();\n        });\n    }\n\n    /**\n     * Update sources counter\n     */\n    function updateSourcesCounter() {\n        var enabled = 0;\n        for (var i = 0; i < sources.length; i++) {\n            if (sources[i].is_enabled) enabled++;\n        }\n        sourcesCounter.textContent = enabled + ' of ' + sources.length + ' sources currently enabled';\n    }\n\n    /**\n     * Render sources list\n     */\n    function renderSources() {\n        var html = '';\n\n        for (var i = 0; i < sources.length; i++) {\n            var source = sources[i];\n            var enabledClass = source.is_enabled ? 'source-enabled' : 'source-disabled';\n            var activeBadge = source.is_enabled ? '<span class=\"source-active-badge\">Active</span>' : '';\n            var toggleIcon = source.is_enabled\n                ? '<svg class=\"toggle-icon toggle-on\" xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><rect x=\"1\" y=\"5\" width=\"22\" height=\"14\" rx=\"7\" ry=\"7\"></rect><circle cx=\"16\" cy=\"12\" r=\"4\" fill=\"var(--background)\"></circle></svg>'\n                : '<svg class=\"toggle-icon toggle-off\" xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"1\" y=\"5\" width=\"22\" height=\"14\" rx=\"7\" ry=\"7\"></rect><circle cx=\"8\" cy=\"12\" r=\"3\"></circle></svg>';\n\n            html += '<div class=\"source-item ' + enabledClass + '\" data-source-id=\"' + source.id + '\">';\n            html += '  <div class=\"source-info\">';\n            html += '    <div class=\"source-name-row\">';\n            html += '      <span class=\"source-name\">' + escapeHtml(source.name) + '</span>';\n            html += '      ' + activeBadge;\n            html += '    </div>';\n            html += '    <span class=\"source-host\">' + escapeHtml(source.host) + '</span>';\n            html += '  </div>';\n            html += '  <button type=\"button\" class=\"btn-toggle\" data-action=\"toggle-source\" data-source-id=\"' + source.id + '\">';\n            html += '    ' + toggleIcon;\n            html += '  </button>';\n            html += '</div>';\n        }\n\n        sourcesList.innerHTML = html;\n\n        // Attach event listeners\n        var toggleBtns = sourcesList.querySelectorAll('[data-action=\"toggle-source\"]');\n        for (var i = 0; i < toggleBtns.length; i++) {\n            toggleBtns[i].addEventListener('click', handleToggleSource);\n        }\n    }\n\n    /**\n     * Handle toggle source click\n     */\n    function handleToggleSource(e) {\n        var btn = e.currentTarget;\n        var sourceId = parseInt(btn.getAttribute('data-source-id'), 10);\n\n        btn.disabled = true;\n\n        Cookie.ajax.post('/api/sources/' + sourceId + '/toggle/', {}, function(err, result) {\n            btn.disabled = false;\n\n            if (err) {\n                Cookie.toast.error('Failed to toggle source');\n                return;\n            }\n\n            // Update local data\n            for (var i = 0; i < sources.length; i++) {\n                if (sources[i].id === sourceId) {\n                    sources[i].is_enabled = result.is_enabled;\n                    break;\n                }\n            }\n\n            renderSources();\n            renderSelectors();\n            updateSourcesCounter();\n        });\n    }\n\n    /**\n     * Bulk toggle sources\n     */\n    function bulkToggleSources(enable) {\n        enableAllBtn.disabled = true;\n        disableAllBtn.disabled = true;\n\n        Cookie.ajax.post('/api/sources/bulk-toggle/', { enable: enable }, function(err, result) {\n            enableAllBtn.disabled = false;\n            disableAllBtn.disabled = false;\n\n            if (err) {\n                Cookie.toast.error('Failed to update sources');\n                return;\n            }\n\n            // Update local data\n            for (var i = 0; i < sources.length; i++) {\n                sources[i].is_enabled = enable;\n            }\n\n            renderSources();\n            renderSelectors();\n            updateSourcesCounter();\n            Cookie.toast.success(enable ? 'All sources enabled' : 'All sources disabled');\n        });\n    }\n\n    /**\n     * Setup selectors tab handlers\n     */\n    function setupSelectorsTab() {\n        testAllBtn.addEventListener('click', handleTestAllSources);\n    }\n\n    /**\n     * Render selectors list\n     */\n    function renderSelectors() {\n        var html = '';\n\n        for (var i = 0; i < sources.length; i++) {\n            var source = sources[i];\n            var status = getSourceStatus(source);\n            var statusIcon = getStatusIcon(status);\n            var lastTested = formatRelativeTime(source.last_validated_at);\n            var failureWarning = source.consecutive_failures >= 3\n                ? '<p class=\"selector-failure-warning\">Failed ' + source.consecutive_failures + ' times - auto-disabled</p>'\n                : '';\n\n            html += '<div class=\"selector-item\" data-source-id=\"' + source.id + '\">';\n            html += '  <div class=\"selector-header\">';\n            html += '    <div class=\"selector-info\">';\n            html += '      <div class=\"selector-name-row\">';\n            html += '        <span class=\"selector-name\">' + escapeHtml(source.name) + '</span>';\n            html += '        ' + statusIcon;\n            html += '      </div>';\n            html += '      <span class=\"selector-host\">' + escapeHtml(source.host) + '</span>';\n            html += '      ' + failureWarning;\n            html += '    </div>';\n            html += '    <div class=\"selector-actions\">';\n            html += '      <span class=\"selector-last-tested\">Last tested: ' + lastTested + '</span>';\n            html += '      <button type=\"button\" class=\"btn btn-secondary btn-sm\" data-action=\"test-source\" data-source-id=\"' + source.id + '\">';\n            html += '        <span class=\"btn-icon-wrapper\">';\n            html += '          <svg class=\"btn-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polygon points=\"5 3 19 12 5 21 5 3\"></polygon></svg>';\n            html += '          <span class=\"test-btn-text\">Test</span>';\n            html += '        </span>';\n            html += '      </button>';\n            html += '    </div>';\n            html += '  </div>';\n            html += '  <div class=\"selector-field\">';\n            html += '    <label class=\"selector-label\">CSS Selector</label>';\n            html += '    <div class=\"selector-input-row\" data-source-id=\"' + source.id + '\">';\n            html += '      <code class=\"selector-value\">' + escapeHtml(source.result_selector || '(none)') + '</code>';\n            html += '      <button type=\"button\" class=\"btn btn-edit btn-sm\" data-action=\"edit-selector\" data-source-id=\"' + source.id + '\">Edit</button>';\n            html += '    </div>';\n            html += '    <div class=\"selector-edit-row hidden\" data-source-id=\"' + source.id + '\">';\n            html += '      <input type=\"text\" class=\"input input-mono\" value=\"' + escapeHtml(source.result_selector || '') + '\" data-field=\"selector\">';\n            html += '      <button type=\"button\" class=\"btn btn-secondary btn-sm\" data-action=\"cancel-edit\" data-source-id=\"' + source.id + '\">Cancel</button>';\n            html += '      <button type=\"button\" class=\"btn btn-primary btn-sm\" data-action=\"save-selector\" data-source-id=\"' + source.id + '\">Save</button>';\n            html += '    </div>';\n            html += '  </div>';\n            html += '</div>';\n        }\n\n        selectorsList.innerHTML = html;\n\n        // Attach event listeners\n        var testBtns = selectorsList.querySelectorAll('[data-action=\"test-source\"]');\n        for (var i = 0; i < testBtns.length; i++) {\n            testBtns[i].addEventListener('click', handleTestSource);\n        }\n\n        var editBtns = selectorsList.querySelectorAll('[data-action=\"edit-selector\"]');\n        for (var i = 0; i < editBtns.length; i++) {\n            editBtns[i].addEventListener('click', handleEditSelector);\n        }\n\n        var cancelBtns = selectorsList.querySelectorAll('[data-action=\"cancel-edit\"]');\n        for (var i = 0; i < cancelBtns.length; i++) {\n            cancelBtns[i].addEventListener('click', handleCancelEditSelector);\n        }\n\n        var saveBtns = selectorsList.querySelectorAll('[data-action=\"save-selector\"]');\n        for (var i = 0; i < saveBtns.length; i++) {\n            saveBtns[i].addEventListener('click', handleSaveSelector);\n        }\n    }\n\n    /**\n     * Get source status\n     */\n    function getSourceStatus(source) {\n        if (!source.last_validated_at) return 'untested';\n        if (source.needs_attention || source.consecutive_failures >= 3) return 'broken';\n        return 'working';\n    }\n\n    /**\n     * Get status icon HTML\n     */\n    function getStatusIcon(status) {\n        if (status === 'working') {\n            return '<svg class=\"status-icon status-working\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path><polyline points=\"22 4 12 14.01 9 11.01\"></polyline></svg>';\n        } else if (status === 'broken') {\n            return '<svg class=\"status-icon status-broken\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"></line><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"></line></svg>';\n        } else {\n            return '<svg class=\"status-icon status-untested\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"></path><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"></line></svg>';\n        }\n    }\n\n    /**\n     * Format relative time\n     */\n    function formatRelativeTime(dateStr) {\n        if (!dateStr) return 'Never';\n        var date = new Date(dateStr);\n        var now = new Date();\n        var diffMs = now.getTime() - date.getTime();\n        var diffMins = Math.floor(diffMs / 60000);\n        if (diffMins < 1) return 'Just now';\n        if (diffMins < 60) return diffMins + 'm ago';\n        var diffHours = Math.floor(diffMins / 60);\n        if (diffHours < 24) return diffHours + 'h ago';\n        var diffDays = Math.floor(diffHours / 24);\n        return diffDays + 'd ago';\n    }\n\n    /**\n     * Handle test source click\n     */\n    function handleTestSource(e) {\n        var btn = e.currentTarget;\n        var sourceId = parseInt(btn.getAttribute('data-source-id'), 10);\n        var btnText = btn.querySelector('.test-btn-text');\n\n        btn.disabled = true;\n        btnText.textContent = 'Testing...';\n\n        Cookie.ajax.post('/api/sources/' + sourceId + '/test/', {}, function(err, result) {\n            btn.disabled = false;\n            btnText.textContent = 'Test';\n\n            if (err) {\n                Cookie.toast.error('Failed to test source');\n                return;\n            }\n\n            if (result.success) {\n                Cookie.toast.success(result.message);\n            } else {\n                Cookie.toast.error(result.message);\n            }\n\n            // Reload sources to get updated status\n            loadSources();\n        });\n    }\n\n    /**\n     * Handle test all sources click\n     */\n    function handleTestAllSources() {\n        testAllBtn.disabled = true;\n        testAllText.textContent = 'Testing...';\n\n        Cookie.ajax.post('/api/sources/test-all/', {}, function(err, result) {\n            testAllBtn.disabled = false;\n            testAllText.textContent = 'Test All Sources';\n\n            if (err) {\n                Cookie.toast.error('Failed to test sources');\n                return;\n            }\n\n            Cookie.toast.success('Tested ' + result.tested + ' sources: ' + result.passed + ' passed, ' + result.failed + ' failed');\n\n            // Reload sources to get updated status\n            loadSources();\n        });\n    }\n\n    /**\n     * Handle edit selector click\n     */\n    function handleEditSelector(e) {\n        var sourceId = e.currentTarget.getAttribute('data-source-id');\n        var inputRow = selectorsList.querySelector('.selector-input-row[data-source-id=\"' + sourceId + '\"]');\n        var editRow = selectorsList.querySelector('.selector-edit-row[data-source-id=\"' + sourceId + '\"]');\n\n        inputRow.classList.add('hidden');\n        editRow.classList.remove('hidden');\n    }\n\n    /**\n     * Handle cancel edit selector click\n     */\n    function handleCancelEditSelector(e) {\n        var sourceId = e.currentTarget.getAttribute('data-source-id');\n        var inputRow = selectorsList.querySelector('.selector-input-row[data-source-id=\"' + sourceId + '\"]');\n        var editRow = selectorsList.querySelector('.selector-edit-row[data-source-id=\"' + sourceId + '\"]');\n\n        editRow.classList.add('hidden');\n        inputRow.classList.remove('hidden');\n    }\n\n    /**\n     * Handle save selector click\n     */\n    function handleSaveSelector(e) {\n        var btn = e.currentTarget;\n        var sourceId = parseInt(btn.getAttribute('data-source-id'), 10);\n        var editRow = selectorsList.querySelector('.selector-edit-row[data-source-id=\"' + sourceId + '\"]');\n        var input = editRow.querySelector('[data-field=\"selector\"]');\n        var newSelector = input.value;\n\n        btn.disabled = true;\n        btn.textContent = 'Saving...';\n\n        Cookie.ajax.put('/api/sources/' + sourceId + '/selector/', { result_selector: newSelector }, function(err, result) {\n            btn.disabled = false;\n            btn.textContent = 'Save';\n\n            if (err) {\n                Cookie.toast.error('Failed to update selector');\n                return;\n            }\n\n            Cookie.toast.success('Selector updated');\n\n            // Update local data\n            for (var i = 0; i < sources.length; i++) {\n                if (sources[i].id === sourceId) {\n                    sources[i].result_selector = newSelector;\n                    break;\n                }\n            }\n\n            renderSelectors();\n        });\n    }\n\n    /**\n     * Escape HTML special characters\n     */\n    function escapeHtml(str) {\n        if (!str) return '';\n        var div = document.createElement('div');\n        div.appendChild(document.createTextNode(str));\n        return div.innerHTML;\n    }\n\n    // ============================================\n    // USER MANAGEMENT FUNCTIONS\n    // ============================================\n\n    /**\n     * Load profiles from API\n     */\n    function loadProfiles() {\n        Cookie.ajax.get('/api/profiles/', function(err, result) {\n            if (err) {\n                profilesList.innerHTML = '<div class=\"error-placeholder\">Failed to load profiles</div>';\n                return;\n            }\n\n            profiles = result;\n            renderProfiles();\n            updateProfileCount();\n        });\n    }\n\n    /**\n     * Update profile count display\n     */\n    function updateProfileCount() {\n        profileCount.textContent = profiles.length + ' profile' + (profiles.length !== 1 ? 's' : '');\n    }\n\n    /**\n     * Render profiles list\n     */\n    function renderProfiles() {\n        var html = '';\n\n        for (var i = 0; i < profiles.length; i++) {\n            var profile = profiles[i];\n            var isCurrent = profile.id === currentProfileId;\n            var currentBadge = isCurrent ? '<span class=\"profile-current-badge\">Current</span>' : '';\n            var disabledAttr = isCurrent ? 'disabled' : '';\n            var disabledClass = isCurrent ? 'btn-delete-disabled' : '';\n\n            html += '<div class=\"profile-card\" data-profile-id=\"' + profile.id + '\">';\n            html += '  <div class=\"profile-avatar\" style=\"background-color: ' + escapeHtml(profile.avatar_color) + '\"></div>';\n            html += '  <div class=\"profile-info\">';\n            html += '    <div class=\"profile-name-row\">';\n            html += '      <span class=\"profile-name\">' + escapeHtml(profile.name) + '</span>';\n            html += '      ' + currentBadge;\n            html += '    </div>';\n            html += '    <span class=\"profile-meta\">Created ' + formatDate(profile.created_at) + '</span>';\n            html += '    <span class=\"profile-stats\">';\n            html += '      ' + profile.stats.favorites + ' favorites  ';\n            html += '      ' + profile.stats.collections + ' collections  ';\n            html += '      ' + profile.stats.remixes + ' remixes';\n            html += '    </span>';\n            html += '  </div>';\n            html += '  <button type=\"button\" class=\"btn-delete ' + disabledClass + '\" ' + disabledAttr + ' data-action=\"delete-profile\" data-profile-id=\"' + profile.id + '\" title=\"' + (isCurrent ? 'Cannot delete current profile' : 'Delete profile') + '\">';\n            html += '    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">';\n            html += '      <path d=\"M3 6h18\"></path>';\n            html += '      <path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path>';\n            html += '      <path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path>';\n            html += '    </svg>';\n            html += '  </button>';\n            html += '</div>';\n        }\n\n        profilesList.innerHTML = html;\n\n        // Attach event listeners\n        var deleteBtns = profilesList.querySelectorAll('[data-action=\"delete-profile\"]');\n        for (var i = 0; i < deleteBtns.length; i++) {\n            deleteBtns[i].addEventListener('click', handleDeleteProfileClick);\n        }\n    }\n\n    /**\n     * Format date for display\n     */\n    function formatDate(dateStr) {\n        if (!dateStr) return 'Unknown';\n        var date = new Date(dateStr);\n        return date.toLocaleDateString();\n    }\n\n    /**\n     * Handle delete profile button click\n     */\n    function handleDeleteProfileClick(e) {\n        var btn = e.currentTarget;\n        if (btn.disabled) return;\n\n        var profileId = parseInt(btn.getAttribute('data-profile-id'), 10);\n        pendingDeleteId = profileId;\n\n        // Fetch deletion preview\n        Cookie.ajax.get('/api/profiles/' + profileId + '/deletion-preview/', function(err, preview) {\n            if (err) {\n                Cookie.toast.error('Failed to load profile info');\n                pendingDeleteId = null;\n                return;\n            }\n\n            renderDeleteModal(preview);\n            deleteModal.classList.remove('hidden');\n        });\n    }\n\n    /**\n     * Render delete modal content\n     */\n    function renderDeleteModal(preview) {\n        var profile = preview.profile;\n        var data = preview.data_to_delete;\n\n        // Profile info\n        deleteProfileInfo.innerHTML = [\n            '<div class=\"profile-avatar\" style=\"background-color: ' + escapeHtml(profile.avatar_color) + '\"></div>',\n            '<div>',\n            '  <div class=\"profile-name\">' + escapeHtml(profile.name) + '</div>',\n            '  <div class=\"profile-meta\">Created ' + formatDate(profile.created_at) + '</div>',\n            '</div>'\n        ].join('');\n\n        // Data summary\n        var summaryItems = [];\n        if (data.remixes > 0) {\n            summaryItems.push(data.remixes + ' remixed recipe' + (data.remixes !== 1 ? 's' : '') +\n                ' (' + data.remix_images + ' images)');\n        }\n        if (data.favorites > 0) {\n            summaryItems.push(data.favorites + ' favorite' + (data.favorites !== 1 ? 's' : ''));\n        }\n        if (data.collections > 0) {\n            summaryItems.push(data.collections + ' collection' + (data.collections !== 1 ? 's' : '') +\n                ' (' + data.collection_items + ' items)');\n        }\n        if (data.view_history > 0) {\n            summaryItems.push(data.view_history + ' view history entries');\n        }\n        if (data.scaling_cache > 0 || data.discover_cache > 0) {\n            summaryItems.push('Cached AI data');\n        }\n        if (summaryItems.length === 0) {\n            summaryItems.push('No associated data');\n        }\n\n        deleteDataSummary.innerHTML =\n            '<div class=\"summary-title\">Data to be deleted:</div>' +\n            '<ul class=\"summary-list\">' + summaryItems.map(function(item) {\n                return '<li>' + item + '</li>';\n            }).join('') + '</ul>';\n    }\n\n    /**\n     * Close delete modal (exposed globally)\n     */\n    function closeDeleteModal() {\n        deleteModal.classList.add('hidden');\n        pendingDeleteId = null;\n    }\n\n    /**\n     * Execute profile deletion (exposed globally)\n     */\n    function executeDeleteProfile() {\n        if (!pendingDeleteId) return;\n\n        confirmDeleteBtn.disabled = true;\n        deleteBtnText.textContent = 'Deleting...';\n\n        Cookie.ajax.delete('/api/profiles/' + pendingDeleteId + '/', function(err, result) {\n            confirmDeleteBtn.disabled = false;\n            deleteBtnText.textContent = 'Delete Profile';\n\n            if (err) {\n                Cookie.toast.error('Failed to delete profile');\n                return;\n            }\n\n            Cookie.toast.success('Profile deleted successfully');\n\n            // Remove from local data and re-render (before closing modal clears pendingDeleteId)\n            var deletedId = pendingDeleteId;\n            closeDeleteModal();\n\n            profiles = profiles.filter(function(p) {\n                return p.id !== deletedId;\n            });\n            renderProfiles();\n            updateProfileCount();\n        });\n    }\n\n    // Expose modal functions globally for onclick handlers\n    window.closeDeleteModal = closeDeleteModal;\n    window.executeDeleteProfile = executeDeleteProfile;\n\n    // ============================================\n    // DATABASE RESET FUNCTIONS (DANGER ZONE)\n    // ============================================\n\n    /**\n     * Setup Danger Zone tab handlers\n     */\n    function setupDangerZoneTab() {\n        // Enable/disable confirm button based on input\n        if (resetConfirmInput) {\n            resetConfirmInput.addEventListener('input', function() {\n                confirmResetBtn.disabled = resetConfirmInput.value !== 'RESET';\n            });\n        }\n    }\n\n    /**\n     * Show reset modal (exposed globally)\n     */\n    function showResetModal() {\n        // Fetch reset preview\n        Cookie.ajax.get('/api/system/reset-preview/', function(err, preview) {\n            if (err) {\n                Cookie.toast.error('Failed to load reset preview');\n                return;\n            }\n\n            resetPreview = preview;\n            renderResetSummary(preview);\n            resetModalStep1.classList.remove('hidden');\n        });\n    }\n\n    /**\n     * Render reset data summary\n     */\n    function renderResetSummary(preview) {\n        var counts = preview.data_counts;\n        var html = '<ul class=\"summary-list\">';\n        html += '<li>' + counts.profiles + ' profiles</li>';\n        html += '<li>' + counts.recipes + ' recipes (' + counts.recipe_images + ' images)</li>';\n        html += '<li>' + counts.favorites + ' favorites</li>';\n        html += '<li>' + counts.collections + ' collections</li>';\n        html += '<li>' + counts.view_history + ' view history entries</li>';\n        html += '<li>' + (counts.ai_suggestions + counts.serving_adjustments) + ' cached AI entries</li>';\n        html += '</ul>';\n        resetDataSummary.innerHTML = html;\n    }\n\n    /**\n     * Show step 2 of reset modal (exposed globally)\n     */\n    function showResetStep2() {\n        resetModalStep1.classList.add('hidden');\n        resetModalStep2.classList.remove('hidden');\n        resetConfirmInput.value = '';\n        confirmResetBtn.disabled = true;\n        resetConfirmInput.focus();\n    }\n\n    /**\n     * Show step 1 of reset modal (exposed globally)\n     */\n    function showResetStep1() {\n        resetModalStep2.classList.add('hidden');\n        resetModalStep1.classList.remove('hidden');\n    }\n\n    /**\n     * Close reset modal (exposed globally)\n     */\n    function closeResetModal() {\n        resetModalStep1.classList.add('hidden');\n        resetModalStep2.classList.add('hidden');\n        resetConfirmInput.value = '';\n        confirmResetBtn.disabled = true;\n        resetPreview = null;\n    }\n\n    /**\n     * Execute database reset (exposed globally)\n     */\n    function executeReset() {\n        if (resetConfirmInput.value !== 'RESET') return;\n\n        confirmResetBtn.disabled = true;\n        resetBtnText.textContent = 'Resetting...';\n\n        Cookie.ajax.post('/api/system/reset/', { confirmation_text: 'RESET' }, function(err, result) {\n            confirmResetBtn.disabled = false;\n            resetBtnText.textContent = 'Reset Database';\n\n            if (err) {\n                Cookie.toast.error('Failed to reset database');\n                return;\n            }\n\n            Cookie.toast.success('Database reset complete');\n            closeResetModal();\n\n            // Redirect to home/profile creation\n            setTimeout(function() {\n                window.location.href = '/legacy/';\n            }, 1000);\n        });\n    }\n\n    // Expose reset modal functions globally for onclick handlers\n    window.showResetModal = showResetModal;\n    window.showResetStep1 = showResetStep1;\n    window.showResetStep2 = showResetStep2;\n    window.closeResetModal = closeResetModal;\n    window.executeReset = executeReset;\n\n    return {\n        init: init\n    };\n})();\n\n// Auto-init on page load\n(function() {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', Cookie.pages.settings.init);\n    } else {\n        Cookie.pages.settings.init();\n    }\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/polyfills.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/state.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/time-detect.js","messages":[{"ruleId":"no-redeclare","severity":1,"message":"'mins' is already defined.","line":73,"column":13,"nodeType":"Identifier","messageId":"redeclared","endLine":73,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Time detection in text (ES5, iOS 9 compatible)\n * Detects time mentions like \"15 minutes\", \"2 hours\", \"30 seconds\"\n */\nvar Cookie = Cookie || {};\n\nCookie.TimeDetect = (function() {\n    'use strict';\n\n    /**\n     * Patterns for detecting time in text\n     * Each pattern has a regex and a multiplier to convert to seconds\n     */\n    var patterns = [\n        // Hours: \"2 hours\", \"2 hr\", \"2h\"\n        { regex: /(\\d+)\\s*(?:hours?|hrs?|h)\\b/gi, multiplier: 3600 },\n        // Minutes: \"15 minutes\", \"15 min\", \"15m\"\n        { regex: /(\\d+)\\s*(?:minutes?|mins?|m)\\b/gi, multiplier: 60 },\n        // Seconds: \"30 seconds\", \"30 sec\", \"30s\"\n        { regex: /(\\d+)\\s*(?:seconds?|secs?|s)\\b/gi, multiplier: 1 }\n    ];\n\n    /**\n     * Detect time mentions in text and return durations in seconds\n     * @param {string} text - Text to search for time mentions\n     * @returns {Array<number>} - Array of durations in seconds\n     */\n    function detect(text) {\n        if (!text) return [];\n\n        var times = [];\n        var seen = {}; // Track seen values to avoid duplicates\n\n        for (var i = 0; i < patterns.length; i++) {\n            var pattern = patterns[i];\n            var match;\n\n            // Reset regex lastIndex for each search\n            pattern.regex.lastIndex = 0;\n\n            while ((match = pattern.regex.exec(text)) !== null) {\n                var value = parseInt(match[1], 10);\n                var seconds = value * pattern.multiplier;\n\n                // Create a unique key to avoid duplicates\n                var key = match.index + '-' + value + '-' + pattern.multiplier;\n\n                if (!seen[key] && seconds > 0) {\n                    seen[key] = true;\n                    times.push(seconds);\n                }\n            }\n        }\n\n        return times;\n    }\n\n    /**\n     * Format seconds as a human-readable duration\n     * @param {number} seconds - Duration in seconds\n     * @returns {string} - Formatted duration string\n     */\n    function format(seconds) {\n        if (seconds >= 3600) {\n            var hrs = Math.floor(seconds / 3600);\n            var mins = Math.floor((seconds % 3600) / 60);\n            if (mins > 0) {\n                return hrs + 'h ' + mins + 'm';\n            }\n            return hrs + 'h';\n        }\n\n        var mins = Math.floor(seconds / 60);\n        var secs = seconds % 60;\n\n        if (mins === 0) {\n            return secs + ' sec';\n        }\n        if (secs === 0) {\n            return mins + ' min';\n        }\n        return mins + 'm ' + secs + 's';\n    }\n\n    /**\n     * Check if text contains any time mentions\n     * @param {string} text - Text to check\n     * @returns {boolean} - True if time mentions found\n     */\n    function hasTime(text) {\n        return detect(text).length > 0;\n    }\n\n    // Public API\n    return {\n        detect: detect,\n        format: format,\n        hasTime: hasTime\n    };\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/timer.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'audioInitialized' is assigned a value but never used.","line":16,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":25},{"ruleId":"no-redeclare","severity":1,"message":"'mins' is already defined.","line":374,"column":13,"nodeType":"Identifier","messageId":"redeclared","endLine":374,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Timer functionality (ES5, iOS 9 compatible)\n * CRITICAL: This must work on iOS 9 Safari\n * Uses Web Audio API with webkitAudioContext fallback\n */\nvar Cookie = Cookie || {};\n\nCookie.Timer = (function() {\n    'use strict';\n\n    var timers = [];\n    var nextId = 1;\n\n    // Web Audio API context (created lazily on user gesture)\n    var audioContext = null;\n    var audioInitialized = false;\n\n    /**\n     * Timer constructor\n     * @param {string} label - Timer label\n     * @param {number} durationSeconds - Duration in seconds\n     */\n    function Timer(label, durationSeconds) {\n        this.id = nextId++;\n        this.label = label;\n        this.duration = durationSeconds;\n        this.remaining = durationSeconds;\n        this.isRunning = false;\n        this.intervalId = null;\n        this.element = null;\n        this.onComplete = null;\n    }\n\n    /**\n     * Start the timer\n     */\n    Timer.prototype.start = function() {\n        var self = this;\n        if (this.isRunning) return;\n        if (this.remaining <= 0) return;\n\n        this.isRunning = true;\n        this.intervalId = setInterval(function() {\n            self.remaining--;\n            self.render();\n            if (self.remaining <= 0) {\n                self.complete();\n            }\n        }, 1000);\n        this.render();\n    };\n\n    /**\n     * Pause the timer\n     */\n    Timer.prototype.pause = function() {\n        this.isRunning = false;\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.render();\n    };\n\n    /**\n     * Toggle start/pause\n     */\n    Timer.prototype.toggle = function() {\n        if (this.isRunning) {\n            this.pause();\n        } else {\n            this.start();\n        }\n    };\n\n    /**\n     * Reset the timer to original duration\n     */\n    Timer.prototype.reset = function() {\n        this.pause();\n        this.remaining = this.duration;\n        this.render();\n    };\n\n    /**\n     * Called when timer reaches zero\n     */\n    Timer.prototype.complete = function() {\n        this.pause();\n        this.remaining = 0;\n        this.render();\n        Cookie.Timer.notify(this.label);\n        if (this.onComplete) {\n            this.onComplete(this);\n        }\n    };\n\n    /**\n     * Format remaining time as MM:SS or H:MM:SS\n     */\n    Timer.prototype.formatTime = function() {\n        var totalSecs = Math.max(0, this.remaining);\n        var hrs = Math.floor(totalSecs / 3600);\n        var mins = Math.floor((totalSecs % 3600) / 60);\n        var secs = totalSecs % 60;\n\n        var pad = function(n) {\n            return n < 10 ? '0' + n : '' + n;\n        };\n\n        if (hrs > 0) {\n            return hrs + ':' + pad(mins) + ':' + pad(secs);\n        }\n        return mins + ':' + pad(secs);\n    };\n\n    /**\n     * Update the DOM element with current state\n     */\n    Timer.prototype.render = function() {\n        if (!this.element) return;\n\n        var timeEl = this.element.querySelector('.timer-time');\n        var toggleBtn = this.element.querySelector('.timer-toggle');\n        var progressEl = this.element.querySelector('.timer-progress-bar');\n\n        if (timeEl) {\n            timeEl.textContent = this.formatTime();\n        }\n\n        if (toggleBtn) {\n            toggleBtn.textContent = this.isRunning ? 'Pause' : 'Start';\n            if (this.remaining <= 0) {\n                toggleBtn.textContent = 'Done';\n                toggleBtn.disabled = true;\n            } else {\n                toggleBtn.disabled = false;\n            }\n        }\n\n        if (progressEl) {\n            var percent = this.duration > 0\n                ? ((this.duration - this.remaining) / this.duration) * 100\n                : 100;\n            progressEl.style.width = percent + '%';\n        }\n\n        // Add running class for visual feedback\n        if (this.isRunning) {\n            this.element.classList.add('timer-running');\n        } else {\n            this.element.classList.remove('timer-running');\n        }\n\n        // Add completed class\n        if (this.remaining <= 0) {\n            this.element.classList.add('timer-completed');\n        } else {\n            this.element.classList.remove('timer-completed');\n        }\n    };\n\n    /**\n     * Bind this timer to a DOM element\n     */\n    Timer.prototype.bind = function(element) {\n        this.element = element;\n        this.render();\n        return this;\n    };\n\n    // ==========================================\n    // Audio functions using Web Audio API\n    // ==========================================\n\n    /**\n     * Initialize AudioContext on user gesture (required for iOS)\n     * Uses webkitAudioContext fallback for iOS 9 Safari\n     */\n    function initAudio() {\n        if (audioContext) {\n            // Already initialized, just resume if suspended\n            if (audioContext.state === 'suspended') {\n                audioContext.resume();\n            }\n            return;\n        }\n\n        try {\n            // Use webkitAudioContext for iOS 9 Safari\n            var AudioContextClass = window.AudioContext || window.webkitAudioContext;\n            if (AudioContextClass) {\n                audioContext = new AudioContextClass();\n                audioInitialized = true;\n            }\n        } catch (e) {\n            // Web Audio API not supported\n        }\n\n        // Resume if suspended (iOS autoplay policy)\n        if (audioContext && audioContext.state === 'suspended') {\n            audioContext.resume();\n        }\n    }\n\n    /**\n     * Play alarm sound - 3 beeps at 880 Hz (A5 note)\n     * Uses square wave for harsh, attention-grabbing sound\n     */\n    function playAlarmSound() {\n        if (!audioContext) {\n            return;\n        }\n\n        // Resume if suspended\n        if (audioContext.state === 'suspended') {\n            audioContext.resume();\n        }\n\n        try {\n            var ctx = audioContext;\n            var now = ctx.currentTime;\n\n            // Play 3 beeps\n            for (var i = 0; i < 3; i++) {\n                var startTime = now + (i * 0.3);\n\n                var oscillator = ctx.createOscillator();\n                var gainNode = ctx.createGain();\n\n                oscillator.connect(gainNode);\n                gainNode.connect(ctx.destination);\n\n                // 880 Hz = A5 note, square wave for harsh beep\n                oscillator.frequency.value = 880;\n                oscillator.type = 'square';\n\n                // Volume envelope (attack, sustain, release)\n                gainNode.gain.setValueAtTime(0.5, startTime);\n                gainNode.gain.setValueAtTime(0.5, startTime + 0.12);\n                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);\n\n                oscillator.start(startTime);\n                oscillator.stop(startTime + 0.15);\n            }\n        } catch (e) {\n            // Silent fail\n        }\n    }\n\n    // ==========================================\n    // Module-level functions\n    // ==========================================\n\n    /**\n     * Notification handling - play sound only (no alert)\n     */\n    function notify(label) {\n        // Play alarm sound\n        playAlarmSound();\n\n        // Try Notification API for desktop browsers (optional, non-blocking)\n        if ('Notification' in window && Notification.permission === 'granted') {\n            try {\n                new Notification('Timer Complete!', { body: label });\n            } catch (e) {\n                // Ignore notification errors\n            }\n        }\n        // No alert() - just play the sound and show toast\n    }\n\n    /**\n     * Initialize audio on user interaction (iOS requires this)\n     * Call this from touchstart/click handlers\n     */\n    function unlockAudio() {\n        initAudio();\n    }\n\n    /**\n     * Request notification permission and initialize audio\n     */\n    function requestPermission() {\n        if ('Notification' in window && Notification.permission === 'default') {\n            try {\n                Notification.requestPermission();\n            } catch (e) {\n                // Not supported\n            }\n        }\n        // Initialize audio context (called from user interaction context)\n        initAudio();\n    }\n\n    /**\n     * Create a new timer\n     */\n    function create(label, durationSeconds) {\n        var timer = new Timer(label, durationSeconds);\n        timers.push(timer);\n        return timer;\n    }\n\n    /**\n     * Get all timers\n     */\n    function getAll() {\n        return timers;\n    }\n\n    /**\n     * Get timer by ID\n     */\n    function get(id) {\n        for (var i = 0; i < timers.length; i++) {\n            if (timers[i].id === id) {\n                return timers[i];\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Remove a timer by ID\n     */\n    function remove(id) {\n        for (var i = 0; i < timers.length; i++) {\n            if (timers[i].id === id) {\n                timers[i].pause();\n                timers.splice(i, 1);\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Remove all timers\n     */\n    function clear() {\n        for (var i = 0; i < timers.length; i++) {\n            timers[i].pause();\n        }\n        timers = [];\n    }\n\n    /**\n     * Get count of running timers\n     */\n    function getRunningCount() {\n        var count = 0;\n        for (var i = 0; i < timers.length; i++) {\n            if (timers[i].isRunning) {\n                count++;\n            }\n        }\n        return count;\n    }\n\n    /**\n     * Format duration in seconds to human readable string\n     * e.g., 90 -> \"1 min 30 sec\", 3600 -> \"1 hour\"\n     */\n    function formatDuration(seconds) {\n        if (seconds >= 3600) {\n            var hrs = Math.floor(seconds / 3600);\n            var mins = Math.floor((seconds % 3600) / 60);\n            if (mins > 0) {\n                return hrs + 'h ' + mins + 'm';\n            }\n            return hrs + 'h';\n        }\n        var mins = Math.floor(seconds / 60);\n        var secs = seconds % 60;\n        if (mins === 0) {\n            return secs + ' sec';\n        }\n        if (secs === 0) {\n            return mins + ' min';\n        }\n        return mins + 'm ' + secs + 's';\n    }\n\n    // Public API\n    return {\n        Timer: Timer,\n        create: create,\n        getAll: getAll,\n        get: get,\n        remove: remove,\n        clear: clear,\n        getRunningCount: getRunningCount,\n        notify: notify,\n        requestPermission: requestPermission,\n        unlockAudio: unlockAudio,\n        formatDuration: formatDuration\n    };\n})();\n","usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/toast.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]},{"filePath":"/home/runner/work/cookie/cookie/apps/legacy/static/legacy/js/wake-lock.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"wrap-iife","replacedBy":[]}]}]
