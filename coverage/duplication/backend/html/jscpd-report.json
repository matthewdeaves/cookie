{
  "statistics": {
    "detectionDate": "2026-02-02T06:53:36.870Z",
    "formats": {
      "python": {
        "sources": {
          "cookie/wsgi.py": {
            "lines": 10,
            "tokens": 40,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "cookie/urls.py": {
            "lines": 35,
            "tokens": 280,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "cookie/settings.py": {
            "lines": 170,
            "tokens": 941,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/management/commands/cleanup_search_images.py": {
            "lines": 100,
            "tokens": 556,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/services/search.py": {
            "lines": 558,
            "tokens": 3555,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/services/scraper.py": {
            "lines": 406,
            "tokens": 3118,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/services/image_cache.py": {
            "lines": 263,
            "tokens": 1526,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/services/fingerprint.py": {
            "lines": 78,
            "tokens": 279,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/legacy/templatetags/legacy_tags.py": {
            "lines": 52,
            "tokens": 286,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/validator.py": {
            "lines": 201,
            "tokens": 1591,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 56,
            "duplicatedTokens": 432,
            "percentage": 27.86,
            "percentageTokens": 27.15,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/tips.py": {
            "lines": 107,
            "tokens": 532,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/timer.py": {
            "lines": 70,
            "tokens": 367,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/selector.py": {
            "lines": 180,
            "tokens": 874,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/scaling.py": {
            "lines": 241,
            "tokens": 1535,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 15,
            "duplicatedTokens": 99,
            "percentage": 6.22,
            "percentageTokens": 6.45,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/remix.py": {
            "lines": 309,
            "tokens": 1851,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 45,
            "duplicatedTokens": 273,
            "percentage": 14.56,
            "percentageTokens": 14.75,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/ranking.py": {
            "lines": 161,
            "tokens": 939,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/openrouter.py": {
            "lines": 291,
            "tokens": 1688,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 52,
            "duplicatedTokens": 316,
            "percentage": 17.87,
            "percentageTokens": 18.72,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/discover.py": {
            "lines": 275,
            "tokens": 1812,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/services/cache.py": {
            "lines": 112,
            "tokens": 618,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/utils.py": {
            "lines": 213,
            "tokens": 1087,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/sources_api.py": {
            "lines": 302,
            "tokens": 2040,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/models.py": {
            "lines": 275,
            "tokens": 2135,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/api_user.py": {
            "lines": 288,
            "tokens": 2014,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/recipes/api.py": {
            "lines": 328,
            "tokens": 2059,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/profiles/utils.py": {
            "lines": 58,
            "tokens": 276,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/profiles/models.py": {
            "lines": 24,
            "tokens": 205,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/profiles/apps.py": {
            "lines": 5,
            "tokens": 32,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/profiles/api.py": {
            "lines": 253,
            "tokens": 1784,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/legacy/views.py": {
            "lines": 356,
            "tokens": 2198,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/legacy/urls.py": {
            "lines": 19,
            "tokens": 206,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/legacy/apps.py": {
            "lines": 9,
            "tokens": 39,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/core/models.py": {
            "lines": 42,
            "tokens": 326,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/core/middleware.py": {
            "lines": 63,
            "tokens": 391,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/core/encryption.py": {
            "lines": 86,
            "tokens": 417,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/core/apps.py": {
            "lines": 5,
            "tokens": 32,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/core/api.py": {
            "lines": 196,
            "tokens": 1256,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/models.py": {
            "lines": 105,
            "tokens": 820,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/fixtures.py": {
            "lines": 349,
            "tokens": 1804,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/ai/api.py": {
            "lines": 719,
            "tokens": 4411,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 98,
            "duplicatedTokens": 660,
            "percentage": 13.63,
            "percentageTokens": 14.96,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 7314,
          "tokens": 45920,
          "sources": 39,
          "clones": 7,
          "duplicatedLines": 133,
          "duplicatedTokens": 890,
          "percentage": 1.82,
          "percentageTokens": 1.94,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      }
    },
    "total": {
      "lines": 7314,
      "tokens": 45920,
      "sources": 39,
      "clones": 7,
      "duplicatedLines": 133,
      "duplicatedTokens": 890,
      "percentage": 1.82,
      "percentageTokens": 1.94,
      "newDuplicatedLines": 0,
      "newClones": 0
    }
  },
  "duplicates": [
    {
      "format": "python",
      "lines": 15,
      "fragment": ": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"object\",\n            \"required\": [\"search_query\", \"title\", \"description\"],\n            \"properties\": {\n                \"search_query\": {\"type\": \"string\"},\n                \"title\": {\"type\": \"string\"},\n                \"description\": {\"type\": \"string\"},\n            },\n        },\n        \"minItems\": 1,\n        \"maxItems\": 5,\n    },\n    \"discover_new\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/services/validator.py",
        "start": 77,
        "end": 91,
        "startLoc": {
          "line": 77,
          "column": 20,
          "position": 668
        },
        "endLoc": {
          "line": 91,
          "column": 15,
          "position": 776
        }
      },
      "secondFile": {
        "name": "apps/ai/services/validator.py",
        "start": 63,
        "end": 77,
        "startLoc": {
          "line": 63,
          "column": 21,
          "position": 559
        },
        "endLoc": {
          "line": 77,
          "column": 20,
          "position": 667
        }
      }
    },
    {
      "format": "python",
      "lines": 15,
      "fragment": ": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"object\",\n            \"required\": [\"search_query\", \"title\", \"description\"],\n            \"properties\": {\n                \"search_query\": {\"type\": \"string\"},\n                \"title\": {\"type\": \"string\"},\n                \"description\": {\"type\": \"string\"},\n            },\n        },\n        \"minItems\": 1,\n        \"maxItems\": 5,\n    },\n    \"search_ranking\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/services/validator.py",
        "start": 91,
        "end": 105,
        "startLoc": {
          "line": 91,
          "column": 15,
          "position": 777
        },
        "endLoc": {
          "line": 105,
          "column": 17,
          "position": 885
        }
      },
      "secondFile": {
        "name": "apps/ai/services/validator.py",
        "start": 63,
        "end": 77,
        "startLoc": {
          "line": 63,
          "column": 21,
          "position": 559
        },
        "endLoc": {
          "line": 77,
          "column": 20,
          "position": 667
        }
      }
    },
    {
      "format": "python",
      "lines": 16,
      "fragment": ",\n        modification=modification,\n    )\n\n    # Call AI service\n    service = OpenRouterService()\n    response = service.complete(\n        system_prompt=prompt.system_prompt,\n        user_prompt=user_prompt,\n        model=prompt.model,\n        json_response=True,\n    )\n\n    # Validate response\n    validator = AIResponseValidator()\n    validated = validator.validate(\"nutrition_estimate\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/services/remix.py",
        "start": 229,
        "end": 244,
        "startLoc": {
          "line": 229,
          "column": 13,
          "position": 1363
        },
        "endLoc": {
          "line": 244,
          "column": 21,
          "position": 1450
        }
      },
      "secondFile": {
        "name": "apps/ai/services/remix.py",
        "start": 109,
        "end": 124,
        "startLoc": {
          "line": 109,
          "column": 17,
          "position": 558
        },
        "endLoc": {
          "line": 124,
          "column": 15,
          "position": 645
        }
      }
    },
    {
      "format": "python",
      "lines": 16,
      "fragment": "numbers = re.findall(r\"\\d+\", time_str)\n    if not numbers:\n        return None\n\n    minutes = int(numbers[0])\n\n    # Convert hours to minutes if needed\n    if \"hour\" in time_str:\n        minutes *= 60\n        if len(numbers) > 1:\n            minutes += int(numbers[1])\n\n    return minutes\n\n\ndef _parse_servings",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/services/remix.py",
        "start": 259,
        "end": 274,
        "startLoc": {
          "line": 259,
          "column": 5,
          "position": 1531
        },
        "endLoc": {
          "line": 274,
          "column": 16,
          "position": 1630
        }
      },
      "secondFile": {
        "name": "apps/ai/services/scaling.py",
        "start": 28,
        "end": 43,
        "startLoc": {
          "line": 28,
          "column": 5,
          "position": 164
        },
        "endLoc": {
          "line": 43,
          "column": 13,
          "position": 263
        }
      }
    },
    {
      "format": "python",
      "lines": 27,
      "fragment": "(\n                    messages=messages,\n                    model=model,\n                    stream=False,\n                )\n\n            # Extract the response content\n            if not response or not hasattr(response, \"choices\"):\n                raise AIResponseError(\"Invalid response structure from OpenRouter\")\n\n            if not response.choices:\n                raise AIResponseError(\"No choices in OpenRouter response\")\n\n            content = response.choices[0].message.content\n\n            if json_response:\n                return self._parse_json_response(content)\n\n            return {\"content\": content}\n\n        except AIServiceError:\n            raise\n        except Exception as e:\n            logger.exception(\"OpenRouter API error\")\n            raise AIResponseError(f\"OpenRouter API error: {e}\")\n\n    @",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/services/openrouter.py",
        "start": 167,
        "end": 193,
        "startLoc": {
          "line": 167,
          "column": 11,
          "position": 846
        },
        "endLoc": {
          "line": 193,
          "column": 2,
          "position": 1004
        }
      },
      "secondFile": {
        "name": "apps/ai/services/openrouter.py",
        "start": 116,
        "end": 142,
        "startLoc": {
          "line": 116,
          "column": 5,
          "position": 547
        },
        "endLoc": {
          "line": 142,
          "column": 6,
          "position": 705
        }
      }
    },
    {
      "format": "python",
      "lines": 32,
      "fragment": "from apps.profiles.utils import get_current_profile_or_none\n\n    profile = get_current_profile_or_none(request)\n\n    if not profile:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": \"Profile not found\",\n        }\n\n    # Verify the profile_id in the request matches the session profile\n    if data.profile_id != profile.id:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": f\"Profile {data.profile_id} not found\",\n        }\n\n    try:\n        recipe = Recipe.objects.get(id=data.recipe_id)\n    except Recipe.DoesNotExist:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": f\"Recipe {data.recipe_id} not found\",\n        }\n\n    if recipe.profile_id != profile.id:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": f\"Recipe {data.recipe_id} not found\",\n        }\n\n    try",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/api.py",
        "start": 436,
        "end": 467,
        "startLoc": {
          "line": 436,
          "column": 5,
          "position": 2764
        },
        "endLoc": {
          "line": 467,
          "column": 4,
          "position": 2965
        }
      },
      "secondFile": {
        "name": "apps/ai/api.py",
        "start": 345,
        "end": 376,
        "startLoc": {
          "line": 345,
          "column": 5,
          "position": 2161
        },
        "endLoc": {
          "line": 376,
          "column": 6,
          "position": 2362
        }
      }
    },
    {
      "format": "python",
      "lines": 19,
      "fragment": "from apps.profiles.utils import get_current_profile_or_none\n\n    profile = get_current_profile_or_none(request)\n\n    try:\n        recipe = Recipe.objects.get(id=data.recipe_id)\n    except Recipe.DoesNotExist:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": f\"Recipe {data.recipe_id} not found\",\n        }\n\n    if not profile or recipe.profile_id != profile.id:\n        return 404, {\n            \"error\": \"not_found\",\n            \"message\": f\"Recipe {data.recipe_id} not found\",\n        }\n\n    # Clear existing tips if regenerate requested",
      "tokens": 0,
      "firstFile": {
        "name": "apps/ai/api.py",
        "start": 527,
        "end": 545,
        "startLoc": {
          "line": 527,
          "column": 5,
          "position": 3341
        },
        "endLoc": {
          "line": 545,
          "column": 46,
          "position": 3470
        }
      },
      "secondFile": {
        "name": "apps/ai/api.py",
        "start": 315,
        "end": 333,
        "startLoc": {
          "line": 315,
          "column": 5,
          "position": 1954
        },
        "endLoc": {
          "line": 333,
          "column": 12,
          "position": 2083
        }
      }
    }
  ],
  "filename": "/home/runner/.npm/_npx/652ead47bf63fe99/node_modules/@jscpd/html-reporter/dist/templates/main.pug"
}