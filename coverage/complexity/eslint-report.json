[{"filePath":"/home/runner/work/cookie/cookie/frontend/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/api/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/AddToCollectionDropdown.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'AddToCollectionDropdown' has too many lines (134). Maximum allowed is 50.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":145,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react'\nimport { FolderPlus, Plus } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Collection } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface AddToCollectionDropdownProps {\n  recipeId: number\n  onCreateNew: () => void\n}\n\nexport default function AddToCollectionDropdown({\n  recipeId,\n  onCreateNew,\n}: AddToCollectionDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [collections, setCollections] = useState<Collection[]>([])\n  const [loading, setLoading] = useState(false)\n  const [addingTo, setAddingTo] = useState<number | null>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {\n        setIsOpen(false)\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n      return () => document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isOpen])\n\n  // Load collections when dropdown opens\n  useEffect(() => {\n    if (isOpen) {\n      loadCollections()\n    }\n  }, [isOpen])\n\n  const loadCollections = async () => {\n    setLoading(true)\n    try {\n      const data = await api.collections.list()\n      setCollections(data)\n    } catch (error) {\n      console.error('Failed to load collections:', error)\n      toast.error('Failed to load collections')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleAddToCollection = async (collectionId: number) => {\n    setAddingTo(collectionId)\n    try {\n      await api.collections.addRecipe(collectionId, recipeId)\n      const collection = collections.find((c) => c.id === collectionId)\n      toast.success(`Added to ${collection?.name || 'collection'}`)\n      setIsOpen(false)\n    } catch (error: unknown) {\n      if (error instanceof Error && error.message.includes('already')) {\n        toast.info('Recipe is already in this collection')\n      } else {\n        console.error('Failed to add to collection:', error)\n        toast.error('Failed to add to collection')\n      }\n    } finally {\n      setAddingTo(null)\n    }\n  }\n\n  const handleCreateNew = () => {\n    setIsOpen(false)\n    onCreateNew()\n  }\n\n  return (\n    <div ref={dropdownRef} className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:text-primary\"\n        title=\"Add to collection\"\n      >\n        <FolderPlus className=\"h-5 w-5\" />\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 top-full z-50 mt-2 w-56 rounded-lg border border-border bg-card shadow-lg\">\n          <div className=\"p-2\">\n            <h3 className=\"mb-2 px-2 text-xs font-medium uppercase tracking-wider text-muted-foreground\">\n              Add to Collection\n            </h3>\n\n            {loading ? (\n              <div className=\"px-2 py-4 text-center text-sm text-muted-foreground\">\n                Loading...\n              </div>\n            ) : (\n              <>\n                {collections.length > 0 ? (\n                  <div className=\"max-h-48 overflow-y-auto\">\n                    {collections.map((collection) => (\n                      <button\n                        key={collection.id}\n                        onClick={() => handleAddToCollection(collection.id)}\n                        disabled={addingTo === collection.id}\n                        className={cn(\n                          'flex w-full items-center gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors',\n                          'text-foreground hover:bg-muted disabled:opacity-50'\n                        )}\n                      >\n                        <FolderPlus className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"flex-1 truncate\">{collection.name}</span>\n                        {addingTo === collection.id && (\n                          <span className=\"text-xs text-muted-foreground\">Adding...</span>\n                        )}\n                      </button>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"px-2 py-2 text-sm text-muted-foreground\">\n                    No collections yet\n                  </div>\n                )}\n\n                <div className=\"mt-1 border-t border-border pt-1\">\n                  <button\n                    onClick={handleCreateNew}\n                    className=\"flex w-full items-center gap-2 rounded-md px-2 py-2 text-left text-sm text-primary transition-colors hover:bg-muted\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Create New Collection\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/ErrorBoundary.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Method 'render' has too many lines (65). Maximum allowed is 50.","line":52,"column":3,"nodeType":"MethodDefinition","messageId":"exceed","endLine":116,"endColumn":4}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, type ReactNode, type ErrorInfo } from 'react'\nimport { AlertTriangle, RefreshCw } from 'lucide-react'\n\ninterface Props {\n  children: ReactNode\n  fallback?: ReactNode\n}\n\ninterface State {\n  hasError: boolean\n  error: Error | null\n  errorInfo: ErrorInfo | null\n}\n\n/**\n * Error boundary component that catches JavaScript errors in child components.\n *\n * Displays a user-friendly error UI instead of crashing the entire app.\n * Users can click \"Try Again\" to reset the error state and remount children.\n *\n * @example\n * <ErrorBoundary>\n *   <App />\n * </ErrorBoundary>\n *\n * // Or with custom fallback\n * <ErrorBoundary fallback={<CustomErrorUI />}>\n *   <App />\n * </ErrorBoundary>\n */\nexport default class ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props)\n    this.state = { hasError: false, error: null, errorInfo: null }\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<State> {\n    return { hasError: true, error }\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    this.setState({ errorInfo })\n\n    // Log error for debugging\n    console.error('ErrorBoundary caught an error:', error, errorInfo)\n  }\n\n  handleReset = (): void => {\n    this.setState({ hasError: false, error: null, errorInfo: null })\n  }\n\n  render(): ReactNode {\n    const { hasError, error } = this.state\n    const { children, fallback } = this.props\n\n    if (hasError) {\n      // Use custom fallback if provided\n      if (fallback) {\n        return fallback\n      }\n\n      // Default error UI\n      return (\n        <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-4\">\n          <div className=\"w-full max-w-md rounded-xl border border-border bg-card p-8 text-center shadow-lg\">\n            {/* Icon */}\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10\">\n              <AlertTriangle className=\"h-8 w-8 text-destructive\" />\n            </div>\n\n            {/* Title */}\n            <h1 className=\"mb-2 text-xl font-semibold text-foreground\">\n              Something went wrong\n            </h1>\n\n            {/* Description */}\n            <p className=\"mb-6 text-sm text-muted-foreground\">\n              An unexpected error occurred. This has been logged for debugging.\n            </p>\n\n            {/* Error details (development only) */}\n            {import.meta.env.DEV && error && (\n              <div className=\"mb-6 rounded-lg bg-muted p-3 text-left\">\n                <p className=\"mb-1 text-xs font-medium text-muted-foreground\">\n                  Error Details\n                </p>\n                <code className=\"text-xs text-destructive\">\n                  {error.name}: {error.message}\n                </code>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex flex-col gap-2\">\n              <button\n                onClick={this.handleReset}\n                className=\"flex w-full items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                <RefreshCw className=\"h-4 w-4\" />\n                Try Again\n              </button>\n\n              <button\n                onClick={() => window.location.reload()}\n                className=\"w-full rounded-lg bg-muted px-4 py-2.5 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted/80 hover:text-foreground\"\n              >\n                Reload Page\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    return children\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/RecipeCard.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeCard' has too many lines (93). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":105,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'RecipeCard' has a complexity of 12. Maximum allowed is 10.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":13,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Star, Clock, Heart } from 'lucide-react'\nimport type { Recipe } from '../api/client'\nimport { cn } from '../lib/utils'\nimport { formatTime } from '../lib/formatting'\n\ninterface RecipeCardProps {\n  recipe: Recipe\n  isFavorite?: boolean\n  onFavoriteToggle?: (recipe: Recipe) => void\n  onClick?: (recipe: Recipe) => void\n}\n\nexport default function RecipeCard({\n  recipe,\n  isFavorite = false,\n  onFavoriteToggle,\n  onClick,\n}: RecipeCardProps) {\n  const imageUrl = recipe.image || recipe.image_url\n\n  const handleFavoriteClick = (e: React.MouseEvent) => {\n    e.stopPropagation()\n    onFavoriteToggle?.(recipe)\n  }\n\n  return (\n    <div\n      className={cn(\n        'group relative overflow-hidden rounded-lg bg-card shadow-sm transition-all hover:shadow-md',\n        onClick && 'cursor-pointer'\n      )}\n      onClick={() => onClick?.(recipe)}\n    >\n      {/* Image */}\n      <div className=\"relative aspect-[4/3] overflow-hidden bg-muted\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={recipe.title}\n            className=\"h-full w-full object-cover transition-transform group-hover:scale-105\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center text-muted-foreground\">\n            No image\n          </div>\n        )}\n\n        {/* Favorite button */}\n        {onFavoriteToggle && (\n          <button\n            onClick={handleFavoriteClick}\n            className={cn(\n              'absolute right-2 top-2 rounded-full bg-background/80 p-2 backdrop-blur-sm transition-colors',\n              isFavorite\n                ? 'text-accent hover:bg-background'\n                : 'text-muted-foreground hover:bg-background hover:text-accent'\n            )}\n            aria-label={isFavorite ? 'Remove from favorites' : 'Add to favorites'}\n          >\n            <Heart\n              className={cn('h-5 w-5', isFavorite && 'fill-current')}\n            />\n          </button>\n        )}\n\n        {/* Remix badge */}\n        {recipe.is_remix && (\n          <div className=\"absolute left-2 top-2 rounded-full bg-primary/90 px-2 py-0.5 text-xs text-primary-foreground backdrop-blur-sm\">\n            Remix\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"p-3\">\n        {/* Title */}\n        <h3 className=\"mb-1 line-clamp-2 text-sm font-medium text-card-foreground\">\n          {recipe.title}\n        </h3>\n\n        {/* Meta */}\n        <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n          {/* Source */}\n          <span className=\"truncate\">{recipe.host}</span>\n\n          {/* Time */}\n          {recipe.total_time && (\n            <span className=\"flex shrink-0 items-center gap-1\">\n              <Clock className=\"h-3 w-3\" />\n              {formatTime(recipe.total_time)}\n            </span>\n          )}\n\n          {/* Rating */}\n          {recipe.rating && (\n            <span className=\"flex shrink-0 items-center gap-1\">\n              <Star className=\"h-3 w-3 fill-star text-star\" />\n              {recipe.rating.toFixed(1)}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/RemixModal.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RemixModal' has too many lines (188). Maximum allowed is 50.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":202,"endColumn":2}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSuggestions'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, loadSuggestions, recipe.id]","fix":{"range":[1203,1222],"text":"[isOpen, loadSuggestions, recipe.id]"}}],"suppressions":[{"kind":"directive","justification":"loadSuggestions is stable, only re-run when modal opens or recipe changes"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { X, Sparkles, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type RecipeDetail } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface RemixModalProps {\n  recipe: RecipeDetail\n  profileId: number\n  isOpen: boolean\n  onClose: () => void\n  onRemixCreated: (recipeId: number) => void\n}\n\nexport default function RemixModal({\n  recipe,\n  profileId,\n  isOpen,\n  onClose,\n  onRemixCreated,\n}: RemixModalProps) {\n  const [suggestions, setSuggestions] = useState<string[]>([])\n  const [loadingSuggestions, setLoadingSuggestions] = useState(false)\n  const [selectedSuggestion, setSelectedSuggestion] = useState<string | null>(null)\n  const [customInput, setCustomInput] = useState('')\n  const [creating, setCreating] = useState(false)\n\n  // Load suggestions when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      loadSuggestions()\n    } else {\n      // Reset state when modal closes\n      setSuggestions([])\n      setSelectedSuggestion(null)\n      setCustomInput('')\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- loadSuggestions is stable, only re-run when modal opens or recipe changes\n  }, [isOpen, recipe.id])\n\n  const loadSuggestions = async () => {\n    setLoadingSuggestions(true)\n    try {\n      const response = await api.ai.remix.getSuggestions(recipe.id)\n      setSuggestions(response.suggestions)\n    } catch (error) {\n      console.error('Failed to load remix suggestions:', error)\n      toast.error('Failed to load suggestions')\n    } finally {\n      setLoadingSuggestions(false)\n    }\n  }\n\n  const handleSuggestionClick = (suggestion: string) => {\n    if (selectedSuggestion === suggestion) {\n      setSelectedSuggestion(null)\n    } else {\n      setSelectedSuggestion(suggestion)\n      setCustomInput('')\n    }\n  }\n\n  const handleCustomInputChange = (value: string) => {\n    setCustomInput(value)\n    if (value.trim()) {\n      setSelectedSuggestion(null)\n    }\n  }\n\n  const getModification = () => {\n    if (customInput.trim()) {\n      return customInput.trim()\n    }\n    return selectedSuggestion\n  }\n\n  const canSubmit = () => {\n    return !creating && (selectedSuggestion !== null || customInput.trim() !== '')\n  }\n\n  const handleCreateRemix = async () => {\n    const modification = getModification()\n    if (!modification) return\n\n    setCreating(true)\n    try {\n      const remix = await api.ai.remix.create(recipe.id, modification, profileId)\n      toast.success(`Created \"${remix.title}\"`)\n      onRemixCreated(remix.id)\n      onClose()\n    } catch (error) {\n      console.error('Failed to create remix:', error)\n      toast.error('Failed to create remix')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4\">\n      <div className=\"relative w-full max-w-md rounded-xl bg-card shadow-2xl\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-border px-6 py-4\">\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            <h2 className=\"text-lg font-semibold text-foreground\">Remix This Recipe</h2>\n          </div>\n          <button\n            onClick={onClose}\n            disabled={creating}\n            className=\"rounded-full p-1 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"px-6 py-5\">\n          <p className=\"mb-4 text-sm text-muted-foreground\">\n            Choose a modification or describe your own remix of \"{recipe.title}\"\n          </p>\n\n          {/* AI Suggestions */}\n          <div className=\"mb-5\">\n            <h3 className=\"mb-3 text-sm font-medium text-foreground\">Suggestions</h3>\n            {loadingSuggestions ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                <span className=\"ml-2 text-sm text-muted-foreground\">\n                  Generating suggestions...\n                </span>\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                {suggestions.map((suggestion, index) => (\n                  <button\n                    key={index}\n                    onClick={() => handleSuggestionClick(suggestion)}\n                    disabled={creating}\n                    className={cn(\n                      'rounded-full px-3 py-1.5 text-sm transition-colors',\n                      selectedSuggestion === suggestion\n                        ? 'bg-primary text-primary-foreground'\n                        : 'bg-muted text-foreground hover:bg-muted/80'\n                    )}\n                  >\n                    {suggestion}\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Custom Input */}\n          <div className=\"mb-5\">\n            <label\n              htmlFor=\"custom-remix\"\n              className=\"mb-2 block text-sm font-medium text-foreground\"\n            >\n              Or describe your own remix\n            </label>\n            <input\n              id=\"custom-remix\"\n              type=\"text\"\n              value={customInput}\n              onChange={(e) => handleCustomInputChange(e.target.value)}\n              disabled={creating}\n              placeholder=\"e.g., Make it gluten-free\"\n              className=\"w-full rounded-lg border border-border bg-background px-4 py-2.5 text-foreground placeholder:text-muted-foreground focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary disabled:opacity-50\"\n            />\n          </div>\n\n          {/* Create Button */}\n          <button\n            onClick={handleCreateRemix}\n            disabled={!canSubmit()}\n            className={cn(\n              'flex w-full items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              canSubmit()\n                ? 'bg-primary text-primary-foreground hover:bg-primary/90'\n                : 'bg-muted text-muted-foreground cursor-not-allowed'\n            )}\n          >\n            {creating ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Creating Remix...\n              </>\n            ) : (\n              <>\n                <Sparkles className=\"h-4 w-4\" />\n                Create Remix\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/Skeletons.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeDetailSkeleton' has too many lines (58). Maximum allowed is 50.","line":84,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":141,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Skeleton loading components for React frontend\n * Used to show placeholder content while data is loading\n */\n\nimport { cn } from '../lib/utils'\n\n/**\n * Base skeleton element with pulse animation\n */\nfunction Skeleton({ className }: { className?: string }) {\n  return (\n    <div className={cn('animate-pulse rounded bg-muted', className)} />\n  )\n}\n\n/**\n * Skeleton for recipe cards in grids (AllRecipes, Search, Favorites)\n */\nexport function RecipeCardSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card shadow-sm\">\n      {/* Image placeholder */}\n      <Skeleton className=\"aspect-[4/3] rounded-none\" />\n      {/* Content */}\n      <div className=\"p-3 space-y-2\">\n        {/* Title */}\n        <Skeleton className=\"h-4 w-3/4\" />\n        {/* Meta row */}\n        <div className=\"flex items-center gap-3\">\n          <Skeleton className=\"h-3 w-16\" />\n          <Skeleton className=\"h-3 w-12\" />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Grid of recipe card skeletons\n */\nexport function RecipeGridSkeleton({ count = 8 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <RecipeCardSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n\n/**\n * Skeleton for collection cards\n */\nexport function CollectionCardSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card p-4 shadow-sm\">\n      {/* Icon placeholder */}\n      <Skeleton className=\"mb-8 h-12 w-12 rounded-lg\" />\n      {/* Name */}\n      <Skeleton className=\"mb-2 h-5 w-3/4\" />\n      {/* Count */}\n      <Skeleton className=\"h-4 w-16\" />\n    </div>\n  )\n}\n\n/**\n * Grid of collection card skeletons\n */\nexport function CollectionGridSkeleton({ count = 8 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <CollectionCardSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n\n/**\n * Full recipe detail page skeleton\n */\nexport function RecipeDetailSkeleton() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero image skeleton */}\n      <div className=\"relative h-64 sm:h-80\">\n        <Skeleton className=\"h-full w-full rounded-none\" />\n        {/* Back button placeholder */}\n        <div className=\"absolute left-4 top-4\">\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n        </div>\n        {/* Title overlay placeholder */}\n        <div className=\"absolute bottom-4 left-4 right-4\">\n          <Skeleton className=\"mb-2 h-7 w-3/4\" />\n          <div className=\"flex gap-3\">\n            <Skeleton className=\"h-4 w-16\" />\n            <Skeleton className=\"h-4 w-24\" />\n          </div>\n        </div>\n        {/* Action buttons placeholder */}\n        <div className=\"absolute bottom-4 right-4 flex gap-2\">\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n          <Skeleton className=\"h-10 w-20 rounded-full\" />\n        </div>\n      </div>\n\n      {/* Meta info skeleton */}\n      <div className=\"border-b border-border px-4 py-4\">\n        <div className=\"flex flex-wrap gap-4\">\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-32\" />\n        </div>\n      </div>\n\n      {/* Tabs skeleton */}\n      <div className=\"border-b border-border px-4\">\n        <div className=\"flex gap-4 py-3\">\n          <Skeleton className=\"h-5 w-20\" />\n          <Skeleton className=\"h-5 w-20\" />\n          <Skeleton className=\"h-5 w-16\" />\n          <Skeleton className=\"h-5 w-12\" />\n        </div>\n      </div>\n\n      {/* Content skeleton */}\n      <div className=\"px-4 py-6 space-y-4\">\n        {Array.from({ length: 6 }).map((_, i) => (\n          <div key={i} className=\"flex items-start gap-3\">\n            <Skeleton className=\"h-7 w-7 rounded-full shrink-0\" />\n            <Skeleton className=\"h-5 flex-1\" />\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n/**\n * Simple centered loading spinner\n */\nexport function LoadingSpinner({ className }: { className?: string }) {\n  return (\n    <div className={cn('flex items-center justify-center py-12', className)}>\n      <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n    </div>\n  )\n}\n\n/**\n * Loading state for list pages with optional message\n */\nexport function LoadingState({ message = 'Loading...' }: { message?: string }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-12\">\n      <div className=\"mb-3 h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n      <span className=\"text-sm text-muted-foreground\">{message}</span>\n    </div>\n  )\n}\n\n/**\n * Search result card skeleton\n */\nexport function SearchResultSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card shadow-sm\">\n      {/* Image placeholder */}\n      <Skeleton className=\"aspect-[4/3] rounded-none\" />\n      {/* Content */}\n      <div className=\"p-3 space-y-2\">\n        {/* Title */}\n        <Skeleton className=\"h-4 w-3/4\" />\n        {/* Meta */}\n        <Skeleton className=\"h-3 w-1/2\" />\n        {/* Description */}\n        <Skeleton className=\"h-3 w-full\" />\n        <Skeleton className=\"h-3 w-2/3\" />\n        {/* Button */}\n        <Skeleton className=\"h-8 w-full mt-2\" />\n      </div>\n    </div>\n  )\n}\n\n/**\n * Grid of search result skeletons\n */\nexport function SearchGridSkeleton({ count = 6 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3\">\n      {Array.from({ length: count }).map((_, i) => (\n        <SearchResultSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/TimerPanel.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TimerPanel' has too many lines (148). Maximum allowed is 50.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":167,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'TimerPanel' has a complexity of 11. Maximum allowed is 10.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":20,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Timer as TimerIcon, Plus, ChevronUp, ChevronDown, Sparkles, Loader2 } from 'lucide-react'\nimport { useState } from 'react'\nimport type { UseTimersReturn } from '../hooks/useTimers'\nimport { detectTimes } from '../hooks/useTimers'\nimport TimerWidget from './TimerWidget'\nimport { api } from '../api/client'\n\ninterface TimerPanelProps {\n  timers: UseTimersReturn\n  instructionText?: string\n  aiAvailable?: boolean\n}\n\nconst QUICK_TIMERS = [\n  { label: '+5 min', duration: 5 * 60 },\n  { label: '+10 min', duration: 10 * 60 },\n  { label: '+15 min', duration: 15 * 60 },\n]\n\nexport default function TimerPanel({ timers, instructionText, aiAvailable = false }: TimerPanelProps) {\n  const [expanded, setExpanded] = useState(true)\n  const [loadingTimerId, setLoadingTimerId] = useState<string | null>(null)\n\n  // Detect times from current instruction\n  const detectedTimes = instructionText ? detectTimes(instructionText) : []\n\n  const formatDetectedTime = (seconds: number): string => {\n    if (seconds >= 3600) {\n      const hrs = Math.floor(seconds / 3600)\n      const mins = Math.floor((seconds % 3600) / 60)\n      return mins > 0 ? `${hrs}h ${mins}m` : `${hrs}h`\n    }\n    const mins = Math.floor(seconds / 60)\n    const secs = seconds % 60\n    if (mins === 0) return `${secs}s`\n    if (secs === 0) return `${mins} min`\n    return `${mins}m ${secs}s`\n  }\n\n  const handleAddTimer = async (id: string, fallbackLabel: string, duration: number) => {\n    const durationMinutes = Math.ceil(duration / 60)\n\n    // If AI is available and we have instruction text, try to get an AI-generated name\n    if (aiAvailable && instructionText) {\n      setLoadingTimerId(id)\n      try {\n        const response = await api.ai.timerName(instructionText, durationMinutes)\n        timers.addTimer(response.label, duration)\n      } catch {\n        // AI failed, use fallback\n        timers.addTimer(fallbackLabel, duration)\n      } finally {\n        setLoadingTimerId(null)\n      }\n    } else {\n      // No AI available, use fallback label\n      timers.addTimer(fallbackLabel, duration)\n    }\n  }\n\n  const handleAddQuickTimer = (label: string, duration: number, index: number) => {\n    handleAddTimer(`quick-${index}`, label, duration)\n  }\n\n  const handleAddDetectedTimer = (seconds: number, index: number) => {\n    handleAddTimer(`detected-${index}`, formatDetectedTime(seconds), seconds)\n  }\n\n  const activeTimerCount = timers.timers.filter((t) => t.isRunning).length\n\n  return (\n    <div className=\"border-t border-border bg-card\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center justify-between px-4 py-3\"\n      >\n        <div className=\"flex items-center gap-2\">\n          <TimerIcon className=\"h-5 w-5 text-primary\" />\n          <span className=\"font-medium text-foreground\">Timers</span>\n          {timers.timers.length > 0 && (\n            <span className=\"rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground\">\n              {timers.timers.length}\n              {activeTimerCount > 0 && (\n                <span className=\"text-primary\"> ({activeTimerCount} active)</span>\n              )}\n            </span>\n          )}\n        </div>\n        {expanded ? (\n          <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n        ) : (\n          <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\n        )}\n      </button>\n\n      {expanded && (\n        <div className=\"space-y-4 px-4 pb-4\">\n          {/* Quick timer buttons */}\n          <div className=\"flex flex-wrap gap-2\">\n            {QUICK_TIMERS.map(({ label, duration }, idx) => (\n              <button\n                key={label}\n                onClick={() => handleAddQuickTimer(label.replace('+', '').trim(), duration, idx)}\n                disabled={loadingTimerId !== null}\n                className=\"flex items-center gap-1 rounded-full border border-border bg-background px-3 py-1.5 text-sm text-foreground transition-colors hover:bg-muted disabled:opacity-50\"\n              >\n                {loadingTimerId === `quick-${idx}` ? (\n                  <Loader2 className=\"h-3 w-3 animate-spin\" />\n                ) : (\n                  <Plus className=\"h-3 w-3\" />\n                )}\n                {label}\n              </button>\n            ))}\n            {aiAvailable && instructionText && <Sparkles className=\"h-4 w-4 text-primary self-center\" />}\n          </div>\n\n          {/* Detected time suggestions */}\n          {detectedTimes.length > 0 && (\n            <div>\n              <p className=\"mb-2 text-xs text-muted-foreground\">\n                Detected in this step:\n              </p>\n              <div className=\"flex flex-wrap gap-2\">\n                {detectedTimes.map((seconds, idx) => (\n                  <button\n                    key={idx}\n                    onClick={() => handleAddDetectedTimer(seconds, idx)}\n                    disabled={loadingTimerId !== null}\n                    className=\"flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1.5 text-sm text-primary transition-colors hover:bg-primary/20 disabled:opacity-50\"\n                  >\n                    {loadingTimerId === `detected-${idx}` ? (\n                      <Loader2 className=\"h-3 w-3 animate-spin\" />\n                    ) : (\n                      <Plus className=\"h-3 w-3\" />\n                    )}\n                    {formatDetectedTime(seconds)}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Timer list */}\n          {timers.timers.length > 0 ? (\n            <div className=\"space-y-2\">\n              {timers.timers.map((timer) => (\n                <TimerWidget\n                  key={timer.id}\n                  timer={timer}\n                  onToggle={() => timers.toggleTimer(timer.id)}\n                  onReset={() => timers.resetTimer(timer.id)}\n                  onDelete={() => timers.deleteTimer(timer.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-center text-sm text-muted-foreground\">\n              No active timers. Add one above!\n            </p>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/TimerWidget.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TimerWidget' has too many lines (81). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":93,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Play, Pause, RotateCcw, X } from 'lucide-react'\nimport type { Timer } from '../hooks/useTimers'\nimport { formatTimerDisplay } from '../hooks/useTimers'\nimport { cn } from '../lib/utils'\n\ninterface TimerWidgetProps {\n  timer: Timer\n  onToggle: () => void\n  onReset: () => void\n  onDelete: () => void\n}\n\nexport default function TimerWidget({\n  timer,\n  onToggle,\n  onReset,\n  onDelete,\n}: TimerWidgetProps) {\n  const isComplete = timer.remaining === 0\n  const progress = ((timer.duration - timer.remaining) / timer.duration) * 100\n\n  return (\n    <div\n      className={cn(\n        'relative overflow-hidden rounded-lg border bg-card p-3',\n        isComplete && 'border-accent bg-accent/10'\n      )}\n    >\n      {/* Progress bar background */}\n      <div\n        className={cn(\n          'absolute inset-0 opacity-20 transition-all',\n          isComplete ? 'bg-accent' : 'bg-primary'\n        )}\n        style={{ width: `${progress}%` }}\n      />\n\n      {/* Content */}\n      <div className=\"relative flex items-center justify-between\">\n        <div className=\"min-w-0 flex-1\">\n          <p className=\"truncate text-sm font-medium text-card-foreground\">\n            {timer.label}\n          </p>\n          <p\n            className={cn(\n              'text-2xl font-mono font-bold tabular-nums',\n              isComplete ? 'text-accent' : 'text-foreground'\n            )}\n          >\n            {formatTimerDisplay(timer.remaining)}\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          {!isComplete && (\n            <>\n              <button\n                onClick={onToggle}\n                className={cn(\n                  'rounded-full p-2 transition-colors',\n                  timer.isRunning\n                    ? 'bg-muted text-muted-foreground hover:bg-muted/80'\n                    : 'bg-primary text-primary-foreground hover:bg-primary/90'\n                )}\n                aria-label={timer.isRunning ? 'Pause' : 'Play'}\n              >\n                {timer.isRunning ? (\n                  <Pause className=\"h-4 w-4\" />\n                ) : (\n                  <Play className=\"h-4 w-4\" />\n                )}\n              </button>\n              <button\n                onClick={onReset}\n                className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-muted/80\"\n                aria-label=\"Reset\"\n              >\n                <RotateCcw className=\"h-4 w-4\" />\n              </button>\n            </>\n          )}\n          <button\n            onClick={onDelete}\n            className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-destructive hover:text-destructive-foreground\"\n            aria-label=\"Delete\"\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsDanger.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsDanger' has too many lines (201). Maximum allowed is 50.","line":6,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":206,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { AlertTriangle, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type ResetPreview } from '../../api/client'\n\nexport default function SettingsDanger() {\n  const [showResetModal, setShowResetModal] = useState(false)\n  const [resetPreview, setResetPreview] = useState<ResetPreview | null>(null)\n  const [resetStep, setResetStep] = useState<1 | 2>(1)\n  const [resetConfirmText, setResetConfirmText] = useState('')\n  const [resetting, setResetting] = useState(false)\n\n  const handleResetClick = async () => {\n    try {\n      const preview = await api.system.resetPreview()\n      setResetPreview(preview)\n      setResetStep(1)\n      setResetConfirmText('')\n      setShowResetModal(true)\n    } catch (error) {\n      console.error('Failed to load reset preview:', error)\n      toast.error('Failed to load reset preview')\n    }\n  }\n\n  const handleResetContinue = () => {\n    setResetStep(2)\n  }\n\n  const handleResetBack = () => {\n    setResetStep(1)\n    setResetConfirmText('')\n  }\n\n  const handleConfirmReset = async () => {\n    if (resetConfirmText !== 'RESET') return\n\n    setResetting(true)\n    try {\n      await api.system.reset('RESET')\n      toast.success('Database reset complete')\n      // Redirect to home/profile creation\n      window.location.href = '/'\n    } catch (error) {\n      console.error('Failed to reset database:', error)\n      toast.error('Failed to reset database')\n    } finally {\n      setResetting(false)\n    }\n  }\n\n  const handleCancelReset = () => {\n    setShowResetModal(false)\n    setResetPreview(null)\n    setResetStep(1)\n    setResetConfirmText('')\n  }\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-2 text-destructive\">\n          <AlertTriangle className=\"h-5 w-5\" />\n          <h2 className=\"text-lg font-medium\">Danger Zone</h2>\n        </div>\n\n        <p className=\"text-sm text-muted-foreground\">\n          Destructive operations that cannot be undone\n        </p>\n\n        <div className=\"rounded-lg border border-destructive/50 bg-destructive/5 p-6\">\n          <h3 className=\"font-medium text-destructive\">Reset Database</h3>\n          <p className=\"mt-1 text-sm text-muted-foreground\">\n            Completely reset the application to factory state\n          </p>\n\n          <ul className=\"mt-4 space-y-1 text-sm text-muted-foreground\">\n            <li>• All recipes (scraped and remixed)</li>\n            <li>• All recipe images</li>\n            <li>• All user profiles</li>\n            <li>• All favorites, collections, and view history</li>\n            <li>• All cached AI data</li>\n          </ul>\n\n          <p className=\"mt-4 text-xs text-muted-foreground\">\n            Search source configurations and AI prompts will be preserved.\n          </p>\n\n          <button\n            onClick={handleResetClick}\n            className=\"mt-4 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90\"\n          >\n            Reset Database\n          </button>\n        </div>\n      </div>\n\n      {/* Database Reset Modal */}\n      {showResetModal && resetPreview && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div\n            className=\"absolute inset-0 bg-black/50\"\n            onClick={handleCancelReset}\n          />\n          <div className=\"relative w-full max-w-md rounded-lg border border-border bg-card p-6 shadow-lg\">\n            {resetStep === 1 ? (\n              <>\n                <div className=\"flex items-center gap-2 text-destructive\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-medium\">Reset Database?</h3>\n                </div>\n\n                <div className=\"mt-4 space-y-4\">\n                  <p className=\"text-sm text-foreground\">\n                    This will permanently delete ALL data from the application:\n                  </p>\n\n                  <div className=\"rounded-lg border border-border bg-muted/50 p-3\">\n                    <ul className=\"space-y-1 text-sm text-muted-foreground\">\n                      <li>• {resetPreview.data_counts.profiles} profiles</li>\n                      <li>\n                        • {resetPreview.data_counts.recipes} recipes (\n                        {resetPreview.data_counts.recipe_images} images)\n                      </li>\n                      <li>• {resetPreview.data_counts.favorites} favorites</li>\n                      <li>• {resetPreview.data_counts.collections} collections</li>\n                      <li>\n                        • {resetPreview.data_counts.view_history} view history\n                        entries\n                      </li>\n                      <li>\n                        •{' '}\n                        {resetPreview.data_counts.ai_suggestions +\n                          resetPreview.data_counts.serving_adjustments}{' '}\n                        cached AI entries\n                      </li>\n                    </ul>\n                  </div>\n\n                  <p className=\"text-sm font-medium text-destructive\">\n                    This action cannot be undone.\n                  </p>\n                </div>\n\n                <div className=\"mt-6 flex justify-end gap-3\">\n                  <button\n                    onClick={handleCancelReset}\n                    className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleResetContinue}\n                    className=\"rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90\"\n                  >\n                    I understand, continue\n                  </button>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"flex items-center gap-2 text-destructive\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-medium\">Confirm Reset</h3>\n                </div>\n\n                <div className=\"mt-4 space-y-4\">\n                  <p className=\"text-sm text-foreground\">\n                    Type{' '}\n                    <code className=\"rounded bg-muted px-1 font-mono\">RESET</code>{' '}\n                    to confirm:\n                  </p>\n\n                  <input\n                    type=\"text\"\n                    value={resetConfirmText}\n                    onChange={(e) => setResetConfirmText(e.target.value)}\n                    placeholder=\"Type RESET\"\n                    className=\"w-full rounded-lg border border-border bg-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary\"\n                  />\n                </div>\n\n                <div className=\"mt-6 flex justify-end gap-3\">\n                  <button\n                    onClick={handleResetBack}\n                    className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                  >\n                    Back\n                  </button>\n                  <button\n                    onClick={handleConfirmReset}\n                    disabled={resetConfirmText !== 'RESET' || resetting}\n                    className=\"flex items-center gap-2 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                  >\n                    {resetting && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n                    Reset Database\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsGeneral.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsGeneral' has too many lines (191). Maximum allowed is 50.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":205,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'SettingsGeneral' has a complexity of 23. Maximum allowed is 10.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":15,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { Key, Check, AlertCircle, Loader2, Github } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type AIStatus, type AIModel } from '../../api/client'\nimport { useAIStatus } from '../../contexts/AIStatusContext'\nimport { cn } from '../../lib/utils'\n\ninterface SettingsGeneralProps {\n  aiStatus: AIStatus | null\n  models: AIModel[]\n  onAIStatusChange: (status: AIStatus) => void\n  onModelsChange: (models: AIModel[]) => void\n}\n\nexport default function SettingsGeneral({\n  aiStatus,\n  models,\n  onAIStatusChange,\n  onModelsChange,\n}: SettingsGeneralProps) {\n  const globalAIStatus = useAIStatus()\n  const [apiKey, setApiKey] = useState('')\n  const [testingKey, setTestingKey] = useState(false)\n  const [savingKey, setSavingKey] = useState(false)\n\n  const getModelName = (modelId: string) => {\n    const model = models.find((m) => m.id === modelId)\n    return model?.name || modelId\n  }\n\n  const handleTestApiKey = async () => {\n    if (!apiKey.trim()) {\n      toast.error('Please enter an API key')\n      return\n    }\n\n    setTestingKey(true)\n    try {\n      const result = await api.ai.testApiKey(apiKey.trim())\n      if (result.success) {\n        toast.success(result.message)\n      } else {\n        toast.error(result.message)\n      }\n    } catch (error) {\n      console.error('Failed to test API key:', error)\n      toast.error('Failed to test API key')\n    } finally {\n      setTestingKey(false)\n    }\n  }\n\n  const handleSaveApiKey = async () => {\n    if (!apiKey.trim()) {\n      toast.error('Please enter an API key')\n      return\n    }\n\n    setSavingKey(true)\n    try {\n      const result = await api.ai.saveApiKey(apiKey.trim())\n      if (result.success) {\n        toast.success(result.message)\n        setApiKey('')\n        const statusData = await api.ai.status()\n        onAIStatusChange(statusData)\n        await globalAIStatus.refresh()\n        const modelsData = await api.ai.models()\n        onModelsChange(modelsData)\n      } else {\n        toast.error(result.message)\n      }\n    } catch (error) {\n      console.error('Failed to save API key:', error)\n      toast.error('Failed to save API key')\n    } finally {\n      setSavingKey(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* OpenRouter API */}\n      <div className=\"rounded-lg border border-border bg-card p-4\">\n        <h2 className=\"mb-4 text-lg font-medium text-foreground\">OpenRouter API</h2>\n\n        <div className=\"mb-4 flex items-center gap-2\">\n          <div\n            className={cn(\n              'h-2 w-2 rounded-full',\n              aiStatus?.available\n                ? 'bg-green-500'\n                : aiStatus?.configured\n                  ? 'bg-yellow-500'\n                  : 'bg-red-500'\n            )}\n          />\n          <span className=\"text-sm text-muted-foreground\">\n            {aiStatus?.available\n              ? 'Connected'\n              : aiStatus?.configured\n                ? 'Invalid key'\n                : 'Not configured'}\n          </span>\n        </div>\n\n        {aiStatus?.configured && !aiStatus?.valid && (\n          <div className=\"mb-4 flex items-center gap-2 rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-3\">\n            <AlertCircle className=\"h-5 w-5 flex-shrink-0 text-yellow-500\" />\n            <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">\n              {aiStatus?.error ||\n                'Your API key appears to be invalid or expired. Please update it.'}\n            </p>\n          </div>\n        )}\n\n        {aiStatus?.available && (\n          <div className=\"mb-4 text-sm text-muted-foreground\">\n            Default model:{' '}\n            <span className=\"font-medium text-foreground\">\n              {getModelName(aiStatus.default_model)}\n            </span>\n          </div>\n        )}\n\n        <div className=\"space-y-3\">\n          <label className=\"block\">\n            <span className=\"mb-1 block text-sm font-medium text-foreground\">\n              {aiStatus?.available ? 'Update API Key' : 'API Key'}\n            </span>\n            <input\n              type=\"password\"\n              value={apiKey}\n              onChange={(e) => setApiKey(e.target.value)}\n              placeholder=\"sk-or-v1-...\"\n              className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n            />\n          </label>\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleTestApiKey}\n              disabled={testingKey || !apiKey.trim()}\n              className=\"flex items-center gap-2 rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n            >\n              {testingKey ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <Check className=\"h-4 w-4\" />\n              )}\n              Test Key\n            </button>\n            <button\n              onClick={handleSaveApiKey}\n              disabled={savingKey || !apiKey.trim()}\n              className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n            >\n              {savingKey ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <Key className=\"h-4 w-4\" />\n              )}\n              Save Key\n            </button>\n          </div>\n        </div>\n\n        <p className=\"mt-4 text-sm text-muted-foreground\">\n          Get your API key from{' '}\n          <a\n            href=\"https://openrouter.ai/keys\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"text-primary hover:underline\"\n          >\n            openrouter.ai/keys\n          </a>\n        </p>\n      </div>\n\n      {/* About */}\n      <div className=\"rounded-lg border border-border bg-card p-4\">\n        <h2 className=\"mb-4 text-lg font-medium text-foreground\">About</h2>\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <div className=\"flex items-center justify-between\">\n            <span>Version</span>\n            <span className=\"font-medium text-foreground\">1.0.0</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span>Source Code</span>\n            <a\n              href=\"https://github.com/matthewdeaves/cookie.git\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"flex items-center gap-1 text-primary hover:underline\"\n            >\n              <Github className=\"h-4 w-4\" />\n              GitHub\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsPrompts.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsPrompts' has too many lines (282). Maximum allowed is 50.","line":21,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":302,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (176). Maximum allowed is 50.","line":124,"column":20,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":299,"endColumn":8},{"ruleId":"complexity","severity":1,"message":"Arrow function has a complexity of 12. Maximum allowed is 10.","line":124,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"complex","endLine":124,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport {\n  AlertCircle,\n  Check,\n  X,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type AIPrompt, type AIModel, type AIStatus } from '../../api/client'\nimport { cn } from '../../lib/utils'\n\ninterface SettingsPromptsProps {\n  aiStatus: AIStatus | null\n  prompts: AIPrompt[]\n  models: AIModel[]\n  onPromptsChange: (prompts: AIPrompt[]) => void\n}\n\nexport default function SettingsPrompts({\n  aiStatus,\n  prompts,\n  models,\n  onPromptsChange,\n}: SettingsPromptsProps) {\n  const [editingPromptType, setEditingPromptType] = useState<string | null>(null)\n  const [editForm, setEditForm] = useState<{\n    system_prompt: string\n    user_prompt_template: string\n    model: string\n    is_active: boolean\n  } | null>(null)\n  const [savingPrompt, setSavingPrompt] = useState(false)\n  const [expandedPrompts, setExpandedPrompts] = useState<Set<string>>(new Set())\n\n  const getModelName = (modelId: string) => {\n    const model = models.find((m) => m.id === modelId)\n    return model?.name || modelId\n  }\n\n  const handleEditPrompt = (prompt: AIPrompt) => {\n    setEditingPromptType(prompt.prompt_type)\n    setEditForm({\n      system_prompt: prompt.system_prompt,\n      user_prompt_template: prompt.user_prompt_template,\n      model: prompt.model,\n      is_active: prompt.is_active,\n    })\n  }\n\n  const handleCancelEdit = () => {\n    setEditingPromptType(null)\n    setEditForm(null)\n  }\n\n  const handleSavePrompt = async () => {\n    if (!editingPromptType || !editForm) return\n\n    setSavingPrompt(true)\n    try {\n      const updated = await api.ai.prompts.update(editingPromptType, editForm)\n      onPromptsChange(\n        prompts.map((p) => (p.prompt_type === editingPromptType ? updated : p))\n      )\n      toast.success('Prompt saved successfully')\n      setEditingPromptType(null)\n      setEditForm(null)\n    } catch (error) {\n      console.error('Failed to save prompt:', error)\n      let errorMessage = 'Failed to save prompt'\n      if (error instanceof Error) {\n        try {\n          const parsed = JSON.parse(error.message)\n          if (parsed.message) {\n            errorMessage = parsed.message\n          }\n        } catch {\n          // Not JSON\n        }\n      }\n      toast.error(errorMessage)\n    } finally {\n      setSavingPrompt(false)\n    }\n  }\n\n  const toggleExpandPrompt = (promptType: string) => {\n    setExpandedPrompts((prev) => {\n      const next = new Set(prev)\n      if (next.has(promptType)) {\n        next.delete(promptType)\n      } else {\n        next.add(promptType)\n      }\n      return next\n    })\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-start gap-3 rounded-lg border border-border bg-card p-4\">\n        <AlertCircle className=\"mt-0.5 h-5 w-5 flex-shrink-0 text-primary\" />\n        <div>\n          <h2 className=\"font-medium text-foreground\">AI Prompts Configuration</h2>\n          <p className=\"text-sm text-muted-foreground\">\n            Customize the prompts used for AI features. Each prompt has a system\n            prompt that sets the AI's behavior and a user prompt template that\n            includes placeholders for dynamic content.\n          </p>\n        </div>\n      </div>\n\n      {!aiStatus?.available && (\n        <div className=\"flex items-center gap-3 rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-4\">\n          <AlertCircle className=\"h-5 w-5 text-yellow-500\" />\n          <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">\n            Configure your OpenRouter API key in the General tab to enable AI\n            features.\n          </p>\n        </div>\n      )}\n\n      {prompts.map((prompt) => {\n        const isEditing = editingPromptType === prompt.prompt_type\n        const isExpanded = expandedPrompts.has(prompt.prompt_type)\n\n        return (\n          <div\n            key={prompt.prompt_type}\n            className=\"rounded-lg border border-border bg-card\"\n          >\n            <div className=\"flex items-center justify-between p-4\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  <h3 className=\"font-medium text-foreground\">{prompt.name}</h3>\n                  {!prompt.is_active && (\n                    <span className=\"rounded bg-muted px-2 py-0.5 text-xs text-muted-foreground\">\n                      Disabled\n                    </span>\n                  )}\n                </div>\n                <p className=\"mt-1 text-sm text-muted-foreground\">\n                  {prompt.description}\n                </p>\n                <div className=\"mt-2 flex items-center gap-2\">\n                  <span className=\"rounded bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary\">\n                    {getModelName(prompt.model)}\n                  </span>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {!isEditing && (\n                  <>\n                    <button\n                      onClick={() => toggleExpandPrompt(prompt.prompt_type)}\n                      className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n                      aria-label={isExpanded ? 'Collapse' : 'Expand'}\n                    >\n                      {isExpanded ? (\n                        <ChevronUp className=\"h-5 w-5\" />\n                      ) : (\n                        <ChevronDown className=\"h-5 w-5\" />\n                      )}\n                    </button>\n                    <button\n                      onClick={() => handleEditPrompt(prompt)}\n                      className=\"rounded-lg bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20\"\n                    >\n                      Edit\n                    </button>\n                  </>\n                )}\n              </div>\n            </div>\n\n            {isExpanded && !isEditing && (\n              <div className=\"border-t border-border px-4 py-4\">\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"mb-1 block text-sm font-medium text-muted-foreground\">\n                      System Prompt\n                    </label>\n                    <pre className=\"whitespace-pre-wrap rounded-lg bg-muted p-3 text-sm text-foreground\">\n                      {prompt.system_prompt}\n                    </pre>\n                  </div>\n                  <div>\n                    <label className=\"mb-1 block text-sm font-medium text-muted-foreground\">\n                      User Prompt Template\n                    </label>\n                    <pre className=\"whitespace-pre-wrap rounded-lg bg-muted p-3 text-sm text-foreground\">\n                      {prompt.user_prompt_template}\n                    </pre>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {isEditing && editForm && (\n              <div className=\"border-t border-border px-4 py-4\">\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"mb-1 block text-sm font-medium text-foreground\">\n                      System Prompt\n                    </label>\n                    <textarea\n                      value={editForm.system_prompt}\n                      onChange={(e) =>\n                        setEditForm({ ...editForm, system_prompt: e.target.value })\n                      }\n                      rows={6}\n                      className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"mb-1 block text-sm font-medium text-foreground\">\n                      User Prompt Template\n                    </label>\n                    <textarea\n                      value={editForm.user_prompt_template}\n                      onChange={(e) =>\n                        setEditForm({\n                          ...editForm,\n                          user_prompt_template: e.target.value,\n                        })\n                      }\n                      rows={4}\n                      className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                    />\n                    <p className=\"mt-1 text-xs text-muted-foreground\">\n                      Use {'{placeholders}'} for dynamic content\n                    </p>\n                  </div>\n                  <div className=\"flex gap-4\">\n                    <div className=\"flex-1\">\n                      <label className=\"mb-1 block text-sm font-medium text-foreground\">\n                        Model\n                      </label>\n                      <select\n                        value={editForm.model}\n                        onChange={(e) =>\n                          setEditForm({ ...editForm, model: e.target.value })\n                        }\n                        className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                      >\n                        {models.map((model) => (\n                          <option key={model.id} value={model.id}>\n                            {model.name}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n                    <div>\n                      <label className=\"mb-1 block text-sm font-medium text-foreground\">\n                        Status\n                      </label>\n                      <button\n                        onClick={() =>\n                          setEditForm({ ...editForm, is_active: !editForm.is_active })\n                        }\n                        className={cn(\n                          'rounded-lg px-4 py-2 text-sm font-medium transition-colors',\n                          editForm.is_active\n                            ? 'bg-green-500/10 text-green-600 hover:bg-green-500/20 dark:text-green-400'\n                            : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                        )}\n                      >\n                        {editForm.is_active ? 'Active' : 'Disabled'}\n                      </button>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-end gap-2\">\n                    <button\n                      onClick={handleCancelEdit}\n                      className=\"flex items-center gap-2 rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                      Cancel\n                    </button>\n                    <button\n                      onClick={handleSavePrompt}\n                      disabled={savingPrompt}\n                      className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                    >\n                      {savingPrompt ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Check className=\"h-4 w-4\" />\n                      )}\n                      Save Changes\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        )\n      })}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsSelectors.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsSelectors' has too many lines (235). Maximum allowed is 50.","line":11,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":245,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (100). Maximum allowed is 50.","line":142,"column":22,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":241,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { Check, Loader2, Play, CheckCircle, XCircle, HelpCircle } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Source } from '../../api/client'\n\ninterface SettingsSelectorsProps {\n  sources: Source[]\n  onSourcesChange: (sources: Source[]) => void\n}\n\nexport default function SettingsSelectors({\n  sources,\n  onSourcesChange,\n}: SettingsSelectorsProps) {\n  const [editingSourceId, setEditingSourceId] = useState<number | null>(null)\n  const [editingSelectorValue, setEditingSelectorValue] = useState('')\n  const [savingSelector, setSavingSelector] = useState(false)\n  const [testingSourceId, setTestingSourceId] = useState<number | null>(null)\n  const [testingAll, setTestingAll] = useState(false)\n\n  const getSourceStatus = (source: Source): 'working' | 'broken' | 'untested' => {\n    if (!source.last_validated_at) return 'untested'\n    if (source.needs_attention || source.consecutive_failures >= 3) return 'broken'\n    return 'working'\n  }\n\n  const formatRelativeTime = (dateStr: string | null): string => {\n    if (!dateStr) return 'Never'\n    const date = new Date(dateStr)\n    const now = new Date()\n    const diffMs = now.getTime() - date.getTime()\n    const diffMins = Math.floor(diffMs / 60000)\n    if (diffMins < 1) return 'Just now'\n    if (diffMins < 60) return `${diffMins}m ago`\n    const diffHours = Math.floor(diffMins / 60)\n    if (diffHours < 24) return `${diffHours}h ago`\n    const diffDays = Math.floor(diffHours / 24)\n    return `${diffDays}d ago`\n  }\n\n  const handleEditSelector = (source: Source) => {\n    setEditingSourceId(source.id)\n    setEditingSelectorValue(source.result_selector)\n  }\n\n  const handleCancelEditSelector = () => {\n    setEditingSourceId(null)\n    setEditingSelectorValue('')\n  }\n\n  const handleSaveSelector = async () => {\n    if (editingSourceId === null) return\n\n    setSavingSelector(true)\n    try {\n      const result = await api.sources.updateSelector(\n        editingSourceId,\n        editingSelectorValue\n      )\n      onSourcesChange(\n        sources.map((s) =>\n          s.id === editingSourceId\n            ? { ...s, result_selector: result.result_selector }\n            : s\n        )\n      )\n      toast.success('Selector updated')\n      setEditingSourceId(null)\n      setEditingSelectorValue('')\n    } catch (error) {\n      console.error('Failed to update selector:', error)\n      toast.error('Failed to update selector')\n    } finally {\n      setSavingSelector(false)\n    }\n  }\n\n  const handleTestSource = async (sourceId: number) => {\n    setTestingSourceId(sourceId)\n    try {\n      const result = await api.sources.test(sourceId)\n      if (result.success) {\n        toast.success(result.message)\n      } else {\n        toast.error(result.message)\n      }\n      // Refresh sources to update status\n      const sourcesData = await api.sources.list()\n      onSourcesChange(sourcesData)\n    } catch (error) {\n      console.error('Failed to test source:', error)\n      toast.error('Failed to test source')\n    } finally {\n      setTestingSourceId(null)\n    }\n  }\n\n  const handleTestAllSources = async () => {\n    setTestingAll(true)\n    try {\n      const result = await api.sources.testAll()\n      toast.success(\n        `Tested ${result.tested} sources: ${result.passed} passed, ${result.failed} failed`\n      )\n      // Refresh sources\n      const sourcesData = await api.sources.list()\n      onSourcesChange(sourcesData)\n    } catch (error) {\n      console.error('Failed to test all sources:', error)\n      toast.error('Failed to test all sources')\n    } finally {\n      setTestingAll(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\">\n        <div>\n          <h2 className=\"text-lg font-medium text-foreground\">\n            Search Source Selector Management\n          </h2>\n          <p className=\"text-sm text-muted-foreground\">\n            Edit CSS selectors and test source connectivity\n          </p>\n        </div>\n        <button\n          onClick={handleTestAllSources}\n          disabled={testingAll}\n          className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n        >\n          {testingAll ? (\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\n          ) : (\n            <Play className=\"h-4 w-4\" />\n          )}\n          Test All Sources\n        </button>\n      </div>\n\n      <div className=\"space-y-3\">\n        {sources.map((source) => {\n          const status = getSourceStatus(source)\n          const isEditing = editingSourceId === source.id\n          const isTesting = testingSourceId === source.id\n\n          return (\n            <div\n              key={source.id}\n              className=\"rounded-lg border border-border bg-card p-4\"\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-foreground\">\n                      {source.name}\n                    </span>\n                    {status === 'working' && (\n                      <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    )}\n                    {status === 'broken' && (\n                      <XCircle className=\"h-4 w-4 text-red-500\" />\n                    )}\n                    {status === 'untested' && (\n                      <HelpCircle className=\"h-4 w-4 text-muted-foreground\" />\n                    )}\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">{source.host}</p>\n                  {source.consecutive_failures >= 3 && (\n                    <p className=\"mt-1 text-xs text-red-500\">\n                      Failed {source.consecutive_failures} times - auto-disabled\n                    </p>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs text-muted-foreground\">\n                    Last tested: {formatRelativeTime(source.last_validated_at)}\n                  </span>\n                  <button\n                    onClick={() => handleTestSource(source.id)}\n                    disabled={isTesting || testingAll}\n                    className=\"flex items-center gap-1 rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n                  >\n                    {isTesting ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Play className=\"h-4 w-4\" />\n                    )}\n                    Test\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <label className=\"mb-1 block text-xs font-medium text-muted-foreground\">\n                  CSS Selector\n                </label>\n                {isEditing ? (\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"text\"\n                      value={editingSelectorValue}\n                      onChange={(e) => setEditingSelectorValue(e.target.value)}\n                      className=\"flex-1 rounded-lg border border-border bg-input-background px-3 py-1.5 font-mono text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                    />\n                    <button\n                      onClick={handleCancelEditSelector}\n                      className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                    >\n                      Cancel\n                    </button>\n                    <button\n                      onClick={handleSaveSelector}\n                      disabled={savingSelector}\n                      className=\"flex items-center gap-1 rounded-lg bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                    >\n                      {savingSelector ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Check className=\"h-4 w-4\" />\n                      )}\n                      Save\n                    </button>\n                  </div>\n                ) : (\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 rounded bg-muted px-3 py-1.5 font-mono text-sm text-foreground\">\n                      {source.result_selector || '(none)'}\n                    </code>\n                    <button\n                      onClick={() => handleEditSelector(source)}\n                      className=\"rounded-lg bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20\"\n                    >\n                      Edit\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsSources.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsSources' has too many lines (108). Maximum allowed is 50.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":119,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { Loader2, ToggleLeft, ToggleRight } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Source } from '../../api/client'\nimport { cn } from '../../lib/utils'\n\ninterface SettingsSourcesProps {\n  sources: Source[]\n  onSourcesChange: (sources: Source[]) => void\n}\n\nexport default function SettingsSources({\n  sources,\n  onSourcesChange,\n}: SettingsSourcesProps) {\n  const [togglingSourceId, setTogglingSourceId] = useState<number | null>(null)\n  const [bulkToggling, setBulkToggling] = useState(false)\n\n  const enabledCount = sources.filter((s) => s.is_enabled).length\n\n  const handleToggleSource = async (sourceId: number) => {\n    setTogglingSourceId(sourceId)\n    try {\n      const result = await api.sources.toggle(sourceId)\n      onSourcesChange(\n        sources.map((s) =>\n          s.id === sourceId ? { ...s, is_enabled: result.is_enabled } : s\n        )\n      )\n    } catch (error) {\n      console.error('Failed to toggle source:', error)\n      toast.error('Failed to toggle source')\n    } finally {\n      setTogglingSourceId(null)\n    }\n  }\n\n  const handleBulkToggle = async (enable: boolean) => {\n    setBulkToggling(true)\n    try {\n      await api.sources.bulkToggle(enable)\n      onSourcesChange(sources.map((s) => ({ ...s, is_enabled: enable })))\n      toast.success(enable ? 'All sources enabled' : 'All sources disabled')\n    } catch (error) {\n      console.error('Failed to bulk toggle sources:', error)\n      toast.error('Failed to update sources')\n    } finally {\n      setBulkToggling(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\">\n        <div>\n          <h2 className=\"text-lg font-medium text-foreground\">Recipe Sources</h2>\n          <p className=\"text-sm text-muted-foreground\">\n            {enabledCount} of {sources.length} sources currently enabled\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => handleBulkToggle(true)}\n            disabled={bulkToggling || enabledCount === sources.length}\n            className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n          >\n            Enable All\n          </button>\n          <button\n            onClick={() => handleBulkToggle(false)}\n            disabled={bulkToggling || enabledCount === 0}\n            className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n          >\n            Disable All\n          </button>\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        {sources.map((source) => (\n          <div\n            key={source.id}\n            className={cn(\n              'flex items-center justify-between rounded-lg border p-4 transition-colors',\n              source.is_enabled\n                ? 'border-border bg-card'\n                : 'border-border/50 bg-muted/30'\n            )}\n          >\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"font-medium text-foreground\">{source.name}</span>\n                {source.is_enabled && (\n                  <span className=\"rounded bg-green-500/10 px-2 py-0.5 text-xs font-medium text-green-600 dark:text-green-400\">\n                    Active\n                  </span>\n                )}\n              </div>\n              <p className=\"text-sm text-muted-foreground\">{source.host}</p>\n            </div>\n            <button\n              onClick={() => handleToggleSource(source.id)}\n              disabled={togglingSourceId === source.id}\n              className=\"text-muted-foreground transition-colors hover:text-foreground disabled:opacity-50\"\n            >\n              {togglingSourceId === source.id ? (\n                <Loader2 className=\"h-6 w-6 animate-spin\" />\n              ) : source.is_enabled ? (\n                <ToggleRight className=\"h-8 w-8 text-primary\" />\n              ) : (\n                <ToggleLeft className=\"h-8 w-8\" />\n              )}\n            </button>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/SettingsUsers.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SettingsUsers' has too many lines (233). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":245,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'SettingsUsers' has a complexity of 20. Maximum allowed is 10.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":13,"endColumn":38},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (54). Maximum allowed is 50.","line":80,"column":25,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":133,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { Trash2, AlertTriangle, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type ProfileWithStats, type DeletionPreview } from '../../api/client'\nimport { cn } from '../../lib/utils'\n\ninterface SettingsUsersProps {\n  profiles: ProfileWithStats[]\n  currentProfileId?: number\n  onProfilesChange: (profiles: ProfileWithStats[]) => void\n}\n\nexport default function SettingsUsers({\n  profiles,\n  currentProfileId,\n  onProfilesChange,\n}: SettingsUsersProps) {\n  const [showDeleteModal, setShowDeleteModal] = useState(false)\n  const [deletePreview, setDeletePreview] = useState<DeletionPreview | null>(null)\n  const [deletingId, setDeletingId] = useState<number | null>(null)\n  const [deleting, setDeleting] = useState(false)\n\n  const formatDate = (dateStr: string): string => {\n    return new Date(dateStr).toLocaleDateString()\n  }\n\n  const handleDeleteClick = async (profileId: number) => {\n    try {\n      const preview = await api.profiles.deletionPreview(profileId)\n      setDeletePreview(preview)\n      setDeletingId(profileId)\n      setShowDeleteModal(true)\n    } catch (error) {\n      console.error('Failed to load deletion preview:', error)\n      toast.error('Failed to load profile info')\n    }\n  }\n\n  const handleConfirmDelete = async () => {\n    if (!deletingId) return\n\n    setDeleting(true)\n    try {\n      await api.profiles.delete(deletingId)\n      onProfilesChange(profiles.filter((p) => p.id !== deletingId))\n      toast.success('Profile deleted successfully')\n      setShowDeleteModal(false)\n      setDeletePreview(null)\n      setDeletingId(null)\n    } catch (error) {\n      console.error('Failed to delete profile:', error)\n      toast.error('Failed to delete profile')\n    } finally {\n      setDeleting(false)\n    }\n  }\n\n  const handleCancelDelete = () => {\n    setShowDeleteModal(false)\n    setDeletePreview(null)\n    setDeletingId(null)\n  }\n\n  return (\n    <>\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-lg font-medium text-foreground\">User Management</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              Manage user profiles and their data\n            </p>\n          </div>\n          <span className=\"text-sm text-muted-foreground\">\n            {profiles.length} profile{profiles.length !== 1 ? 's' : ''}\n          </span>\n        </div>\n\n        <div className=\"space-y-3\">\n          {profiles.map((profile) => {\n            const isCurrent = profile.id === currentProfileId\n\n            return (\n              <div\n                key={profile.id}\n                className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  {/* Avatar */}\n                  <div\n                    className=\"h-10 w-10 rounded-full\"\n                    style={{ backgroundColor: profile.avatar_color }}\n                  />\n                  <div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-foreground\">\n                        {profile.name}\n                      </span>\n                      {isCurrent && (\n                        <span className=\"rounded bg-primary/10 px-2 py-0.5 text-xs text-primary\">\n                          Current\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Created {formatDate(profile.created_at)}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {profile.stats.favorites} favorites ·{' '}\n                      {profile.stats.collections} collections ·{' '}\n                      {profile.stats.remixes} remixes\n                    </div>\n                  </div>\n                </div>\n\n                <button\n                  onClick={() => handleDeleteClick(profile.id)}\n                  disabled={isCurrent}\n                  className={cn(\n                    'rounded p-2 transition-colors',\n                    isCurrent\n                      ? 'cursor-not-allowed text-muted-foreground/50'\n                      : 'text-muted-foreground hover:bg-destructive/10 hover:text-destructive'\n                  )}\n                  title={\n                    isCurrent ? 'Cannot delete current profile' : 'Delete profile'\n                  }\n                >\n                  <Trash2 className=\"h-5 w-5\" />\n                </button>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n\n      {/* Delete Profile Modal */}\n      {showDeleteModal && deletePreview && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div\n            className=\"absolute inset-0 bg-black/50\"\n            onClick={handleCancelDelete}\n          />\n          <div className=\"relative w-full max-w-md rounded-lg border border-border bg-card p-6 shadow-lg\">\n            <div className=\"flex items-center gap-2 text-destructive\">\n              <AlertTriangle className=\"h-5 w-5\" />\n              <h3 className=\"text-lg font-medium\">Delete Profile?</h3>\n            </div>\n\n            <div className=\"mt-4 space-y-4\">\n              {/* Profile info */}\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className=\"h-12 w-12 rounded-full\"\n                  style={{ backgroundColor: deletePreview.profile.avatar_color }}\n                />\n                <div>\n                  <div className=\"font-medium text-foreground\">\n                    {deletePreview.profile.name}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Created {formatDate(deletePreview.profile.created_at)}\n                  </div>\n                </div>\n              </div>\n\n              {/* Data summary */}\n              <div className=\"rounded-lg border border-border bg-muted/50 p-3\">\n                <div className=\"mb-2 text-sm font-medium text-foreground\">\n                  Data to be deleted:\n                </div>\n                <ul className=\"space-y-1 text-sm text-muted-foreground\">\n                  {deletePreview.data_to_delete.remixes > 0 && (\n                    <li>\n                      • {deletePreview.data_to_delete.remixes} remixed recipe\n                      {deletePreview.data_to_delete.remixes !== 1 ? 's' : ''} (\n                      {deletePreview.data_to_delete.remix_images} images)\n                    </li>\n                  )}\n                  {deletePreview.data_to_delete.favorites > 0 && (\n                    <li>\n                      • {deletePreview.data_to_delete.favorites} favorite\n                      {deletePreview.data_to_delete.favorites !== 1 ? 's' : ''}\n                    </li>\n                  )}\n                  {deletePreview.data_to_delete.collections > 0 && (\n                    <li>\n                      • {deletePreview.data_to_delete.collections} collection\n                      {deletePreview.data_to_delete.collections !== 1 ? 's' : ''} (\n                      {deletePreview.data_to_delete.collection_items} items)\n                    </li>\n                  )}\n                  {deletePreview.data_to_delete.view_history > 0 && (\n                    <li>\n                      • {deletePreview.data_to_delete.view_history} view history\n                      entries\n                    </li>\n                  )}\n                  {(deletePreview.data_to_delete.scaling_cache > 0 ||\n                    deletePreview.data_to_delete.discover_cache > 0) && (\n                    <li>• Cached AI data</li>\n                  )}\n                  {deletePreview.data_to_delete.remixes === 0 &&\n                    deletePreview.data_to_delete.favorites === 0 &&\n                    deletePreview.data_to_delete.collections === 0 &&\n                    deletePreview.data_to_delete.view_history === 0 &&\n                    deletePreview.data_to_delete.scaling_cache === 0 &&\n                    deletePreview.data_to_delete.discover_cache === 0 && (\n                      <li>• No associated data</li>\n                    )}\n                </ul>\n              </div>\n\n              {/* Warning */}\n              <div className=\"text-sm text-destructive\">\n                This action cannot be undone. All data will be permanently deleted.\n              </div>\n            </div>\n\n            <div className=\"mt-6 flex justify-end gap-3\">\n              <button\n                onClick={handleCancelDelete}\n                className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirmDelete}\n                disabled={deleting}\n                className=\"flex items-center gap-2 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:cursor-not-allowed disabled:opacity-50\"\n              >\n                {deleting ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <Trash2 className=\"h-4 w-4\" />\n                )}\n                Delete Profile\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/settings/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/contexts/AIStatusContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":28,"suppressions":[{"kind":"directive","justification":"Hook is tightly coupled to provider"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/contexts/ProfileContext.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'ProfileProvider' has too many lines (125). Maximum allowed is 50.","line":32,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":156,"endColumn":2}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":20,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":20,"endColumn":27,"suppressions":[{"kind":"directive","justification":"Hook is tightly coupled to provider"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react'\nimport { toast } from 'sonner'\nimport { api, type Profile, type RecipeDetail } from '../api/client'\n\ninterface ProfileContextType {\n  profile: Profile | null\n  theme: 'light' | 'dark'\n  favoriteRecipeIds: Set<number>\n  loading: boolean\n  selectProfile: (profile: Profile) => Promise<void>\n  logout: () => void\n  toggleTheme: () => Promise<void>\n  toggleFavorite: (recipe: RecipeDetail) => Promise<void>\n  isFavorite: (recipeId: number) => boolean\n}\n\nconst ProfileContext = createContext<ProfileContextType | null>(null)\n\n// eslint-disable-next-line react-refresh/only-export-components -- Hook is tightly coupled to provider\nexport function useProfile() {\n  const context = useContext(ProfileContext)\n  if (!context) {\n    throw new Error('useProfile must be used within a ProfileProvider')\n  }\n  return context\n}\n\ninterface ProfileProviderProps {\n  children: ReactNode\n}\n\nexport function ProfileProvider({ children }: ProfileProviderProps) {\n  const [profile, setProfile] = useState<Profile | null>(null)\n  const [theme, setTheme] = useState<'light' | 'dark'>('light')\n  const [favoriteRecipeIds, setFavoriteRecipeIds] = useState<Set<number>>(new Set())\n  const [loading, setLoading] = useState(true)\n\n  // Apply theme class to document\n  useEffect(() => {\n    if (theme === 'dark') {\n      document.documentElement.classList.add('dark')\n    } else {\n      document.documentElement.classList.remove('dark')\n    }\n  }, [theme])\n\n  // Check for existing session on mount\n  useEffect(() => {\n    const checkSession = async () => {\n      try {\n        // Try to get the current profile from session\n        // Check if there's a profile with an active session (cookie-based)\n        // For now, we don't persist sessions across reloads, so just set loading false\n        await api.profiles.list()\n        setLoading(false)\n      } catch (error) {\n        console.error('Failed to check session:', error)\n        setLoading(false)\n      }\n    }\n    checkSession()\n  }, [])\n\n  // Load favorites when profile changes\n  useEffect(() => {\n    // Clear favorites and skip API call if no profile\n    if (!profile) {\n      // Use callback form to satisfy react-hooks/set-state-in-effect\n      Promise.resolve().then(() => setFavoriteRecipeIds(new Set()))\n      return\n    }\n\n    api.favorites\n      .list()\n      .then((favorites) => setFavoriteRecipeIds(new Set(favorites.map((f) => f.recipe.id))))\n      .catch((error) => console.error('Failed to load favorites:', error))\n  }, [profile])\n\n  const selectProfile = useCallback(async (selectedProfile: Profile) => {\n    try {\n      await api.profiles.select(selectedProfile.id)\n      setProfile(selectedProfile)\n      setTheme(selectedProfile.theme as 'light' | 'dark')\n    } catch (error) {\n      console.error('Failed to select profile:', error)\n      throw error\n    }\n  }, [])\n\n  const logout = useCallback(() => {\n    setProfile(null)\n    setFavoriteRecipeIds(new Set())\n  }, [])\n\n  const toggleTheme = useCallback(async () => {\n    if (!profile) return\n\n    const newTheme = theme === 'light' ? 'dark' : 'light'\n    setTheme(newTheme)\n\n    try {\n      const updated = await api.profiles.update(profile.id, {\n        ...profile,\n        theme: newTheme,\n      })\n      setProfile(updated)\n    } catch (error) {\n      console.error('Failed to update theme:', error)\n      setTheme(theme) // Revert on error\n    }\n  }, [profile, theme])\n\n  const toggleFavorite = useCallback(async (recipe: RecipeDetail) => {\n    const isFav = favoriteRecipeIds.has(recipe.id)\n    try {\n      if (isFav) {\n        await api.favorites.remove(recipe.id)\n        setFavoriteRecipeIds((prev) => {\n          const next = new Set(prev)\n          next.delete(recipe.id)\n          return next\n        })\n        toast.success('Removed from favorites')\n      } else {\n        await api.favorites.add(recipe.id)\n        setFavoriteRecipeIds((prev) => new Set(prev).add(recipe.id))\n        toast.success('Added to favorites')\n      }\n    } catch (error) {\n      console.error('Failed to toggle favorite:', error)\n      toast.error('Failed to update favorites')\n    }\n  }, [favoriteRecipeIds])\n\n  const isFavorite = useCallback((recipeId: number) => {\n    return favoriteRecipeIds.has(recipeId)\n  }, [favoriteRecipeIds])\n\n  return (\n    <ProfileContext.Provider\n      value={{\n        profile,\n        theme,\n        favoriteRecipeIds,\n        loading,\n        selectProfile,\n        logout,\n        toggleTheme,\n        toggleFavorite,\n        isFavorite,\n      }}\n    >\n      {children}\n    </ProfileContext.Provider>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/hooks/useAsync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/hooks/useTimers.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'useTimers' has too many lines (169). Maximum allowed is 50.","line":21,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":189,"endColumn":2},{"ruleId":"max-nested-callbacks","severity":1,"message":"Too many nested callbacks (4). Maximum allowed is 3.","line":60,"column":20,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":75,"endColumn":12},{"ruleId":"max-nested-callbacks","severity":1,"message":"Too many nested callbacks (4). Maximum allowed is 3.","line":95,"column":18,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":110,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react'\n\nexport interface Timer {\n  id: string\n  label: string\n  duration: number // seconds\n  remaining: number // seconds\n  isRunning: boolean\n}\n\nexport interface UseTimersReturn {\n  timers: Timer[]\n  addTimer: (label: string, duration: number, autoStart?: boolean) => string\n  startTimer: (id: string) => void\n  pauseTimer: (id: string) => void\n  resetTimer: (id: string) => void\n  deleteTimer: (id: string) => void\n  toggleTimer: (id: string) => void\n}\n\nexport function useTimers(onTimerComplete?: (timer: Timer) => void): UseTimersReturn {\n  const [timers, setTimers] = useState<Timer[]>([])\n  const intervalsRef = useRef<Map<string, number>>(new Map())\n  const onCompleteRef = useRef(onTimerComplete)\n\n  // Keep callback ref up to date\n  useEffect(() => {\n    onCompleteRef.current = onTimerComplete\n  }, [onTimerComplete])\n\n  // Cleanup intervals on unmount\n  useEffect(() => {\n    const intervals = intervalsRef.current\n    return () => {\n      intervals.forEach((intervalId) => {\n        clearInterval(intervalId)\n      })\n    }\n  }, [])\n\n  const addTimer = useCallback((label: string, duration: number, autoStart: boolean = true): string => {\n    const id = crypto.randomUUID()\n\n    // Add timer to state FIRST to ensure it exists before interval ticks\n    setTimers((prev) => [\n      ...prev,\n      {\n        id,\n        label,\n        duration,\n        remaining: duration,\n        isRunning: autoStart,\n      },\n    ])\n\n    // Set up interval AFTER state update is queued (timer will exist before first tick)\n    if (autoStart) {\n      const intervalId = window.setInterval(() => {\n        setTimers((prev) =>\n          prev.map((timer) => {\n            if (timer.id !== id) return timer\n            if (!timer.isRunning) return timer\n\n            const newRemaining = timer.remaining - 1\n\n            if (newRemaining <= 0) {\n              // Timer completed\n              clearInterval(intervalsRef.current.get(id))\n              intervalsRef.current.delete(id)\n              onCompleteRef.current?.({ ...timer, remaining: 0, isRunning: false })\n              return { ...timer, remaining: 0, isRunning: false }\n            }\n\n            return { ...timer, remaining: newRemaining }\n          })\n        )\n      }, 1000)\n\n      intervalsRef.current.set(id, intervalId)\n    }\n\n    return id\n  }, [])\n\n  const startTimer = useCallback((id: string) => {\n    // Clear any existing interval for this timer\n    const existingInterval = intervalsRef.current.get(id)\n    if (existingInterval) {\n      clearInterval(existingInterval)\n    }\n\n    // Start new interval\n    const intervalId = window.setInterval(() => {\n      setTimers((prev) =>\n        prev.map((timer) => {\n          if (timer.id !== id) return timer\n          if (!timer.isRunning) return timer\n\n          const newRemaining = timer.remaining - 1\n\n          if (newRemaining <= 0) {\n            // Timer completed\n            clearInterval(intervalsRef.current.get(id))\n            intervalsRef.current.delete(id)\n            onCompleteRef.current?.({ ...timer, remaining: 0, isRunning: false })\n            return { ...timer, remaining: 0, isRunning: false }\n          }\n\n          return { ...timer, remaining: newRemaining }\n        })\n      )\n    }, 1000)\n\n    intervalsRef.current.set(id, intervalId)\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id ? { ...timer, isRunning: true } : timer\n      )\n    )\n  }, [])\n\n  const pauseTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id ? { ...timer, isRunning: false } : timer\n      )\n    )\n  }, [])\n\n  const resetTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id\n          ? { ...timer, remaining: timer.duration, isRunning: false }\n          : timer\n      )\n    )\n  }, [])\n\n  const deleteTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) => prev.filter((timer) => timer.id !== id))\n  }, [])\n\n  const toggleTimer = useCallback(\n    (id: string) => {\n      const timer = timers.find((t) => t.id === id)\n      if (!timer) return\n\n      if (timer.isRunning) {\n        pauseTimer(id)\n      } else {\n        startTimer(id)\n      }\n    },\n    [timers, pauseTimer, startTimer]\n  )\n\n  return {\n    timers,\n    addTimer,\n    startTimer,\n    pauseTimer,\n    resetTimer,\n    deleteTimer,\n    toggleTimer,\n  }\n}\n\n/**\n * Detects time mentions in text and returns durations in seconds.\n *\n * Supports patterns like:\n * - \"15 minutes\", \"15 min\", \"15m\"\n * - \"2 hours\", \"2 hr\", \"2h\"\n * - \"30 seconds\", \"30 sec\", \"30s\"\n */\nexport function detectTimes(text: string): number[] {\n  const times: number[] = []\n  const seen = new Set<string>()\n\n  // Patterns for different time units\n  const patterns = [\n    { regex: /(\\d+)\\s*(?:hours?|hrs?|h)\\b/gi, multiplier: 3600 },\n    { regex: /(\\d+)\\s*(?:minutes?|mins?|m)\\b/gi, multiplier: 60 },\n    { regex: /(\\d+)\\s*(?:seconds?|secs?|s)\\b/gi, multiplier: 1 },\n  ]\n\n  for (const { regex, multiplier } of patterns) {\n    let match\n    while ((match = regex.exec(text)) !== null) {\n      const value = parseInt(match[1], 10)\n      const seconds = value * multiplier\n      const key = `${match.index}-${value}-${multiplier}`\n      if (!seen.has(key) && seconds > 0) {\n        seen.add(key)\n        times.push(seconds)\n      }\n    }\n  }\n\n  // Sort by appearance in text (earlier matches first)\n  return times\n}\n\n/**\n * Formats seconds as a human-readable time string.\n * e.g., 90 -> \"1:30\", 3661 -> \"1:01:01\"\n */\nexport function formatTimerDisplay(seconds: number): string {\n  const hrs = Math.floor(seconds / 3600)\n  const mins = Math.floor((seconds % 3600) / 60)\n  const secs = seconds % 60\n\n  if (hrs > 0) {\n    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n  return `${mins}:${secs.toString().padStart(2, '0')}`\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/hooks/useWakeLock.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'useWakeLock' has too many lines (124). Maximum allowed is 50.","line":47,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":170,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useCallback } from 'react'\n\n// Silent MP4 video (base64) - ~1KB, used as fallback for older browsers\n// This is a minimal valid MP4 that plays silently\nconst SILENT_VIDEO_BASE64 =\n  'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAA' +\n  'NBtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5' +\n  'YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6' +\n  'Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVi' +\n  'bG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9' +\n  'MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MDgg' +\n  'OHg4ZGN0PTEgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZz' +\n  'ZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0w' +\n  'IGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRy' +\n  'YT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0' +\n  'PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0y' +\n  'My4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFx' +\n  'PTE6MS4wMACAAAAAwWWIhAAz//727L4FNf2f0JcRLMXaSnA+KqSAgHc0wAAAAwAAAwAAFgn0AAAA' +\n  'AAIBAAADAAMAAAMAAAMAAFAAAAB4AAABpjgBAAZAAAABgQAAAEQQACAAAAAABIgYF//+l3EXpve' +\n  'bZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00' +\n  'IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3Jn' +\n  'L3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMAAAAUZnR5cGlzb20AAAIAaXNvbWlz' +\n  'bzIAAAAIZnJlZQAAANhtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyAAAAFGZ0eXBpc29t' +\n  'AAACAGlzb21pc28yAAAACGZyZWUAAADYbWRhdAAAAq4GBf//qtxF6b3m2Ui3lizYINkj7u94MgAA' +\n  'AAhtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAAZAABAAABAAAAAAAAAAAAAAAAAQAAAAAAAA' +\n  'AAAAAAAAAAAQAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAB' +\n  'pHRyYWsAAABcdGtoZAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAZAAAAAAAAAAAAAAAAAAAAAABAAAAAA' +\n  'AAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAJHbWRpYQAAACBtZGhkAAAA' +\n  'AAAAAAAAAAAAAAA8AAAABQBVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRl' +\n  'b0hhbmRsZXIAAAAA3G1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAA' +\n  'AAAAAQAAAAx1cmwgAAAAAQAAAJxzdGJsAAAAmHN0c2QAAAAAAAAAAQAAAIhhdmMxAAAAAAAAAAEA' +\n  'AAAAAAAAAAAAAAAAAAAAACgAIABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +\n  'AAAAAAAAAAAAGP//AAAAMWF2Y0MBZAAK/+EAGGdkAAqs2UHgloQAAAMABAAAAwAoPGDGWAEABmjr' +\n  '48siwAAAABhzdHRzAAAAAAAAAAEAAAABAAAFAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEA' +\n  'AAAUc3RzegAAAAAAAAL0AAAAAQAAABRzdGNvAAAAAAAAAAEAAAAwAAAAYnVkdGEAAABabWV0YQAA' +\n  'AAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRh' +\n  'dGEAAAABAAAAAExhdmY1Ni40MC4xMDE='\n\n/**\n * useWakeLock - Prevents the screen from locking while active\n *\n * Uses the Screen Wake Lock API (iOS 16.4+, Chrome 84+) with a silent video\n * fallback for older browsers.\n *\n * @param enabled - Whether wake lock should be active (default: true)\n */\nexport function useWakeLock(enabled: boolean = true): void {\n  const wakeLockRef = useRef<WakeLockSentinel | null>(null)\n  const videoRef = useRef<HTMLVideoElement | null>(null)\n  const usingFallbackRef = useRef(false)\n\n  // Check if Screen Wake Lock API is supported\n  const isWakeLockSupported = useCallback(() => {\n    return 'wakeLock' in navigator\n  }, [])\n\n  // Request wake lock using native API\n  const requestWakeLock = useCallback(async () => {\n    if (!isWakeLockSupported()) {\n      return false\n    }\n\n    try {\n      wakeLockRef.current = await navigator.wakeLock.request('screen')\n\n      // Re-acquire wake lock if released (e.g., tab becomes visible again)\n      wakeLockRef.current.addEventListener('release', () => {\n        wakeLockRef.current = null\n      })\n\n      return true\n    } catch {\n      // Wake lock request failed (e.g., low battery, permissions)\n      return false\n    }\n  }, [isWakeLockSupported])\n\n  // Release wake lock\n  const releaseWakeLock = useCallback(async () => {\n    if (wakeLockRef.current) {\n      try {\n        await wakeLockRef.current.release()\n      } catch {\n        // Ignore release errors\n      }\n      wakeLockRef.current = null\n    }\n  }, [])\n\n  // Start video fallback for older browsers\n  const startVideoFallback = useCallback(() => {\n    if (videoRef.current) {\n      return // Already created\n    }\n\n    const video = document.createElement('video')\n    video.setAttribute('playsinline', '')\n    video.setAttribute('muted', '')\n    video.setAttribute('loop', '')\n    video.muted = true\n    video.src = SILENT_VIDEO_BASE64\n    video.style.position = 'fixed'\n    video.style.top = '-9999px'\n    video.style.left = '-9999px'\n    video.style.width = '1px'\n    video.style.height = '1px'\n    video.style.opacity = '0.01'\n\n    document.body.appendChild(video)\n    videoRef.current = video\n\n    // Try to play (may require user interaction on iOS)\n    video.play().catch(() => {\n      // Silent fail - will try again on user interaction\n    })\n\n    usingFallbackRef.current = true\n  }, [])\n\n  // Stop video fallback\n  const stopVideoFallback = useCallback(() => {\n    if (videoRef.current) {\n      videoRef.current.pause()\n      videoRef.current.remove()\n      videoRef.current = null\n    }\n    usingFallbackRef.current = false\n  }, [])\n\n  // Main effect to manage wake lock lifecycle\n  useEffect(() => {\n    if (!enabled) {\n      releaseWakeLock()\n      stopVideoFallback()\n      return\n    }\n\n    let mounted = true\n\n    const enableWakeLock = async () => {\n      // Try native API first\n      const success = await requestWakeLock()\n\n      if (!success && mounted) {\n        // Fall back to video technique\n        startVideoFallback()\n      }\n    }\n\n    enableWakeLock()\n\n    // Re-acquire wake lock when page becomes visible\n    const handleVisibilityChange = async () => {\n      if (document.visibilityState === 'visible' && mounted && enabled) {\n        if (!usingFallbackRef.current) {\n          await requestWakeLock()\n        }\n      }\n    }\n\n    document.addEventListener('visibilitychange', handleVisibilityChange)\n\n    return () => {\n      mounted = false\n      releaseWakeLock()\n      stopVideoFallback()\n      document.removeEventListener('visibilitychange', handleVisibilityChange)\n    }\n  }, [enabled, requestWakeLock, releaseWakeLock, startVideoFallback, stopVideoFallback])\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/lib/audio.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/lib/formatting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/router.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":17,"column":10,"nodeType":"Identifier","messageId":"localComponents","endLine":17,"endColumn":19,"suppressions":[{"kind":"directive","justification":"Internal router component, not exported for reuse"}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":29,"column":10,"nodeType":"Identifier","messageId":"localComponents","endLine":29,"endColumn":24,"suppressions":[{"kind":"directive","justification":"Internal router component, not exported for reuse"}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":49,"column":10,"nodeType":"Identifier","messageId":"localComponents","endLine":49,"endColumn":21,"suppressions":[{"kind":"directive","justification":"Internal router component, not exported for reuse"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/AllRecipes.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'AllRecipes' has too many lines (89). Maximum allowed is 50.","line":9,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":97,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { ArrowLeft, BookOpen } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type HistoryItem } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\n\nexport default function AllRecipes() {\n  const navigate = useNavigate()\n  const [history, setHistory] = useState<HistoryItem[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadHistory()\n  }, [])\n\n  const loadHistory = async () => {\n    try {\n      // Load all history (use large limit)\n      const data = await api.history.list(1000)\n      setHistory(data)\n    } catch (error) {\n      console.error('Failed to load recipes:', error)\n      toast.error('Failed to load recipes')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRecipeClick = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    navigate(`/recipe/${recipeId}`)\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={() => navigate('/home')}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">All Recipes</h1>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <RecipeGridSkeleton count={8} />\n          ) : history.length > 0 ? (\n            <>\n              <p className=\"mb-4 text-sm text-muted-foreground\">\n                {history.length} recipe{history.length !== 1 ? 's' : ''}\n              </p>\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n                {history.map((item) => (\n                  <RecipeCard\n                    key={item.recipe.id}\n                    recipe={item.recipe}\n                    onClick={() => handleRecipeClick(item.recipe.id)}\n                  />\n                ))}\n              </div>\n            </>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <BookOpen className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No recipes viewed yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Start browsing and viewing recipes to see them here\n              </p>\n              <button\n                onClick={() => navigate('/home')}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Browse Recipes\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/CollectionDetail.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'CollectionDetail' has too many lines (190). Maximum allowed is 50.","line":9,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":198,"endColumn":2}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCollection'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [collectionId, loadCollection]","fix":{"range":[1012,1026],"text":"[collectionId, loadCollection]"}}],"suppressions":[{"kind":"directive","justification":"loadCollection is stable, only re-run when collectionId changes"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport { ArrowLeft, Trash2, X, FolderOpen } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type CollectionDetail as CollectionDetailType, type Recipe } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { LoadingSpinner } from '../components/Skeletons'\n\nexport default function CollectionDetail() {\n  const navigate = useNavigate()\n  const { id } = useParams<{ id: string }>()\n  const collectionId = Number(id)\n\n  const [collection, setCollection] = useState<CollectionDetailType | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)\n  const [deleting, setDeleting] = useState(false)\n\n  useEffect(() => {\n    if (collectionId) {\n      loadCollection()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- loadCollection is stable, only re-run when collectionId changes\n  }, [collectionId])\n\n  const loadCollection = async () => {\n    try {\n      const data = await api.collections.get(collectionId)\n      setCollection(data)\n    } catch (error) {\n      console.error('Failed to load collection:', error)\n      toast.error('Failed to load collection')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRemoveRecipe = async (recipe: Recipe) => {\n    if (!collection) return\n\n    try {\n      await api.collections.removeRecipe(collectionId, recipe.id)\n      setCollection({\n        ...collection,\n        recipes: collection.recipes.filter((item) => item.recipe.id !== recipe.id),\n      })\n      toast.success('Removed from collection')\n    } catch (error) {\n      console.error('Failed to remove recipe:', error)\n      toast.error('Failed to remove recipe')\n    }\n  }\n\n  const handleDeleteCollection = async () => {\n    setDeleting(true)\n    try {\n      await api.collections.delete(collectionId)\n      toast.success('Collection deleted')\n      navigate('/collections')\n    } catch (error) {\n      console.error('Failed to delete collection:', error)\n      toast.error('Failed to delete collection')\n    } finally {\n      setDeleting(false)\n    }\n  }\n\n  const handleRecipeClick = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    navigate(`/recipe/${recipeId}`)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <LoadingSpinner className=\"min-h-screen\" />\n      </div>\n    )\n  }\n\n  if (!collection) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background\">\n        <span className=\"mb-4 text-muted-foreground\">Collection not found</span>\n        <button\n          onClick={() => navigate('/collections')}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Go Back\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => navigate('/collections')}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </button>\n          <div>\n            <h1 className=\"text-xl font-medium text-foreground\">\n              {collection.name}\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              {collection.recipes.length} recipe\n              {collection.recipes.length !== 1 ? 's' : ''}\n            </p>\n          </div>\n        </div>\n        <button\n          onClick={() => setShowDeleteConfirm(true)}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-destructive/10 hover:text-destructive\"\n          title=\"Delete collection\"\n        >\n          <Trash2 className=\"h-5 w-5\" />\n        </button>\n      </header>\n\n      {/* Delete confirmation */}\n      {showDeleteConfirm && (\n        <div className=\"border-b border-destructive/30 bg-destructive/10 px-4 py-3\">\n          <div className=\"mx-auto flex max-w-4xl items-center justify-between\">\n            <p className=\"text-sm text-foreground\">\n              Delete \"{collection.name}\"? This cannot be undone.\n            </p>\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => setShowDeleteConfirm(false)}\n                className=\"rounded-lg px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted hover:text-foreground\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleDeleteCollection}\n                disabled={deleting}\n                className=\"rounded-lg bg-destructive px-3 py-1.5 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50\"\n              >\n                {deleting ? 'Deleting...' : 'Delete'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {collection.recipes.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {collection.recipes.map((item) => (\n                <div key={item.recipe.id} className=\"group relative\">\n                  <RecipeCard\n                    recipe={item.recipe}\n                    onClick={() => handleRecipeClick(item.recipe.id)}\n                  />\n                  {/* Remove button overlay */}\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      handleRemoveRecipe(item.recipe)\n                    }}\n                    className=\"absolute right-2 top-2 rounded-full bg-destructive/90 p-1.5 text-destructive-foreground opacity-0 transition-opacity group-hover:opacity-100\"\n                    title=\"Remove from collection\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <FolderOpen className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                This collection is empty\n              </h3>\n              <p className=\"text-center text-muted-foreground\">\n                Add recipes from their detail pages.\n              </p>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Collections.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Collections' has too many lines (218). Maximum allowed is 50.","line":9,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":226,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate, useSearchParams } from 'react-router-dom'\nimport { ArrowLeft, FolderPlus, Plus, X } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Collection } from '../api/client'\nimport { cn } from '../lib/utils'\nimport { CollectionGridSkeleton } from '../components/Skeletons'\n\nexport default function Collections() {\n  const navigate = useNavigate()\n  const [searchParams] = useSearchParams()\n  const pendingRecipeId = searchParams.get('addRecipe') ? Number(searchParams.get('addRecipe')) : null\n\n  const [collections, setCollections] = useState<Collection[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [newCollectionName, setNewCollectionName] = useState('')\n  const [creating, setCreating] = useState(false)\n\n  useEffect(() => {\n    loadCollections()\n  }, [])\n\n  const loadCollections = async () => {\n    try {\n      const data = await api.collections.list()\n      setCollections(data)\n    } catch (error) {\n      console.error('Failed to load collections:', error)\n      toast.error('Failed to load collections')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCreateCollection = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!newCollectionName.trim()) return\n\n    setCreating(true)\n    try {\n      const collection = await api.collections.create({\n        name: newCollectionName.trim(),\n      })\n      setCollections([collection, ...collections])\n      setNewCollectionName('')\n      setShowCreateForm(false)\n      toast.success('Collection created')\n\n      // If there's a pending recipe to add, add it and navigate to collection\n      if (pendingRecipeId) {\n        try {\n          await api.collections.addRecipe(collection.id, pendingRecipeId)\n          toast.success('Recipe added to collection')\n        } catch (error) {\n          console.error('Failed to add recipe to collection:', error)\n        }\n        navigate(`/collection/${collection.id}`)\n      }\n    } catch (error) {\n      console.error('Failed to create collection:', error)\n      toast.error('Failed to create collection')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  const handleCollectionClick = async (collectionId: number) => {\n    // If there's a pending recipe, add it first\n    if (pendingRecipeId) {\n      try {\n        await api.collections.addRecipe(collectionId, pendingRecipeId)\n        toast.success('Recipe added to collection')\n      } catch (error: unknown) {\n        // Ignore \"already in collection\" error\n        if (error instanceof Error && !error.message.includes('already')) {\n          console.error('Failed to add recipe to collection:', error)\n          toast.error('Failed to add recipe to collection')\n        } else {\n          toast.info('Recipe is already in this collection')\n        }\n      }\n    }\n    navigate(`/collection/${collectionId}`)\n  }\n\n  const handleBack = () => {\n    if (pendingRecipeId) {\n      navigate(-1)\n    } else {\n      navigate('/home')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={handleBack}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </button>\n          <h1 className=\"text-xl font-medium text-foreground\">Collections</h1>\n        </div>\n        <button\n          onClick={() => setShowCreateForm(true)}\n          className=\"flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          New Collection\n        </button>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Create form */}\n          {showCreateForm && (\n            <form\n              onSubmit={handleCreateCollection}\n              className=\"mb-6 rounded-lg border border-border bg-card p-4\"\n            >\n              <div className=\"mb-4 flex items-center justify-between\">\n                <h2 className=\"font-medium text-foreground\">New Collection</h2>\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewCollectionName('')\n                  }}\n                  className=\"rounded p-1 text-muted-foreground hover:bg-muted hover:text-foreground\"\n                >\n                  <X className=\"h-5 w-5\" />\n                </button>\n              </div>\n              <input\n                type=\"text\"\n                value={newCollectionName}\n                onChange={(e) => setNewCollectionName(e.target.value)}\n                placeholder=\"Collection name\"\n                className=\"mb-3 w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                autoFocus\n              />\n              <div className=\"flex justify-end gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewCollectionName('')\n                  }}\n                  className=\"rounded-lg px-4 py-2 text-sm text-muted-foreground hover:bg-muted hover:text-foreground\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={!newCollectionName.trim() || creating}\n                  className=\"rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                >\n                  {creating ? 'Creating...' : 'Create'}\n                </button>\n              </div>\n            </form>\n          )}\n\n          {/* Pending recipe notice */}\n          {pendingRecipeId && (\n            <div className=\"mb-4 rounded-lg border border-primary/30 bg-primary/10 p-3 text-sm text-foreground\">\n              Select a collection or create a new one to add the recipe\n            </div>\n          )}\n\n          {loading ? (\n            <CollectionGridSkeleton count={8} />\n          ) : collections.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {collections.map((collection) => (\n                <button\n                  key={collection.id}\n                  onClick={() => handleCollectionClick(collection.id)}\n                  className={cn(\n                    'group relative overflow-hidden rounded-lg bg-card p-4 text-left shadow-sm transition-all hover:shadow-md',\n                    pendingRecipeId && 'ring-2 ring-primary/20 hover:ring-primary/40'\n                  )}\n                >\n                  <div className=\"mb-8 rounded-lg bg-muted p-3\">\n                    <FolderPlus className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <h3 className=\"mb-1 font-medium text-card-foreground line-clamp-1\">\n                    {collection.name}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {collection.recipe_count} recipe\n                    {collection.recipe_count !== 1 ? 's' : ''}\n                  </p>\n                </button>\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <FolderPlus className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No collections yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Create one to organize your recipes!\n              </p>\n              <button\n                onClick={() => setShowCreateForm(true)}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Create Collection\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Favorites.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Favorites' has too many lines (96). Maximum allowed is 50.","line":9,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":104,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { ArrowLeft, Heart } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Recipe, type Favorite } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\n\nexport default function Favorites() {\n  const navigate = useNavigate()\n  const [favorites, setFavorites] = useState<Favorite[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadFavorites()\n  }, [])\n\n  const loadFavorites = async () => {\n    try {\n      const data = await api.favorites.list()\n      setFavorites(data)\n    } catch (error) {\n      console.error('Failed to load favorites:', error)\n      toast.error('Failed to load favorites')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRemoveFavorite = async (recipe: Recipe) => {\n    try {\n      await api.favorites.remove(recipe.id)\n      setFavorites(favorites.filter((f) => f.recipe.id !== recipe.id))\n      toast.success('Removed from favorites')\n    } catch (error) {\n      console.error('Failed to remove favorite:', error)\n      toast.error('Failed to remove from favorites')\n    }\n  }\n\n  const handleRecipeClick = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    navigate(`/recipe/${recipeId}`)\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={() => navigate('/home')}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">Favorites</h1>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <RecipeGridSkeleton count={8} />\n          ) : favorites.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {favorites.map((favorite) => (\n                <RecipeCard\n                  key={favorite.recipe.id}\n                  recipe={favorite.recipe}\n                  isFavorite\n                  onFavoriteToggle={handleRemoveFavorite}\n                  onClick={() => handleRecipeClick(favorite.recipe.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <Heart className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No favorites yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Browse recipes to add some!\n              </p>\n              <button\n                onClick={() => navigate('/home')}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Discover Recipes\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Home.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Home' has too many lines (429). Maximum allowed is 50.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":448,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Home' has a complexity of 18. Maximum allowed is 10.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":20,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { Moon, Sun, LogOut, Search, Sparkles, Heart, FolderOpen, Settings, RefreshCw } from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type Recipe,\n  type Favorite,\n  type HistoryItem,\n  type DiscoverSuggestion,\n} from '../api/client'\nimport { useProfile } from '../contexts/ProfileContext'\nimport { useAIStatus } from '../contexts/AIStatusContext'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\nimport { cn } from '../lib/utils'\n\ntype Tab = 'favorites' | 'discover'\n\nexport default function Home() {\n  const navigate = useNavigate()\n  const { profile, theme, toggleTheme, logout } = useProfile()\n  const aiStatus = useAIStatus()\n\n  const [searchQuery, setSearchQuery] = useState('')\n  const [activeTab, setActiveTab] = useState<Tab>('favorites')\n  const [favorites, setFavorites] = useState<Favorite[]>([])\n  const [history, setHistory] = useState<HistoryItem[]>([])\n  const [historyCount, setHistoryCount] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [discoverSuggestions, setDiscoverSuggestions] = useState<DiscoverSuggestion[]>([])\n  const [discoverLoading, setDiscoverLoading] = useState(false)\n  const [discoverError, setDiscoverError] = useState(false)\n  const [, setDiscoverRefreshedAt] = useState<string | null>(null)\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  const loadData = async () => {\n    try {\n      const [favoritesData, historyData] = await Promise.all([\n        api.favorites.list(),\n        api.history.list(1000),\n      ])\n      setFavorites(favoritesData)\n      setHistoryCount(historyData.length)\n      setHistory(historyData.slice(0, 6))\n    } catch (error) {\n      console.error('Failed to load data:', error)\n      toast.error('Failed to load recipes')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadDiscoverSuggestions = async () => {\n    if (!profile) return\n    setDiscoverLoading(true)\n    setDiscoverError(false)\n    try {\n      const result = await api.ai.discover(profile.id)\n      setDiscoverSuggestions(result.suggestions)\n      setDiscoverRefreshedAt(result.refreshed_at)\n    } catch (error) {\n      console.error('Failed to load discover suggestions:', error)\n      setDiscoverError(true)\n    } finally {\n      setDiscoverLoading(false)\n    }\n  }\n\n  // Load discover suggestions when tab is clicked (Task 4.3 - move to onClick)\n  const handleDiscoverTabClick = () => {\n    setActiveTab('discover')\n    if (discoverSuggestions.length === 0 && !discoverLoading && !discoverError && aiStatus.available) {\n      loadDiscoverSuggestions()\n    }\n  }\n\n  const handleSuggestionClick = (suggestion: DiscoverSuggestion) => {\n    navigate(`/search?q=${encodeURIComponent(suggestion.search_query)}`)\n  }\n\n  const handleSearchSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    if (searchQuery.trim()) {\n      navigate(`/search?q=${encodeURIComponent(searchQuery.trim())}`)\n    }\n  }\n\n  const handleRecipeClick = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    navigate(`/recipe/${recipeId}`)\n  }\n\n  const handleRemoveFavorite = async (recipe: Recipe) => {\n    try {\n      await api.favorites.remove(recipe.id)\n      setFavorites(favorites.filter((f) => f.recipe.id !== recipe.id))\n      toast.success('Removed from favorites')\n    } catch (error) {\n      console.error('Failed to remove favorite:', error)\n      toast.error('Failed to remove from favorites')\n    }\n  }\n\n  const handleLogout = () => {\n    logout()\n    navigate('/')\n  }\n\n  const getInitial = (name: string) => {\n    return name.charAt(0).toUpperCase()\n  }\n\n  // Memoize favorite IDs set (Task 5.2)\n  const localFavoriteIds = useMemo(\n    () => new Set(favorites.map((f) => f.recipe.id)),\n    [favorites]\n  )\n\n  if (!profile) return null\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <h1 className=\"text-xl font-medium text-primary\">Cookie</h1>\n\n        <div className=\"flex items-center gap-3\">\n          {/* Favorites */}\n          <button\n            onClick={() => navigate('/favorites')}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-accent\"\n            aria-label=\"View favorites\"\n          >\n            <Heart className=\"h-5 w-5\" />\n          </button>\n\n          {/* Collections */}\n          <button\n            onClick={() => navigate('/collections')}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-primary\"\n            aria-label=\"View collections\"\n          >\n            <FolderOpen className=\"h-5 w-5\" />\n          </button>\n\n          {/* Theme toggle */}\n          <button\n            onClick={toggleTheme}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label={theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode'}\n          >\n            {theme === 'light' ? (\n              <Moon className=\"h-5 w-5\" />\n            ) : (\n              <Sun className=\"h-5 w-5\" />\n            )}\n          </button>\n\n          {/* Settings */}\n          <button\n            onClick={() => navigate('/settings')}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label=\"Settings\"\n          >\n            <Settings className=\"h-5 w-5\" />\n          </button>\n\n          {/* Profile avatar */}\n          <button\n            onClick={handleLogout}\n            className=\"flex h-9 w-9 items-center justify-center rounded-full text-sm font-medium text-white\"\n            style={{ backgroundColor: profile.avatar_color }}\n            aria-label=\"Switch profile\"\n          >\n            {getInitial(profile.name)}\n          </button>\n\n          {/* Logout */}\n          <button\n            onClick={handleLogout}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label=\"Switch profile\"\n          >\n            <LogOut className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </header>\n\n      {/* Main content */}\n      <main className=\"flex-1 px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Search bar */}\n          <form onSubmit={handleSearchSubmit} className=\"mb-6\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground\" />\n              <input\n                type=\"text\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                placeholder=\"Search recipes or paste a URL...\"\n                className=\"w-full rounded-xl border border-border bg-input-background py-3 pl-12 pr-4 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n              />\n            </div>\n          </form>\n\n          {/* Tab toggle - only show if AI is available */}\n          {aiStatus.available && (\n            <div className=\"mb-6 flex justify-center\">\n              <div className=\"inline-flex rounded-lg bg-muted p-1\">\n                <button\n                  onClick={() => setActiveTab('favorites')}\n                  className={cn(\n                    'rounded-md px-4 py-2 text-sm font-medium transition-colors',\n                    activeTab === 'favorites'\n                      ? 'bg-background text-foreground shadow-sm'\n                      : 'text-muted-foreground hover:text-foreground'\n                  )}\n                >\n                  My Favorites\n                </button>\n                <button\n                  onClick={handleDiscoverTabClick}\n                  className={cn(\n                    'rounded-md px-4 py-2 text-sm font-medium transition-colors',\n                    activeTab === 'discover'\n                      ? 'bg-background text-foreground shadow-sm'\n                      : 'text-muted-foreground hover:text-foreground'\n                  )}\n                >\n                  Discover\n                </button>\n              </div>\n            </div>\n          )}\n\n          {loading ? (\n            <RecipeGridSkeleton count={6} />\n          ) : activeTab === 'favorites' || !aiStatus.available ? (\n            <>\n              {/* Recently Viewed */}\n              {history.length > 0 && (\n                <section className=\"mb-8\">\n                  <div className=\"mb-4 flex items-center justify-between\">\n                    <h2 className=\"text-lg font-medium text-foreground\">\n                      Recently Viewed\n                    </h2>\n                    <button\n                      onClick={() => navigate('/all-recipes')}\n                      className=\"text-sm font-medium text-primary hover:underline\"\n                    >\n                      View All ({historyCount})\n                    </button>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6\">\n                    {history.map((item) => (\n                      <RecipeCard\n                        key={item.recipe.id}\n                        recipe={item.recipe}\n                        isFavorite={localFavoriteIds.has(item.recipe.id)}\n                        onClick={() => handleRecipeClick(item.recipe.id)}\n                      />\n                    ))}\n                  </div>\n                </section>\n              )}\n\n              {/* Favorites */}\n              <section>\n                <div className=\"mb-4 flex items-center justify-between\">\n                  <h2 className=\"text-lg font-medium text-foreground\">\n                    My Favorite Recipes\n                  </h2>\n                  {favorites.length > 0 && (\n                    <button\n                      onClick={() => navigate('/favorites')}\n                      className=\"text-sm font-medium text-primary hover:underline\"\n                    >\n                      View All ({favorites.length})\n                    </button>\n                  )}\n                </div>\n                {favorites.length > 0 ? (\n                  <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n                    {favorites.map((favorite) => (\n                      <RecipeCard\n                        key={favorite.recipe.id}\n                        recipe={favorite.recipe}\n                        isFavorite\n                        onFavoriteToggle={handleRemoveFavorite}\n                        onClick={() => handleRecipeClick(favorite.recipe.id)}\n                      />\n                    ))}\n                  </div>\n                ) : (\n                  /* Empty state */\n                  <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n                    <div className=\"mb-4 rounded-full bg-muted p-4\">\n                      <Search className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                    <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                      No favorites yet\n                    </h3>\n                    <p className=\"mb-4 text-center text-muted-foreground\">\n                      Search for recipes and add them to your favorites\n                    </p>\n                    <button\n                      onClick={() => document.querySelector('input')?.focus()}\n                      className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                    >\n                      Discover Recipes\n                    </button>\n                  </div>\n                )}\n              </section>\n            </>\n          ) : (\n            /* Discover tab - AI recommendations */\n            <div>\n              {discoverLoading ? (\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 animate-pulse text-primary\" />\n                  </div>\n                  <p className=\"text-muted-foreground\">\n                    Generating personalized suggestions...\n                  </p>\n                </div>\n              ) : discoverSuggestions.length > 0 ? (\n                <div className=\"space-y-6\">\n                  {/* Header with refresh time */}\n                  <div className=\"flex items-center justify-between\">\n                    <h2 className=\"text-lg font-medium text-foreground\">\n                      Personalized For You\n                    </h2>\n                    <button\n                      onClick={loadDiscoverSuggestions}\n                      className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground\"\n                      disabled={discoverLoading}\n                    >\n                      <RefreshCw className={cn('h-4 w-4', discoverLoading && 'animate-spin')} />\n                      Refresh\n                    </button>\n                  </div>\n\n                  {/* Suggestions grid */}\n                  <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n                    {discoverSuggestions.map((suggestion, index) => (\n                      <button\n                        key={`${suggestion.type}-${index}`}\n                        onClick={() => handleSuggestionClick(suggestion)}\n                        className=\"group flex flex-col rounded-xl border border-border bg-card p-4 text-left transition-all hover:border-primary hover:shadow-md\"\n                      >\n                        <div className=\"mb-2 flex items-center gap-2\">\n                          <Sparkles className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                            {suggestion.type === 'favorites' && 'Based on Favorites'}\n                            {suggestion.type === 'seasonal' && 'Seasonal'}\n                            {suggestion.type === 'new' && 'Try Something New'}\n                          </span>\n                        </div>\n                        <h3 className=\"mb-1 font-medium text-foreground group-hover:text-primary\">\n                          {suggestion.title}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {suggestion.description}\n                        </p>\n                        <div className=\"mt-3 flex items-center gap-1 text-xs text-primary\">\n                          <Search className=\"h-3 w-3\" />\n                          <span>Search: {suggestion.search_query}</span>\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              ) : !aiStatus.available ? (\n                /* Empty state - AI unavailable (no API key) */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    AI Recommendations\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Configure an API key in settings to enable personalized recipe suggestions\n                  </p>\n                  <button\n                    onClick={() => navigate('/settings')}\n                    className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    Go to Settings\n                  </button>\n                </div>\n              ) : discoverError ? (\n                /* Empty state - API error */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    Unable to Load Suggestions\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Something went wrong. Please try again.\n                  </p>\n                  <button\n                    onClick={loadDiscoverSuggestions}\n                    className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    <RefreshCw className=\"h-4 w-4\" />\n                    Try Again\n                  </button>\n                </div>\n              ) : (\n                /* Empty state - No suggestions available */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    No Suggestions Yet\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Add some favorites to get personalized recommendations\n                  </p>\n                  <button\n                    onClick={() => setActiveTab('favorites')}\n                    className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    View Favorites\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/PlayMode.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'PlayMode' has too many lines (270). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":282,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'PlayMode' has a complexity of 11. Maximum allowed is 10.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":13,"endColumn":33}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, recipeId]","fix":{"range":[1145,1155],"text":"[loadData, recipeId]"}}],"suppressions":[{"kind":"directive","justification":"loadData is stable, only re-run when recipeId changes"}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":101,"column":30,"nodeType":"MemberExpression","endLine":101,"endColumn":55,"suppressions":[{"kind":"directive","justification":"currentStep is controlled state (number), not user input"}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleExit', 'handleNext', and 'handlePrevious'. Either include them or remove the dependency array.","line":135,"column":6,"nodeType":"ArrayExpression","endLine":135,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [currentStep, handleExit, handleNext, handlePrevious, totalSteps]","fix":{"range":[4165,4190],"text":"[currentStep, handleExit, handleNext, handlePrevious, totalSteps]"}}],"suppressions":[{"kind":"directive","justification":"handlers use currentStep/totalSteps from closure, re-bind when they change"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport { X, ChevronLeft, ChevronRight } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type RecipeDetail } from '../api/client'\nimport { useTimers } from '../hooks/useTimers'\nimport { useWakeLock } from '../hooks/useWakeLock'\nimport TimerPanel from '../components/TimerPanel'\nimport { cn } from '../lib/utils'\nimport { unlockAudio, playTimerAlert } from '../lib/audio'\nimport { LoadingSpinner } from '../components/Skeletons'\n\nexport default function PlayMode() {\n  const navigate = useNavigate()\n  const { id } = useParams<{ id: string }>()\n  const recipeId = Number(id)\n\n  const [recipe, setRecipe] = useState<RecipeDetail | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [currentStep, setCurrentStep] = useState(0)\n  const [aiAvailable, setAiAvailable] = useState(false)\n\n  // Fetch recipe data on mount\n  useEffect(() => {\n    if (recipeId) {\n      loadData()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- loadData is stable, only re-run when recipeId changes\n  }, [recipeId])\n\n  const loadData = async () => {\n    try {\n      const [recipeData, aiStatus] = await Promise.all([\n        api.recipes.get(recipeId),\n        api.ai.status(),\n      ])\n      setRecipe(recipeData)\n      setAiAvailable(aiStatus.available)\n    } catch (error) {\n      console.error('Failed to load recipe:', error)\n      toast.error('Failed to load recipe')\n      navigate(-1)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Get instructions array\n  const instructions = recipe\n    ? recipe.instructions.length > 0\n      ? recipe.instructions\n      : recipe.instructions_text\n        ? recipe.instructions_text.split('\\n').filter((s) => s.trim())\n        : []\n    : []\n\n  const totalSteps = instructions.length\n\n  // Timer completion handler\n  const handleTimerComplete = useCallback(\n    (timer: { label: string }) => {\n      // Play audio alert\n      playTimerAlert()\n\n      // Show toast notification\n      toast.success(`Timer complete: ${timer.label}`, {\n        duration: 10000,\n      })\n\n      // Show browser notification (may include system sound)\n      try {\n        if ('Notification' in window && Notification.permission === 'granted') {\n          new Notification('Timer Complete!', {\n            body: timer.label,\n            icon: '/favicon.ico',\n          })\n        }\n      } catch {\n        // Notification not supported or blocked\n      }\n    },\n    []\n  )\n\n  const timers = useTimers(handleTimerComplete)\n\n  // Keep screen awake during Play Mode\n  useWakeLock()\n\n  // Request notification permission and unlock audio on mount\n  useEffect(() => {\n    if ('Notification' in window && Notification.permission === 'default') {\n      Notification.requestPermission()\n    }\n    // Unlock audio for iOS (requires user interaction context)\n    // This works because entering Play Mode requires a button click\n    unlockAudio()\n  }, [])\n\n  // eslint-disable-next-line security/detect-object-injection -- currentStep is controlled state (number), not user input\n  const currentInstruction = instructions[currentStep] || ''\n  const progress = totalSteps > 0 ? ((currentStep + 1) / totalSteps) * 100 : 0\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1)\n    }\n  }\n\n  const handleNext = () => {\n    if (currentStep < totalSteps - 1) {\n      setCurrentStep(currentStep + 1)\n    }\n  }\n\n  const handleExit = () => {\n    navigate(-1)\n  }\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {\n        handlePrevious()\n      } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {\n        handleNext()\n      } else if (e.key === 'Escape') {\n        handleExit()\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- handlers use currentStep/totalSteps from closure, re-bind when they change\n  }, [currentStep, totalSteps])\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <LoadingSpinner className=\"min-h-screen\" />\n      </div>\n    )\n  }\n\n  if (!recipe) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-4\">\n        <p className=\"mb-4 text-center text-muted-foreground\">\n          Recipe not found.\n        </p>\n        <button\n          onClick={handleExit}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Go Back\n        </button>\n      </div>\n    )\n  }\n\n  if (totalSteps === 0) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-4\">\n        <p className=\"mb-4 text-center text-muted-foreground\">\n          No instructions available for this recipe.\n        </p>\n        <button\n          onClick={handleExit}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Exit\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header with progress */}\n      <div className=\"relative border-b border-border\">\n        {/* Progress bar */}\n        <div className=\"h-1 bg-muted\">\n          <div\n            className=\"h-full bg-primary transition-all duration-300\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n\n        {/* Header content */}\n        <div className=\"flex items-center justify-between px-4 py-3\">\n          <div className=\"flex-1\">\n            <h1 className=\"line-clamp-1 text-sm font-medium text-foreground\">\n              {recipe.title}\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">\n              Step {currentStep + 1} of {totalSteps}\n            </p>\n          </div>\n\n          <button\n            onClick={handleExit}\n            className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-muted/80\"\n            aria-label=\"Exit play mode\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"flex flex-1 flex-col\">\n        {/* Instruction display */}\n        <div className=\"flex flex-1 items-center justify-center p-6\">\n          <div className=\"max-w-2xl text-center\">\n            {/* Step number */}\n            <div className=\"mx-auto mb-6 flex h-12 w-12 items-center justify-center rounded-full bg-primary text-xl font-bold text-primary-foreground\">\n              {currentStep + 1}\n            </div>\n\n            {/* Instruction text */}\n            <p className=\"text-xl leading-relaxed text-foreground sm:text-2xl\">\n              {currentInstruction}\n            </p>\n          </div>\n        </div>\n\n        {/* Navigation buttons */}\n        <div className=\"flex items-center justify-between border-t border-border px-4 py-4\">\n          <button\n            onClick={handlePrevious}\n            disabled={currentStep === 0}\n            className={cn(\n              'flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              currentStep === 0\n                ? 'text-muted-foreground opacity-50'\n                : 'bg-muted text-foreground hover:bg-muted/80'\n            )}\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n            Previous\n          </button>\n\n          {/* Step indicators */}\n          <div className=\"hidden gap-1.5 sm:flex\">\n            {instructions.map((_, idx) => (\n              <button\n                key={idx}\n                onClick={() => setCurrentStep(idx)}\n                className={cn(\n                  'h-2 w-2 rounded-full transition-all',\n                  idx === currentStep\n                    ? 'w-6 bg-primary'\n                    : idx < currentStep\n                      ? 'bg-primary/50'\n                      : 'bg-muted'\n                )}\n                aria-label={`Go to step ${idx + 1}`}\n              />\n            ))}\n          </div>\n\n          <button\n            onClick={handleNext}\n            disabled={currentStep === totalSteps - 1}\n            className={cn(\n              'flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              currentStep === totalSteps - 1\n                ? 'text-muted-foreground opacity-50'\n                : 'bg-primary text-primary-foreground hover:bg-primary/90'\n            )}\n          >\n            Next\n            <ChevronRight className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {/* Timer panel */}\n        <TimerPanel timers={timers} instructionText={currentInstruction} aiAvailable={aiAvailable} />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/ProfileSelector.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'ProfileSelector' has too many lines (178). Maximum allowed is 50.","line":22,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":199,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { Plus } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Profile, type ProfileInput } from '../api/client'\nimport { useProfile } from '../contexts/ProfileContext'\nimport { cn } from '../lib/utils'\n\nconst PROFILE_COLORS = [\n  '#d97850',\n  '#8fae6f',\n  '#c9956b',\n  '#6b9dad',\n  '#d16b6b',\n  '#9d80b8',\n  '#e6a05f',\n  '#6bb8a5',\n  '#c77a9e',\n  '#7d9e6f',\n]\n\nexport default function ProfileSelector() {\n  const navigate = useNavigate()\n  const { selectProfile } = useProfile()\n  const [profiles, setProfiles] = useState<Profile[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [newName, setNewName] = useState('')\n  const [selectedColor, setSelectedColor] = useState(PROFILE_COLORS[0])\n  const [creating, setCreating] = useState(false)\n\n  useEffect(() => {\n    loadProfiles()\n  }, [])\n\n  const loadProfiles = async () => {\n    try {\n      const data = await api.profiles.list()\n      setProfiles(data)\n    } catch (error) {\n      console.error('Failed to load profiles:', error)\n      toast.error('Failed to load profiles')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleProfileSelect = async (profile: Profile) => {\n    try {\n      await selectProfile(profile)\n      navigate('/home')\n    } catch (error) {\n      console.error('Failed to select profile:', error)\n      toast.error('Failed to select profile')\n    }\n  }\n\n  const handleCreateProfile = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!newName.trim()) return\n\n    setCreating(true)\n    try {\n      const data: ProfileInput = {\n        name: newName.trim(),\n        avatar_color: selectedColor,\n        theme: 'light',\n        unit_preference: 'metric',\n      }\n      const profile = await api.profiles.create(data)\n      setProfiles([...profiles, profile])\n      await selectProfile(profile)\n      toast.success(`Welcome, ${profile.name}!`)\n      navigate('/home')\n    } catch (error) {\n      console.error('Failed to create profile:', error)\n      toast.error('Failed to create profile')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  const getInitial = (name: string) => {\n    return name.charAt(0).toUpperCase()\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col items-center justify-center bg-background px-4\">\n      <div className=\"w-full max-w-md text-center\">\n        {/* Title */}\n        <h1 className=\"mb-2 text-4xl font-medium text-primary\">Cookie</h1>\n        <p className=\"mb-10 text-muted-foreground\">Who's cooking today?</p>\n\n        {/* Profile grid */}\n        <div className=\"mb-8 flex flex-wrap justify-center gap-6\">\n          {profiles.map((profile) => (\n            <button\n              key={profile.id}\n              onClick={() => handleProfileSelect(profile)}\n              className=\"group flex flex-col items-center gap-2\"\n            >\n              <div\n                className=\"flex h-20 w-20 items-center justify-center rounded-full text-2xl font-medium text-white transition-transform group-hover:scale-105\"\n                style={{ backgroundColor: profile.avatar_color }}\n              >\n                {getInitial(profile.name)}\n              </div>\n              <span className=\"text-sm text-foreground\">{profile.name}</span>\n            </button>\n          ))}\n\n          {/* Add profile button */}\n          <button\n            onClick={() => setShowCreateForm(true)}\n            className=\"group flex flex-col items-center gap-2\"\n          >\n            <div className=\"flex h-20 w-20 items-center justify-center rounded-full border-2 border-dashed border-muted-foreground/40 transition-colors group-hover:border-primary\">\n              <Plus className=\"h-8 w-8 text-muted-foreground/60 group-hover:text-primary\" />\n            </div>\n            <span className=\"text-sm text-muted-foreground\">Add Profile</span>\n          </button>\n        </div>\n\n        {/* Create profile form */}\n        {showCreateForm && (\n          <div className=\"rounded-lg border border-border bg-card p-6 shadow-sm\">\n            <h2 className=\"mb-4 text-lg font-medium text-card-foreground\">\n              Create Profile\n            </h2>\n            <form onSubmit={handleCreateProfile}>\n              <div className=\"mb-4\">\n                <input\n                  type=\"text\"\n                  value={newName}\n                  onChange={(e) => setNewName(e.target.value)}\n                  placeholder=\"Enter your name\"\n                  className=\"w-full rounded-lg border border-border bg-input-background px-4 py-3 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                  autoFocus\n                  maxLength={20}\n                />\n              </div>\n\n              {/* Color picker */}\n              <div className=\"mb-6\">\n                <label className=\"mb-2 block text-sm text-muted-foreground\">\n                  Choose a color\n                </label>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {PROFILE_COLORS.map((color) => (\n                    <button\n                      key={color}\n                      type=\"button\"\n                      onClick={() => setSelectedColor(color)}\n                      className={cn(\n                        'h-10 w-10 rounded-full transition-transform hover:scale-110',\n                        selectedColor === color && 'ring-2 ring-ring ring-offset-2 ring-offset-card'\n                      )}\n                      style={{ backgroundColor: color }}\n                    />\n                  ))}\n                </div>\n              </div>\n\n              {/* Buttons */}\n              <div className=\"flex gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewName('')\n                    setSelectedColor(PROFILE_COLORS[0])\n                  }}\n                  className=\"flex-1 rounded-lg border border-border bg-secondary px-4 py-2.5 text-secondary-foreground transition-colors hover:bg-muted\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={!newName.trim() || creating}\n                  className=\"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                >\n                  {creating ? 'Creating...' : 'Create'}\n                </button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/RecipeDetail.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeDetail' has too many lines (471). Maximum allowed is 50.","line":31,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":501,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'RecipeDetail' has a complexity of 55. Maximum allowed is 10.","line":31,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":31,"endColumn":37},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'IngredientsTab' has too many lines (55). Maximum allowed is 50.","line":503,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":557,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TipsTab' has too many lines (107). Maximum allowed is 50.","line":640,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":746,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'TipsTab' has a complexity of 11. Maximum allowed is 10.","line":640,"column":1,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":640,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, recipeId]","fix":{"range":[1942,1952],"text":"[loadData, recipeId]"}}],"suppressions":[{"kind":"directive","justification":"loadData is stable, only re-run when recipeId changes"}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'recipe'. Either include it or remove the dependency array.","line":101,"column":6,"nodeType":"ArrayExpression","endLine":101,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [recipe, recipe.id, recipe.scraped_at, tips.length]","fix":{"range":[3380,3425],"text":"[recipe, recipe.id, recipe.scraped_at, tips.length]"}}],"suppressions":[{"kind":"directive","justification":"recipe object changes on fetch, only care about id/scraped_at/tips changes"}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'aiStatus.available', 'handleGenerateTips', 'recipe', 'tips.length', 'tipsLoading', and 'tipsPolling'. Either include them or remove the dependency array.","line":116,"column":6,"nodeType":"ArrayExpression","endLine":116,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, aiStatus.available, handleGenerateTips, recipe, tips.length, tipsLoading, tipsPolling]","fix":{"range":[3856,3867],"text":"[activeTab, aiStatus.available, handleGenerateTips, recipe, tips.length, tipsLoading, tipsPolling]"}}],"suppressions":[{"kind":"directive","justification":"intentionally only trigger on tab change, other deps checked inside"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport {\n  ArrowLeft,\n  Star,\n  Clock,\n  Heart,\n  PlayCircle,\n  Sparkles,\n  ChevronDown,\n  ChevronUp,\n  Minus,\n  Plus,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type RecipeDetail as RecipeDetailType,\n  type ScaleResponse,\n} from '../api/client'\nimport { cn, formatNutritionKey } from '../lib/utils'\nimport { formatTime } from '../lib/formatting'\nimport { useProfile } from '../contexts/ProfileContext'\nimport { useAIStatus } from '../contexts/AIStatusContext'\nimport AddToCollectionDropdown from '../components/AddToCollectionDropdown'\nimport RemixModal from '../components/RemixModal'\nimport { RecipeDetailSkeleton } from '../components/Skeletons'\n\ntype Tab = 'ingredients' | 'instructions' | 'nutrition' | 'tips'\n\nexport default function RecipeDetail() {\n  const navigate = useNavigate()\n  const { id } = useParams<{ id: string }>()\n  const recipeId = Number(id)\n  const { profile, isFavorite, toggleFavorite } = useProfile()\n  const aiStatus = useAIStatus()\n\n  const [recipe, setRecipe] = useState<RecipeDetailType | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [activeTab, setActiveTab] = useState<Tab>('ingredients')\n  const [metaExpanded, setMetaExpanded] = useState(true)\n  const [servings, setServings] = useState<number | null>(null)\n  const [showRemixModal, setShowRemixModal] = useState(false)\n  const [scaledData, setScaledData] = useState<ScaleResponse | null>(null)\n  const [scalingLoading, setScalingLoading] = useState(false)\n  const [tips, setTips] = useState<string[]>([])\n  const [tipsLoading, setTipsLoading] = useState(false)\n  const [tipsPolling, setTipsPolling] = useState(false)\n\n  useEffect(() => {\n    if (recipeId) {\n      loadData()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- loadData is stable, only re-run when recipeId changes\n  }, [recipeId])\n\n  // Poll for tips if recipe is recently imported and has no tips yet\n  useEffect(() => {\n    if (!recipe) return\n\n    const recipeAge = Date.now() - new Date(recipe.scraped_at).getTime()\n    const isRecent = recipeAge < 60000 // 60 seconds\n\n    // Only poll for recent recipes with no tips\n    if (!isRecent || tips.length > 0) {\n      setTipsPolling(false)\n      return\n    }\n\n    setTipsPolling(true)\n    const startTime = Date.now()\n    const POLL_INTERVAL = 3000 // 3 seconds\n    const MAX_POLL_DURATION = 30000 // 30 seconds\n\n    const interval = setInterval(async () => {\n      // Stop if we've been polling too long\n      if (Date.now() - startTime > MAX_POLL_DURATION) {\n        clearInterval(interval)\n        setTipsPolling(false)\n        return\n      }\n\n      try {\n        const updated = await api.recipes.get(recipe.id)\n        if (updated.ai_tips && updated.ai_tips.length > 0) {\n          setTips(updated.ai_tips)\n          setRecipe((prev) => prev ? { ...prev, ai_tips: updated.ai_tips } : prev)\n          clearInterval(interval)\n          setTipsPolling(false)\n        }\n      } catch {\n        // Ignore polling errors, will retry on next interval\n      }\n    }, POLL_INTERVAL)\n\n    return () => {\n      clearInterval(interval)\n      setTipsPolling(false)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- recipe object changes on fetch, only care about id/scraped_at/tips changes\n  }, [recipe?.id, recipe?.scraped_at, tips.length])\n\n  // Auto-generate tips when viewing Tips tab for old recipes without tips\n  useEffect(() => {\n    if (\n      activeTab === 'tips' &&\n      tips.length === 0 &&\n      aiStatus.available &&\n      !tipsLoading &&\n      !tipsPolling &&\n      recipe\n    ) {\n      handleGenerateTips(false)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- intentionally only trigger on tab change, other deps checked inside\n  }, [activeTab])\n\n  const loadData = async () => {\n    try {\n      const recipeData = await api.recipes.get(recipeId)\n      setRecipe(recipeData)\n      setServings(recipeData.servings)\n      setTips(recipeData.ai_tips || [])\n      // Reset scaled data when loading a new recipe\n      setScaledData(null)\n    } catch (error) {\n      console.error('Failed to load recipe:', error)\n      toast.error('Failed to load recipe')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const canShowServingAdjustment =\n    aiStatus.available && recipe?.servings !== null\n\n  const handleServingChange = async (delta: number) => {\n    if (!servings || !recipe || !profile) return\n    const newServings = Math.max(1, servings + delta)\n    setServings(newServings)\n\n    // If returning to original servings, clear scaled data\n    if (newServings === recipe.servings) {\n      setScaledData(null)\n      return\n    }\n\n    // Call AI to scale ingredients\n    setScalingLoading(true)\n    try {\n      const result = await api.ai.scale(recipe.id, newServings, profile.id)\n      setScaledData(result)\n      if (result.notes.length > 0) {\n        toast.info(result.notes[0])\n      }\n    } catch (error) {\n      console.error('Failed to scale recipe:', error)\n      toast.error('Failed to scale ingredients')\n      // Revert to previous servings on error\n      setServings(servings)\n    } finally {\n      setScalingLoading(false)\n    }\n  }\n\n  const handleGenerateTips = async (regenerate: boolean = false) => {\n    if (!recipe || tipsLoading) return\n\n    setTipsLoading(true)\n    try {\n      const result = await api.ai.tips(recipe.id, regenerate)\n      setTips(result.tips)\n      // Update the recipe object too\n      setRecipe({ ...recipe, ai_tips: result.tips })\n      toast.success(regenerate ? 'Tips regenerated!' : 'Tips generated!')\n    } catch (error) {\n      console.error('Failed to generate tips:', error)\n      toast.error('Failed to generate tips')\n    } finally {\n      setTipsLoading(false)\n    }\n  }\n\n  const handleFavoriteToggle = async () => {\n    if (!recipe) return\n    await toggleFavorite(recipe)\n  }\n\n  const handleStartCooking = () => {\n    navigate(`/recipe/${recipeId}/play`)\n  }\n\n  const handleAddToNewCollection = () => {\n    navigate(`/collections?addRecipe=${recipeId}`)\n  }\n\n  const handleRemixCreated = (newRecipeId: number) => {\n    navigate(`/recipe/${newRecipeId}`)\n  }\n\n  const handleBack = () => {\n    navigate(-1)\n  }\n\n  if (loading) {\n    return <RecipeDetailSkeleton />\n  }\n\n  if (!recipe || !profile) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background\">\n        <span className=\"mb-4 text-muted-foreground\">Recipe not found</span>\n        <button\n          onClick={handleBack}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Go Back\n        </button>\n      </div>\n    )\n  }\n\n  const imageUrl = recipe.image || recipe.image_url\n  const recipeIsFavorite = isFavorite(recipe.id)\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Image */}\n      <div className=\"relative h-64 sm:h-80\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={recipe.title}\n            className=\"h-full w-full object-cover\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center bg-muted\">\n            <span className=\"text-muted-foreground\">No image</span>\n          </div>\n        )}\n\n        {/* Gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent\" />\n\n        {/* Back button */}\n        <button\n          onClick={handleBack}\n          className=\"absolute left-4 top-4 rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:bg-black/60\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n\n        {/* Title and rating overlay */}\n        <div className=\"absolute bottom-4 left-4 right-4\">\n          <h1 className=\"mb-2 text-xl font-medium text-white drop-shadow-lg sm:text-2xl\">\n            {recipe.title}\n          </h1>\n          <div className=\"flex items-center gap-3 text-sm text-white/90\">\n            {recipe.rating && (\n              <span className=\"flex items-center gap-1\">\n                <Star className=\"h-4 w-4 fill-star text-star\" />\n                {recipe.rating.toFixed(1)}\n                {recipe.rating_count && (\n                  <span className=\"text-white/70\">\n                    ({recipe.rating_count})\n                  </span>\n                )}\n              </span>\n            )}\n            <span>{recipe.host}</span>\n          </div>\n        </div>\n\n        {/* Action buttons */}\n        <div className=\"absolute bottom-4 right-4 flex gap-2\">\n          <button\n            onClick={handleFavoriteToggle}\n            className={cn(\n              'rounded-full bg-black/40 p-2 backdrop-blur-sm transition-colors',\n              recipeIsFavorite ? 'text-accent' : 'text-white hover:text-accent'\n            )}\n            title={recipeIsFavorite ? 'Remove from favorites' : 'Add to favorites'}\n          >\n            <Heart className={cn('h-5 w-5', recipeIsFavorite && 'fill-current')} />\n          </button>\n          <AddToCollectionDropdown\n            recipeId={recipeId}\n            onCreateNew={handleAddToNewCollection}\n          />\n          {aiStatus.available && (\n            <button\n              onClick={() => setShowRemixModal(true)}\n              className=\"rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:text-primary\"\n              title=\"Remix recipe\"\n            >\n              <Sparkles className=\"h-5 w-5\" />\n            </button>\n          )}\n          <button\n            onClick={handleStartCooking}\n            className=\"flex items-center gap-1.5 rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n          >\n            <PlayCircle className=\"h-4 w-4\" />\n            Cook!\n          </button>\n        </div>\n      </div>\n\n      {/* Meta info (collapsible) */}\n      <div className=\"border-b border-border\">\n        <button\n          onClick={() => setMetaExpanded(!metaExpanded)}\n          className=\"flex w-full items-center justify-between px-4 py-3 text-left\"\n        >\n          <span className=\"text-sm font-medium text-foreground\">\n            Recipe Details\n          </span>\n          {metaExpanded ? (\n            <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\n          ) : (\n            <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n          )}\n        </button>\n\n        {metaExpanded && (\n          <div className=\"flex flex-wrap gap-4 px-4 pb-4\">\n            {/* Prep time */}\n            {recipe.prep_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Prep:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.prep_time_adjusted &&\n                  scaledData.prep_time_adjusted !== recipe.prep_time ? (\n                    <>\n                      {formatTime(scaledData.prep_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.prep_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.prep_time_adjusted ?? recipe.prep_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Cook time */}\n            {recipe.cook_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Cook:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.cook_time_adjusted &&\n                  scaledData.cook_time_adjusted !== recipe.cook_time ? (\n                    <>\n                      {formatTime(scaledData.cook_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.cook_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.cook_time_adjusted ?? recipe.cook_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Total time */}\n            {recipe.total_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Total:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.total_time_adjusted &&\n                  scaledData.total_time_adjusted !== recipe.total_time ? (\n                    <>\n                      {formatTime(scaledData.total_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.total_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.total_time_adjusted ?? recipe.total_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Servings adjuster - only show if AI available and servings present */}\n            {canShowServingAdjustment && servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Servings:</span>\n                <div className=\"flex items-center gap-1\">\n                  <button\n                    onClick={() => handleServingChange(-1)}\n                    disabled={servings <= 1 || scalingLoading}\n                    className=\"rounded-md bg-muted p-1 text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    <Minus className=\"h-4 w-4\" />\n                  </button>\n                  <span className=\"w-8 text-center font-medium text-foreground\">\n                    {scalingLoading ? '...' : servings}\n                  </span>\n                  <button\n                    onClick={() => handleServingChange(1)}\n                    disabled={scalingLoading}\n                    className=\"rounded-md bg-muted p-1 text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                  </button>\n                </div>\n                {scaledData && servings !== recipe?.servings && (\n                  <span className=\"text-xs text-muted-foreground\">\n                    (scaled from {recipe?.servings})\n                  </span>\n                )}\n              </div>\n            )}\n\n            {/* Show static servings if AI not available */}\n            {!canShowServingAdjustment && recipe.servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Servings:</span>\n                <span className=\"text-foreground\">{recipe.servings}</span>\n              </div>\n            )}\n\n            {/* Yields (if different from servings) */}\n            {recipe.yields && !recipe.servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Yields:</span>\n                <span className=\"text-foreground\">{recipe.yields}</span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Tabs */}\n      <div className=\"border-b border-border\">\n        <div className=\"flex px-4\">\n          {(\n            [\n              { key: 'ingredients' as const, label: 'Ingredients' },\n              { key: 'instructions' as const, label: 'Instructions' },\n              { key: 'nutrition' as const, label: 'Nutrition' },\n              // Only show Tips tab when AI is available\n              ...(aiStatus.available ? [{ key: 'tips' as const, label: 'Tips' }] : []),\n            ]\n          ).map(({ key, label }) => (\n            <button\n              key={key}\n              onClick={() => setActiveTab(key)}\n              className={cn(\n                'border-b-2 px-4 py-3 text-sm font-medium transition-colors',\n                activeTab === key\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              {label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Tab content */}\n      <div className=\"px-4 py-6\">\n        {activeTab === 'ingredients' && (\n          <IngredientsTab recipe={recipe} scaledData={scaledData} />\n        )}\n        {activeTab === 'instructions' && (\n          <InstructionsTab recipe={recipe} scaledData={scaledData} />\n        )}\n        {activeTab === 'nutrition' && (\n          <NutritionTab recipe={recipe} />\n        )}\n        {activeTab === 'tips' && (\n          <TipsTab\n            tips={tips}\n            scalingNotes={scaledData?.notes || []}\n            aiAvailable={aiStatus.available}\n            loading={tipsLoading}\n            polling={tipsPolling}\n            onGenerateTips={handleGenerateTips}\n          />\n        )}\n      </div>\n\n      {/* Remix Modal */}\n      <RemixModal\n        recipe={recipe}\n        profileId={profile.id}\n        isOpen={showRemixModal}\n        onClose={() => setShowRemixModal(false)}\n        onRemixCreated={handleRemixCreated}\n      />\n    </div>\n  )\n}\n\nfunction IngredientsTab({\n  recipe,\n  scaledData,\n}: {\n  recipe: RecipeDetailType\n  scaledData: ScaleResponse | null\n}) {\n  // Use scaled ingredients if available, otherwise use recipe ingredients\n  const ingredients = scaledData?.ingredients || recipe.ingredients\n\n  // Use ingredient_groups if available and not scaled, otherwise flat ingredients list\n  const hasGroups = recipe.ingredient_groups.length > 0 && !scaledData\n\n  if (hasGroups) {\n    return (\n      <div className=\"space-y-6\">\n        {recipe.ingredient_groups.map((group, groupIndex) => (\n          <div key={groupIndex}>\n            {group.purpose && (\n              <h3 className=\"mb-3 font-medium text-foreground\">\n                {group.purpose}\n              </h3>\n            )}\n            <ol className=\"space-y-2\">\n              {group.ingredients.map((ingredient, index) => (\n                <li\n                  key={index}\n                  className=\"flex items-start gap-3 text-foreground\"\n                >\n                  <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n                    {index + 1}\n                  </span>\n                  <span>{ingredient}</span>\n                </li>\n              ))}\n            </ol>\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  return (\n    <ol className=\"space-y-2\">\n      {ingredients.map((ingredient, index) => (\n        <li key={index} className=\"flex items-start gap-3 text-foreground\">\n          <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n            {index + 1}\n          </span>\n          <span>{ingredient}</span>\n        </li>\n      ))}\n    </ol>\n  )\n}\n\nfunction InstructionsTab({\n  recipe,\n  scaledData,\n}: {\n  recipe: RecipeDetailType\n  scaledData: ScaleResponse | null\n}) {\n  // Use scaled instructions if available, otherwise fall back to original\n  const hasScaledInstructions = scaledData?.instructions && scaledData.instructions.length > 0\n  const instructions = hasScaledInstructions\n    ? scaledData.instructions\n    : recipe.instructions.length > 0\n      ? recipe.instructions\n      : recipe.instructions_text\n        ? recipe.instructions_text.split('\\n').filter((s) => s.trim())\n        : []\n\n  if (instructions.length === 0) {\n    return (\n      <p className=\"text-muted-foreground\">\n        No instructions available for this recipe.\n      </p>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {hasScaledInstructions && (\n        <p className=\"text-sm text-muted-foreground\">\n          Instructions adjusted for {scaledData.target_servings} servings\n        </p>\n      )}\n      <ol className=\"space-y-4\">\n        {instructions.map((step, index) => (\n          <li key={index} className=\"flex items-start gap-4\">\n            <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n              {index + 1}\n            </span>\n            <p className=\"pt-0.5 text-foreground\">{step}</p>\n          </li>\n        ))}\n      </ol>\n    </div>\n  )\n}\n\nfunction NutritionTab({ recipe }: { recipe: RecipeDetailType }) {\n  const nutritionEntries = Object.entries(recipe.nutrition || {})\n\n  if (nutritionEntries.length === 0) {\n    return (\n      <p className=\"text-muted-foreground\">\n        No nutrition information available for this recipe.\n      </p>\n    )\n  }\n\n  return (\n    <div>\n      {recipe.servings && (\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          Per serving (recipe makes {recipe.servings})\n        </p>\n      )}\n      <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3\">\n        {nutritionEntries.map(([key, value]) => (\n          <div\n            key={key}\n            className=\"rounded-lg bg-muted/50 p-3\"\n          >\n            <span className=\"block text-sm text-muted-foreground\">\n              {formatNutritionKey(key)}\n            </span>\n            <span className=\"text-lg font-medium text-foreground\">{value}</span>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\nfunction TipsTab({\n  tips,\n  scalingNotes,\n  aiAvailable,\n  loading,\n  polling,\n  onGenerateTips,\n}: {\n  tips: string[]\n  scalingNotes: string[]\n  aiAvailable?: boolean\n  loading: boolean\n  polling: boolean\n  onGenerateTips: (regenerate: boolean) => void\n}) {\n  // Show loading state when manually generating tips\n  if (loading) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 animate-pulse text-primary\" />\n        <p className=\"text-foreground\">Generating cooking tips...</p>\n      </div>\n    )\n  }\n\n  const hasTips = tips.length > 0\n  const hasContent = hasTips || scalingNotes.length > 0\n\n  // Show polling state when waiting for background generation\n  if (!hasContent && polling) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 animate-pulse text-primary\" />\n        <p className=\"text-foreground\">Generating cooking tips...</p>\n        <p className=\"mt-2 text-sm text-muted-foreground\">\n          Tips are being generated in the background\n        </p>\n      </div>\n    )\n  }\n\n  if (!hasContent) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 text-muted-foreground\" />\n        <p className=\"mb-2 text-foreground\">No cooking tips yet</p>\n        {aiAvailable ? (\n          <button\n            onClick={() => onGenerateTips(false)}\n            className=\"mt-4 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n          >\n            Generate Tips\n          </button>\n        ) : (\n          <p className=\"text-sm text-muted-foreground\">\n            Configure an API key in settings to enable AI-generated tips\n          </p>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scaling notes */}\n      {scalingNotes.length > 0 && (\n        <div className=\"rounded-lg bg-accent/10 p-3\">\n          <h4 className=\"mb-2 flex items-center gap-2 text-sm font-medium text-foreground\">\n            <Sparkles className=\"h-4 w-4 text-accent\" />\n            Scaling Notes\n          </h4>\n          <ul className=\"space-y-1 text-sm text-muted-foreground\">\n            {scalingNotes.map((note, index) => (\n              <li key={index}>• {note}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      {/* Tips */}\n      {hasTips && (\n        <ol className=\"space-y-3\">\n          {tips.map((tip, index) => (\n            <li key={index} className=\"flex items-start gap-3\">\n              <span className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-accent text-xs font-medium text-accent-foreground\">\n                {index + 1}\n              </span>\n              <p className=\"text-foreground\">{tip}</p>\n            </li>\n          ))}\n        </ol>\n      )}\n\n      {/* Regenerate/Generate button */}\n      {aiAvailable && (\n        <div className=\"text-center pt-4\">\n          <button\n            onClick={() => onGenerateTips(hasTips)}\n            className=\"rounded-lg bg-muted px-4 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted/80 hover:text-foreground\"\n          >\n            {hasTips ? 'Regenerate Tips' : 'Generate Tips'}\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Search.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Search' has too many lines (241). Maximum allowed is 50.","line":8,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":248,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Search' has a complexity of 20. Maximum allowed is 10.","line":8,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":8,"endColumn":31},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SearchResultCard' has too many lines (59). Maximum allowed is 50.","line":256,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":314,"endColumn":2}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'navigate' and 'searchRecipes'. Either include them or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, query, searchRecipes, selectedSource]","fix":{"range":[1399,1422],"text":"[navigate, query, searchRecipes, selectedSource]"}}],"suppressions":[{"kind":"directive","justification":"navigate and searchRecipes are stable, only re-run when query or filter changes"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate, useSearchParams } from 'react-router-dom'\nimport { ArrowLeft, Link as LinkIcon, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type SearchResult } from '../api/client'\nimport { cn } from '../lib/utils'\n\nexport default function Search() {\n  const navigate = useNavigate()\n  const [searchParams] = useSearchParams()\n  const query = searchParams.get('q') || ''\n\n  const [results, setResults] = useState<SearchResult[]>([])\n  const [total, setTotal] = useState(0)\n  const [page, setPage] = useState(1)\n  const [hasMore, setHasMore] = useState(false)\n  const [sites, setSites] = useState<Record<string, number>>({})\n  const [selectedSource, setSelectedSource] = useState<string | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [loadingMore, setLoadingMore] = useState(false)\n  const [importing, setImporting] = useState<string | null>(null)\n\n  // Detect if query is a URL\n  const isUrl = /^https?:\\/\\//i.test(query.trim())\n\n  useEffect(() => {\n    if (!query) {\n      navigate('/home')\n      return\n    }\n    // Reset state when query or source filter changes\n    setResults([])\n    setPage(1)\n    setLoading(true)\n    searchRecipes(1, true)\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- navigate and searchRecipes are stable, only re-run when query or filter changes\n  }, [query, selectedSource])\n\n  const searchRecipes = async (pageNum: number, reset: boolean = false) => {\n    try {\n      const sources = selectedSource || undefined\n      const response = await api.recipes.search(query, sources, pageNum)\n\n      if (reset) {\n        setResults(response.results)\n        setSites(response.sites)\n      } else {\n        setResults((prev) => [...prev, ...response.results])\n      }\n\n      setTotal(response.total)\n      setHasMore(response.has_more)\n      setPage(pageNum)\n    } catch (error) {\n      console.error('Search failed:', error)\n      toast.error('Search failed. Please try again.')\n    } finally {\n      setLoading(false)\n      setLoadingMore(false)\n    }\n  }\n\n  const handleLoadMore = () => {\n    setLoadingMore(true)\n    searchRecipes(page + 1, false)\n  }\n\n  const handleSourceFilter = (source: string | null) => {\n    setSelectedSource(source)\n  }\n\n  const handleImport = async (url: string) => {\n    setImporting(url)\n    try {\n      const recipe = await api.recipes.scrape(url)\n      toast.success(`Imported: ${recipe.title}`)\n      // Record in history\n      await api.history.record(recipe.id)\n      // Navigate to recipe detail\n      navigate(`/recipe/${recipe.id}`)\n    } catch (error) {\n      console.error('Failed to import recipe:', error)\n      const message = error instanceof Error ? error.message : 'Failed to import recipe'\n      toast.error(message)\n    } finally {\n      setImporting(null)\n    }\n  }\n\n  const handleBack = () => {\n    navigate('/home')\n  }\n\n  // Sort sites by count descending for filter chips\n  const sortedSites = Object.entries(sites).sort(([, a], [, b]) => b - a)\n  const allSourcesCount = Object.values(sites).reduce((sum, n) => sum + n, 0)\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header with breadcrumb */}\n      <header className=\"border-b border-border px-4 py-3\">\n        <button\n          onClick={handleBack}\n          className=\"flex items-center gap-2 text-muted-foreground transition-colors hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n          <span>Back to Home</span>\n        </button>\n      </header>\n\n      <main className=\"flex-1 px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Query info */}\n          <div className=\"mb-6\">\n            <h1 className=\"mb-1 text-xl font-medium text-foreground\">\n              {isUrl ? 'Import Recipe' : `Search: \"${query}\"`}\n            </h1>\n            {!isUrl && !loading && (\n              <p className=\"text-sm text-muted-foreground\">\n                {total} {total === 1 ? 'result' : 'results'} found\n              </p>\n            )}\n          </div>\n\n          {/* URL Import Card */}\n          {isUrl && (\n            <div className=\"mb-8 rounded-xl border border-border bg-card p-6\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"rounded-full bg-primary/10 p-3\">\n                  <LinkIcon className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h2 className=\"mb-1 font-medium text-card-foreground\">\n                    Import Recipe from URL\n                  </h2>\n                  <p className=\"mb-4 text-sm text-muted-foreground line-clamp-1\">\n                    {query}\n                  </p>\n                  <button\n                    onClick={() => handleImport(query)}\n                    disabled={!!importing}\n                    className=\"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                  >\n                    {importing === query ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        Importing...\n                      </>\n                    ) : (\n                      'Import Recipe'\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Source filter chips */}\n          {!isUrl && sortedSites.length > 0 && (\n            <div className=\"mb-6 flex flex-wrap gap-2\">\n              <button\n                onClick={() => handleSourceFilter(null)}\n                className={cn(\n                  'rounded-full px-3 py-1.5 text-sm font-medium transition-colors',\n                  selectedSource === null\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                )}\n              >\n                All Sources ({allSourcesCount})\n              </button>\n              {sortedSites.map(([site, count]) => (\n                <button\n                  key={site}\n                  onClick={() => handleSourceFilter(site)}\n                  className={cn(\n                    'rounded-full px-3 py-1.5 text-sm font-medium transition-colors',\n                    selectedSource === site\n                      ? 'bg-primary text-primary-foreground'\n                      : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                  )}\n                >\n                  {site} ({count})\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* Loading state */}\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          )}\n\n          {/* Results grid */}\n          {!loading && !isUrl && results.length > 0 && (\n            <>\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3\">\n                {results.map((result, index) => (\n                  <SearchResultCard\n                    key={`${result.url}-${index}`}\n                    result={result}\n                    onImport={handleImport}\n                    importing={importing === result.url}\n                  />\n                ))}\n              </div>\n\n              {/* Load more / End of results */}\n              <div className=\"mt-8 flex justify-center\">\n                {hasMore ? (\n                  <button\n                    onClick={handleLoadMore}\n                    disabled={loadingMore}\n                    className=\"inline-flex items-center gap-2 rounded-lg bg-muted px-6 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    {loadingMore ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        Loading...\n                      </>\n                    ) : (\n                      'Load More'\n                    )}\n                  </button>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">\n                    End of results\n                  </p>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* Empty state */}\n          {!loading && !isUrl && results.length === 0 && (\n            <div className=\"flex flex-col items-center justify-center py-12\">\n              <p className=\"text-muted-foreground\">\n                No recipes found for \"{query}\"\n              </p>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n\ninterface SearchResultCardProps {\n  result: SearchResult\n  onImport: (url: string) => void\n  importing: boolean\n}\n\nfunction SearchResultCard({\n  result,\n  onImport,\n  importing,\n}: SearchResultCardProps) {\n  // Prefer cached image, fallback to external\n  const imageUrl = result.cached_image_url || result.image_url\n\n  return (\n    <div className=\"group overflow-hidden rounded-lg bg-card shadow-sm transition-all hover:shadow-md\">\n      {/* Image */}\n      <div className=\"relative aspect-[4/3] overflow-hidden bg-muted\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={result.title}\n            className=\"h-full w-full object-cover transition-transform group-hover:scale-105\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center text-muted-foreground\">\n            No image\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"p-3\">\n        <h3 className=\"mb-1 line-clamp-2 text-sm font-medium text-card-foreground\">\n          {result.title}\n        </h3>\n        <p className=\"mb-2 text-xs text-muted-foreground\">\n          {result.host}\n          {result.rating_count && (\n            <span> · {result.rating_count.toLocaleString()} Ratings</span>\n          )}\n        </p>\n        {result.description && (\n          <p className=\"mb-3 line-clamp-2 text-xs text-muted-foreground\">\n            {result.description}\n          </p>\n        )}\n        <button\n          onClick={() => onImport(result.url)}\n          disabled={importing}\n          className=\"w-full rounded-md bg-primary/10 py-1.5 text-xs font-medium text-primary transition-colors hover:bg-primary/20 disabled:opacity-50\"\n        >\n          {importing ? (\n            <span className=\"inline-flex items-center gap-1\">\n              <Loader2 className=\"h-3 w-3 animate-spin\" />\n              Importing...\n            </span>\n          ) : (\n            'Import'\n          )}\n        </button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Settings.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Settings' has too many lines (184). Maximum allowed is 50.","line":35,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":218,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Settings' has a complexity of 15. Maximum allowed is 10.","line":35,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":35,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport {\n  ArrowLeft,\n  Bot,\n  AlertTriangle,\n  Loader2,\n  Globe,\n  Code,\n  Settings as SettingsIcon,\n  Users,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type AIPrompt,\n  type AIModel,\n  type AIStatus,\n  type Source,\n  type ProfileWithStats,\n} from '../api/client'\nimport { cn } from '../lib/utils'\nimport { useProfile } from '../contexts/ProfileContext'\nimport {\n  SettingsGeneral,\n  SettingsPrompts,\n  SettingsSources,\n  SettingsSelectors,\n  SettingsUsers,\n  SettingsDanger,\n} from '../components/settings'\n\ntype Tab = 'general' | 'prompts' | 'sources' | 'selectors' | 'users' | 'danger'\n\nexport default function Settings() {\n  const navigate = useNavigate()\n  const { profile } = useProfile()\n  const currentProfileId = profile?.id\n\n  const [activeTab, setActiveTab] = useState<Tab>('general')\n  const [aiStatus, setAiStatus] = useState<AIStatus | null>(null)\n  const [prompts, setPrompts] = useState<AIPrompt[]>([])\n  const [models, setModels] = useState<AIModel[]>([])\n  const [sources, setSources] = useState<Source[]>([])\n  const [profiles, setProfiles] = useState<ProfileWithStats[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  const loadData = async () => {\n    try {\n      const [statusData, promptsData, modelsData, sourcesData, profilesData] =\n        await Promise.all([\n          api.ai.status(),\n          api.ai.prompts.list(),\n          api.ai.models(),\n          api.sources.list(),\n          api.profiles.list(),\n        ])\n      setAiStatus(statusData)\n      setPrompts(promptsData)\n      setModels(modelsData)\n      setSources(sourcesData)\n      setProfiles(profilesData)\n    } catch (error) {\n      console.error('Failed to load settings:', error)\n      toast.error('Failed to load settings')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={() => navigate('/home')}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">Settings</h1>\n      </header>\n\n      {/* Tab navigation */}\n      <div className=\"border-b border-border px-4\">\n        <div className=\"mx-auto max-w-4xl\">\n          <div className=\"flex gap-4 overflow-x-auto\">\n            <button\n              onClick={() => setActiveTab('general')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'general'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <SettingsIcon className=\"h-4 w-4\" />\n                General\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('prompts')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'prompts'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Bot className=\"h-4 w-4\" />\n                AI Prompts\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('sources')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'sources'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Globe className=\"h-4 w-4\" />\n                Sources\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('selectors')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'selectors'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Code className=\"h-4 w-4\" />\n                Selectors\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('users')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'users'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Users className=\"h-4 w-4\" />\n                Users\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('danger')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'danger'\n                  ? 'border-destructive text-destructive'\n                  : 'border-transparent text-muted-foreground hover:text-destructive'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                Danger Zone\n              </span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : activeTab === 'general' ? (\n            <SettingsGeneral\n              aiStatus={aiStatus}\n              models={models}\n              onAIStatusChange={setAiStatus}\n              onModelsChange={setModels}\n            />\n          ) : activeTab === 'prompts' ? (\n            <SettingsPrompts\n              aiStatus={aiStatus}\n              prompts={prompts}\n              models={models}\n              onPromptsChange={setPrompts}\n            />\n          ) : activeTab === 'sources' ? (\n            <SettingsSources sources={sources} onSourcesChange={setSources} />\n          ) : activeTab === 'selectors' ? (\n            <SettingsSelectors sources={sources} onSourcesChange={setSources} />\n          ) : activeTab === 'users' ? (\n            <SettingsUsers\n              profiles={profiles}\n              currentProfileId={currentProfileId}\n              onProfilesChange={setProfiles}\n            />\n          ) : activeTab === 'danger' ? (\n            <SettingsDanger />\n          ) : null}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/AddToCollectionDropdown.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (201). Maximum allowed is 50.","line":25,"column":37,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":225,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport AddToCollectionDropdown from '../components/AddToCollectionDropdown'\nimport { api } from '../api/client'\n\n// Mock the API\nvi.mock('../api/client', () => ({\n  api: {\n    collections: {\n      list: vi.fn(),\n      addRecipe: vi.fn(),\n    },\n  },\n}))\n\n// Mock sonner toast\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n    info: vi.fn(),\n  },\n}))\n\ndescribe('AddToCollectionDropdown', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('renders the folder button', () => {\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n    expect(screen.getByTitle('Add to collection')).toBeInTheDocument()\n  })\n\n  it('opens dropdown when button is clicked', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([])\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Add to Collection')).toBeInTheDocument()\n    })\n  })\n\n  it('shows loading state while fetching collections', async () => {\n    vi.mocked(api.collections.list).mockImplementation(\n      () => new Promise(() => {})\n    )\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Loading...')).toBeInTheDocument()\n    })\n  })\n\n  it('displays collections when loaded', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([\n      { id: 1, name: 'Favorites', description: '', recipe_count: 0, created_at: '', updated_at: '' },\n      { id: 2, name: 'Quick Meals', description: '', recipe_count: 0, created_at: '', updated_at: '' },\n    ])\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Favorites')).toBeInTheDocument()\n      expect(screen.getByText('Quick Meals')).toBeInTheDocument()\n    })\n  })\n\n  it('shows empty message when no collections exist', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([])\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('No collections yet')).toBeInTheDocument()\n    })\n  })\n\n  it('shows Create New Collection option', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([])\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Create New Collection')).toBeInTheDocument()\n    })\n  })\n\n  it('calls onCreateNew when Create New Collection is clicked', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([])\n\n    const handleCreateNew = vi.fn()\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={handleCreateNew} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Create New Collection')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Create New Collection'))\n\n    expect(handleCreateNew).toHaveBeenCalled()\n  })\n\n  it('adds recipe to collection when collection is clicked', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([\n      { id: 1, name: 'Favorites', description: '', recipe_count: 0, created_at: '', updated_at: '' },\n    ])\n    vi.mocked(api.collections.addRecipe).mockResolvedValue({} as never)\n\n    render(\n      <AddToCollectionDropdown recipeId={42} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Favorites')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Favorites'))\n\n    await waitFor(() => {\n      expect(api.collections.addRecipe).toHaveBeenCalledWith(1, 42)\n    })\n  })\n\n  it('closes dropdown after adding recipe', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([\n      { id: 1, name: 'Favorites', description: '', recipe_count: 0, created_at: '', updated_at: '' },\n    ])\n    vi.mocked(api.collections.addRecipe).mockResolvedValue({} as never)\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Favorites')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Favorites'))\n\n    await waitFor(() => {\n      expect(screen.queryByText('Favorites')).not.toBeInTheDocument()\n    })\n  })\n\n  it('closes dropdown when clicking outside', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([])\n\n    render(\n      <div>\n        <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n        <button data-testid=\"outside\">Outside</button>\n      </div>\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Add to Collection')).toBeInTheDocument()\n    })\n\n    fireEvent.mouseDown(screen.getByTestId('outside'))\n\n    await waitFor(() => {\n      expect(screen.queryByText('Add to Collection')).not.toBeInTheDocument()\n    })\n  })\n\n  it('shows Adding... while adding recipe', async () => {\n    vi.mocked(api.collections.list).mockResolvedValue([\n      { id: 1, name: 'Favorites', description: '', recipe_count: 0, created_at: '', updated_at: '' },\n    ])\n    vi.mocked(api.collections.addRecipe).mockImplementation(\n      () => new Promise((resolve) => setTimeout(resolve, 100))\n    )\n\n    render(\n      <AddToCollectionDropdown recipeId={1} onCreateNew={vi.fn()} />\n    )\n\n    fireEvent.click(screen.getByTitle('Add to collection'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Favorites')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Favorites'))\n\n    await waitFor(() => {\n      expect(screen.getByText('Adding...')).toBeInTheDocument()\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/ErrorBoundary.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (161). Maximum allowed is 50.","line":13,"column":27,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":173,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { render, screen, fireEvent } from '@testing-library/react'\nimport ErrorBoundary from '../components/ErrorBoundary'\n\n// Component that throws an error\nfunction ThrowingComponent({ shouldThrow }: { shouldThrow: boolean }) {\n  if (shouldThrow) {\n    throw new Error('Test error')\n  }\n  return <div>Content rendered successfully</div>\n}\n\ndescribe('ErrorBoundary', () => {\n  // Suppress console.error during tests since we're testing error handling\n  const originalConsoleError = console.error\n\n  beforeEach(() => {\n    console.error = vi.fn()\n  })\n\n  afterEach(() => {\n    console.error = originalConsoleError\n  })\n\n  it('renders children when there is no error', () => {\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={false} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText('Content rendered successfully')).toBeInTheDocument()\n  })\n\n  it('renders error UI when child throws', () => {\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText('Something went wrong')).toBeInTheDocument()\n    expect(screen.getByText(/An unexpected error occurred/)).toBeInTheDocument()\n  })\n\n  it('renders custom fallback when provided', () => {\n    render(\n      <ErrorBoundary fallback={<div>Custom error UI</div>}>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText('Custom error UI')).toBeInTheDocument()\n    expect(screen.queryByText('Something went wrong')).not.toBeInTheDocument()\n  })\n\n  it('shows Try Again button', () => {\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByRole('button', { name: /Try Again/i })).toBeInTheDocument()\n  })\n\n  it('shows Reload Page button', () => {\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByRole('button', { name: /Reload Page/i })).toBeInTheDocument()\n  })\n\n  it('logs error to console', () => {\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(console.error).toHaveBeenCalledWith(\n      'ErrorBoundary caught an error:',\n      expect.any(Error),\n      expect.any(Object)\n    )\n  })\n\n  it('resets error state when Try Again is clicked', () => {\n    // Track whether the component should throw\n    let shouldThrow = true\n\n    function ConditionalThrow() {\n      if (shouldThrow) {\n        throw new Error('Test error')\n      }\n      return <div>Content rendered successfully</div>\n    }\n\n    render(\n      <ErrorBoundary>\n        <ConditionalThrow />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText('Something went wrong')).toBeInTheDocument()\n\n    // Change the condition so component won't throw on next render\n    shouldThrow = false\n\n    // Click Try Again (this resets internal state and re-renders children)\n    fireEvent.click(screen.getByRole('button', { name: /Try Again/i }))\n\n    // Should show content again since shouldThrow is now false\n    expect(screen.getByText('Content rendered successfully')).toBeInTheDocument()\n  })\n\n  it('calls window.location.reload when Reload Page is clicked', () => {\n    // Mock window.location.reload\n    const reloadMock = vi.fn()\n    const originalLocation = window.location\n\n    // Create a mock for location\n    Object.defineProperty(window, 'location', {\n      writable: true,\n      value: { ...originalLocation, reload: reloadMock },\n    })\n\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    fireEvent.click(screen.getByRole('button', { name: /Reload Page/i }))\n\n    expect(reloadMock).toHaveBeenCalled()\n\n    // Restore original location\n    Object.defineProperty(window, 'location', {\n      writable: true,\n      value: originalLocation,\n    })\n  })\n\n  it('shows error details in development mode', () => {\n    // import.meta.env.DEV is true in test environment\n    render(\n      <ErrorBoundary>\n        <ThrowingComponent shouldThrow={true} />\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText(/Error Details/)).toBeInTheDocument()\n    expect(screen.getByText(/Error: Test error/)).toBeInTheDocument()\n  })\n\n  it('catches errors from nested children', () => {\n    render(\n      <ErrorBoundary>\n        <div>\n          <div>\n            <ThrowingComponent shouldThrow={true} />\n          </div>\n        </div>\n      </ErrorBoundary>\n    )\n\n    expect(screen.getByText('Something went wrong')).toBeInTheDocument()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/RecipeCard.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (151). Maximum allowed is 50.","line":19,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":169,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest'\nimport { render, screen, fireEvent } from '@testing-library/react'\nimport RecipeCard from '../components/RecipeCard'\nimport type { Recipe } from '../api/client'\n\n// Mock recipe data\nconst mockRecipe: Recipe = {\n  id: 1,\n  title: 'Chocolate Chip Cookies',\n  host: 'example.com',\n  image_url: 'https://example.com/cookies.jpg',\n  image: null,\n  total_time: 45,\n  rating: 4.5,\n  is_remix: false,\n  scraped_at: '2024-01-01T00:00:00Z',\n}\n\ndescribe('RecipeCard', () => {\n  it('renders recipe title', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    expect(screen.getByText('Chocolate Chip Cookies')).toBeInTheDocument()\n  })\n\n  it('renders recipe host', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    expect(screen.getByText('example.com')).toBeInTheDocument()\n  })\n\n  it('renders recipe image when image_url is provided', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    const img = screen.getByRole('img')\n    expect(img).toHaveAttribute('src', 'https://example.com/cookies.jpg')\n    expect(img).toHaveAttribute('alt', 'Chocolate Chip Cookies')\n  })\n\n  it('uses image property over image_url when both are present', () => {\n    const recipeWithImage: Recipe = {\n      ...mockRecipe,\n      image: 'https://example.com/main-image.jpg',\n    }\n    render(<RecipeCard recipe={recipeWithImage} />)\n    const img = screen.getByRole('img')\n    expect(img).toHaveAttribute('src', 'https://example.com/main-image.jpg')\n  })\n\n  it('shows \"No image\" text when no image is available', () => {\n    const recipeNoImage: Recipe = {\n      ...mockRecipe,\n      image_url: '',\n      image: null,\n    }\n    render(<RecipeCard recipe={recipeNoImage} />)\n    expect(screen.getByText('No image')).toBeInTheDocument()\n  })\n\n  it('formats time correctly for minutes under 60', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    expect(screen.getByText('45 min')).toBeInTheDocument()\n  })\n\n  it('formats time correctly for hours', () => {\n    const recipeWithHours: Recipe = {\n      ...mockRecipe,\n      total_time: 90,\n    }\n    render(<RecipeCard recipe={recipeWithHours} />)\n    expect(screen.getByText('1h 30m')).toBeInTheDocument()\n  })\n\n  it('does not show time when total_time is null', () => {\n    const recipeNoTime: Recipe = {\n      ...mockRecipe,\n      total_time: null,\n    }\n    render(<RecipeCard recipe={recipeNoTime} />)\n    // Check that no time element with Clock icon exists\n    expect(screen.queryByText(/^\\d+\\s*min$/)).not.toBeInTheDocument()\n    expect(screen.queryByText(/^\\d+h$/)).not.toBeInTheDocument()\n    expect(screen.queryByText(/^\\d+h\\s+\\d+m$/)).not.toBeInTheDocument()\n  })\n\n  it('renders rating when present', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    expect(screen.getByText('4.5')).toBeInTheDocument()\n  })\n\n  it('does not show rating when null', () => {\n    const recipeNoRating: Recipe = {\n      ...mockRecipe,\n      rating: null,\n    }\n    render(<RecipeCard recipe={recipeNoRating} />)\n    expect(screen.queryByText(/^\\d+\\.\\d+$/)).not.toBeInTheDocument()\n  })\n\n  it('shows Remix badge when is_remix is true', () => {\n    const remixRecipe: Recipe = {\n      ...mockRecipe,\n      is_remix: true,\n    }\n    render(<RecipeCard recipe={remixRecipe} />)\n    expect(screen.getByText('Remix')).toBeInTheDocument()\n  })\n\n  it('does not show Remix badge when is_remix is false', () => {\n    render(<RecipeCard recipe={mockRecipe} />)\n    expect(screen.queryByText('Remix')).not.toBeInTheDocument()\n  })\n\n  it('calls onClick when card is clicked', () => {\n    const handleClick = vi.fn()\n    render(<RecipeCard recipe={mockRecipe} onClick={handleClick} />)\n    fireEvent.click(screen.getByText('Chocolate Chip Cookies'))\n    expect(handleClick).toHaveBeenCalledWith(mockRecipe)\n  })\n\n  it('shows favorite button when onFavoriteToggle is provided', () => {\n    const handleFavorite = vi.fn()\n    render(\n      <RecipeCard\n        recipe={mockRecipe}\n        onFavoriteToggle={handleFavorite}\n        isFavorite={false}\n      />\n    )\n    expect(screen.getByLabelText('Add to favorites')).toBeInTheDocument()\n  })\n\n  it('calls onFavoriteToggle when favorite button is clicked', () => {\n    const handleFavorite = vi.fn()\n    render(\n      <RecipeCard\n        recipe={mockRecipe}\n        onFavoriteToggle={handleFavorite}\n        isFavorite={false}\n      />\n    )\n    fireEvent.click(screen.getByLabelText('Add to favorites'))\n    expect(handleFavorite).toHaveBeenCalledWith(mockRecipe)\n  })\n\n  it('shows \"Remove from favorites\" aria-label when isFavorite is true', () => {\n    render(\n      <RecipeCard\n        recipe={mockRecipe}\n        onFavoriteToggle={vi.fn()}\n        isFavorite={true}\n      />\n    )\n    expect(screen.getByLabelText('Remove from favorites')).toBeInTheDocument()\n  })\n\n  it('does not propagate click when favorite button is clicked', () => {\n    const handleClick = vi.fn()\n    const handleFavorite = vi.fn()\n    render(\n      <RecipeCard\n        recipe={mockRecipe}\n        onClick={handleClick}\n        onFavoriteToggle={handleFavorite}\n        isFavorite={false}\n      />\n    )\n    fireEvent.click(screen.getByLabelText('Add to favorites'))\n    expect(handleFavorite).toHaveBeenCalled()\n    expect(handleClick).not.toHaveBeenCalled()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/RemixModal.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (311). Maximum allowed is 50.","line":66,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":376,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport RemixModal from '../components/RemixModal'\nimport { api } from '../api/client'\nimport type { RecipeDetail } from '../api/client'\n\n// Mock the API\nvi.mock('../api/client', () => ({\n  api: {\n    ai: {\n      remix: {\n        getSuggestions: vi.fn(),\n        create: vi.fn(),\n      },\n    },\n  },\n}))\n\n// Mock sonner toast\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n    info: vi.fn(),\n  },\n}))\n\nconst mockRecipe: RecipeDetail = {\n  id: 1,\n  title: 'Chocolate Chip Cookies',\n  host: 'example.com',\n  source_url: 'https://example.com/recipe',\n  canonical_url: 'https://example.com/recipe',\n  site_name: 'Example',\n  author: 'Chef Test',\n  description: 'Delicious cookies',\n  image: 'https://example.com/image.jpg',\n  image_url: 'https://example.com/image.jpg',\n  ingredients: ['flour', 'sugar', 'chocolate chips'],\n  ingredient_groups: [],\n  instructions: ['Mix ingredients', 'Bake at 350F'],\n  instructions_text: '',\n  nutrition: {},\n  servings: 24,\n  prep_time: 15,\n  cook_time: 12,\n  total_time: 27,\n  yields: '24 cookies',\n  rating: 4.5,\n  rating_count: 100,\n  ai_tips: [],\n  scraped_at: '2024-01-01T00:00:00Z',\n  is_remix: false,\n  category: 'Dessert',\n  cuisine: 'American',\n  cooking_method: 'Baking',\n  keywords: ['cookies', 'chocolate'],\n  dietary_restrictions: [],\n  equipment: ['oven', 'mixing bowl'],\n  language: 'en',\n  links: [],\n  remix_profile_id: null,\n  updated_at: '2024-01-01T00:00:00Z',\n}\n\ndescribe('RemixModal', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('does not render when isOpen is false', () => {\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={false}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n    expect(screen.queryByText('Remix This Recipe')).not.toBeInTheDocument()\n  })\n\n  it('renders modal when isOpen is true', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan', 'Make it spicy'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    expect(screen.getByText('Remix This Recipe')).toBeInTheDocument()\n    expect(screen.getByText(/Chocolate Chip Cookies/)).toBeInTheDocument()\n  })\n\n  it('shows loading state while fetching suggestions', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockImplementation(\n      () => new Promise(() => {})\n    )\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    expect(screen.getByText('Generating suggestions...')).toBeInTheDocument()\n  })\n\n  it('displays suggestions when loaded', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan', 'Make it gluten-free'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n      expect(screen.getByText('Make it gluten-free')).toBeInTheDocument()\n    })\n  })\n\n  it('allows selecting a suggestion', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Make it vegan'))\n\n    // The button should now be selected (has primary background)\n    const button = screen.getByText('Make it vegan')\n    expect(button).toHaveClass('bg-primary')\n  })\n\n  it('deselects suggestion when clicked again', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n    })\n\n    const suggestionBtn = screen.getByText('Make it vegan')\n    fireEvent.click(suggestionBtn)\n    fireEvent.click(suggestionBtn)\n\n    expect(suggestionBtn).toHaveClass('bg-muted')\n  })\n\n  it('allows entering custom input', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: [],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByPlaceholderText('e.g., Make it gluten-free')).toBeInTheDocument()\n    })\n\n    fireEvent.change(screen.getByPlaceholderText('e.g., Make it gluten-free'), {\n      target: { value: 'Add more chocolate' },\n    })\n\n    expect(screen.getByDisplayValue('Add more chocolate')).toBeInTheDocument()\n  })\n\n  it('clears suggestion selection when custom input is entered', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n    })\n\n    // Select suggestion first\n    fireEvent.click(screen.getByText('Make it vegan'))\n    expect(screen.getByText('Make it vegan')).toHaveClass('bg-primary')\n\n    // Enter custom input\n    fireEvent.change(screen.getByPlaceholderText('e.g., Make it gluten-free'), {\n      target: { value: 'Custom modification' },\n    })\n\n    // Suggestion should be deselected\n    expect(screen.getByText('Make it vegan')).toHaveClass('bg-muted')\n  })\n\n  it('disables Create button when no selection or input', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: [],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Create Remix')).toBeInTheDocument()\n    })\n\n    expect(screen.getByText('Create Remix').closest('button')).toBeDisabled()\n  })\n\n  it('enables Create button when suggestion is selected', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan'],\n    })\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={vi.fn()}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Make it vegan'))\n\n    expect(screen.getByText('Create Remix').closest('button')).not.toBeDisabled()\n  })\n\n  it('calls onClose when close button is clicked', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: [],\n    })\n\n    const handleClose = vi.fn()\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={handleClose}\n        onRemixCreated={vi.fn()}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Remix This Recipe')).toBeInTheDocument()\n    })\n\n    // Find close button (X button in header)\n    const closeButtons = screen.getAllByRole('button')\n    const closeButton = closeButtons.find(btn =>\n      btn.querySelector('svg.lucide-x') !== null\n    )\n\n    if (closeButton) {\n      fireEvent.click(closeButton)\n      expect(handleClose).toHaveBeenCalled()\n    }\n  })\n\n  it('creates remix and calls onRemixCreated on success', async () => {\n    vi.mocked(api.ai.remix.getSuggestions).mockResolvedValue({\n      suggestions: ['Make it vegan'],\n    })\n    vi.mocked(api.ai.remix.create).mockResolvedValue({\n      id: 2,\n      title: 'Vegan Chocolate Chip Cookies',\n      description: '',\n      ingredients: [],\n      instructions: [],\n      host: 'cookie-remix',\n      site_name: 'Cookie Remix',\n      is_remix: true,\n      prep_time: 15,\n      cook_time: 12,\n      total_time: 27,\n      yields: '24 cookies',\n      servings: 24,\n    })\n\n    const handleRemixCreated = vi.fn()\n    const handleClose = vi.fn()\n\n    render(\n      <RemixModal\n        recipe={mockRecipe}\n        profileId={1}\n        isOpen={true}\n        onClose={handleClose}\n        onRemixCreated={handleRemixCreated}\n      />\n    )\n\n    await waitFor(() => {\n      expect(screen.getByText('Make it vegan')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Make it vegan'))\n    fireEvent.click(screen.getByText('Create Remix'))\n\n    await waitFor(() => {\n      expect(api.ai.remix.create).toHaveBeenCalledWith(1, 'Make it vegan', 1)\n      expect(handleRemixCreated).toHaveBeenCalledWith(2)\n      expect(handleClose).toHaveBeenCalled()\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/Skeletons.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/TimerPanel.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (200). Maximum allowed is 50.","line":35,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":234,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport TimerPanel from '../components/TimerPanel'\nimport type { UseTimersReturn, Timer } from '../hooks/useTimers'\nimport { api } from '../api/client'\n\n// Mock the API\nvi.mock('../api/client', () => ({\n  api: {\n    ai: {\n      timerName: vi.fn(),\n    },\n  },\n}))\n\nconst createMockTimer = (overrides: Partial<Timer> = {}): Timer => ({\n  id: 'timer-1',\n  label: 'Bake cookies',\n  duration: 600,\n  remaining: 300,\n  isRunning: false,\n  ...overrides,\n})\n\nconst createMockTimersReturn = (timers: Timer[] = []): UseTimersReturn => ({\n  timers,\n  addTimer: vi.fn(),\n  startTimer: vi.fn(),\n  pauseTimer: vi.fn(),\n  resetTimer: vi.fn(),\n  deleteTimer: vi.fn(),\n  toggleTimer: vi.fn(),\n})\n\ndescribe('TimerPanel', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  it('renders Timers header', () => {\n    const mockTimers = createMockTimersReturn()\n    render(<TimerPanel timers={mockTimers} />)\n    expect(screen.getByText('Timers')).toBeInTheDocument()\n  })\n\n  it('shows timer count when timers exist', () => {\n    const mockTimers = createMockTimersReturn([createMockTimer()])\n    render(<TimerPanel timers={mockTimers} />)\n    expect(screen.getByText('1')).toBeInTheDocument()\n  })\n\n  it('shows active timer count when timers are running', () => {\n    const mockTimers = createMockTimersReturn([\n      createMockTimer({ id: '1', isRunning: true }),\n      createMockTimer({ id: '2', isRunning: false }),\n    ])\n    render(<TimerPanel timers={mockTimers} />)\n    expect(screen.getByText(/1 active/)).toBeInTheDocument()\n  })\n\n  it('renders quick timer buttons', () => {\n    const mockTimers = createMockTimersReturn()\n    render(<TimerPanel timers={mockTimers} />)\n\n    expect(screen.getByText('+5 min')).toBeInTheDocument()\n    expect(screen.getByText('+10 min')).toBeInTheDocument()\n    expect(screen.getByText('+15 min')).toBeInTheDocument()\n  })\n\n  it('adds timer when quick timer button is clicked (no AI)', async () => {\n    const mockTimers = createMockTimersReturn()\n    render(<TimerPanel timers={mockTimers} aiAvailable={false} />)\n\n    fireEvent.click(screen.getByText('+5 min'))\n\n    expect(mockTimers.addTimer).toHaveBeenCalledWith('5 min', 300)\n  })\n\n  it('uses AI to generate timer name when available', async () => {\n    vi.mocked(api.ai.timerName).mockResolvedValue({ label: 'Browning onions' })\n\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        aiAvailable={true}\n        instructionText=\"Sauté onions for 5 minutes\"\n      />\n    )\n\n    fireEvent.click(screen.getByText('+5 min'))\n\n    await waitFor(() => {\n      expect(api.ai.timerName).toHaveBeenCalledWith('Sauté onions for 5 minutes', 5)\n      expect(mockTimers.addTimer).toHaveBeenCalledWith('Browning onions', 300)\n    })\n  })\n\n  it('falls back to default label when AI fails', async () => {\n    vi.mocked(api.ai.timerName).mockRejectedValue(new Error('API error'))\n\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        aiAvailable={true}\n        instructionText=\"Sauté onions for 5 minutes\"\n      />\n    )\n\n    fireEvent.click(screen.getByText('+5 min'))\n\n    await waitFor(() => {\n      expect(mockTimers.addTimer).toHaveBeenCalledWith('5 min', 300)\n    })\n  })\n\n  it('detects times in instruction text', () => {\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        instructionText=\"Bake for 20 minutes until golden\"\n      />\n    )\n\n    expect(screen.getByText('Detected in this step:')).toBeInTheDocument()\n    expect(screen.getByText('20 min')).toBeInTheDocument()\n  })\n\n  it('detects multiple times in instruction text', () => {\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        instructionText=\"Preheat for 10 minutes, then bake for 30 minutes\"\n      />\n    )\n\n    expect(screen.getByText('10 min')).toBeInTheDocument()\n    expect(screen.getByText('30 min')).toBeInTheDocument()\n  })\n\n  it('adds detected time when clicked', async () => {\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        aiAvailable={false}\n        instructionText=\"Bake for 15 minutes\"\n      />\n    )\n\n    // Find the detected time button (not the quick timer)\n    const detectedButtons = screen.getAllByText('15 min')\n    // The detected time button should be in the \"Detected in this step\" section\n    const detectedButton = detectedButtons.find(btn =>\n      btn.closest('div')?.className.includes('bg-primary/10')\n    )\n\n    if (detectedButton) {\n      fireEvent.click(detectedButton)\n      expect(mockTimers.addTimer).toHaveBeenCalledWith('15 min', 900)\n    }\n  })\n\n  it('displays existing timers', () => {\n    const mockTimers = createMockTimersReturn([\n      createMockTimer({ label: 'Bake cookies', remaining: 300 }),\n    ])\n    render(<TimerPanel timers={mockTimers} />)\n\n    expect(screen.getByText('Bake cookies')).toBeInTheDocument()\n  })\n\n  it('shows empty message when no timers', () => {\n    const mockTimers = createMockTimersReturn([])\n    render(<TimerPanel timers={mockTimers} />)\n\n    expect(screen.getByText('No active timers. Add one above!')).toBeInTheDocument()\n  })\n\n  it('can be collapsed', () => {\n    const mockTimers = createMockTimersReturn()\n    render(<TimerPanel timers={mockTimers} />)\n\n    // Initially expanded - quick timer buttons should be visible\n    expect(screen.getByText('+5 min')).toBeInTheDocument()\n\n    // Click header to collapse\n    fireEvent.click(screen.getByText('Timers'))\n\n    // Quick timer buttons should be hidden\n    expect(screen.queryByText('+5 min')).not.toBeInTheDocument()\n  })\n\n  it('shows AI sparkle icon when AI is available and has instruction text', () => {\n    const mockTimers = createMockTimersReturn()\n    const { container } = render(\n      <TimerPanel\n        timers={mockTimers}\n        aiAvailable={true}\n        instructionText=\"Some instruction\"\n      />\n    )\n\n    // Check for sparkles icon (Lucide icon)\n    expect(container.querySelector('.lucide-sparkles')).toBeInTheDocument()\n  })\n\n  it('formats detected hour times correctly', () => {\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        instructionText=\"Let rise for 2 hours\"\n      />\n    )\n\n    expect(screen.getByText('2h')).toBeInTheDocument()\n  })\n\n  it('formats detected seconds correctly', () => {\n    const mockTimers = createMockTimersReturn()\n    render(\n      <TimerPanel\n        timers={mockTimers}\n        instructionText=\"Microwave for 30 seconds\"\n      />\n    )\n\n    expect(screen.getByText('30s')).toBeInTheDocument()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/TimerWidget.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (141). Maximum allowed is 50.","line":15,"column":25,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":155,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest'\nimport { render, screen, fireEvent } from '@testing-library/react'\nimport TimerWidget from '../components/TimerWidget'\nimport type { Timer } from '../hooks/useTimers'\n\nconst createMockTimer = (overrides: Partial<Timer> = {}): Timer => ({\n  id: 'timer-1',\n  label: 'Bake cookies',\n  duration: 600,\n  remaining: 300,\n  isRunning: false,\n  ...overrides,\n})\n\ndescribe('TimerWidget', () => {\n  it('renders timer label', () => {\n    const timer = createMockTimer()\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByText('Bake cookies')).toBeInTheDocument()\n  })\n\n  it('displays remaining time in mm:ss format', () => {\n    const timer = createMockTimer({ remaining: 300 })\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByText('5:00')).toBeInTheDocument()\n  })\n\n  it('displays remaining time in h:mm:ss format for long timers', () => {\n    const timer = createMockTimer({ remaining: 3661 }) // 1 hour, 1 min, 1 sec\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByText('1:01:01')).toBeInTheDocument()\n  })\n\n  it('shows Play button when timer is not running', () => {\n    const timer = createMockTimer({ isRunning: false })\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByLabelText('Play')).toBeInTheDocument()\n  })\n\n  it('shows Pause button when timer is running', () => {\n    const timer = createMockTimer({ isRunning: true })\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByLabelText('Pause')).toBeInTheDocument()\n  })\n\n  it('calls onToggle when play/pause button is clicked', () => {\n    const handleToggle = vi.fn()\n    const timer = createMockTimer()\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={handleToggle}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    fireEvent.click(screen.getByLabelText('Play'))\n    expect(handleToggle).toHaveBeenCalled()\n  })\n\n  it('calls onReset when reset button is clicked', () => {\n    const handleReset = vi.fn()\n    const timer = createMockTimer()\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={handleReset}\n        onDelete={vi.fn()}\n      />\n    )\n    fireEvent.click(screen.getByLabelText('Reset'))\n    expect(handleReset).toHaveBeenCalled()\n  })\n\n  it('calls onDelete when delete button is clicked', () => {\n    const handleDelete = vi.fn()\n    const timer = createMockTimer()\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={handleDelete}\n      />\n    )\n    fireEvent.click(screen.getByLabelText('Delete'))\n    expect(handleDelete).toHaveBeenCalled()\n  })\n\n  it('hides play/pause and reset buttons when timer is complete', () => {\n    const timer = createMockTimer({ remaining: 0 })\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.queryByLabelText('Play')).not.toBeInTheDocument()\n    expect(screen.queryByLabelText('Pause')).not.toBeInTheDocument()\n    expect(screen.queryByLabelText('Reset')).not.toBeInTheDocument()\n    // Delete button should still be visible\n    expect(screen.getByLabelText('Delete')).toBeInTheDocument()\n  })\n\n  it('shows 0:00 when timer is complete', () => {\n    const timer = createMockTimer({ remaining: 0 })\n    render(\n      <TimerWidget\n        timer={timer}\n        onToggle={vi.fn()}\n        onReset={vi.fn()}\n        onDelete={vi.fn()}\n      />\n    )\n    expect(screen.getByText('0:00')).toBeInTheDocument()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/api.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (482). Maximum allowed is 50.","line":8,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":489,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (80). Maximum allowed is 50.","line":17,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":96,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (82). Maximum allowed is 50.","line":98,"column":22,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":179,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (131). Maximum allowed is 50.","line":209,"column":27,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":339,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (59). Maximum allowed is 50.","line":341,"column":25,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":399,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (70). Maximum allowed is 50.","line":401,"column":23,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":470,"endColumn":4}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { api } from '../api/client'\n\n// Mock fetch globally\nconst mockFetch = vi.fn()\nglobalThis.fetch = mockFetch\n\ndescribe('API Client', () => {\n  beforeEach(() => {\n    mockFetch.mockClear()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  describe('profiles', () => {\n    it('lists profiles', async () => {\n      const profiles = [\n        { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us' },\n        { id: 2, name: 'Bob', avatar_color: '#8fae6f', theme: 'dark', unit_preference: 'metric' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(profiles),\n      })\n\n      const result = await api.profiles.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/', expect.objectContaining({\n        headers: { 'Content-Type': 'application/json' },\n      }))\n      expect(result).toEqual(profiles)\n    })\n\n    it('creates a profile', async () => {\n      const newProfile = { name: 'Charlie', avatar_color: '#6b9dad' }\n      const createdProfile = { id: 3, ...newProfile, theme: 'light', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(createdProfile),\n      })\n\n      const result = await api.profiles.create(newProfile)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify(newProfile),\n      }))\n      expect(result).toEqual(createdProfile)\n    })\n\n    it('selects a profile', async () => {\n      const profile = { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(profile),\n      })\n\n      const result = await api.profiles.select(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/select/', expect.objectContaining({\n        method: 'POST',\n      }))\n      expect(result).toEqual(profile)\n    })\n\n    it('updates a profile', async () => {\n      const updatedProfile = { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'dark', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(updatedProfile),\n      })\n\n      const result = await api.profiles.update(1, { name: 'Alice', avatar_color: '#d97850', theme: 'dark' })\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/', expect.objectContaining({\n        method: 'PUT',\n      }))\n      expect(result.theme).toBe('dark')\n    })\n\n    it('deletes a profile', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.profiles.delete(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('search', () => {\n    it('searches recipes with query', async () => {\n      const searchResponse = {\n        results: [\n          { url: 'https://example.com/recipe1', title: 'Chocolate Cookies', host: 'example.com', image_url: '', description: 'Delicious cookies' },\n          { url: 'https://example.com/recipe2', title: 'Sugar Cookies', host: 'example.com', image_url: '', description: 'Sweet treats' },\n        ],\n        total: 2,\n        page: 1,\n        has_more: false,\n        sites: { 'example.com': 2 },\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=1', expect.any(Object))\n      expect(result.results).toHaveLength(2)\n      expect(result.total).toBe(2)\n      expect(result.has_more).toBe(false)\n    })\n\n    it('searches recipes with source filter', async () => {\n      const searchResponse = {\n        results: [{ url: 'https://allrecipes.com/recipe', title: 'Recipe', host: 'allrecipes.com', image_url: '', description: '' }],\n        total: 1,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 1 },\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies', 'allrecipes.com')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=1&sources=allrecipes.com', expect.any(Object))\n      expect(result.results).toHaveLength(1)\n    })\n\n    it('searches recipes with pagination', async () => {\n      const searchResponse = {\n        results: [],\n        total: 20,\n        page: 3,\n        has_more: false,\n        sites: {},\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies', undefined, 3)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=3', expect.any(Object))\n      expect(result.page).toBe(3)\n    })\n\n    it('returns has_more when more results exist', async () => {\n      const searchResponse = {\n        results: Array(6).fill({ url: '', title: '', host: '', image_url: '', description: '' }),\n        total: 50,\n        page: 1,\n        has_more: true,\n        sites: {},\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('pasta')\n\n      expect(result.has_more).toBe(true)\n      expect(result.total).toBe(50)\n    })\n  })\n\n  describe('scrape', () => {\n    it('scrapes a recipe from URL', async () => {\n      const recipe = {\n        id: 1,\n        title: 'Chocolate Cake',\n        host: 'example.com',\n        image_url: 'https://example.com/cake.jpg',\n        image: null,\n        total_time: 60,\n        rating: 4.5,\n        is_remix: false,\n        scraped_at: '2024-01-01T00:00:00Z',\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(recipe),\n      })\n\n      const result = await api.recipes.scrape('https://example.com/chocolate-cake')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/scrape/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ url: 'https://example.com/chocolate-cake' }),\n      }))\n      expect(result.title).toBe('Chocolate Cake')\n    })\n  })\n\n  describe('collections', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Test Recipe',\n      host: 'example.com',\n      image_url: 'https://example.com/img.jpg',\n      image: null,\n      total_time: 30,\n      rating: 4.5,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists collections', async () => {\n      const collections = [\n        { id: 1, name: 'Weeknight Dinners', description: 'Quick meals', recipe_count: 5, created_at: '2024-01-01T00:00:00Z', updated_at: '2024-01-01T00:00:00Z' },\n        { id: 2, name: 'Holiday Baking', description: '', recipe_count: 3, created_at: '2024-01-02T00:00:00Z', updated_at: '2024-01-02T00:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collections),\n      })\n\n      const result = await api.collections.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/', expect.objectContaining({\n        headers: { 'Content-Type': 'application/json' },\n      }))\n      expect(result).toHaveLength(2)\n      expect(result[0].name).toBe('Weeknight Dinners')\n    })\n\n    it('creates a collection', async () => {\n      const newCollection = { name: 'Desserts', description: 'Sweet treats' }\n      const createdCollection = { id: 3, ...newCollection, recipe_count: 0, created_at: '2024-01-03T00:00:00Z', updated_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(createdCollection),\n      })\n\n      const result = await api.collections.create(newCollection)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify(newCollection),\n      }))\n      expect(result.name).toBe('Desserts')\n    })\n\n    it('gets a collection with recipes', async () => {\n      const collectionDetail = {\n        id: 1,\n        name: 'Weeknight Dinners',\n        description: 'Quick meals',\n        recipes: [\n          { recipe: mockRecipe, order: 1, added_at: '2024-01-01T00:00:00Z' },\n        ],\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collectionDetail),\n      })\n\n      const result = await api.collections.get(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.any(Object))\n      expect(result.recipes).toHaveLength(1)\n      expect(result.recipes[0].recipe.title).toBe('Test Recipe')\n    })\n\n    it('updates a collection', async () => {\n      const updatedCollection = { id: 1, name: 'Quick Dinners', description: 'Updated desc', recipe_count: 5, created_at: '2024-01-01T00:00:00Z', updated_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(updatedCollection),\n      })\n\n      const result = await api.collections.update(1, { name: 'Quick Dinners', description: 'Updated desc' })\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.objectContaining({\n        method: 'PUT',\n      }))\n      expect(result.name).toBe('Quick Dinners')\n    })\n\n    it('deletes a collection', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.collections.delete(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n\n    it('adds a recipe to a collection', async () => {\n      const collectionItem = { recipe: mockRecipe, order: 2, added_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collectionItem),\n      })\n\n      const result = await api.collections.addRecipe(1, 1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/recipes/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Test Recipe')\n    })\n\n    it('removes a recipe from a collection', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.collections.removeRecipe(1, 1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/recipes/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('favorites', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Chocolate Cake',\n      host: 'example.com',\n      image_url: 'https://example.com/cake.jpg',\n      image: null,\n      total_time: 60,\n      rating: 4.8,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists favorites', async () => {\n      const favorites = [\n        { recipe: mockRecipe, created_at: '2024-01-01T00:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(favorites),\n      })\n\n      const result = await api.favorites.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/', expect.any(Object))\n      expect(result).toHaveLength(1)\n      expect(result[0].recipe.title).toBe('Chocolate Cake')\n    })\n\n    it('adds a favorite', async () => {\n      const favorite = { recipe: mockRecipe, created_at: '2024-01-01T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(favorite),\n      })\n\n      const result = await api.favorites.add(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Chocolate Cake')\n    })\n\n    it('removes a favorite', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.favorites.remove(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('history', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Pasta Carbonara',\n      host: 'example.com',\n      image_url: 'https://example.com/pasta.jpg',\n      image: null,\n      total_time: 30,\n      rating: 4.7,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists history', async () => {\n      const history = [\n        { recipe: mockRecipe, viewed_at: '2024-01-01T12:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(history),\n      })\n\n      const result = await api.history.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/?limit=6', expect.any(Object))\n      expect(result).toHaveLength(1)\n      expect(result[0].recipe.title).toBe('Pasta Carbonara')\n    })\n\n    it('lists history with custom limit', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve([]),\n      })\n\n      await api.history.list(10)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/?limit=10', expect.any(Object))\n    })\n\n    it('records a view', async () => {\n      const historyItem = { recipe: mockRecipe, viewed_at: '2024-01-01T12:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(historyItem),\n      })\n\n      const result = await api.history.record(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Pasta Carbonara')\n    })\n\n    it('clears history', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.history.clear()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('error handling', () => {\n    it('throws on API error', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 404,\n        text: () => Promise.resolve('Not found'),\n      })\n\n      await expect(api.profiles.get(999)).rejects.toThrow('Not found')\n    })\n\n    it('throws on network error', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'))\n\n      await expect(api.profiles.list()).rejects.toThrow('Network error')\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/components.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (113). Maximum allowed is 50.","line":82,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":194,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (239). Maximum allowed is 50.","line":196,"column":20,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":434,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport { MemoryRouter, Routes, Route } from 'react-router-dom'\nimport ProfileSelector from '../screens/ProfileSelector'\nimport Search from '../screens/Search'\nimport { api } from '../api/client'\nimport type { ProfileStats } from '../api/client'\n\n// Mock the API client\nvi.mock('../api/client', () => ({\n  api: {\n    profiles: {\n      list: vi.fn(),\n      create: vi.fn(),\n      select: vi.fn(),\n    },\n    recipes: {\n      search: vi.fn(),\n      scrape: vi.fn(),\n    },\n    favorites: {\n      list: vi.fn(),\n      add: vi.fn(),\n      remove: vi.fn(),\n    },\n    history: {\n      list: vi.fn(),\n      record: vi.fn(),\n    },\n  },\n}))\n\n// Mock sonner toast\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n    info: vi.fn(),\n  },\n  Toaster: () => null,\n}))\n\n// Mock ProfileContext\nconst mockSelectProfile = vi.fn()\nconst mockProfileContext = {\n  profile: null,\n  theme: 'light' as const,\n  favoriteRecipeIds: new Set<number>(),\n  loading: false,\n  selectProfile: mockSelectProfile,\n  logout: vi.fn(),\n  toggleTheme: vi.fn(),\n  toggleFavorite: vi.fn(),\n  isFavorite: vi.fn(() => false),\n}\n\nvi.mock('../contexts/ProfileContext', () => ({\n  useProfile: () => mockProfileContext,\n  ProfileProvider: ({ children }: { children: React.ReactNode }) => children,\n}))\n\n// Shared test fixtures\nconst mockStats: ProfileStats = {\n  favorites: 0,\n  collections: 0,\n  collection_items: 0,\n  remixes: 0,\n  view_history: 0,\n  scaling_cache: 0,\n  discover_cache: 0,\n}\n\n// Helper to render with router\nconst renderWithRouter = (ui: React.ReactElement, { initialEntries = ['/'] } = {}) => {\n  return render(\n    <MemoryRouter initialEntries={initialEntries}>\n      {ui}\n    </MemoryRouter>\n  )\n}\n\ndescribe('ProfileSelector', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  it('shows loading state initially', () => {\n    vi.mocked(api.profiles.list).mockImplementation(() => new Promise(() => {}))\n\n    renderWithRouter(<ProfileSelector />)\n\n    expect(screen.getByText('Loading...')).toBeInTheDocument()\n  })\n\n  it('renders profiles after loading', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n      { id: 2, name: 'Bob', avatar_color: '#8fae6f', theme: 'dark', unit_preference: 'metric', created_at: '2024-01-01', stats: mockStats },\n    ])\n\n    renderWithRouter(<ProfileSelector />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice')).toBeInTheDocument()\n      expect(screen.getByText('Bob')).toBeInTheDocument()\n    })\n\n    expect(screen.getByText(\"Who's cooking today?\")).toBeInTheDocument()\n  })\n\n  it('calls selectProfile when profile is clicked', async () => {\n    const profiles = [\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n    ]\n    vi.mocked(api.profiles.list).mockResolvedValueOnce(profiles)\n    mockSelectProfile.mockResolvedValueOnce(undefined)\n\n    renderWithRouter(<ProfileSelector />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Alice'))\n\n    await waitFor(() => {\n      expect(mockSelectProfile).toHaveBeenCalledWith(profiles[0])\n    })\n  })\n\n  it('shows create profile form when add button is clicked', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([])\n\n    renderWithRouter(<ProfileSelector />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Add Profile')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Add Profile'))\n\n    expect(screen.getByText('Create Profile')).toBeInTheDocument()\n    expect(screen.getByPlaceholderText('Enter your name')).toBeInTheDocument()\n  })\n\n  it('creates a new profile when form is submitted', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([])\n    vi.mocked(api.profiles.create).mockResolvedValueOnce({\n      id: 1,\n      name: 'Charlie',\n      avatar_color: '#d97850',\n      theme: 'light',\n      unit_preference: 'metric',\n    })\n    mockSelectProfile.mockResolvedValueOnce(undefined)\n\n    renderWithRouter(<ProfileSelector />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Add Profile')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Add Profile'))\n\n    const input = screen.getByPlaceholderText('Enter your name')\n    fireEvent.change(input, { target: { value: 'Charlie' } })\n    fireEvent.click(screen.getByText('Create'))\n\n    await waitFor(() => {\n      expect(api.profiles.create).toHaveBeenCalledWith({\n        name: 'Charlie',\n        avatar_color: '#d97850',\n        theme: 'light',\n        unit_preference: 'metric',\n      })\n    })\n  })\n\n  it('displays profile initials', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n    ])\n\n    renderWithRouter(<ProfileSelector />)\n\n    await waitFor(() => {\n      expect(screen.getByText('A')).toBeInTheDocument()\n    })\n  })\n})\n\ndescribe('Search', () => {\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  // Helper to render Search with a query in the URL\n  const renderSearch = (query: string) => {\n    return render(\n      <MemoryRouter initialEntries={[`/search?q=${encodeURIComponent(query)}`]}>\n        <Routes>\n          <Route path=\"/search\" element={<Search />} />\n          <Route path=\"/home\" element={<div>Home</div>} />\n          <Route path=\"/recipe/:id\" element={<div>Recipe</div>} />\n        </Routes>\n      </MemoryRouter>\n    )\n  }\n\n  it('shows search results', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [\n        { url: 'https://example.com/recipe1', title: 'Chocolate Cookies', host: 'example.com', image_url: '', cached_image_url: null, description: 'Delicious', rating_count: null },\n        { url: 'https://example.com/recipe2', title: 'Sugar Cookies', host: 'example.com', image_url: '', cached_image_url: null, description: 'Sweet', rating_count: null },\n      ],\n      total: 2,\n      page: 1,\n      has_more: false,\n      sites: { 'example.com': 2 },\n    })\n\n    renderSearch('cookies')\n\n    await waitFor(() => {\n      expect(screen.getByText('Chocolate Cookies')).toBeInTheDocument()\n      expect(screen.getByText('Sugar Cookies')).toBeInTheDocument()\n    })\n  })\n\n  it('displays result count', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Test Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 1,\n      page: 1,\n      has_more: false,\n      sites: { 'example.com': 1 },\n    })\n\n    renderSearch('cookies')\n\n    await waitFor(() => {\n      expect(screen.getByText('1 result found')).toBeInTheDocument()\n    })\n  })\n\n  it('displays source filter chips', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 10,\n      page: 1,\n      has_more: false,\n      sites: { 'allrecipes.com': 5, 'foodnetwork.com': 5 },\n    })\n\n    renderSearch('pasta')\n\n    await waitFor(() => {\n      expect(screen.getByText('All Sources (10)')).toBeInTheDocument()\n      expect(screen.getByText('allrecipes.com (5)')).toBeInTheDocument()\n      expect(screen.getByText('foodnetwork.com (5)')).toBeInTheDocument()\n    })\n  })\n\n  it('filters by source when chip is clicked', async () => {\n    vi.mocked(api.recipes.search)\n      .mockResolvedValueOnce({\n        results: [],\n        total: 10,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 5, 'foodnetwork.com': 5 },\n      })\n      .mockResolvedValueOnce({\n        results: [],\n        total: 5,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 5 },\n      })\n\n    renderSearch('pasta')\n\n    await waitFor(() => {\n      expect(screen.getByText('allrecipes.com (5)')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('allrecipes.com (5)'))\n\n    await waitFor(() => {\n      expect(api.recipes.search).toHaveBeenCalledWith('pasta', 'allrecipes.com', 1)\n    })\n  })\n\n  it('shows load more button when has_more is true', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 50,\n      page: 1,\n      has_more: true,\n      sites: {},\n    })\n\n    renderSearch('cookies')\n\n    await waitFor(() => {\n      expect(screen.getByText('Load More')).toBeInTheDocument()\n    })\n  })\n\n  it('shows end of results when has_more is false', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 1,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    renderSearch('cookies')\n\n    await waitFor(() => {\n      expect(screen.getByText('End of results')).toBeInTheDocument()\n    })\n  })\n\n  it('shows URL import card when query is a URL', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    renderSearch('https://example.com/my-recipe')\n\n    await waitFor(() => {\n      expect(screen.getByText('Import Recipe from URL')).toBeInTheDocument()\n      expect(screen.getByRole('button', { name: 'Import Recipe' })).toBeInTheDocument()\n    })\n  })\n\n  it('imports recipe when import button is clicked', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n    vi.mocked(api.recipes.scrape).mockResolvedValueOnce({\n      id: 123,\n      title: 'Imported Recipe',\n      host: 'example.com',\n      canonical_url: 'https://example.com/recipe',\n      image: '',\n      image_url: '',\n      ingredients: [],\n      ingredient_groups: [],\n      instructions: [],\n      instructions_text: '',\n      nutrition: {},\n      servings: null,\n      prep_time: null,\n      cook_time: null,\n      total_time: null,\n      yields: '',\n      rating: null,\n      rating_count: null,\n      ai_tips: [],\n      scraped_at: '2024-01-01',\n    } as never)\n    vi.mocked(api.history.record).mockResolvedValueOnce({} as never)\n\n    renderSearch('https://example.com/recipe')\n\n    await waitFor(() => {\n      expect(screen.getByRole('button', { name: 'Import Recipe' })).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByRole('button', { name: 'Import Recipe' }))\n\n    await waitFor(() => {\n      expect(api.recipes.scrape).toHaveBeenCalledWith('https://example.com/recipe')\n    })\n  })\n\n  it('navigates back when back button is clicked', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    renderSearch('cookies')\n\n    await waitFor(() => {\n      expect(screen.getByText('Back to Home')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Back to Home'))\n\n    // Should navigate to /home\n    await waitFor(() => {\n      expect(screen.getByText('Home')).toBeInTheDocument()\n    })\n  })\n\n  it('shows empty state when no results', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    renderSearch('zzzzzzz')\n\n    await waitFor(() => {\n      expect(screen.getByText('No recipes found for \"zzzzzzz\"')).toBeInTheDocument()\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/formatting.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/timers.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (242). Maximum allowed is 50.","line":80,"column":23,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":321,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { renderHook, act } from '@testing-library/react'\nimport { useTimers, detectTimes, formatTimerDisplay } from '../hooks/useTimers'\n\n// Mock crypto.randomUUID\nvi.stubGlobal('crypto', {\n  randomUUID: () => 'test-uuid-' + Math.random().toString(36).slice(2, 11),\n})\n\ndescribe('detectTimes', () => {\n  it('detects minutes', () => {\n    expect(detectTimes('bake for 15 minutes')).toContain(900)\n  })\n\n  it('detects minute variations', () => {\n    expect(detectTimes('cook 5 min')).toContain(300)\n    expect(detectTimes('cook 5min')).toContain(300)\n    expect(detectTimes('cook 5 mins')).toContain(300)\n    expect(detectTimes('wait 10 m')).toContain(600)\n  })\n\n  it('detects hours', () => {\n    expect(detectTimes('bake for 2 hours')).toContain(7200)\n    expect(detectTimes('cook 1 hr')).toContain(3600)\n    expect(detectTimes('simmer 3h')).toContain(10800)\n  })\n\n  it('detects seconds', () => {\n    expect(detectTimes('microwave 30 seconds')).toContain(30)\n    expect(detectTimes('wait 45 sec')).toContain(45)\n    expect(detectTimes('blend 10s')).toContain(10)\n  })\n\n  it('detects multiple times', () => {\n    const times = detectTimes('cook 5 min then bake 30 minutes')\n    expect(times).toContain(300)\n    expect(times).toContain(1800)\n    expect(times).toHaveLength(2)\n  })\n\n  it('returns empty array for no times', () => {\n    expect(detectTimes('mix until smooth')).toEqual([])\n    expect(detectTimes('add flour and sugar')).toEqual([])\n  })\n\n  it('handles complex instruction text', () => {\n    const times = detectTimes(\n      'Preheat oven to 350F. Bake for 25 minutes, then let rest 10 minutes before serving.'\n    )\n    expect(times).toContain(1500) // 25 minutes\n    expect(times).toContain(600) // 10 minutes\n  })\n\n  it('ignores zero values', () => {\n    expect(detectTimes('0 minutes')).toEqual([])\n  })\n})\n\ndescribe('formatTimerDisplay', () => {\n  it('formats seconds only', () => {\n    expect(formatTimerDisplay(45)).toBe('0:45')\n  })\n\n  it('formats minutes and seconds', () => {\n    expect(formatTimerDisplay(90)).toBe('1:30')\n    expect(formatTimerDisplay(300)).toBe('5:00')\n  })\n\n  it('formats hours, minutes, and seconds', () => {\n    expect(formatTimerDisplay(3661)).toBe('1:01:01')\n    expect(formatTimerDisplay(7200)).toBe('2:00:00')\n  })\n\n  it('pads with zeros correctly', () => {\n    expect(formatTimerDisplay(65)).toBe('1:05')\n    expect(formatTimerDisplay(3605)).toBe('1:00:05')\n  })\n})\n\ndescribe('useTimers', () => {\n  beforeEach(() => {\n    vi.useFakeTimers()\n  })\n\n  afterEach(() => {\n    vi.useRealTimers()\n  })\n\n  it('adds timer and auto-starts by default', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test Timer', 300)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Test Timer')\n    expect(result.current.timers[0].duration).toBe(300)\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(true)\n  })\n\n  it('adds timer without auto-start when specified', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test Timer', 300, false)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Test Timer')\n    expect(result.current.timers[0].duration).toBe(300)\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('returns timer id from addTimer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    let timerId: string = ''\n    act(() => {\n      timerId = result.current.addTimer('Test Timer', 300)\n    })\n\n    expect(timerId).toBeTruthy()\n    expect(result.current.timers[0].id).toBe(timerId)\n  })\n\n  it('starts and pauses timer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n    expect(result.current.timers[0].isRunning).toBe(false)\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(true)\n\n    act(() => {\n      result.current.pauseTimer(timerId)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('toggles timer state', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n    expect(result.current.timers[0].isRunning).toBe(false)\n\n    // Toggle on\n    act(() => {\n      result.current.toggleTimer(timerId)\n    })\n    expect(result.current.timers[0].isRunning).toBe(true)\n\n    // Toggle off\n    act(() => {\n      result.current.toggleTimer(timerId)\n    })\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('resets timer to initial duration', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    // Start and advance time\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(295)\n\n    // Reset\n    act(() => {\n      result.current.resetTimer(timerId)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('deletes timer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Timer 1', 300)\n      result.current.addTimer('Timer 2', 600)\n    })\n\n    expect(result.current.timers).toHaveLength(2)\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.deleteTimer(timerId)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Timer 2')\n  })\n\n  it('decrements remaining time when running', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 10)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    // Advance 5 seconds\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(5)\n  })\n\n  it('calls onComplete when timer finishes', () => {\n    const onComplete = vi.fn()\n    const { result } = renderHook(() => useTimers(onComplete))\n\n    act(() => {\n      result.current.addTimer('Test', 3)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    // Advance past completion\n    act(() => {\n      vi.advanceTimersByTime(4000)\n    })\n\n    expect(onComplete).toHaveBeenCalledTimes(1)\n    expect(onComplete).toHaveBeenCalledWith(\n      expect.objectContaining({\n        label: 'Test',\n        remaining: 0,\n        isRunning: false,\n      })\n    )\n  })\n\n  it('stops timer at zero', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 2)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(0)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('supports multiple simultaneous timers', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Timer 1', 100)\n      result.current.addTimer('Timer 2', 200)\n    })\n\n    const timer1Id = result.current.timers[0].id\n    const timer2Id = result.current.timers[1].id\n\n    act(() => {\n      result.current.startTimer(timer1Id)\n      result.current.startTimer(timer2Id)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(true)\n    expect(result.current.timers[1].isRunning).toBe(true)\n\n    act(() => {\n      vi.advanceTimersByTime(10000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(90)\n    expect(result.current.timers[1].remaining).toBe(190)\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/useAsync.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (175). Maximum allowed is 50.","line":5,"column":22,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":179,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (104). Maximum allowed is 50.","line":181,"column":35,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":284,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest'\nimport { renderHook, act } from '@testing-library/react'\nimport { useAsync, useAsyncWithStaleData } from '../hooks/useAsync'\n\ndescribe('useAsync', () => {\n  it('starts with initial state', () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    expect(result.current.loading).toBe(false)\n    expect(result.current.error).toBeNull()\n    expect(result.current.data).toBeNull()\n  })\n\n  it('sets loading to true during execution', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    let resolvePromise: (value: string) => void\n    const promise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    act(() => {\n      result.current.execute(promise)\n    })\n\n    expect(result.current.loading).toBe(true)\n    expect(result.current.error).toBeNull()\n    expect(result.current.data).toBeNull()\n\n    await act(async () => {\n      resolvePromise('result')\n    })\n  })\n\n  it('sets data on successful execution', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    await act(async () => {\n      await result.current.execute(Promise.resolve('success'))\n    })\n\n    expect(result.current.loading).toBe(false)\n    expect(result.current.error).toBeNull()\n    expect(result.current.data).toBe('success')\n  })\n\n  it('sets error on failed execution', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    await act(async () => {\n      try {\n        await result.current.execute(Promise.reject(new Error('failed')))\n      } catch {\n        // Expected\n      }\n    })\n\n    expect(result.current.loading).toBe(false)\n    expect(result.current.error).toEqual(new Error('failed'))\n    expect(result.current.data).toBeNull()\n  })\n\n  it('converts non-Error rejections to Error objects', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    await act(async () => {\n      try {\n        await result.current.execute(Promise.reject('string error'))\n      } catch {\n        // Expected\n      }\n    })\n\n    expect(result.current.error).toBeInstanceOf(Error)\n    expect(result.current.error?.message).toBe('string error')\n  })\n\n  it('rethrows the error from execute', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    await expect(\n      act(async () => {\n        await result.current.execute(Promise.reject(new Error('test error')))\n      })\n    ).rejects.toThrow('test error')\n  })\n\n  it('returns data from execute on success', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    let returnedData: string | undefined\n\n    await act(async () => {\n      returnedData = await result.current.execute(Promise.resolve('return value'))\n    })\n\n    expect(returnedData).toBe('return value')\n  })\n\n  it('clears previous data when starting new execution', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    // First execution\n    await act(async () => {\n      await result.current.execute(Promise.resolve('first'))\n    })\n\n    expect(result.current.data).toBe('first')\n\n    // Start second execution\n    let resolvePromise: (value: string) => void\n    const promise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    act(() => {\n      result.current.execute(promise)\n    })\n\n    // Data should be cleared during loading\n    expect(result.current.data).toBeNull()\n\n    await act(async () => {\n      resolvePromise('second')\n    })\n  })\n\n  it('clears previous error when starting new execution', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    // First execution fails\n    await act(async () => {\n      try {\n        await result.current.execute(Promise.reject(new Error('failed')))\n      } catch {\n        // Expected\n      }\n    })\n\n    expect(result.current.error).not.toBeNull()\n\n    // Second execution starts\n    let resolvePromise: (value: string) => void\n    const promise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    act(() => {\n      result.current.execute(promise)\n    })\n\n    // Error should be cleared during loading\n    expect(result.current.error).toBeNull()\n\n    await act(async () => {\n      resolvePromise('success')\n    })\n  })\n\n  it('reset() clears all state', async () => {\n    const { result } = renderHook(() => useAsync<string>())\n\n    // Execute successfully\n    await act(async () => {\n      await result.current.execute(Promise.resolve('data'))\n    })\n\n    expect(result.current.data).toBe('data')\n\n    // Reset\n    act(() => {\n      result.current.reset()\n    })\n\n    expect(result.current.loading).toBe(false)\n    expect(result.current.error).toBeNull()\n    expect(result.current.data).toBeNull()\n  })\n})\n\ndescribe('useAsyncWithStaleData', () => {\n  it('preserves previous data during loading', async () => {\n    const { result } = renderHook(() => useAsyncWithStaleData<string>())\n\n    // First execution\n    await act(async () => {\n      await result.current.execute(Promise.resolve('first'))\n    })\n\n    expect(result.current.data).toBe('first')\n\n    // Start second execution\n    let resolvePromise: (value: string) => void\n    const promise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    act(() => {\n      result.current.execute(promise)\n    })\n\n    // Data should be preserved during loading\n    expect(result.current.loading).toBe(true)\n    expect(result.current.data).toBe('first')\n\n    await act(async () => {\n      resolvePromise('second')\n    })\n\n    expect(result.current.data).toBe('second')\n  })\n\n  it('preserves previous data on error', async () => {\n    const { result } = renderHook(() => useAsyncWithStaleData<string>())\n\n    // First execution succeeds\n    await act(async () => {\n      await result.current.execute(Promise.resolve('initial'))\n    })\n\n    expect(result.current.data).toBe('initial')\n\n    // Second execution fails\n    await act(async () => {\n      try {\n        await result.current.execute(Promise.reject(new Error('failed')))\n      } catch {\n        // Expected\n      }\n    })\n\n    // Data should be preserved even after error\n    expect(result.current.data).toBe('initial')\n    expect(result.current.error).not.toBeNull()\n  })\n\n  it('clears previous error on new execution', async () => {\n    const { result } = renderHook(() => useAsyncWithStaleData<string>())\n\n    // First execution fails\n    await act(async () => {\n      try {\n        await result.current.execute(Promise.reject(new Error('failed')))\n      } catch {\n        // Expected\n      }\n    })\n\n    expect(result.current.error).not.toBeNull()\n\n    // Second execution starts\n    let resolvePromise: (value: string) => void\n    const promise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    act(() => {\n      result.current.execute(promise)\n    })\n\n    // Error should be cleared during loading\n    expect(result.current.error).toBeNull()\n\n    await act(async () => {\n      resolvePromise('success')\n    })\n  })\n\n  it('reset() clears all state including stale data', async () => {\n    const { result } = renderHook(() => useAsyncWithStaleData<string>())\n\n    await act(async () => {\n      await result.current.execute(Promise.resolve('data'))\n    })\n\n    act(() => {\n      result.current.reset()\n    })\n\n    expect(result.current.loading).toBe(false)\n    expect(result.current.error).toBeNull()\n    expect(result.current.data).toBeNull()\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/utils.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (73). Maximum allowed is 50.","line":4,"column":32,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":76,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest'\nimport { formatNutritionKey } from '../lib/utils'\n\ndescribe('formatNutritionKey', () => {\n  describe('camelCase with Content suffix', () => {\n    it('formats carbohydrateContent', () => {\n      expect(formatNutritionKey('carbohydrateContent')).toBe('Carbohydrate')\n    })\n\n    it('formats cholesterolContent', () => {\n      expect(formatNutritionKey('cholesterolContent')).toBe('Cholesterol')\n    })\n\n    it('formats proteinContent', () => {\n      expect(formatNutritionKey('proteinContent')).toBe('Protein')\n    })\n\n    it('formats fatContent', () => {\n      expect(formatNutritionKey('fatContent')).toBe('Fat')\n    })\n\n    it('formats saturatedFatContent', () => {\n      expect(formatNutritionKey('saturatedFatContent')).toBe('Saturated Fat')\n    })\n\n    it('formats sodiumContent', () => {\n      expect(formatNutritionKey('sodiumContent')).toBe('Sodium')\n    })\n\n    it('formats fiberContent', () => {\n      expect(formatNutritionKey('fiberContent')).toBe('Fiber')\n    })\n\n    it('formats sugarContent', () => {\n      expect(formatNutritionKey('sugarContent')).toBe('Sugar')\n    })\n  })\n\n  describe('simple camelCase without suffix', () => {\n    it('formats calories', () => {\n      expect(formatNutritionKey('calories')).toBe('Calories')\n    })\n\n    it('formats servingSize', () => {\n      expect(formatNutritionKey('servingSize')).toBe('Serving Size')\n    })\n  })\n\n  describe('snake_case', () => {\n    it('formats saturated_fat', () => {\n      expect(formatNutritionKey('saturated_fat')).toBe('Saturated Fat')\n    })\n\n    it('formats total_carbs', () => {\n      expect(formatNutritionKey('total_carbs')).toBe('Total Carbs')\n    })\n\n    it('formats dietary_fiber', () => {\n      expect(formatNutritionKey('dietary_fiber')).toBe('Dietary Fiber')\n    })\n  })\n\n  describe('edge cases', () => {\n    it('handles empty string', () => {\n      expect(formatNutritionKey('')).toBe('')\n    })\n\n    it('handles single word', () => {\n      expect(formatNutritionKey('protein')).toBe('Protein')\n    })\n\n    it('handles already capitalized', () => {\n      expect(formatNutritionKey('Calories')).toBe('Calories')\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
