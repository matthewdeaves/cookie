[{"filePath":"/home/runner/work/cookie/cookie/frontend/src/App.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'AppContent' has too many lines (300). Maximum allowed is 50.","line":28,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":327,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'AppContent' has a complexity of 19. Maximum allowed is 10.","line":28,"column":1,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":28,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { Toaster, toast } from 'sonner'\nimport ProfileSelector from './screens/ProfileSelector'\nimport Home from './screens/Home'\nimport Search from './screens/Search'\nimport RecipeDetail from './screens/RecipeDetail'\nimport PlayMode from './screens/PlayMode'\nimport Favorites from './screens/Favorites'\nimport AllRecipes from './screens/AllRecipes'\nimport Collections from './screens/Collections'\nimport CollectionDetail from './screens/CollectionDetail'\nimport Settings from './screens/Settings'\nimport { api, type Profile, type RecipeDetail as RecipeDetailType } from './api/client'\nimport { AIStatusProvider, useAIStatus } from './contexts/AIStatusContext'\n\ntype Screen =\n  | 'profile-selector'\n  | 'home'\n  | 'search'\n  | 'recipe-detail'\n  | 'play-mode'\n  | 'favorites'\n  | 'all-recipes'\n  | 'collections'\n  | 'collection-detail'\n  | 'settings'\n\nfunction AppContent() {\n  const [currentScreen, setCurrentScreen] = useState<Screen>('profile-selector')\n  const [currentProfile, setCurrentProfile] = useState<Profile | null>(null)\n  const [theme, setTheme] = useState<'light' | 'dark'>('light')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [selectedRecipeId, setSelectedRecipeId] = useState<number | null>(null)\n  const aiStatus = useAIStatus()\n  const [playModeRecipe, setPlayModeRecipe] = useState<RecipeDetailType | null>(null)\n  const [favoriteRecipeIds, setFavoriteRecipeIds] = useState<Set<number>>(new Set())\n  const [selectedCollectionId, setSelectedCollectionId] = useState<number | null>(null)\n  const [pendingRecipeForCollection, setPendingRecipeForCollection] = useState<number | null>(null)\n  const [previousScreen, setPreviousScreen] = useState<Screen>('home')\n\n  // Apply theme class to document\n  useEffect(() => {\n    if (theme === 'dark') {\n      document.documentElement.classList.add('dark')\n    } else {\n      document.documentElement.classList.remove('dark')\n    }\n  }, [theme])\n\n\n  // Load favorites when profile is set\n  useEffect(() => {\n    if (!currentProfile) return\n\n    api.favorites\n      .list()\n      .then((favorites) => setFavoriteRecipeIds(new Set(favorites.map((f) => f.recipe.id))))\n      .catch((error) => console.error('Failed to load favorites:', error))\n  }, [currentProfile])\n\n  const handleProfileSelect = async (profile: Profile) => {\n    try {\n      await api.profiles.select(profile.id)\n      setCurrentProfile(profile)\n      setTheme(profile.theme as 'light' | 'dark')\n      setCurrentScreen('home')\n    } catch (error) {\n      console.error('Failed to select profile:', error)\n    }\n  }\n\n  const handleThemeToggle = async () => {\n    if (!currentProfile) return\n\n    const newTheme = theme === 'light' ? 'dark' : 'light'\n    setTheme(newTheme)\n\n    try {\n      const updated = await api.profiles.update(currentProfile.id, {\n        ...currentProfile,\n        theme: newTheme,\n      })\n      setCurrentProfile(updated)\n    } catch (error) {\n      console.error('Failed to update theme:', error)\n      setTheme(theme) // Revert on error\n    }\n  }\n\n  const handleLogout = () => {\n    setCurrentProfile(null)\n    setFavoriteRecipeIds(new Set())\n    setCurrentScreen('profile-selector')\n  }\n\n  const handleSearch = (query: string) => {\n    setSearchQuery(query)\n    setCurrentScreen('search')\n  }\n\n  const handleSearchBack = () => {\n    setCurrentScreen('home')\n    setSearchQuery('')\n  }\n\n  const handleImport = async (url: string) => {\n    try {\n      const recipe = await api.recipes.scrape(url)\n      toast.success(`Imported: ${recipe.title}`)\n      // Record in history\n      await api.history.record(recipe.id)\n      // Navigate to recipe detail (preserve search context for back navigation)\n      setPreviousScreen('search')\n      setSelectedRecipeId(recipe.id)\n      setCurrentScreen('recipe-detail')\n    } catch (error) {\n      console.error('Failed to import recipe:', error)\n      const message = error instanceof Error ? error.message : 'Failed to import recipe'\n      toast.error(message)\n      throw error\n    }\n  }\n\n  const handleRecipeClick = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    setPreviousScreen(currentScreen)\n    setSelectedRecipeId(recipeId)\n    setCurrentScreen('recipe-detail')\n  }\n\n  const handleRecipeDetailBack = () => {\n    setSelectedRecipeId(null)\n    // Go back to previous screen\n    if (previousScreen === 'search' || previousScreen === 'all-recipes' || previousScreen === 'favorites') {\n      setCurrentScreen(previousScreen)\n    } else {\n      setCurrentScreen('home')\n    }\n  }\n\n  const handleFavoriteToggle = async (recipe: RecipeDetailType) => {\n    const isFavorite = favoriteRecipeIds.has(recipe.id)\n    try {\n      if (isFavorite) {\n        await api.favorites.remove(recipe.id)\n        setFavoriteRecipeIds((prev) => {\n          const next = new Set(prev)\n          next.delete(recipe.id)\n          return next\n        })\n        toast.success('Removed from favorites')\n      } else {\n        await api.favorites.add(recipe.id)\n        setFavoriteRecipeIds((prev) => new Set(prev).add(recipe.id))\n        toast.success('Added to favorites')\n      }\n    } catch (error) {\n      console.error('Failed to toggle favorite:', error)\n      toast.error('Failed to update favorites')\n    }\n  }\n\n  const handleStartCooking = (recipe: RecipeDetailType) => {\n    setPlayModeRecipe(recipe)\n    setCurrentScreen('play-mode')\n  }\n\n  const handleExitPlayMode = () => {\n    setPlayModeRecipe(null)\n    setCurrentScreen('recipe-detail')\n  }\n\n  const handleFavoritesClick = () => {\n    setCurrentScreen('favorites')\n  }\n\n  const handleFavoritesBack = () => {\n    setCurrentScreen('home')\n  }\n\n  const handleAllRecipesClick = () => {\n    setCurrentScreen('all-recipes')\n  }\n\n  const handleAllRecipesBack = () => {\n    setCurrentScreen('home')\n  }\n\n  const handleCollectionsClick = () => {\n    setPreviousScreen(currentScreen)\n    setCurrentScreen('collections')\n  }\n\n  const handleCollectionsBack = () => {\n    setPendingRecipeForCollection(null)\n    setCurrentScreen(previousScreen)\n  }\n\n  const handleCollectionClick = (collectionId: number) => {\n    setSelectedCollectionId(collectionId)\n    setPendingRecipeForCollection(null)\n    setCurrentScreen('collection-detail')\n  }\n\n  const handleCollectionDetailBack = () => {\n    setSelectedCollectionId(null)\n    setCurrentScreen('collections')\n  }\n\n  const handleCollectionDelete = () => {\n    setSelectedCollectionId(null)\n    setCurrentScreen('collections')\n  }\n\n  const handleSettingsClick = () => {\n    setCurrentScreen('settings')\n  }\n\n  const handleSettingsBack = () => {\n    setCurrentScreen('home')\n  }\n\n  const handleAddToNewCollection = (recipeId: number) => {\n    setPendingRecipeForCollection(recipeId)\n    setPreviousScreen('recipe-detail')\n    setCurrentScreen('collections')\n  }\n\n  const handleRecipeClickFromCollection = async (recipeId: number) => {\n    try {\n      await api.history.record(recipeId)\n    } catch (error) {\n      console.error('Failed to record history:', error)\n    }\n    setSelectedRecipeId(recipeId)\n    setCurrentScreen('recipe-detail')\n  }\n\n  const handleRecipeDetailBackFromCollection = () => {\n    setSelectedRecipeId(null)\n    if (selectedCollectionId) {\n      setCurrentScreen('collection-detail')\n    } else {\n      setCurrentScreen(searchQuery ? 'search' : 'home')\n    }\n  }\n\n  return (\n    <>\n      <Toaster position=\"top-center\" richColors />\n      {currentScreen === 'profile-selector' && (\n        <ProfileSelector onProfileSelect={handleProfileSelect} />\n      )}\n      {currentScreen === 'home' && currentProfile && (\n        <Home\n          profile={currentProfile}\n          theme={theme}\n          aiAvailable={aiStatus.available}\n          onThemeToggle={handleThemeToggle}\n          onLogout={handleLogout}\n          onSearch={handleSearch}\n          onRecipeClick={handleRecipeClick}\n          onFavoritesClick={handleFavoritesClick}\n          onAllRecipesClick={handleAllRecipesClick}\n          onCollectionsClick={handleCollectionsClick}\n          onSettingsClick={handleSettingsClick}\n        />\n      )}\n      {currentScreen === 'search' && (\n        <Search\n          query={searchQuery}\n          onBack={handleSearchBack}\n          onImport={handleImport}\n        />\n      )}\n      {currentScreen === 'recipe-detail' && selectedRecipeId && currentProfile && (\n        <RecipeDetail\n          recipeId={selectedRecipeId}\n          profileId={currentProfile.id}\n          isFavorite={favoriteRecipeIds.has(selectedRecipeId)}\n          onBack={selectedCollectionId ? handleRecipeDetailBackFromCollection : handleRecipeDetailBack}\n          onFavoriteToggle={handleFavoriteToggle}\n          onStartCooking={handleStartCooking}\n          onAddToNewCollection={handleAddToNewCollection}\n          onRemixCreated={handleRecipeClick}\n        />\n      )}\n      {currentScreen === 'play-mode' && playModeRecipe && (\n        <PlayMode recipe={playModeRecipe} onExit={handleExitPlayMode} />\n      )}\n      {currentScreen === 'favorites' && (\n        <Favorites\n          onBack={handleFavoritesBack}\n          onRecipeClick={handleRecipeClick}\n        />\n      )}\n      {currentScreen === 'all-recipes' && (\n        <AllRecipes\n          onBack={handleAllRecipesBack}\n          onRecipeClick={handleRecipeClick}\n        />\n      )}\n      {currentScreen === 'collections' && (\n        <Collections\n          onBack={handleCollectionsBack}\n          onCollectionClick={handleCollectionClick}\n          pendingRecipeId={pendingRecipeForCollection}\n        />\n      )}\n      {currentScreen === 'collection-detail' && selectedCollectionId && (\n        <CollectionDetail\n          collectionId={selectedCollectionId}\n          onBack={handleCollectionDetailBack}\n          onRecipeClick={handleRecipeClickFromCollection}\n          onDelete={handleCollectionDelete}\n        />\n      )}\n      {currentScreen === 'settings' && (\n        <Settings onBack={handleSettingsBack} currentProfileId={currentProfile?.id ?? null} />\n      )}\n    </>\n  )\n}\n\nfunction App() {\n  return (\n    <AIStatusProvider>\n      <AppContent />\n    </AIStatusProvider>\n  )\n}\n\nexport default App\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/api/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/AddToCollectionDropdown.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'AddToCollectionDropdown' has too many lines (134). Maximum allowed is 50.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":145,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react'\nimport { FolderPlus, Plus } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Collection } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface AddToCollectionDropdownProps {\n  recipeId: number\n  onCreateNew: () => void\n}\n\nexport default function AddToCollectionDropdown({\n  recipeId,\n  onCreateNew,\n}: AddToCollectionDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [collections, setCollections] = useState<Collection[]>([])\n  const [loading, setLoading] = useState(false)\n  const [addingTo, setAddingTo] = useState<number | null>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {\n        setIsOpen(false)\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n      return () => document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isOpen])\n\n  // Load collections when dropdown opens\n  useEffect(() => {\n    if (isOpen) {\n      loadCollections()\n    }\n  }, [isOpen])\n\n  const loadCollections = async () => {\n    setLoading(true)\n    try {\n      const data = await api.collections.list()\n      setCollections(data)\n    } catch (error) {\n      console.error('Failed to load collections:', error)\n      toast.error('Failed to load collections')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleAddToCollection = async (collectionId: number) => {\n    setAddingTo(collectionId)\n    try {\n      await api.collections.addRecipe(collectionId, recipeId)\n      const collection = collections.find((c) => c.id === collectionId)\n      toast.success(`Added to ${collection?.name || 'collection'}`)\n      setIsOpen(false)\n    } catch (error: unknown) {\n      if (error instanceof Error && error.message.includes('already')) {\n        toast.info('Recipe is already in this collection')\n      } else {\n        console.error('Failed to add to collection:', error)\n        toast.error('Failed to add to collection')\n      }\n    } finally {\n      setAddingTo(null)\n    }\n  }\n\n  const handleCreateNew = () => {\n    setIsOpen(false)\n    onCreateNew()\n  }\n\n  return (\n    <div ref={dropdownRef} className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:text-primary\"\n        title=\"Add to collection\"\n      >\n        <FolderPlus className=\"h-5 w-5\" />\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 top-full z-50 mt-2 w-56 rounded-lg border border-border bg-card shadow-lg\">\n          <div className=\"p-2\">\n            <h3 className=\"mb-2 px-2 text-xs font-medium uppercase tracking-wider text-muted-foreground\">\n              Add to Collection\n            </h3>\n\n            {loading ? (\n              <div className=\"px-2 py-4 text-center text-sm text-muted-foreground\">\n                Loading...\n              </div>\n            ) : (\n              <>\n                {collections.length > 0 ? (\n                  <div className=\"max-h-48 overflow-y-auto\">\n                    {collections.map((collection) => (\n                      <button\n                        key={collection.id}\n                        onClick={() => handleAddToCollection(collection.id)}\n                        disabled={addingTo === collection.id}\n                        className={cn(\n                          'flex w-full items-center gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors',\n                          'text-foreground hover:bg-muted disabled:opacity-50'\n                        )}\n                      >\n                        <FolderPlus className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"flex-1 truncate\">{collection.name}</span>\n                        {addingTo === collection.id && (\n                          <span className=\"text-xs text-muted-foreground\">Adding...</span>\n                        )}\n                      </button>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"px-2 py-2 text-sm text-muted-foreground\">\n                    No collections yet\n                  </div>\n                )}\n\n                <div className=\"mt-1 border-t border-border pt-1\">\n                  <button\n                    onClick={handleCreateNew}\n                    className=\"flex w-full items-center gap-2 rounded-md px-2 py-2 text-left text-sm text-primary transition-colors hover:bg-muted\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Create New Collection\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/RecipeCard.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeCard' has too many lines (101). Maximum allowed is 50.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":112,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'RecipeCard' has a complexity of 12. Maximum allowed is 10.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":12,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Star, Clock, Heart } from 'lucide-react'\nimport type { Recipe } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface RecipeCardProps {\n  recipe: Recipe\n  isFavorite?: boolean\n  onFavoriteToggle?: (recipe: Recipe) => void\n  onClick?: (recipe: Recipe) => void\n}\n\nexport default function RecipeCard({\n  recipe,\n  isFavorite = false,\n  onFavoriteToggle,\n  onClick,\n}: RecipeCardProps) {\n  const imageUrl = recipe.image || recipe.image_url\n\n  const formatTime = (minutes: number | null) => {\n    if (!minutes) return null\n    if (minutes < 60) return `${minutes} min`\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`\n  }\n\n  const handleFavoriteClick = (e: React.MouseEvent) => {\n    e.stopPropagation()\n    onFavoriteToggle?.(recipe)\n  }\n\n  return (\n    <div\n      className={cn(\n        'group relative overflow-hidden rounded-lg bg-card shadow-sm transition-all hover:shadow-md',\n        onClick && 'cursor-pointer'\n      )}\n      onClick={() => onClick?.(recipe)}\n    >\n      {/* Image */}\n      <div className=\"relative aspect-[4/3] overflow-hidden bg-muted\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={recipe.title}\n            className=\"h-full w-full object-cover transition-transform group-hover:scale-105\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center text-muted-foreground\">\n            No image\n          </div>\n        )}\n\n        {/* Favorite button */}\n        {onFavoriteToggle && (\n          <button\n            onClick={handleFavoriteClick}\n            className={cn(\n              'absolute right-2 top-2 rounded-full bg-background/80 p-2 backdrop-blur-sm transition-colors',\n              isFavorite\n                ? 'text-accent hover:bg-background'\n                : 'text-muted-foreground hover:bg-background hover:text-accent'\n            )}\n            aria-label={isFavorite ? 'Remove from favorites' : 'Add to favorites'}\n          >\n            <Heart\n              className={cn('h-5 w-5', isFavorite && 'fill-current')}\n            />\n          </button>\n        )}\n\n        {/* Remix badge */}\n        {recipe.is_remix && (\n          <div className=\"absolute left-2 top-2 rounded-full bg-primary/90 px-2 py-0.5 text-xs text-primary-foreground backdrop-blur-sm\">\n            Remix\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"p-3\">\n        {/* Title */}\n        <h3 className=\"mb-1 line-clamp-2 text-sm font-medium text-card-foreground\">\n          {recipe.title}\n        </h3>\n\n        {/* Meta */}\n        <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n          {/* Source */}\n          <span className=\"truncate\">{recipe.host}</span>\n\n          {/* Time */}\n          {recipe.total_time && (\n            <span className=\"flex shrink-0 items-center gap-1\">\n              <Clock className=\"h-3 w-3\" />\n              {formatTime(recipe.total_time)}\n            </span>\n          )}\n\n          {/* Rating */}\n          {recipe.rating && (\n            <span className=\"flex shrink-0 items-center gap-1\">\n              <Star className=\"h-3 w-3 fill-star text-star\" />\n              {recipe.rating.toFixed(1)}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/RemixModal.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RemixModal' has too many lines (187). Maximum allowed is 50.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":201,"endColumn":2},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSuggestions'. Either include it or remove the dependency array.","line":38,"column":6,"nodeType":"ArrayExpression","endLine":38,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, loadSuggestions, recipe.id]","fix":{"range":[1066,1085],"text":"[isOpen, loadSuggestions, recipe.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { X, Sparkles, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type RecipeDetail } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface RemixModalProps {\n  recipe: RecipeDetail\n  profileId: number\n  isOpen: boolean\n  onClose: () => void\n  onRemixCreated: (recipeId: number) => void\n}\n\nexport default function RemixModal({\n  recipe,\n  profileId,\n  isOpen,\n  onClose,\n  onRemixCreated,\n}: RemixModalProps) {\n  const [suggestions, setSuggestions] = useState<string[]>([])\n  const [loadingSuggestions, setLoadingSuggestions] = useState(false)\n  const [selectedSuggestion, setSelectedSuggestion] = useState<string | null>(null)\n  const [customInput, setCustomInput] = useState('')\n  const [creating, setCreating] = useState(false)\n\n  // Load suggestions when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      loadSuggestions()\n    } else {\n      // Reset state when modal closes\n      setSuggestions([])\n      setSelectedSuggestion(null)\n      setCustomInput('')\n    }\n  }, [isOpen, recipe.id])\n\n  const loadSuggestions = async () => {\n    setLoadingSuggestions(true)\n    try {\n      const response = await api.ai.remix.getSuggestions(recipe.id)\n      setSuggestions(response.suggestions)\n    } catch (error) {\n      console.error('Failed to load remix suggestions:', error)\n      toast.error('Failed to load suggestions')\n    } finally {\n      setLoadingSuggestions(false)\n    }\n  }\n\n  const handleSuggestionClick = (suggestion: string) => {\n    if (selectedSuggestion === suggestion) {\n      setSelectedSuggestion(null)\n    } else {\n      setSelectedSuggestion(suggestion)\n      setCustomInput('')\n    }\n  }\n\n  const handleCustomInputChange = (value: string) => {\n    setCustomInput(value)\n    if (value.trim()) {\n      setSelectedSuggestion(null)\n    }\n  }\n\n  const getModification = () => {\n    if (customInput.trim()) {\n      return customInput.trim()\n    }\n    return selectedSuggestion\n  }\n\n  const canSubmit = () => {\n    return !creating && (selectedSuggestion !== null || customInput.trim() !== '')\n  }\n\n  const handleCreateRemix = async () => {\n    const modification = getModification()\n    if (!modification) return\n\n    setCreating(true)\n    try {\n      const remix = await api.ai.remix.create(recipe.id, modification, profileId)\n      toast.success(`Created \"${remix.title}\"`)\n      onRemixCreated(remix.id)\n      onClose()\n    } catch (error) {\n      console.error('Failed to create remix:', error)\n      toast.error('Failed to create remix')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4\">\n      <div className=\"relative w-full max-w-md rounded-xl bg-card shadow-2xl\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-border px-6 py-4\">\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            <h2 className=\"text-lg font-semibold text-foreground\">Remix This Recipe</h2>\n          </div>\n          <button\n            onClick={onClose}\n            disabled={creating}\n            className=\"rounded-full p-1 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"px-6 py-5\">\n          <p className=\"mb-4 text-sm text-muted-foreground\">\n            Choose a modification or describe your own remix of \"{recipe.title}\"\n          </p>\n\n          {/* AI Suggestions */}\n          <div className=\"mb-5\">\n            <h3 className=\"mb-3 text-sm font-medium text-foreground\">Suggestions</h3>\n            {loadingSuggestions ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                <span className=\"ml-2 text-sm text-muted-foreground\">\n                  Generating suggestions...\n                </span>\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                {suggestions.map((suggestion, index) => (\n                  <button\n                    key={index}\n                    onClick={() => handleSuggestionClick(suggestion)}\n                    disabled={creating}\n                    className={cn(\n                      'rounded-full px-3 py-1.5 text-sm transition-colors',\n                      selectedSuggestion === suggestion\n                        ? 'bg-primary text-primary-foreground'\n                        : 'bg-muted text-foreground hover:bg-muted/80'\n                    )}\n                  >\n                    {suggestion}\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Custom Input */}\n          <div className=\"mb-5\">\n            <label\n              htmlFor=\"custom-remix\"\n              className=\"mb-2 block text-sm font-medium text-foreground\"\n            >\n              Or describe your own remix\n            </label>\n            <input\n              id=\"custom-remix\"\n              type=\"text\"\n              value={customInput}\n              onChange={(e) => handleCustomInputChange(e.target.value)}\n              disabled={creating}\n              placeholder=\"e.g., Make it gluten-free\"\n              className=\"w-full rounded-lg border border-border bg-background px-4 py-2.5 text-foreground placeholder:text-muted-foreground focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary disabled:opacity-50\"\n            />\n          </div>\n\n          {/* Create Button */}\n          <button\n            onClick={handleCreateRemix}\n            disabled={!canSubmit()}\n            className={cn(\n              'flex w-full items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              canSubmit()\n                ? 'bg-primary text-primary-foreground hover:bg-primary/90'\n                : 'bg-muted text-muted-foreground cursor-not-allowed'\n            )}\n          >\n            {creating ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Creating Remix...\n              </>\n            ) : (\n              <>\n                <Sparkles className=\"h-4 w-4\" />\n                Create Remix\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/Skeletons.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeDetailSkeleton' has too many lines (58). Maximum allowed is 50.","line":84,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":141,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Skeleton loading components for React frontend\n * Used to show placeholder content while data is loading\n */\n\nimport { cn } from '../lib/utils'\n\n/**\n * Base skeleton element with pulse animation\n */\nfunction Skeleton({ className }: { className?: string }) {\n  return (\n    <div className={cn('animate-pulse rounded bg-muted', className)} />\n  )\n}\n\n/**\n * Skeleton for recipe cards in grids (AllRecipes, Search, Favorites)\n */\nexport function RecipeCardSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card shadow-sm\">\n      {/* Image placeholder */}\n      <Skeleton className=\"aspect-[4/3] rounded-none\" />\n      {/* Content */}\n      <div className=\"p-3 space-y-2\">\n        {/* Title */}\n        <Skeleton className=\"h-4 w-3/4\" />\n        {/* Meta row */}\n        <div className=\"flex items-center gap-3\">\n          <Skeleton className=\"h-3 w-16\" />\n          <Skeleton className=\"h-3 w-12\" />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Grid of recipe card skeletons\n */\nexport function RecipeGridSkeleton({ count = 8 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <RecipeCardSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n\n/**\n * Skeleton for collection cards\n */\nexport function CollectionCardSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card p-4 shadow-sm\">\n      {/* Icon placeholder */}\n      <Skeleton className=\"mb-8 h-12 w-12 rounded-lg\" />\n      {/* Name */}\n      <Skeleton className=\"mb-2 h-5 w-3/4\" />\n      {/* Count */}\n      <Skeleton className=\"h-4 w-16\" />\n    </div>\n  )\n}\n\n/**\n * Grid of collection card skeletons\n */\nexport function CollectionGridSkeleton({ count = 8 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <CollectionCardSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n\n/**\n * Full recipe detail page skeleton\n */\nexport function RecipeDetailSkeleton() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero image skeleton */}\n      <div className=\"relative h-64 sm:h-80\">\n        <Skeleton className=\"h-full w-full rounded-none\" />\n        {/* Back button placeholder */}\n        <div className=\"absolute left-4 top-4\">\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n        </div>\n        {/* Title overlay placeholder */}\n        <div className=\"absolute bottom-4 left-4 right-4\">\n          <Skeleton className=\"mb-2 h-7 w-3/4\" />\n          <div className=\"flex gap-3\">\n            <Skeleton className=\"h-4 w-16\" />\n            <Skeleton className=\"h-4 w-24\" />\n          </div>\n        </div>\n        {/* Action buttons placeholder */}\n        <div className=\"absolute bottom-4 right-4 flex gap-2\">\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\n          <Skeleton className=\"h-10 w-20 rounded-full\" />\n        </div>\n      </div>\n\n      {/* Meta info skeleton */}\n      <div className=\"border-b border-border px-4 py-4\">\n        <div className=\"flex flex-wrap gap-4\">\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-5 w-32\" />\n        </div>\n      </div>\n\n      {/* Tabs skeleton */}\n      <div className=\"border-b border-border px-4\">\n        <div className=\"flex gap-4 py-3\">\n          <Skeleton className=\"h-5 w-20\" />\n          <Skeleton className=\"h-5 w-20\" />\n          <Skeleton className=\"h-5 w-16\" />\n          <Skeleton className=\"h-5 w-12\" />\n        </div>\n      </div>\n\n      {/* Content skeleton */}\n      <div className=\"px-4 py-6 space-y-4\">\n        {Array.from({ length: 6 }).map((_, i) => (\n          <div key={i} className=\"flex items-start gap-3\">\n            <Skeleton className=\"h-7 w-7 rounded-full shrink-0\" />\n            <Skeleton className=\"h-5 flex-1\" />\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n/**\n * Simple centered loading spinner\n */\nexport function LoadingSpinner({ className }: { className?: string }) {\n  return (\n    <div className={cn('flex items-center justify-center py-12', className)}>\n      <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n    </div>\n  )\n}\n\n/**\n * Loading state for list pages with optional message\n */\nexport function LoadingState({ message = 'Loading...' }: { message?: string }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-12\">\n      <div className=\"mb-3 h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n      <span className=\"text-sm text-muted-foreground\">{message}</span>\n    </div>\n  )\n}\n\n/**\n * Search result card skeleton\n */\nexport function SearchResultSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg bg-card shadow-sm\">\n      {/* Image placeholder */}\n      <Skeleton className=\"aspect-[4/3] rounded-none\" />\n      {/* Content */}\n      <div className=\"p-3 space-y-2\">\n        {/* Title */}\n        <Skeleton className=\"h-4 w-3/4\" />\n        {/* Meta */}\n        <Skeleton className=\"h-3 w-1/2\" />\n        {/* Description */}\n        <Skeleton className=\"h-3 w-full\" />\n        <Skeleton className=\"h-3 w-2/3\" />\n        {/* Button */}\n        <Skeleton className=\"h-8 w-full mt-2\" />\n      </div>\n    </div>\n  )\n}\n\n/**\n * Grid of search result skeletons\n */\nexport function SearchGridSkeleton({ count = 6 }: { count?: number }) {\n  return (\n    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3\">\n      {Array.from({ length: count }).map((_, i) => (\n        <SearchResultSkeleton key={i} />\n      ))}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/TimerPanel.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TimerPanel' has too many lines (148). Maximum allowed is 50.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":167,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'TimerPanel' has a complexity of 11. Maximum allowed is 10.","line":20,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":20,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Timer as TimerIcon, Plus, ChevronUp, ChevronDown, Sparkles, Loader2 } from 'lucide-react'\nimport { useState } from 'react'\nimport type { UseTimersReturn } from '../hooks/useTimers'\nimport { detectTimes } from '../hooks/useTimers'\nimport TimerWidget from './TimerWidget'\nimport { api } from '../api/client'\n\ninterface TimerPanelProps {\n  timers: UseTimersReturn\n  instructionText?: string\n  aiAvailable?: boolean\n}\n\nconst QUICK_TIMERS = [\n  { label: '+5 min', duration: 5 * 60 },\n  { label: '+10 min', duration: 10 * 60 },\n  { label: '+15 min', duration: 15 * 60 },\n]\n\nexport default function TimerPanel({ timers, instructionText, aiAvailable = false }: TimerPanelProps) {\n  const [expanded, setExpanded] = useState(true)\n  const [loadingTimerId, setLoadingTimerId] = useState<string | null>(null)\n\n  // Detect times from current instruction\n  const detectedTimes = instructionText ? detectTimes(instructionText) : []\n\n  const formatDetectedTime = (seconds: number): string => {\n    if (seconds >= 3600) {\n      const hrs = Math.floor(seconds / 3600)\n      const mins = Math.floor((seconds % 3600) / 60)\n      return mins > 0 ? `${hrs}h ${mins}m` : `${hrs}h`\n    }\n    const mins = Math.floor(seconds / 60)\n    const secs = seconds % 60\n    if (mins === 0) return `${secs}s`\n    if (secs === 0) return `${mins} min`\n    return `${mins}m ${secs}s`\n  }\n\n  const handleAddTimer = async (id: string, fallbackLabel: string, duration: number) => {\n    const durationMinutes = Math.ceil(duration / 60)\n\n    // If AI is available and we have instruction text, try to get an AI-generated name\n    if (aiAvailable && instructionText) {\n      setLoadingTimerId(id)\n      try {\n        const response = await api.ai.timerName(instructionText, durationMinutes)\n        timers.addTimer(response.label, duration)\n      } catch {\n        // AI failed, use fallback\n        timers.addTimer(fallbackLabel, duration)\n      } finally {\n        setLoadingTimerId(null)\n      }\n    } else {\n      // No AI available, use fallback label\n      timers.addTimer(fallbackLabel, duration)\n    }\n  }\n\n  const handleAddQuickTimer = (label: string, duration: number, index: number) => {\n    handleAddTimer(`quick-${index}`, label, duration)\n  }\n\n  const handleAddDetectedTimer = (seconds: number, index: number) => {\n    handleAddTimer(`detected-${index}`, formatDetectedTime(seconds), seconds)\n  }\n\n  const activeTimerCount = timers.timers.filter((t) => t.isRunning).length\n\n  return (\n    <div className=\"border-t border-border bg-card\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center justify-between px-4 py-3\"\n      >\n        <div className=\"flex items-center gap-2\">\n          <TimerIcon className=\"h-5 w-5 text-primary\" />\n          <span className=\"font-medium text-foreground\">Timers</span>\n          {timers.timers.length > 0 && (\n            <span className=\"rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground\">\n              {timers.timers.length}\n              {activeTimerCount > 0 && (\n                <span className=\"text-primary\"> ({activeTimerCount} active)</span>\n              )}\n            </span>\n          )}\n        </div>\n        {expanded ? (\n          <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n        ) : (\n          <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\n        )}\n      </button>\n\n      {expanded && (\n        <div className=\"space-y-4 px-4 pb-4\">\n          {/* Quick timer buttons */}\n          <div className=\"flex flex-wrap gap-2\">\n            {QUICK_TIMERS.map(({ label, duration }, idx) => (\n              <button\n                key={label}\n                onClick={() => handleAddQuickTimer(label.replace('+', '').trim(), duration, idx)}\n                disabled={loadingTimerId !== null}\n                className=\"flex items-center gap-1 rounded-full border border-border bg-background px-3 py-1.5 text-sm text-foreground transition-colors hover:bg-muted disabled:opacity-50\"\n              >\n                {loadingTimerId === `quick-${idx}` ? (\n                  <Loader2 className=\"h-3 w-3 animate-spin\" />\n                ) : (\n                  <Plus className=\"h-3 w-3\" />\n                )}\n                {label}\n              </button>\n            ))}\n            {aiAvailable && instructionText && <Sparkles className=\"h-4 w-4 text-primary self-center\" />}\n          </div>\n\n          {/* Detected time suggestions */}\n          {detectedTimes.length > 0 && (\n            <div>\n              <p className=\"mb-2 text-xs text-muted-foreground\">\n                Detected in this step:\n              </p>\n              <div className=\"flex flex-wrap gap-2\">\n                {detectedTimes.map((seconds, idx) => (\n                  <button\n                    key={idx}\n                    onClick={() => handleAddDetectedTimer(seconds, idx)}\n                    disabled={loadingTimerId !== null}\n                    className=\"flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1.5 text-sm text-primary transition-colors hover:bg-primary/20 disabled:opacity-50\"\n                  >\n                    {loadingTimerId === `detected-${idx}` ? (\n                      <Loader2 className=\"h-3 w-3 animate-spin\" />\n                    ) : (\n                      <Plus className=\"h-3 w-3\" />\n                    )}\n                    {formatDetectedTime(seconds)}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Timer list */}\n          {timers.timers.length > 0 ? (\n            <div className=\"space-y-2\">\n              {timers.timers.map((timer) => (\n                <TimerWidget\n                  key={timer.id}\n                  timer={timer}\n                  onToggle={() => timers.toggleTimer(timer.id)}\n                  onReset={() => timers.resetTimer(timer.id)}\n                  onDelete={() => timers.deleteTimer(timer.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-center text-sm text-muted-foreground\">\n              No active timers. Add one above!\n            </p>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/components/TimerWidget.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TimerWidget' has too many lines (81). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":93,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Play, Pause, RotateCcw, X } from 'lucide-react'\nimport type { Timer } from '../hooks/useTimers'\nimport { formatTimerDisplay } from '../hooks/useTimers'\nimport { cn } from '../lib/utils'\n\ninterface TimerWidgetProps {\n  timer: Timer\n  onToggle: () => void\n  onReset: () => void\n  onDelete: () => void\n}\n\nexport default function TimerWidget({\n  timer,\n  onToggle,\n  onReset,\n  onDelete,\n}: TimerWidgetProps) {\n  const isComplete = timer.remaining === 0\n  const progress = ((timer.duration - timer.remaining) / timer.duration) * 100\n\n  return (\n    <div\n      className={cn(\n        'relative overflow-hidden rounded-lg border bg-card p-3',\n        isComplete && 'border-accent bg-accent/10'\n      )}\n    >\n      {/* Progress bar background */}\n      <div\n        className={cn(\n          'absolute inset-0 opacity-20 transition-all',\n          isComplete ? 'bg-accent' : 'bg-primary'\n        )}\n        style={{ width: `${progress}%` }}\n      />\n\n      {/* Content */}\n      <div className=\"relative flex items-center justify-between\">\n        <div className=\"min-w-0 flex-1\">\n          <p className=\"truncate text-sm font-medium text-card-foreground\">\n            {timer.label}\n          </p>\n          <p\n            className={cn(\n              'text-2xl font-mono font-bold tabular-nums',\n              isComplete ? 'text-accent' : 'text-foreground'\n            )}\n          >\n            {formatTimerDisplay(timer.remaining)}\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          {!isComplete && (\n            <>\n              <button\n                onClick={onToggle}\n                className={cn(\n                  'rounded-full p-2 transition-colors',\n                  timer.isRunning\n                    ? 'bg-muted text-muted-foreground hover:bg-muted/80'\n                    : 'bg-primary text-primary-foreground hover:bg-primary/90'\n                )}\n                aria-label={timer.isRunning ? 'Pause' : 'Play'}\n              >\n                {timer.isRunning ? (\n                  <Pause className=\"h-4 w-4\" />\n                ) : (\n                  <Play className=\"h-4 w-4\" />\n                )}\n              </button>\n              <button\n                onClick={onReset}\n                className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-muted/80\"\n                aria-label=\"Reset\"\n              >\n                <RotateCcw className=\"h-4 w-4\" />\n              </button>\n            </>\n          )}\n          <button\n            onClick={onDelete}\n            className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-destructive hover:text-destructive-foreground\"\n            aria-label=\"Delete\"\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/contexts/AIStatusContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":26,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":26,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react'\nimport { api, AIStatus } from '../api/client'\n\ninterface AIStatusContextType {\n  available: boolean\n  configured: boolean\n  valid: boolean\n  error: string | null\n  errorCode: string | null\n  loading: boolean\n  refresh: () => Promise<void>\n}\n\nconst defaultStatus: AIStatusContextType = {\n  available: false,\n  configured: false,\n  valid: false,\n  error: null,\n  errorCode: null,\n  loading: true,\n  refresh: async () => {},\n}\n\nconst AIStatusContext = createContext<AIStatusContextType>(defaultStatus)\n\nexport function useAIStatus() {\n  return useContext(AIStatusContext)\n}\n\ninterface AIStatusProviderProps {\n  children: ReactNode\n}\n\nexport function AIStatusProvider({ children }: AIStatusProviderProps) {\n  const [status, setStatus] = useState<Omit<AIStatusContextType, 'refresh' | 'loading'>>({\n    available: false,\n    configured: false,\n    valid: false,\n    error: null,\n    errorCode: null,\n  })\n  const [loading, setLoading] = useState(true)\n\n  const refresh = useCallback(async () => {\n    try {\n      const data: AIStatus = await api.ai.status()\n      setStatus({\n        available: data.available,\n        configured: data.configured,\n        valid: data.valid,\n        error: data.error,\n        errorCode: data.error_code,\n      })\n    } catch (error) {\n      console.error('Failed to fetch AI status:', error)\n      setStatus({\n        available: false,\n        configured: false,\n        valid: false,\n        error: 'Failed to check AI availability',\n        errorCode: 'connection_error',\n      })\n    } finally {\n      setLoading(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    refresh()\n    // Refresh every 5 minutes\n    const interval = setInterval(refresh, 5 * 60 * 1000)\n    return () => clearInterval(interval)\n  }, [refresh])\n\n  return (\n    <AIStatusContext.Provider value={{ ...status, loading, refresh }}>\n      {children}\n    </AIStatusContext.Provider>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/hooks/useTimers.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'useTimers' has too many lines (167). Maximum allowed is 50.","line":21,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":187,"endColumn":2},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'intervalsRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'intervalsRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":34,"column":20,"nodeType":"Identifier","endLine":34,"endColumn":27},{"ruleId":"max-nested-callbacks","severity":1,"message":"Too many nested callbacks (4). Maximum allowed is 3.","line":47,"column":20,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":62,"endColumn":12},{"ruleId":"max-nested-callbacks","severity":1,"message":"Too many nested callbacks (4). Maximum allowed is 3.","line":93,"column":18,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":108,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react'\n\nexport interface Timer {\n  id: string\n  label: string\n  duration: number // seconds\n  remaining: number // seconds\n  isRunning: boolean\n}\n\nexport interface UseTimersReturn {\n  timers: Timer[]\n  addTimer: (label: string, duration: number, autoStart?: boolean) => string\n  startTimer: (id: string) => void\n  pauseTimer: (id: string) => void\n  resetTimer: (id: string) => void\n  deleteTimer: (id: string) => void\n  toggleTimer: (id: string) => void\n}\n\nexport function useTimers(onTimerComplete?: (timer: Timer) => void): UseTimersReturn {\n  const [timers, setTimers] = useState<Timer[]>([])\n  const intervalsRef = useRef<Map<string, number>>(new Map())\n  const onCompleteRef = useRef(onTimerComplete)\n\n  // Keep callback ref up to date\n  useEffect(() => {\n    onCompleteRef.current = onTimerComplete\n  }, [onTimerComplete])\n\n  // Cleanup intervals on unmount\n  useEffect(() => {\n    return () => {\n      intervalsRef.current.forEach((intervalId) => {\n        clearInterval(intervalId)\n      })\n    }\n  }, [])\n\n  const addTimer = useCallback((label: string, duration: number, autoStart: boolean = true): string => {\n    const id = crypto.randomUUID()\n\n    // If autoStart, set up the interval immediately (before setTimers completes)\n    if (autoStart) {\n      const intervalId = window.setInterval(() => {\n        setTimers((prev) =>\n          prev.map((timer) => {\n            if (timer.id !== id) return timer\n            if (!timer.isRunning) return timer\n\n            const newRemaining = timer.remaining - 1\n\n            if (newRemaining <= 0) {\n              // Timer completed\n              clearInterval(intervalsRef.current.get(id))\n              intervalsRef.current.delete(id)\n              onCompleteRef.current?.({ ...timer, remaining: 0, isRunning: false })\n              return { ...timer, remaining: 0, isRunning: false }\n            }\n\n            return { ...timer, remaining: newRemaining }\n          })\n        )\n      }, 1000)\n\n      intervalsRef.current.set(id, intervalId)\n    }\n\n    setTimers((prev) => [\n      ...prev,\n      {\n        id,\n        label,\n        duration,\n        remaining: duration,\n        isRunning: autoStart,\n      },\n    ])\n\n    return id\n  }, [])\n\n  const startTimer = useCallback((id: string) => {\n    // Clear any existing interval for this timer\n    const existingInterval = intervalsRef.current.get(id)\n    if (existingInterval) {\n      clearInterval(existingInterval)\n    }\n\n    // Start new interval\n    const intervalId = window.setInterval(() => {\n      setTimers((prev) =>\n        prev.map((timer) => {\n          if (timer.id !== id) return timer\n          if (!timer.isRunning) return timer\n\n          const newRemaining = timer.remaining - 1\n\n          if (newRemaining <= 0) {\n            // Timer completed\n            clearInterval(intervalsRef.current.get(id))\n            intervalsRef.current.delete(id)\n            onCompleteRef.current?.({ ...timer, remaining: 0, isRunning: false })\n            return { ...timer, remaining: 0, isRunning: false }\n          }\n\n          return { ...timer, remaining: newRemaining }\n        })\n      )\n    }, 1000)\n\n    intervalsRef.current.set(id, intervalId)\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id ? { ...timer, isRunning: true } : timer\n      )\n    )\n  }, [])\n\n  const pauseTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id ? { ...timer, isRunning: false } : timer\n      )\n    )\n  }, [])\n\n  const resetTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) =>\n      prev.map((timer) =>\n        timer.id === id\n          ? { ...timer, remaining: timer.duration, isRunning: false }\n          : timer\n      )\n    )\n  }, [])\n\n  const deleteTimer = useCallback((id: string) => {\n    // Clear interval\n    const intervalId = intervalsRef.current.get(id)\n    if (intervalId) {\n      clearInterval(intervalId)\n      intervalsRef.current.delete(id)\n    }\n\n    setTimers((prev) => prev.filter((timer) => timer.id !== id))\n  }, [])\n\n  const toggleTimer = useCallback(\n    (id: string) => {\n      const timer = timers.find((t) => t.id === id)\n      if (!timer) return\n\n      if (timer.isRunning) {\n        pauseTimer(id)\n      } else {\n        startTimer(id)\n      }\n    },\n    [timers, pauseTimer, startTimer]\n  )\n\n  return {\n    timers,\n    addTimer,\n    startTimer,\n    pauseTimer,\n    resetTimer,\n    deleteTimer,\n    toggleTimer,\n  }\n}\n\n/**\n * Detects time mentions in text and returns durations in seconds.\n *\n * Supports patterns like:\n * - \"15 minutes\", \"15 min\", \"15m\"\n * - \"2 hours\", \"2 hr\", \"2h\"\n * - \"30 seconds\", \"30 sec\", \"30s\"\n */\nexport function detectTimes(text: string): number[] {\n  const times: number[] = []\n  const seen = new Set<string>()\n\n  // Patterns for different time units\n  const patterns = [\n    { regex: /(\\d+)\\s*(?:hours?|hrs?|h)\\b/gi, multiplier: 3600 },\n    { regex: /(\\d+)\\s*(?:minutes?|mins?|m)\\b/gi, multiplier: 60 },\n    { regex: /(\\d+)\\s*(?:seconds?|secs?|s)\\b/gi, multiplier: 1 },\n  ]\n\n  for (const { regex, multiplier } of patterns) {\n    let match\n    while ((match = regex.exec(text)) !== null) {\n      const value = parseInt(match[1], 10)\n      const seconds = value * multiplier\n      const key = `${match.index}-${value}-${multiplier}`\n      if (!seen.has(key) && seconds > 0) {\n        seen.add(key)\n        times.push(seconds)\n      }\n    }\n  }\n\n  // Sort by appearance in text (earlier matches first)\n  return times\n}\n\n/**\n * Formats seconds as a human-readable time string.\n * e.g., 90 -> \"1:30\", 3661 -> \"1:01:01\"\n */\nexport function formatTimerDisplay(seconds: number): string {\n  const hrs = Math.floor(seconds / 3600)\n  const mins = Math.floor((seconds % 3600) / 60)\n  const secs = seconds % 60\n\n  if (hrs > 0) {\n    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n  return `${mins}:${secs.toString().padStart(2, '0')}`\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/hooks/useWakeLock.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'useWakeLock' has too many lines (160). Maximum allowed is 50.","line":11,"column":8,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":170,"endColumn":2},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'SILENT_VIDEO_BASE64'. Either include it or remove the dependency array.","line":118,"column":6,"nodeType":"ArrayExpression","endLine":118,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [SILENT_VIDEO_BASE64]","fix":{"range":[5192,5194],"text":"[SILENT_VIDEO_BASE64]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useCallback } from 'react'\n\n/**\n * useWakeLock - Prevents the screen from locking while active\n *\n * Uses the Screen Wake Lock API (iOS 16.4+, Chrome 84+) with a silent video\n * fallback for older browsers.\n *\n * @param enabled - Whether wake lock should be active (default: true)\n */\nexport function useWakeLock(enabled: boolean = true): void {\n  const wakeLockRef = useRef<WakeLockSentinel | null>(null)\n  const videoRef = useRef<HTMLVideoElement | null>(null)\n  const usingFallbackRef = useRef(false)\n\n  // Silent MP4 video (base64) - ~1KB, used as fallback for older browsers\n  // This is a minimal valid MP4 that plays silently\n  const SILENT_VIDEO_BASE64 =\n    'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAA' +\n    'NBtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5' +\n    'YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6' +\n    'Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVi' +\n    'bG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9' +\n    'MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MDgg' +\n    'OHg4ZGN0PTEgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZz' +\n    'ZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0w' +\n    'IGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRy' +\n    'YT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0' +\n    'PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0y' +\n    'My4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFx' +\n    'PTE6MS4wMACAAAAAwWWIhAAz//727L4FNf2f0JcRLMXaSnA+KqSAgHc0wAAAAwAAAwAAFgn0AAAA' +\n    'AAIBAAADAAMAAAMAAAMAAFAAAAB4AAABpjgBAAZAAAABgQAAAEQQACAAAAAABIgYF//+l3EXpve' +\n    'bZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00' +\n    'IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3Jn' +\n    'L3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMAAAAUZnR5cGlzb20AAAIAaXNvbWlz' +\n    'bzIAAAAIZnJlZQAAANhtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyAAAAFGZ0eXBpc29t' +\n    'AAACAGlzb21pc28yAAAACGZyZWUAAADYbWRhdAAAAq4GBf//qtxF6b3m2Ui3lizYINkj7u94MgAA' +\n    'AAhtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAAZAABAAABAAAAAAAAAAAAAAAAAQAAAAAAAA' +\n    'AAAAAAAAAAAQAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAB' +\n    'pHRyYWsAAABcdGtoZAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAZAAAAAAAAAAAAAAAAAAAAAABAAAAAA' +\n    'AAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAJHbWRpYQAAACBtZGhkAAAA' +\n    'AAAAAAAAAAAAAAA8AAAABQBVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRl' +\n    'b0hhbmRsZXIAAAAA3G1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAA' +\n    'AAAAAQAAAAx1cmwgAAAAAQAAAJxzdGJsAAAAmHN0c2QAAAAAAAAAAQAAAIhhdmMxAAAAAAAAAAEA' +\n    'AAAAAAAAAAAAAAAAAAAAACgAIABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +\n    'AAAAAAAAAAAAGP//AAAAMWF2Y0MBZAAK/+EAGGdkAAqs2UHgloQAAAMABAAAAwAoPGDGWAEABmjr' +\n    '48siwAAAABhzdHRzAAAAAAAAAAEAAAABAAAFAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEA' +\n    'AAAUc3RzegAAAAAAAAL0AAAAAQAAABRzdGNvAAAAAAAAAAEAAAAwAAAAYnVkdGEAAABabWV0YQAA' +\n    'AAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRh' +\n    'dGEAAAABAAAAAExhdmY1Ni40MC4xMDE='\n\n  // Check if Screen Wake Lock API is supported\n  const isWakeLockSupported = useCallback(() => {\n    return 'wakeLock' in navigator\n  }, [])\n\n  // Request wake lock using native API\n  const requestWakeLock = useCallback(async () => {\n    if (!isWakeLockSupported()) {\n      return false\n    }\n\n    try {\n      wakeLockRef.current = await navigator.wakeLock.request('screen')\n\n      // Re-acquire wake lock if released (e.g., tab becomes visible again)\n      wakeLockRef.current.addEventListener('release', () => {\n        wakeLockRef.current = null\n      })\n\n      return true\n    } catch {\n      // Wake lock request failed (e.g., low battery, permissions)\n      return false\n    }\n  }, [isWakeLockSupported])\n\n  // Release wake lock\n  const releaseWakeLock = useCallback(async () => {\n    if (wakeLockRef.current) {\n      try {\n        await wakeLockRef.current.release()\n      } catch {\n        // Ignore release errors\n      }\n      wakeLockRef.current = null\n    }\n  }, [])\n\n  // Start video fallback for older browsers\n  const startVideoFallback = useCallback(() => {\n    if (videoRef.current) {\n      return // Already created\n    }\n\n    const video = document.createElement('video')\n    video.setAttribute('playsinline', '')\n    video.setAttribute('muted', '')\n    video.setAttribute('loop', '')\n    video.muted = true\n    video.src = SILENT_VIDEO_BASE64\n    video.style.position = 'fixed'\n    video.style.top = '-9999px'\n    video.style.left = '-9999px'\n    video.style.width = '1px'\n    video.style.height = '1px'\n    video.style.opacity = '0.01'\n\n    document.body.appendChild(video)\n    videoRef.current = video\n\n    // Try to play (may require user interaction on iOS)\n    video.play().catch(() => {\n      // Silent fail - will try again on user interaction\n    })\n\n    usingFallbackRef.current = true\n  }, [])\n\n  // Stop video fallback\n  const stopVideoFallback = useCallback(() => {\n    if (videoRef.current) {\n      videoRef.current.pause()\n      videoRef.current.remove()\n      videoRef.current = null\n    }\n    usingFallbackRef.current = false\n  }, [])\n\n  // Main effect to manage wake lock lifecycle\n  useEffect(() => {\n    if (!enabled) {\n      releaseWakeLock()\n      stopVideoFallback()\n      return\n    }\n\n    let mounted = true\n\n    const enableWakeLock = async () => {\n      // Try native API first\n      const success = await requestWakeLock()\n\n      if (!success && mounted) {\n        // Fall back to video technique\n        startVideoFallback()\n      }\n    }\n\n    enableWakeLock()\n\n    // Re-acquire wake lock when page becomes visible\n    const handleVisibilityChange = async () => {\n      if (document.visibilityState === 'visible' && mounted && enabled) {\n        if (!usingFallbackRef.current) {\n          await requestWakeLock()\n        }\n      }\n    }\n\n    document.addEventListener('visibilitychange', handleVisibilityChange)\n\n    return () => {\n      mounted = false\n      releaseWakeLock()\n      stopVideoFallback()\n      document.removeEventListener('visibilitychange', handleVisibilityChange)\n    }\n  }, [enabled, requestWakeLock, releaseWakeLock, startVideoFallback, stopVideoFallback])\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/lib/audio.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/AllRecipes.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'AllRecipes' has too many lines (79). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":91,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { ArrowLeft, BookOpen } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type HistoryItem } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\n\ninterface AllRecipesProps {\n  onBack: () => void\n  onRecipeClick: (recipeId: number) => void\n}\n\nexport default function AllRecipes({ onBack, onRecipeClick }: AllRecipesProps) {\n  const [history, setHistory] = useState<HistoryItem[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadHistory()\n  }, [])\n\n  const loadHistory = async () => {\n    try {\n      // Load all history (use large limit)\n      const data = await api.history.list(1000)\n      setHistory(data)\n    } catch (error) {\n      console.error('Failed to load recipes:', error)\n      toast.error('Failed to load recipes')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={onBack}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">All Recipes</h1>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <RecipeGridSkeleton count={8} />\n          ) : history.length > 0 ? (\n            <>\n              <p className=\"mb-4 text-sm text-muted-foreground\">\n                {history.length} recipe{history.length !== 1 ? 's' : ''}\n              </p>\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n                {history.map((item) => (\n                  <RecipeCard\n                    key={item.recipe.id}\n                    recipe={item.recipe}\n                    onClick={() => onRecipeClick(item.recipe.id)}\n                  />\n                ))}\n              </div>\n            </>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <BookOpen className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No recipes viewed yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Start browsing and viewing recipes to see them here\n              </p>\n              <button\n                onClick={onBack}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Browse Recipes\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/CollectionDetail.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'CollectionDetail' has too many lines (179). Maximum allowed is 50.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":193,"endColumn":2},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCollection'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [collectionId, loadCollection]","fix":{"range":[911,925],"text":"[collectionId, loadCollection]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { ArrowLeft, Trash2, X, FolderOpen } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type CollectionDetail as CollectionDetailType, type Recipe } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { LoadingSpinner } from '../components/Skeletons'\n\ninterface CollectionDetailProps {\n  collectionId: number\n  onBack: () => void\n  onRecipeClick: (recipeId: number) => void\n  onDelete: () => void\n}\n\nexport default function CollectionDetail({\n  collectionId,\n  onBack,\n  onRecipeClick,\n  onDelete,\n}: CollectionDetailProps) {\n  const [collection, setCollection] = useState<CollectionDetailType | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)\n  const [deleting, setDeleting] = useState(false)\n\n  useEffect(() => {\n    loadCollection()\n  }, [collectionId])\n\n  const loadCollection = async () => {\n    try {\n      const data = await api.collections.get(collectionId)\n      setCollection(data)\n    } catch (error) {\n      console.error('Failed to load collection:', error)\n      toast.error('Failed to load collection')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRemoveRecipe = async (recipe: Recipe) => {\n    if (!collection) return\n\n    try {\n      await api.collections.removeRecipe(collectionId, recipe.id)\n      setCollection({\n        ...collection,\n        recipes: collection.recipes.filter((item) => item.recipe.id !== recipe.id),\n      })\n      toast.success('Removed from collection')\n    } catch (error) {\n      console.error('Failed to remove recipe:', error)\n      toast.error('Failed to remove recipe')\n    }\n  }\n\n  const handleDeleteCollection = async () => {\n    setDeleting(true)\n    try {\n      await api.collections.delete(collectionId)\n      toast.success('Collection deleted')\n      onDelete()\n    } catch (error) {\n      console.error('Failed to delete collection:', error)\n      toast.error('Failed to delete collection')\n    } finally {\n      setDeleting(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <LoadingSpinner className=\"min-h-screen\" />\n      </div>\n    )\n  }\n\n  if (!collection) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background\">\n        <span className=\"mb-4 text-muted-foreground\">Collection not found</span>\n        <button\n          onClick={onBack}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Go Back\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={onBack}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </button>\n          <div>\n            <h1 className=\"text-xl font-medium text-foreground\">\n              {collection.name}\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              {collection.recipes.length} recipe\n              {collection.recipes.length !== 1 ? 's' : ''}\n            </p>\n          </div>\n        </div>\n        <button\n          onClick={() => setShowDeleteConfirm(true)}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-destructive/10 hover:text-destructive\"\n          title=\"Delete collection\"\n        >\n          <Trash2 className=\"h-5 w-5\" />\n        </button>\n      </header>\n\n      {/* Delete confirmation */}\n      {showDeleteConfirm && (\n        <div className=\"border-b border-destructive/30 bg-destructive/10 px-4 py-3\">\n          <div className=\"mx-auto flex max-w-4xl items-center justify-between\">\n            <p className=\"text-sm text-foreground\">\n              Delete \"{collection.name}\"? This cannot be undone.\n            </p>\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => setShowDeleteConfirm(false)}\n                className=\"rounded-lg px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted hover:text-foreground\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleDeleteCollection}\n                disabled={deleting}\n                className=\"rounded-lg bg-destructive px-3 py-1.5 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50\"\n              >\n                {deleting ? 'Deleting...' : 'Delete'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {collection.recipes.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {collection.recipes.map((item) => (\n                <div key={item.recipe.id} className=\"group relative\">\n                  <RecipeCard\n                    recipe={item.recipe}\n                    onClick={() => onRecipeClick(item.recipe.id)}\n                  />\n                  {/* Remove button overlay */}\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation()\n                      handleRemoveRecipe(item.recipe)\n                    }}\n                    className=\"absolute right-2 top-2 rounded-full bg-destructive/90 p-1.5 text-destructive-foreground opacity-0 transition-opacity group-hover:opacity-100\"\n                    title=\"Remove from collection\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <FolderOpen className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                This collection is empty\n              </h3>\n              <p className=\"text-center text-muted-foreground\">\n                Add recipes from their detail pages.\n              </p>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Collections.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Collections' has too many lines (210). Maximum allowed is 50.","line":14,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":223,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { ArrowLeft, FolderPlus, Plus, X } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Collection } from '../api/client'\nimport { cn } from '../lib/utils'\nimport { CollectionGridSkeleton } from '../components/Skeletons'\n\ninterface CollectionsProps {\n  onBack: () => void\n  onCollectionClick: (collectionId: number) => void\n  pendingRecipeId?: number | null\n}\n\nexport default function Collections({\n  onBack,\n  onCollectionClick,\n  pendingRecipeId,\n}: CollectionsProps) {\n  const [collections, setCollections] = useState<Collection[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [newCollectionName, setNewCollectionName] = useState('')\n  const [creating, setCreating] = useState(false)\n\n  useEffect(() => {\n    loadCollections()\n  }, [])\n\n  const loadCollections = async () => {\n    try {\n      const data = await api.collections.list()\n      setCollections(data)\n    } catch (error) {\n      console.error('Failed to load collections:', error)\n      toast.error('Failed to load collections')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCreateCollection = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!newCollectionName.trim()) return\n\n    setCreating(true)\n    try {\n      const collection = await api.collections.create({\n        name: newCollectionName.trim(),\n      })\n      setCollections([collection, ...collections])\n      setNewCollectionName('')\n      setShowCreateForm(false)\n      toast.success('Collection created')\n\n      // If there's a pending recipe to add, add it and navigate to collection\n      if (pendingRecipeId) {\n        try {\n          await api.collections.addRecipe(collection.id, pendingRecipeId)\n          toast.success('Recipe added to collection')\n        } catch (error) {\n          console.error('Failed to add recipe to collection:', error)\n        }\n        onCollectionClick(collection.id)\n      }\n    } catch (error) {\n      console.error('Failed to create collection:', error)\n      toast.error('Failed to create collection')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  const handleCollectionClick = async (collectionId: number) => {\n    // If there's a pending recipe, add it first\n    if (pendingRecipeId) {\n      try {\n        await api.collections.addRecipe(collectionId, pendingRecipeId)\n        toast.success('Recipe added to collection')\n      } catch (error: unknown) {\n        // Ignore \"already in collection\" error\n        if (error instanceof Error && !error.message.includes('already')) {\n          console.error('Failed to add recipe to collection:', error)\n          toast.error('Failed to add recipe to collection')\n        } else {\n          toast.info('Recipe is already in this collection')\n        }\n      }\n    }\n    onCollectionClick(collectionId)\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={onBack}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </button>\n          <h1 className=\"text-xl font-medium text-foreground\">Collections</h1>\n        </div>\n        <button\n          onClick={() => setShowCreateForm(true)}\n          className=\"flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          New Collection\n        </button>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Create form */}\n          {showCreateForm && (\n            <form\n              onSubmit={handleCreateCollection}\n              className=\"mb-6 rounded-lg border border-border bg-card p-4\"\n            >\n              <div className=\"mb-4 flex items-center justify-between\">\n                <h2 className=\"font-medium text-foreground\">New Collection</h2>\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewCollectionName('')\n                  }}\n                  className=\"rounded p-1 text-muted-foreground hover:bg-muted hover:text-foreground\"\n                >\n                  <X className=\"h-5 w-5\" />\n                </button>\n              </div>\n              <input\n                type=\"text\"\n                value={newCollectionName}\n                onChange={(e) => setNewCollectionName(e.target.value)}\n                placeholder=\"Collection name\"\n                className=\"mb-3 w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                autoFocus\n              />\n              <div className=\"flex justify-end gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewCollectionName('')\n                  }}\n                  className=\"rounded-lg px-4 py-2 text-sm text-muted-foreground hover:bg-muted hover:text-foreground\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={!newCollectionName.trim() || creating}\n                  className=\"rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                >\n                  {creating ? 'Creating...' : 'Create'}\n                </button>\n              </div>\n            </form>\n          )}\n\n          {/* Pending recipe notice */}\n          {pendingRecipeId && (\n            <div className=\"mb-4 rounded-lg border border-primary/30 bg-primary/10 p-3 text-sm text-foreground\">\n              Select a collection or create a new one to add the recipe\n            </div>\n          )}\n\n          {loading ? (\n            <CollectionGridSkeleton count={8} />\n          ) : collections.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {collections.map((collection) => (\n                <button\n                  key={collection.id}\n                  onClick={() => handleCollectionClick(collection.id)}\n                  className={cn(\n                    'group relative overflow-hidden rounded-lg bg-card p-4 text-left shadow-sm transition-all hover:shadow-md',\n                    pendingRecipeId && 'ring-2 ring-primary/20 hover:ring-primary/40'\n                  )}\n                >\n                  <div className=\"mb-8 rounded-lg bg-muted p-3\">\n                    <FolderPlus className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <h3 className=\"mb-1 font-medium text-card-foreground line-clamp-1\">\n                    {collection.name}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {collection.recipe_count} recipe\n                    {collection.recipe_count !== 1 ? 's' : ''}\n                  </p>\n                </button>\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <FolderPlus className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No collections yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Create one to organize your recipes!\n              </p>\n              <button\n                onClick={() => setShowCreateForm(true)}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Create Collection\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Favorites.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Favorites' has too many lines (86). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":98,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { ArrowLeft, Heart } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Recipe, type Favorite } from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\n\ninterface FavoritesProps {\n  onBack: () => void\n  onRecipeClick: (recipeId: number) => void\n}\n\nexport default function Favorites({ onBack, onRecipeClick }: FavoritesProps) {\n  const [favorites, setFavorites] = useState<Favorite[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    loadFavorites()\n  }, [])\n\n  const loadFavorites = async () => {\n    try {\n      const data = await api.favorites.list()\n      setFavorites(data)\n    } catch (error) {\n      console.error('Failed to load favorites:', error)\n      toast.error('Failed to load favorites')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRemoveFavorite = async (recipe: Recipe) => {\n    try {\n      await api.favorites.remove(recipe.id)\n      setFavorites(favorites.filter((f) => f.recipe.id !== recipe.id))\n      toast.success('Removed from favorites')\n    } catch (error) {\n      console.error('Failed to remove favorite:', error)\n      toast.error('Failed to remove from favorites')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={onBack}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">Favorites</h1>\n      </header>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <RecipeGridSkeleton count={8} />\n          ) : favorites.length > 0 ? (\n            <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n              {favorites.map((favorite) => (\n                <RecipeCard\n                  key={favorite.recipe.id}\n                  recipe={favorite.recipe}\n                  isFavorite\n                  onFavoriteToggle={handleRemoveFavorite}\n                  onClick={() => onRecipeClick(favorite.recipe.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n              <div className=\"mb-4 rounded-full bg-muted p-4\">\n                <Heart className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                No favorites yet\n              </h3>\n              <p className=\"mb-4 text-center text-muted-foreground\">\n                Browse recipes to add some!\n              </p>\n              <button\n                onClick={onBack}\n                className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n              >\n                Discover Recipes\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Home.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Home' has too many lines (416). Maximum allowed is 50.","line":32,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":447,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Home' has a complexity of 17. Maximum allowed is 10.","line":32,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":32,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'discoverError', 'discoverLoading', 'discoverSuggestions.length', and 'loadDiscoverSuggestions'. Either include them or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, aiAvailable, discoverError, discoverLoading, discoverSuggestions.length, loadDiscoverSuggestions]","fix":{"range":[2003,2027],"text":"[activeTab, aiAvailable, discoverError, discoverLoading, discoverSuggestions.length, loadDiscoverSuggestions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { Moon, Sun, LogOut, Search, Sparkles, Heart, FolderOpen, Settings, RefreshCw } from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type Profile,\n  type Recipe,\n  type Favorite,\n  type HistoryItem,\n  type DiscoverSuggestion,\n} from '../api/client'\nimport RecipeCard from '../components/RecipeCard'\nimport { RecipeGridSkeleton } from '../components/Skeletons'\nimport { cn } from '../lib/utils'\n\ninterface HomeProps {\n  profile: Profile\n  theme: 'light' | 'dark'\n  aiAvailable: boolean\n  onThemeToggle: () => void\n  onLogout: () => void\n  onSearch: (query: string) => void\n  onRecipeClick: (recipeId: number) => void\n  onFavoritesClick: () => void\n  onAllRecipesClick: () => void\n  onCollectionsClick: () => void\n  onSettingsClick: () => void\n}\n\ntype Tab = 'favorites' | 'discover'\n\nexport default function Home({\n  profile,\n  theme,\n  aiAvailable,\n  onThemeToggle,\n  onLogout,\n  onSearch,\n  onRecipeClick,\n  onFavoritesClick,\n  onAllRecipesClick,\n  onCollectionsClick,\n  onSettingsClick,\n}: HomeProps) {\n  const [searchQuery, setSearchQuery] = useState('')\n  const [activeTab, setActiveTab] = useState<Tab>('favorites')\n  const [favorites, setFavorites] = useState<Favorite[]>([])\n  const [history, setHistory] = useState<HistoryItem[]>([])\n  const [historyCount, setHistoryCount] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [discoverSuggestions, setDiscoverSuggestions] = useState<DiscoverSuggestion[]>([])\n  const [discoverLoading, setDiscoverLoading] = useState(false)\n  const [discoverError, setDiscoverError] = useState(false)\n  // Refreshed at timestamp could be used for display, keeping for future use\n  const [, setDiscoverRefreshedAt] = useState<string | null>(null)\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  useEffect(() => {\n    if (activeTab === 'discover' && discoverSuggestions.length === 0 && !discoverLoading && !discoverError && aiAvailable) {\n      loadDiscoverSuggestions()\n    }\n  }, [activeTab, aiAvailable])\n\n  const loadData = async () => {\n    try {\n      const [favoritesData, historyData] = await Promise.all([\n        api.favorites.list(),\n        api.history.list(1000), // Get all to count, display first 6\n      ])\n      setFavorites(favoritesData)\n      setHistoryCount(historyData.length)\n      setHistory(historyData.slice(0, 6))\n    } catch (error) {\n      console.error('Failed to load data:', error)\n      toast.error('Failed to load recipes')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadDiscoverSuggestions = async () => {\n    setDiscoverLoading(true)\n    setDiscoverError(false)\n    try {\n      const result = await api.ai.discover(profile.id)\n      setDiscoverSuggestions(result.suggestions)\n      setDiscoverRefreshedAt(result.refreshed_at)\n    } catch (error) {\n      console.error('Failed to load discover suggestions:', error)\n      setDiscoverError(true)\n    } finally {\n      setDiscoverLoading(false)\n    }\n  }\n\n  const handleSuggestionClick = (suggestion: DiscoverSuggestion) => {\n    // Execute the search query from the suggestion\n    onSearch(suggestion.search_query)\n  }\n\n  const handleSearchSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    if (searchQuery.trim()) {\n      onSearch(searchQuery.trim())\n    }\n  }\n\n  const handleRemoveFavorite = async (recipe: Recipe) => {\n    try {\n      await api.favorites.remove(recipe.id)\n      setFavorites(favorites.filter((f) => f.recipe.id !== recipe.id))\n      toast.success('Removed from favorites')\n    } catch (error) {\n      console.error('Failed to remove favorite:', error)\n      toast.error('Failed to remove from favorites')\n    }\n  }\n\n  const getInitial = (name: string) => {\n    return name.charAt(0).toUpperCase()\n  }\n\n  const favoriteRecipeIds = new Set(favorites.map((f) => f.recipe.id))\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n        <h1 className=\"text-xl font-medium text-primary\">Cookie</h1>\n\n        <div className=\"flex items-center gap-3\">\n          {/* Favorites */}\n          <button\n            onClick={onFavoritesClick}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-accent\"\n            aria-label=\"View favorites\"\n          >\n            <Heart className=\"h-5 w-5\" />\n          </button>\n\n          {/* Collections */}\n          <button\n            onClick={onCollectionsClick}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-primary\"\n            aria-label=\"View collections\"\n          >\n            <FolderOpen className=\"h-5 w-5\" />\n          </button>\n\n          {/* Theme toggle */}\n          <button\n            onClick={onThemeToggle}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label={theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode'}\n          >\n            {theme === 'light' ? (\n              <Moon className=\"h-5 w-5\" />\n            ) : (\n              <Sun className=\"h-5 w-5\" />\n            )}\n          </button>\n\n          {/* Settings */}\n          <button\n            onClick={onSettingsClick}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label=\"Settings\"\n          >\n            <Settings className=\"h-5 w-5\" />\n          </button>\n\n          {/* Profile avatar */}\n          <button\n            onClick={onLogout}\n            className=\"flex h-9 w-9 items-center justify-center rounded-full text-sm font-medium text-white\"\n            style={{ backgroundColor: profile.avatar_color }}\n            aria-label=\"Switch profile\"\n          >\n            {getInitial(profile.name)}\n          </button>\n\n          {/* Logout */}\n          <button\n            onClick={onLogout}\n            className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n            aria-label=\"Switch profile\"\n          >\n            <LogOut className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </header>\n\n      {/* Main content */}\n      <main className=\"flex-1 px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Search bar */}\n          <form onSubmit={handleSearchSubmit} className=\"mb-6\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground\" />\n              <input\n                type=\"text\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                placeholder=\"Search recipes or paste a URL...\"\n                className=\"w-full rounded-xl border border-border bg-input-background py-3 pl-12 pr-4 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n              />\n            </div>\n          </form>\n\n          {/* Tab toggle - only show if AI is available (8B.11 graceful degradation) */}\n          {aiAvailable && (\n            <div className=\"mb-6 flex justify-center\">\n              <div className=\"inline-flex rounded-lg bg-muted p-1\">\n                <button\n                  onClick={() => setActiveTab('favorites')}\n                  className={cn(\n                    'rounded-md px-4 py-2 text-sm font-medium transition-colors',\n                    activeTab === 'favorites'\n                      ? 'bg-background text-foreground shadow-sm'\n                      : 'text-muted-foreground hover:text-foreground'\n                  )}\n                >\n                  My Favorites\n                </button>\n                <button\n                  onClick={() => setActiveTab('discover')}\n                  className={cn(\n                    'rounded-md px-4 py-2 text-sm font-medium transition-colors',\n                    activeTab === 'discover'\n                      ? 'bg-background text-foreground shadow-sm'\n                      : 'text-muted-foreground hover:text-foreground'\n                  )}\n                >\n                  Discover\n                </button>\n              </div>\n            </div>\n          )}\n\n          {loading ? (\n            <RecipeGridSkeleton count={6} />\n          ) : activeTab === 'favorites' || !aiAvailable ? (\n            <>\n              {/* Recently Viewed */}\n              {history.length > 0 && (\n                <section className=\"mb-8\">\n                  <div className=\"mb-4 flex items-center justify-between\">\n                    <h2 className=\"text-lg font-medium text-foreground\">\n                      Recently Viewed\n                    </h2>\n                    <button\n                      onClick={onAllRecipesClick}\n                      className=\"text-sm font-medium text-primary hover:underline\"\n                    >\n                      View All ({historyCount})\n                    </button>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6\">\n                    {history.map((item) => (\n                      <RecipeCard\n                        key={item.recipe.id}\n                        recipe={item.recipe}\n                        isFavorite={favoriteRecipeIds.has(item.recipe.id)}\n                        onClick={() => onRecipeClick(item.recipe.id)}\n                      />\n                    ))}\n                  </div>\n                </section>\n              )}\n\n              {/* Favorites */}\n              <section>\n                <div className=\"mb-4 flex items-center justify-between\">\n                  <h2 className=\"text-lg font-medium text-foreground\">\n                    My Favorite Recipes\n                  </h2>\n                  {favorites.length > 0 && (\n                    <button\n                      onClick={onFavoritesClick}\n                      className=\"text-sm font-medium text-primary hover:underline\"\n                    >\n                      View All ({favorites.length})\n                    </button>\n                  )}\n                </div>\n                {favorites.length > 0 ? (\n                  <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n                    {favorites.map((favorite) => (\n                      <RecipeCard\n                        key={favorite.recipe.id}\n                        recipe={favorite.recipe}\n                        isFavorite\n                        onFavoriteToggle={handleRemoveFavorite}\n                        onClick={() => onRecipeClick(favorite.recipe.id)}\n                      />\n                    ))}\n                  </div>\n                ) : (\n                  /* Empty state */\n                  <div className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-border py-12\">\n                    <div className=\"mb-4 rounded-full bg-muted p-4\">\n                      <Search className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                    <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                      No favorites yet\n                    </h3>\n                    <p className=\"mb-4 text-center text-muted-foreground\">\n                      Search for recipes and add them to your favorites\n                    </p>\n                    <button\n                      onClick={() => document.querySelector('input')?.focus()}\n                      className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                    >\n                      Discover Recipes\n                    </button>\n                  </div>\n                )}\n              </section>\n            </>\n          ) : (\n            /* Discover tab - AI recommendations */\n            <div>\n              {discoverLoading ? (\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 animate-pulse text-primary\" />\n                  </div>\n                  <p className=\"text-muted-foreground\">\n                    Generating personalized suggestions...\n                  </p>\n                </div>\n              ) : discoverSuggestions.length > 0 ? (\n                <div className=\"space-y-6\">\n                  {/* Header with refresh time */}\n                  <div className=\"flex items-center justify-between\">\n                    <h2 className=\"text-lg font-medium text-foreground\">\n                      Personalized For You\n                    </h2>\n                    <button\n                      onClick={loadDiscoverSuggestions}\n                      className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground\"\n                      disabled={discoverLoading}\n                    >\n                      <RefreshCw className={cn('h-4 w-4', discoverLoading && 'animate-spin')} />\n                      Refresh\n                    </button>\n                  </div>\n\n                  {/* Suggestions grid */}\n                  <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n                    {discoverSuggestions.map((suggestion, index) => (\n                      <button\n                        key={`${suggestion.type}-${index}`}\n                        onClick={() => handleSuggestionClick(suggestion)}\n                        className=\"group flex flex-col rounded-xl border border-border bg-card p-4 text-left transition-all hover:border-primary hover:shadow-md\"\n                      >\n                        <div className=\"mb-2 flex items-center gap-2\">\n                          <Sparkles className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                            {suggestion.type === 'favorites' && 'Based on Favorites'}\n                            {suggestion.type === 'seasonal' && 'Seasonal'}\n                            {suggestion.type === 'new' && 'Try Something New'}\n                          </span>\n                        </div>\n                        <h3 className=\"mb-1 font-medium text-foreground group-hover:text-primary\">\n                          {suggestion.title}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {suggestion.description}\n                        </p>\n                        <div className=\"mt-3 flex items-center gap-1 text-xs text-primary\">\n                          <Search className=\"h-3 w-3\" />\n                          <span>Search: {suggestion.search_query}</span>\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              ) : !aiAvailable ? (\n                /* Empty state - AI unavailable (no API key) */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    AI Recommendations\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Configure an API key in settings to enable personalized recipe suggestions\n                  </p>\n                  <button\n                    onClick={onSettingsClick}\n                    className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    Go to Settings\n                  </button>\n                </div>\n              ) : discoverError ? (\n                /* Empty state - API error */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    Unable to Load Suggestions\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Something went wrong. Please try again.\n                  </p>\n                  <button\n                    onClick={loadDiscoverSuggestions}\n                    className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    <RefreshCw className=\"h-4 w-4\" />\n                    Try Again\n                  </button>\n                </div>\n              ) : (\n                /* Empty state - No suggestions available */\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <div className=\"mb-4 rounded-full bg-muted p-4\">\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground\" />\n                  </div>\n                  <h3 className=\"mb-2 text-lg font-medium text-foreground\">\n                    No Suggestions Yet\n                  </h3>\n                  <p className=\"mb-4 text-center text-muted-foreground\">\n                    Add some favorites to get personalized recommendations\n                  </p>\n                  <button\n                    onClick={() => setActiveTab('favorites')}\n                    className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90\"\n                  >\n                    View Favorites\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/PlayMode.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'PlayMode' has too many lines (217). Maximum allowed is 50.","line":17,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":233,"endColumn":2},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleNext' and 'handlePrevious'. Either include them or remove the dependency array.","line":110,"column":6,"nodeType":"ArrayExpression","endLine":110,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [currentStep, totalSteps, onExit, handlePrevious, handleNext]","fix":{"range":[3175,3208],"text":"[currentStep, totalSteps, onExit, handlePrevious, handleNext]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react'\nimport { X, ChevronLeft, ChevronRight } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api } from '../api/client'\nimport type { RecipeDetail } from '../api/client'\nimport { useTimers } from '../hooks/useTimers'\nimport { useWakeLock } from '../hooks/useWakeLock'\nimport TimerPanel from '../components/TimerPanel'\nimport { cn } from '../lib/utils'\nimport { unlockAudio, playTimerAlert } from '../lib/audio'\n\ninterface PlayModeProps {\n  recipe: RecipeDetail\n  onExit: () => void\n}\n\nexport default function PlayMode({ recipe, onExit }: PlayModeProps) {\n  const [currentStep, setCurrentStep] = useState(0)\n  const [aiAvailable, setAiAvailable] = useState(false)\n\n  // Fetch AI availability on mount\n  useEffect(() => {\n    api.ai.status().then((status) => {\n      setAiAvailable(status.available)\n    }).catch(() => {\n      setAiAvailable(false)\n    })\n  }, [])\n\n  // Get instructions array\n  const instructions =\n    recipe.instructions.length > 0\n      ? recipe.instructions\n      : recipe.instructions_text\n        ? recipe.instructions_text.split('\\n').filter((s) => s.trim())\n        : []\n\n  const totalSteps = instructions.length\n\n  // Timer completion handler\n  const handleTimerComplete = useCallback(\n    (timer: { label: string }) => {\n      // Play audio alert\n      playTimerAlert()\n\n      // Show toast notification\n      toast.success(`Timer complete: ${timer.label}`, {\n        duration: 10000,\n      })\n\n      // Show browser notification (may include system sound)\n      try {\n        if ('Notification' in window && Notification.permission === 'granted') {\n          new Notification('Timer Complete!', {\n            body: timer.label,\n            icon: '/favicon.ico',\n          })\n        }\n      } catch {\n        // Notification not supported or blocked\n      }\n    },\n    []\n  )\n\n  const timers = useTimers(handleTimerComplete)\n\n  // Keep screen awake during Play Mode\n  useWakeLock()\n\n  // Request notification permission and unlock audio on mount\n  useEffect(() => {\n    if ('Notification' in window && Notification.permission === 'default') {\n      Notification.requestPermission()\n    }\n    // Unlock audio for iOS (requires user interaction context)\n    // This works because entering Play Mode requires a button click\n    unlockAudio()\n  }, [])\n\n  const currentInstruction = instructions[currentStep] || ''\n  const progress = totalSteps > 0 ? ((currentStep + 1) / totalSteps) * 100 : 0\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1)\n    }\n  }\n\n  const handleNext = () => {\n    if (currentStep < totalSteps - 1) {\n      setCurrentStep(currentStep + 1)\n    }\n  }\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {\n        handlePrevious()\n      } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {\n        handleNext()\n      } else if (e.key === 'Escape') {\n        onExit()\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [currentStep, totalSteps, onExit])\n\n  if (totalSteps === 0) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-4\">\n        <p className=\"mb-4 text-center text-muted-foreground\">\n          No instructions available for this recipe.\n        </p>\n        <button\n          onClick={onExit}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Exit\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header with progress */}\n      <div className=\"relative border-b border-border\">\n        {/* Progress bar */}\n        <div className=\"h-1 bg-muted\">\n          <div\n            className=\"h-full bg-primary transition-all duration-300\"\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n\n        {/* Header content */}\n        <div className=\"flex items-center justify-between px-4 py-3\">\n          <div className=\"flex-1\">\n            <h1 className=\"line-clamp-1 text-sm font-medium text-foreground\">\n              {recipe.title}\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">\n              Step {currentStep + 1} of {totalSteps}\n            </p>\n          </div>\n\n          <button\n            onClick={onExit}\n            className=\"rounded-full bg-muted p-2 text-muted-foreground transition-colors hover:bg-muted/80\"\n            aria-label=\"Exit play mode\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"flex flex-1 flex-col\">\n        {/* Instruction display */}\n        <div className=\"flex flex-1 items-center justify-center p-6\">\n          <div className=\"max-w-2xl text-center\">\n            {/* Step number */}\n            <div className=\"mx-auto mb-6 flex h-12 w-12 items-center justify-center rounded-full bg-primary text-xl font-bold text-primary-foreground\">\n              {currentStep + 1}\n            </div>\n\n            {/* Instruction text */}\n            <p className=\"text-xl leading-relaxed text-foreground sm:text-2xl\">\n              {currentInstruction}\n            </p>\n          </div>\n        </div>\n\n        {/* Navigation buttons */}\n        <div className=\"flex items-center justify-between border-t border-border px-4 py-4\">\n          <button\n            onClick={handlePrevious}\n            disabled={currentStep === 0}\n            className={cn(\n              'flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              currentStep === 0\n                ? 'text-muted-foreground opacity-50'\n                : 'bg-muted text-foreground hover:bg-muted/80'\n            )}\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n            Previous\n          </button>\n\n          {/* Step indicators */}\n          <div className=\"hidden gap-1.5 sm:flex\">\n            {instructions.map((_, idx) => (\n              <button\n                key={idx}\n                onClick={() => setCurrentStep(idx)}\n                className={cn(\n                  'h-2 w-2 rounded-full transition-all',\n                  idx === currentStep\n                    ? 'w-6 bg-primary'\n                    : idx < currentStep\n                      ? 'bg-primary/50'\n                      : 'bg-muted'\n                )}\n                aria-label={`Go to step ${idx + 1}`}\n              />\n            ))}\n          </div>\n\n          <button\n            onClick={handleNext}\n            disabled={currentStep === totalSteps - 1}\n            className={cn(\n              'flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium transition-colors',\n              currentStep === totalSteps - 1\n                ? 'text-muted-foreground opacity-50'\n                : 'bg-primary text-primary-foreground hover:bg-primary/90'\n            )}\n          >\n            Next\n            <ChevronRight className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {/* Timer panel */}\n        <TimerPanel timers={timers} instructionText={currentInstruction} aiAvailable={aiAvailable} />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/ProfileSelector.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'ProfileSelector' has too many lines (170). Maximum allowed is 50.","line":24,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":193,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { Plus } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type Profile, type ProfileInput } from '../api/client'\nimport { cn } from '../lib/utils'\n\nconst PROFILE_COLORS = [\n  '#d97850',\n  '#8fae6f',\n  '#c9956b',\n  '#6b9dad',\n  '#d16b6b',\n  '#9d80b8',\n  '#e6a05f',\n  '#6bb8a5',\n  '#c77a9e',\n  '#7d9e6f',\n]\n\ninterface ProfileSelectorProps {\n  onProfileSelect: (profile: Profile) => void\n}\n\nexport default function ProfileSelector({\n  onProfileSelect,\n}: ProfileSelectorProps) {\n  const [profiles, setProfiles] = useState<Profile[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [newName, setNewName] = useState('')\n  const [selectedColor, setSelectedColor] = useState(PROFILE_COLORS[0])\n  const [creating, setCreating] = useState(false)\n\n  useEffect(() => {\n    loadProfiles()\n  }, [])\n\n  const loadProfiles = async () => {\n    try {\n      const data = await api.profiles.list()\n      setProfiles(data)\n    } catch (error) {\n      console.error('Failed to load profiles:', error)\n      toast.error('Failed to load profiles')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCreateProfile = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!newName.trim()) return\n\n    setCreating(true)\n    try {\n      const data: ProfileInput = {\n        name: newName.trim(),\n        avatar_color: selectedColor,\n        theme: 'light',\n        unit_preference: 'metric',\n      }\n      const profile = await api.profiles.create(data)\n      setProfiles([...profiles, profile])\n      onProfileSelect(profile)\n      setShowCreateForm(false)\n      setNewName('')\n      setSelectedColor(PROFILE_COLORS[0])\n      toast.success(`Welcome, ${profile.name}!`)\n    } catch (error) {\n      console.error('Failed to create profile:', error)\n      toast.error('Failed to create profile')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  const getInitial = (name: string) => {\n    return name.charAt(0).toUpperCase()\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col items-center justify-center bg-background px-4\">\n      <div className=\"w-full max-w-md text-center\">\n        {/* Title */}\n        <h1 className=\"mb-2 text-4xl font-medium text-primary\">Cookie</h1>\n        <p className=\"mb-10 text-muted-foreground\">Who's cooking today?</p>\n\n        {/* Profile grid */}\n        <div className=\"mb-8 flex flex-wrap justify-center gap-6\">\n          {profiles.map((profile) => (\n            <button\n              key={profile.id}\n              onClick={() => onProfileSelect(profile)}\n              className=\"group flex flex-col items-center gap-2\"\n            >\n              <div\n                className=\"flex h-20 w-20 items-center justify-center rounded-full text-2xl font-medium text-white transition-transform group-hover:scale-105\"\n                style={{ backgroundColor: profile.avatar_color }}\n              >\n                {getInitial(profile.name)}\n              </div>\n              <span className=\"text-sm text-foreground\">{profile.name}</span>\n            </button>\n          ))}\n\n          {/* Add profile button */}\n          <button\n            onClick={() => setShowCreateForm(true)}\n            className=\"group flex flex-col items-center gap-2\"\n          >\n            <div className=\"flex h-20 w-20 items-center justify-center rounded-full border-2 border-dashed border-muted-foreground/40 transition-colors group-hover:border-primary\">\n              <Plus className=\"h-8 w-8 text-muted-foreground/60 group-hover:text-primary\" />\n            </div>\n            <span className=\"text-sm text-muted-foreground\">Add Profile</span>\n          </button>\n        </div>\n\n        {/* Create profile form */}\n        {showCreateForm && (\n          <div className=\"rounded-lg border border-border bg-card p-6 shadow-sm\">\n            <h2 className=\"mb-4 text-lg font-medium text-card-foreground\">\n              Create Profile\n            </h2>\n            <form onSubmit={handleCreateProfile}>\n              <div className=\"mb-4\">\n                <input\n                  type=\"text\"\n                  value={newName}\n                  onChange={(e) => setNewName(e.target.value)}\n                  placeholder=\"Enter your name\"\n                  className=\"w-full rounded-lg border border-border bg-input-background px-4 py-3 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                  autoFocus\n                  maxLength={20}\n                />\n              </div>\n\n              {/* Color picker */}\n              <div className=\"mb-6\">\n                <label className=\"mb-2 block text-sm text-muted-foreground\">\n                  Choose a color\n                </label>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {PROFILE_COLORS.map((color) => (\n                    <button\n                      key={color}\n                      type=\"button\"\n                      onClick={() => setSelectedColor(color)}\n                      className={cn(\n                        'h-10 w-10 rounded-full transition-transform hover:scale-110',\n                        selectedColor === color && 'ring-2 ring-ring ring-offset-2 ring-offset-card'\n                      )}\n                      style={{ backgroundColor: color }}\n                    />\n                  ))}\n                </div>\n              </div>\n\n              {/* Buttons */}\n              <div className=\"flex gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowCreateForm(false)\n                    setNewName('')\n                    setSelectedColor(PROFILE_COLORS[0])\n                  }}\n                  className=\"flex-1 rounded-lg border border-border bg-secondary px-4 py-2.5 text-secondary-foreground transition-colors hover:bg-muted\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={!newName.trim() || creating}\n                  className=\"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                >\n                  {creating ? 'Creating...' : 'Create'}\n                </button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/RecipeDetail.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'RecipeDetail' has too many lines (456). Maximum allowed is 50.","line":39,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":494,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'RecipeDetail' has a complexity of 54. Maximum allowed is 10.","line":39,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":39,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, recipeId]","fix":{"range":[1914,1924],"text":"[loadData, recipeId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'recipe'. Either include it or remove the dependency array.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [recipe, recipe.id, recipe.scraped_at, tips.length]","fix":{"range":[3214,3259],"text":"[recipe, recipe.id, recipe.scraped_at, tips.length]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'aiStatus.available', 'handleGenerateTips', 'recipe', 'tips.length', 'tipsLoading', and 'tipsPolling'. Either include them or remove the dependency array.","line":123,"column":6,"nodeType":"ArrayExpression","endLine":123,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, aiStatus.available, handleGenerateTips, recipe, tips.length, tipsLoading, tipsPolling]","fix":{"range":[3568,3579],"text":"[activeTab, aiStatus.available, handleGenerateTips, recipe, tips.length, tipsLoading, tipsPolling]"}}]},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'IngredientsTab' has too many lines (55). Maximum allowed is 50.","line":496,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":550,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'TipsTab' has too many lines (107). Maximum allowed is 50.","line":633,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":739,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'TipsTab' has a complexity of 11. Maximum allowed is 10.","line":633,"column":1,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":633,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport {\n  ArrowLeft,\n  Star,\n  Clock,\n  Heart,\n  PlayCircle,\n  Sparkles,\n  ChevronDown,\n  ChevronUp,\n  Minus,\n  Plus,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type RecipeDetail as RecipeDetailType,\n  type ScaleResponse,\n} from '../api/client'\nimport { cn } from '../lib/utils'\nimport AddToCollectionDropdown from '../components/AddToCollectionDropdown'\nimport RemixModal from '../components/RemixModal'\nimport { useAIStatus } from '../contexts/AIStatusContext'\nimport { RecipeDetailSkeleton } from '../components/Skeletons'\n\ninterface RecipeDetailProps {\n  recipeId: number\n  profileId: number\n  isFavorite: boolean\n  onBack: () => void\n  onFavoriteToggle: (recipe: RecipeDetailType) => void\n  onStartCooking: (recipe: RecipeDetailType) => void\n  onAddToNewCollection: (recipeId: number) => void\n  onRemixCreated: (recipeId: number) => void\n}\n\ntype Tab = 'ingredients' | 'instructions' | 'nutrition' | 'tips'\n\nexport default function RecipeDetail({\n  recipeId,\n  profileId,\n  isFavorite,\n  onBack,\n  onFavoriteToggle,\n  onStartCooking,\n  onAddToNewCollection,\n  onRemixCreated,\n}: RecipeDetailProps) {\n  const [recipe, setRecipe] = useState<RecipeDetailType | null>(null)\n  const aiStatus = useAIStatus()\n  const [loading, setLoading] = useState(true)\n  const [activeTab, setActiveTab] = useState<Tab>('ingredients')\n  const [metaExpanded, setMetaExpanded] = useState(true)\n  const [servings, setServings] = useState<number | null>(null)\n  const [showRemixModal, setShowRemixModal] = useState(false)\n  const [scaledData, setScaledData] = useState<ScaleResponse | null>(null)\n  const [scalingLoading, setScalingLoading] = useState(false)\n  const [tips, setTips] = useState<string[]>([])\n  const [tipsLoading, setTipsLoading] = useState(false)\n  const [tipsPolling, setTipsPolling] = useState(false)\n\n  useEffect(() => {\n    loadData()\n  }, [recipeId])\n\n  // Poll for tips if recipe is recently imported and has no tips yet\n  useEffect(() => {\n    if (!recipe) return\n\n    const recipeAge = Date.now() - new Date(recipe.scraped_at).getTime()\n    const isRecent = recipeAge < 60000 // 60 seconds\n\n    // Only poll for recent recipes with no tips\n    if (!isRecent || tips.length > 0) {\n      setTipsPolling(false)\n      return\n    }\n\n    setTipsPolling(true)\n    const startTime = Date.now()\n    const POLL_INTERVAL = 3000 // 3 seconds\n    const MAX_POLL_DURATION = 30000 // 30 seconds\n\n    const interval = setInterval(async () => {\n      // Stop if we've been polling too long\n      if (Date.now() - startTime > MAX_POLL_DURATION) {\n        clearInterval(interval)\n        setTipsPolling(false)\n        return\n      }\n\n      try {\n        const updated = await api.recipes.get(recipe.id)\n        if (updated.ai_tips && updated.ai_tips.length > 0) {\n          setTips(updated.ai_tips)\n          setRecipe((prev) => prev ? { ...prev, ai_tips: updated.ai_tips } : prev)\n          clearInterval(interval)\n          setTipsPolling(false)\n        }\n      } catch {\n        // Ignore polling errors, will retry on next interval\n      }\n    }, POLL_INTERVAL)\n\n    return () => {\n      clearInterval(interval)\n      setTipsPolling(false)\n    }\n  }, [recipe?.id, recipe?.scraped_at, tips.length])\n\n  // Auto-generate tips when viewing Tips tab for old recipes without tips (QA-046)\n  useEffect(() => {\n    if (\n      activeTab === 'tips' &&\n      tips.length === 0 &&\n      aiStatus.available &&\n      !tipsLoading &&\n      !tipsPolling &&\n      recipe\n    ) {\n      handleGenerateTips(false)\n    }\n  }, [activeTab]) // Only trigger on tab change\n\n  const loadData = async () => {\n    try {\n      const recipeData = await api.recipes.get(recipeId)\n      setRecipe(recipeData)\n      setServings(recipeData.servings)\n      setTips(recipeData.ai_tips || [])\n      // Reset scaled data when loading a new recipe\n      setScaledData(null)\n    } catch (error) {\n      console.error('Failed to load recipe:', error)\n      toast.error('Failed to load recipe')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatTime = (minutes: number | null) => {\n    if (!minutes) return null\n    if (minutes < 60) return `${minutes} min`\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`\n  }\n\n  const canShowServingAdjustment =\n    aiStatus.available && recipe?.servings !== null\n\n  const handleServingChange = async (delta: number) => {\n    if (!servings || !recipe) return\n    const newServings = Math.max(1, servings + delta)\n    setServings(newServings)\n\n    // If returning to original servings, clear scaled data\n    if (newServings === recipe.servings) {\n      setScaledData(null)\n      return\n    }\n\n    // Call AI to scale ingredients\n    setScalingLoading(true)\n    try {\n      const result = await api.ai.scale(recipe.id, newServings, profileId)\n      setScaledData(result)\n      if (result.notes.length > 0) {\n        toast.info(result.notes[0])\n      }\n    } catch (error) {\n      console.error('Failed to scale recipe:', error)\n      toast.error('Failed to scale ingredients')\n      // Revert to previous servings on error\n      setServings(servings)\n    } finally {\n      setScalingLoading(false)\n    }\n  }\n\n  const handleGenerateTips = async (regenerate: boolean = false) => {\n    if (!recipe || tipsLoading) return\n\n    setTipsLoading(true)\n    try {\n      const result = await api.ai.tips(recipe.id, regenerate)\n      setTips(result.tips)\n      // Update the recipe object too\n      setRecipe({ ...recipe, ai_tips: result.tips })\n      toast.success(regenerate ? 'Tips regenerated!' : 'Tips generated!')\n    } catch (error) {\n      console.error('Failed to generate tips:', error)\n      toast.error('Failed to generate tips')\n    } finally {\n      setTipsLoading(false)\n    }\n  }\n\n  if (loading) {\n    return <RecipeDetailSkeleton />\n  }\n\n  if (!recipe) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center bg-background\">\n        <span className=\"mb-4 text-muted-foreground\">Recipe not found</span>\n        <button\n          onClick={onBack}\n          className=\"rounded-lg bg-primary px-4 py-2 text-primary-foreground\"\n        >\n          Go Back\n        </button>\n      </div>\n    )\n  }\n\n  const imageUrl = recipe.image || recipe.image_url\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Image */}\n      <div className=\"relative h-64 sm:h-80\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={recipe.title}\n            className=\"h-full w-full object-cover\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center bg-muted\">\n            <span className=\"text-muted-foreground\">No image</span>\n          </div>\n        )}\n\n        {/* Gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent\" />\n\n        {/* Back button */}\n        <button\n          onClick={onBack}\n          className=\"absolute left-4 top-4 rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:bg-black/60\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n\n        {/* Title and rating overlay */}\n        <div className=\"absolute bottom-4 left-4 right-4\">\n          <h1 className=\"mb-2 text-xl font-medium text-white drop-shadow-lg sm:text-2xl\">\n            {recipe.title}\n          </h1>\n          <div className=\"flex items-center gap-3 text-sm text-white/90\">\n            {recipe.rating && (\n              <span className=\"flex items-center gap-1\">\n                <Star className=\"h-4 w-4 fill-star text-star\" />\n                {recipe.rating.toFixed(1)}\n                {recipe.rating_count && (\n                  <span className=\"text-white/70\">\n                    ({recipe.rating_count})\n                  </span>\n                )}\n              </span>\n            )}\n            <span>{recipe.host}</span>\n          </div>\n        </div>\n\n        {/* Action buttons */}\n        <div className=\"absolute bottom-4 right-4 flex gap-2\">\n          <button\n            onClick={() => onFavoriteToggle(recipe)}\n            className={cn(\n              'rounded-full bg-black/40 p-2 backdrop-blur-sm transition-colors',\n              isFavorite ? 'text-accent' : 'text-white hover:text-accent'\n            )}\n            title={isFavorite ? 'Remove from favorites' : 'Add to favorites'}\n          >\n            <Heart className={cn('h-5 w-5', isFavorite && 'fill-current')} />\n          </button>\n          <AddToCollectionDropdown\n            recipeId={recipeId}\n            onCreateNew={() => onAddToNewCollection(recipeId)}\n          />\n          {aiStatus.available && (\n            <button\n              onClick={() => setShowRemixModal(true)}\n              className=\"rounded-full bg-black/40 p-2 text-white backdrop-blur-sm transition-colors hover:text-primary\"\n              title=\"Remix recipe\"\n            >\n              <Sparkles className=\"h-5 w-5\" />\n            </button>\n          )}\n          <button\n            onClick={() => onStartCooking(recipe)}\n            className=\"flex items-center gap-1.5 rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n          >\n            <PlayCircle className=\"h-4 w-4\" />\n            Cook!\n          </button>\n        </div>\n      </div>\n\n      {/* Meta info (collapsible) */}\n      <div className=\"border-b border-border\">\n        <button\n          onClick={() => setMetaExpanded(!metaExpanded)}\n          className=\"flex w-full items-center justify-between px-4 py-3 text-left\"\n        >\n          <span className=\"text-sm font-medium text-foreground\">\n            Recipe Details\n          </span>\n          {metaExpanded ? (\n            <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\n          ) : (\n            <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n          )}\n        </button>\n\n        {metaExpanded && (\n          <div className=\"flex flex-wrap gap-4 px-4 pb-4\">\n            {/* Prep time */}\n            {recipe.prep_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Prep:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.prep_time_adjusted &&\n                  scaledData.prep_time_adjusted !== recipe.prep_time ? (\n                    <>\n                      {formatTime(scaledData.prep_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.prep_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.prep_time_adjusted ?? recipe.prep_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Cook time */}\n            {recipe.cook_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Cook:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.cook_time_adjusted &&\n                  scaledData.cook_time_adjusted !== recipe.cook_time ? (\n                    <>\n                      {formatTime(scaledData.cook_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.cook_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.cook_time_adjusted ?? recipe.cook_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Total time */}\n            {recipe.total_time && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Total:</span>\n                <span className=\"text-foreground\">\n                  {scaledData?.total_time_adjusted &&\n                  scaledData.total_time_adjusted !== recipe.total_time ? (\n                    <>\n                      {formatTime(scaledData.total_time_adjusted)}\n                      <span className=\"ml-1 text-muted-foreground\">\n                        (was {formatTime(recipe.total_time)})\n                      </span>\n                    </>\n                  ) : (\n                    formatTime(scaledData?.total_time_adjusted ?? recipe.total_time)\n                  )}\n                </span>\n              </div>\n            )}\n\n            {/* Servings adjuster - only show if AI available and servings present */}\n            {canShowServingAdjustment && servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Servings:</span>\n                <div className=\"flex items-center gap-1\">\n                  <button\n                    onClick={() => handleServingChange(-1)}\n                    disabled={servings <= 1 || scalingLoading}\n                    className=\"rounded-md bg-muted p-1 text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    <Minus className=\"h-4 w-4\" />\n                  </button>\n                  <span className=\"w-8 text-center font-medium text-foreground\">\n                    {scalingLoading ? '...' : servings}\n                  </span>\n                  <button\n                    onClick={() => handleServingChange(1)}\n                    disabled={scalingLoading}\n                    className=\"rounded-md bg-muted p-1 text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                  </button>\n                </div>\n                {scaledData && servings !== recipe?.servings && (\n                  <span className=\"text-xs text-muted-foreground\">\n                    (scaled from {recipe?.servings})\n                  </span>\n                )}\n              </div>\n            )}\n\n            {/* Show static servings if AI not available */}\n            {!canShowServingAdjustment && recipe.servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Servings:</span>\n                <span className=\"text-foreground\">{recipe.servings}</span>\n              </div>\n            )}\n\n            {/* Yields (if different from servings) */}\n            {recipe.yields && !recipe.servings && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <span className=\"text-muted-foreground\">Yields:</span>\n                <span className=\"text-foreground\">{recipe.yields}</span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Tabs */}\n      <div className=\"border-b border-border\">\n        <div className=\"flex px-4\">\n          {(\n            [\n              { key: 'ingredients' as const, label: 'Ingredients' },\n              { key: 'instructions' as const, label: 'Instructions' },\n              { key: 'nutrition' as const, label: 'Nutrition' },\n              // Only show Tips tab when AI is available (8B.11 graceful degradation)\n              ...(aiStatus.available ? [{ key: 'tips' as const, label: 'Tips' }] : []),\n            ]\n          ).map(({ key, label }) => (\n            <button\n              key={key}\n              onClick={() => setActiveTab(key)}\n              className={cn(\n                'border-b-2 px-4 py-3 text-sm font-medium transition-colors',\n                activeTab === key\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              {label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Tab content */}\n      <div className=\"px-4 py-6\">\n        {activeTab === 'ingredients' && (\n          <IngredientsTab recipe={recipe} scaledData={scaledData} />\n        )}\n        {activeTab === 'instructions' && (\n          <InstructionsTab recipe={recipe} scaledData={scaledData} />\n        )}\n        {activeTab === 'nutrition' && (\n          <NutritionTab recipe={recipe} />\n        )}\n        {activeTab === 'tips' && (\n          <TipsTab\n            tips={tips}\n            scalingNotes={scaledData?.notes || []}\n            aiAvailable={aiStatus.available}\n            loading={tipsLoading}\n            polling={tipsPolling}\n            onGenerateTips={handleGenerateTips}\n          />\n        )}\n      </div>\n\n      {/* Remix Modal */}\n      <RemixModal\n        recipe={recipe}\n        profileId={profileId}\n        isOpen={showRemixModal}\n        onClose={() => setShowRemixModal(false)}\n        onRemixCreated={onRemixCreated}\n      />\n    </div>\n  )\n}\n\nfunction IngredientsTab({\n  recipe,\n  scaledData,\n}: {\n  recipe: RecipeDetailType\n  scaledData: ScaleResponse | null\n}) {\n  // Use scaled ingredients if available, otherwise use recipe ingredients\n  const ingredients = scaledData?.ingredients || recipe.ingredients\n\n  // Use ingredient_groups if available and not scaled, otherwise flat ingredients list\n  const hasGroups = recipe.ingredient_groups.length > 0 && !scaledData\n\n  if (hasGroups) {\n    return (\n      <div className=\"space-y-6\">\n        {recipe.ingredient_groups.map((group, groupIndex) => (\n          <div key={groupIndex}>\n            {group.purpose && (\n              <h3 className=\"mb-3 font-medium text-foreground\">\n                {group.purpose}\n              </h3>\n            )}\n            <ol className=\"space-y-2\">\n              {group.ingredients.map((ingredient, index) => (\n                <li\n                  key={index}\n                  className=\"flex items-start gap-3 text-foreground\"\n                >\n                  <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n                    {index + 1}\n                  </span>\n                  <span>{ingredient}</span>\n                </li>\n              ))}\n            </ol>\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  return (\n    <ol className=\"space-y-2\">\n      {ingredients.map((ingredient, index) => (\n        <li key={index} className=\"flex items-start gap-3 text-foreground\">\n          <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n            {index + 1}\n          </span>\n          <span>{ingredient}</span>\n        </li>\n      ))}\n    </ol>\n  )\n}\n\nfunction InstructionsTab({\n  recipe,\n  scaledData,\n}: {\n  recipe: RecipeDetailType\n  scaledData: ScaleResponse | null\n}) {\n  // Use scaled instructions if available, otherwise fall back to original\n  const hasScaledInstructions = scaledData?.instructions && scaledData.instructions.length > 0\n  const instructions = hasScaledInstructions\n    ? scaledData.instructions\n    : recipe.instructions.length > 0\n      ? recipe.instructions\n      : recipe.instructions_text\n        ? recipe.instructions_text.split('\\n').filter((s) => s.trim())\n        : []\n\n  if (instructions.length === 0) {\n    return (\n      <p className=\"text-muted-foreground\">\n        No instructions available for this recipe.\n      </p>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {hasScaledInstructions && (\n        <p className=\"text-sm text-muted-foreground\">\n          Instructions adjusted for {scaledData.target_servings} servings\n        </p>\n      )}\n      <ol className=\"space-y-4\">\n        {instructions.map((step, index) => (\n          <li key={index} className=\"flex items-start gap-4\">\n            <span className=\"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground\">\n              {index + 1}\n            </span>\n            <p className=\"pt-0.5 text-foreground\">{step}</p>\n          </li>\n        ))}\n      </ol>\n    </div>\n  )\n}\n\nfunction NutritionTab({ recipe }: { recipe: RecipeDetailType }) {\n  const nutritionEntries = Object.entries(recipe.nutrition || {})\n\n  if (nutritionEntries.length === 0) {\n    return (\n      <p className=\"text-muted-foreground\">\n        No nutrition information available for this recipe.\n      </p>\n    )\n  }\n\n  return (\n    <div>\n      {recipe.servings && (\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          Per serving (recipe makes {recipe.servings})\n        </p>\n      )}\n      <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3\">\n        {nutritionEntries.map(([key, value]) => (\n          <div\n            key={key}\n            className=\"rounded-lg bg-muted/50 p-3\"\n          >\n            <span className=\"block text-sm capitalize text-muted-foreground\">\n              {key.replace(/_/g, ' ')}\n            </span>\n            <span className=\"text-lg font-medium text-foreground\">{value}</span>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\nfunction TipsTab({\n  tips,\n  scalingNotes,\n  aiAvailable,\n  loading,\n  polling,\n  onGenerateTips,\n}: {\n  tips: string[]\n  scalingNotes: string[]\n  aiAvailable?: boolean\n  loading: boolean\n  polling: boolean\n  onGenerateTips: (regenerate: boolean) => void\n}) {\n  // Show loading state when manually generating tips\n  if (loading) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 animate-pulse text-primary\" />\n        <p className=\"text-foreground\">Generating cooking tips...</p>\n      </div>\n    )\n  }\n\n  const hasTips = tips.length > 0\n  const hasContent = hasTips || scalingNotes.length > 0\n\n  // Show polling state when waiting for background generation\n  if (!hasContent && polling) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 animate-pulse text-primary\" />\n        <p className=\"text-foreground\">Generating cooking tips...</p>\n        <p className=\"mt-2 text-sm text-muted-foreground\">\n          Tips are being generated in the background\n        </p>\n      </div>\n    )\n  }\n\n  if (!hasContent) {\n    return (\n      <div className=\"text-center\">\n        <Sparkles className=\"mx-auto mb-3 h-8 w-8 text-muted-foreground\" />\n        <p className=\"mb-2 text-foreground\">No cooking tips yet</p>\n        {aiAvailable ? (\n          <button\n            onClick={() => onGenerateTips(false)}\n            className=\"mt-4 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90\"\n          >\n            Generate Tips\n          </button>\n        ) : (\n          <p className=\"text-sm text-muted-foreground\">\n            Configure an API key in settings to enable AI-generated tips\n          </p>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Scaling notes */}\n      {scalingNotes.length > 0 && (\n        <div className=\"rounded-lg bg-accent/10 p-3\">\n          <h4 className=\"mb-2 flex items-center gap-2 text-sm font-medium text-foreground\">\n            <Sparkles className=\"h-4 w-4 text-accent\" />\n            Scaling Notes\n          </h4>\n          <ul className=\"space-y-1 text-sm text-muted-foreground\">\n            {scalingNotes.map((note, index) => (\n              <li key={index}> {note}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      {/* Tips */}\n      {hasTips && (\n        <ol className=\"space-y-3\">\n          {tips.map((tip, index) => (\n            <li key={index} className=\"flex items-start gap-3\">\n              <span className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-accent text-xs font-medium text-accent-foreground\">\n                {index + 1}\n              </span>\n              <p className=\"text-foreground\">{tip}</p>\n            </li>\n          ))}\n        </ol>\n      )}\n\n      {/* Regenerate/Generate button */}\n      {aiAvailable && (\n        <div className=\"text-center pt-4\">\n          <button\n            onClick={() => onGenerateTips(hasTips)}\n            className=\"rounded-lg bg-muted px-4 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-muted/80 hover:text-foreground\"\n          >\n            {hasTips ? 'Regenerate Tips' : 'Generate Tips'}\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Search.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Search' has too many lines (228). Maximum allowed is 50.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":240,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Search' has a complexity of 19. Maximum allowed is 10.","line":13,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":13,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchRecipes'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [query, searchRecipes, selectedSource]","fix":{"range":[1148,1171],"text":"[query, searchRecipes, selectedSource]"}}]},{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'SearchResultCard' has too many lines (59). Maximum allowed is 50.","line":248,"column":1,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":306,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport { ArrowLeft, Link as LinkIcon, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { api, type SearchResult } from '../api/client'\nimport { cn } from '../lib/utils'\n\ninterface SearchProps {\n  query: string\n  onBack: () => void\n  onImport: (url: string) => void\n}\n\nexport default function Search({ query, onBack, onImport }: SearchProps) {\n  const [results, setResults] = useState<SearchResult[]>([])\n  const [total, setTotal] = useState(0)\n  const [page, setPage] = useState(1)\n  const [hasMore, setHasMore] = useState(false)\n  const [sites, setSites] = useState<Record<string, number>>({})\n  const [selectedSource, setSelectedSource] = useState<string | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [loadingMore, setLoadingMore] = useState(false)\n  const [importing, setImporting] = useState<string | null>(null)\n\n  // Detect if query is a URL\n  const isUrl = /^https?:\\/\\//i.test(query.trim())\n\n  useEffect(() => {\n    // Reset state when query or source filter changes\n    setResults([])\n    setPage(1)\n    setLoading(true)\n    searchRecipes(1, true)\n  }, [query, selectedSource])\n\n  const searchRecipes = async (pageNum: number, reset: boolean = false) => {\n    try {\n      const sources = selectedSource || undefined\n      const response = await api.recipes.search(query, sources, pageNum)\n\n      if (reset) {\n        setResults(response.results)\n        setSites(response.sites)\n      } else {\n        setResults((prev) => [...prev, ...response.results])\n      }\n\n      setTotal(response.total)\n      setHasMore(response.has_more)\n      setPage(pageNum)\n    } catch (error) {\n      console.error('Search failed:', error)\n      toast.error('Search failed. Please try again.')\n    } finally {\n      setLoading(false)\n      setLoadingMore(false)\n    }\n  }\n\n  const handleLoadMore = () => {\n    setLoadingMore(true)\n    searchRecipes(page + 1, false)\n  }\n\n  const handleSourceFilter = (source: string | null) => {\n    setSelectedSource(source)\n  }\n\n  const handleImportUrl = async () => {\n    setImporting(query)\n    try {\n      await onImport(query)\n    } finally {\n      setImporting(null)\n    }\n  }\n\n  const handleImportResult = async (url: string) => {\n    setImporting(url)\n    try {\n      await onImport(url)\n    } finally {\n      setImporting(null)\n    }\n  }\n\n  // Sort sites by count descending for filter chips\n  const sortedSites = Object.entries(sites).sort(([, a], [, b]) => b - a)\n  const allSourcesCount = Object.values(sites).reduce((sum, n) => sum + n, 0)\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-background\">\n      {/* Header with breadcrumb */}\n      <header className=\"border-b border-border px-4 py-3\">\n        <button\n          onClick={onBack}\n          className=\"flex items-center gap-2 text-muted-foreground transition-colors hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n          <span>Back to Home</span>\n        </button>\n      </header>\n\n      <main className=\"flex-1 px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {/* Query info */}\n          <div className=\"mb-6\">\n            <h1 className=\"mb-1 text-xl font-medium text-foreground\">\n              {isUrl ? 'Import Recipe' : `Search: \"${query}\"`}\n            </h1>\n            {!isUrl && !loading && (\n              <p className=\"text-sm text-muted-foreground\">\n                {total} {total === 1 ? 'result' : 'results'} found\n              </p>\n            )}\n          </div>\n\n          {/* URL Import Card */}\n          {isUrl && (\n            <div className=\"mb-8 rounded-xl border border-border bg-card p-6\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"rounded-full bg-primary/10 p-3\">\n                  <LinkIcon className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h2 className=\"mb-1 font-medium text-card-foreground\">\n                    Import Recipe from URL\n                  </h2>\n                  <p className=\"mb-4 text-sm text-muted-foreground line-clamp-1\">\n                    {query}\n                  </p>\n                  <button\n                    onClick={handleImportUrl}\n                    disabled={!!importing}\n                    className=\"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50\"\n                  >\n                    {importing === query ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        Importing...\n                      </>\n                    ) : (\n                      'Import Recipe'\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Source filter chips */}\n          {!isUrl && sortedSites.length > 0 && (\n            <div className=\"mb-6 flex flex-wrap gap-2\">\n              <button\n                onClick={() => handleSourceFilter(null)}\n                className={cn(\n                  'rounded-full px-3 py-1.5 text-sm font-medium transition-colors',\n                  selectedSource === null\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                )}\n              >\n                All Sources ({allSourcesCount})\n              </button>\n              {sortedSites.map(([site, count]) => (\n                <button\n                  key={site}\n                  onClick={() => handleSourceFilter(site)}\n                  className={cn(\n                    'rounded-full px-3 py-1.5 text-sm font-medium transition-colors',\n                    selectedSource === site\n                      ? 'bg-primary text-primary-foreground'\n                      : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                  )}\n                >\n                  {site} ({count})\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* Loading state */}\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          )}\n\n          {/* Results grid */}\n          {!loading && !isUrl && results.length > 0 && (\n            <>\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3\">\n                {results.map((result, index) => (\n                  <SearchResultCard\n                    key={`${result.url}-${index}`}\n                    result={result}\n                    onImport={handleImportResult}\n                    importing={importing === result.url}\n                  />\n                ))}\n              </div>\n\n              {/* Load more / End of results */}\n              <div className=\"mt-8 flex justify-center\">\n                {hasMore ? (\n                  <button\n                    onClick={handleLoadMore}\n                    disabled={loadingMore}\n                    className=\"inline-flex items-center gap-2 rounded-lg bg-muted px-6 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted/80 disabled:opacity-50\"\n                  >\n                    {loadingMore ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        Loading...\n                      </>\n                    ) : (\n                      'Load More'\n                    )}\n                  </button>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">\n                    End of results\n                  </p>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* Empty state */}\n          {!loading && !isUrl && results.length === 0 && (\n            <div className=\"flex flex-col items-center justify-center py-12\">\n              <p className=\"text-muted-foreground\">\n                No recipes found for \"{query}\"\n              </p>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  )\n}\n\ninterface SearchResultCardProps {\n  result: SearchResult\n  onImport: (url: string) => void\n  importing: boolean\n}\n\nfunction SearchResultCard({\n  result,\n  onImport,\n  importing,\n}: SearchResultCardProps) {\n  // Prefer cached image, fallback to external\n  const imageUrl = result.cached_image_url || result.image_url\n\n  return (\n    <div className=\"group overflow-hidden rounded-lg bg-card shadow-sm transition-all hover:shadow-md\">\n      {/* Image */}\n      <div className=\"relative aspect-[4/3] overflow-hidden bg-muted\">\n        {imageUrl ? (\n          <img\n            src={imageUrl}\n            alt={result.title}\n            className=\"h-full w-full object-cover transition-transform group-hover:scale-105\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center text-muted-foreground\">\n            No image\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"p-3\">\n        <h3 className=\"mb-1 line-clamp-2 text-sm font-medium text-card-foreground\">\n          {result.title}\n        </h3>\n        <p className=\"mb-2 text-xs text-muted-foreground\">\n          {result.host}\n          {result.rating_count && (\n            <span>  {result.rating_count.toLocaleString()} Ratings</span>\n          )}\n        </p>\n        {result.description && (\n          <p className=\"mb-3 line-clamp-2 text-xs text-muted-foreground\">\n            {result.description}\n          </p>\n        )}\n        <button\n          onClick={() => onImport(result.url)}\n          disabled={importing}\n          className=\"w-full rounded-md bg-primary/10 py-1.5 text-xs font-medium text-primary transition-colors hover:bg-primary/20 disabled:opacity-50\"\n        >\n          {importing ? (\n            <span className=\"inline-flex items-center gap-1\">\n              <Loader2 className=\"h-3 w-3 animate-spin\" />\n              Importing...\n            </span>\n          ) : (\n            'Import'\n          )}\n        </button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/screens/Settings.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Function 'Settings' has too many lines (1268). Maximum allowed is 50.","line":47,"column":16,"nodeType":"FunctionDeclaration","messageId":"exceed","endLine":1314,"endColumn":2},{"ruleId":"complexity","severity":1,"message":"Function 'Settings' has a complexity of 65. Maximum allowed is 10.","line":47,"column":16,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":47,"endColumn":33},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (141). Maximum allowed is 50.","line":697,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":837,"endColumn":16},{"ruleId":"complexity","severity":1,"message":"Arrow function has a complexity of 12. Maximum allowed is 10.","line":697,"column":37,"nodeType":"ArrowFunctionExpression","messageId":"complex","endLine":697,"endColumn":39},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (92). Maximum allowed is 50.","line":929,"column":30,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":1020,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\nimport {\n  ArrowLeft,\n  Key,\n  Bot,\n  Check,\n  X,\n  ChevronDown,\n  ChevronUp,\n  AlertCircle,\n  AlertTriangle,\n  Loader2,\n  Globe,\n  Code,\n  Settings as SettingsIcon,\n  Github,\n  ToggleLeft,\n  ToggleRight,\n  CheckCircle,\n  XCircle,\n  HelpCircle,\n  Play,\n  Users,\n  Trash2,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  api,\n  type AIPrompt,\n  type AIModel,\n  type AIStatus,\n  type Source,\n  type ProfileWithStats,\n  type DeletionPreview,\n  type ResetPreview,\n} from '../api/client'\nimport { cn } from '../lib/utils'\nimport { useAIStatus } from '../contexts/AIStatusContext'\n\ninterface SettingsProps {\n  onBack: () => void\n  currentProfileId?: number | null\n}\n\ntype Tab = 'general' | 'prompts' | 'sources' | 'selectors' | 'users' | 'danger'\n\nexport default function Settings({ onBack, currentProfileId }: SettingsProps) {\n  const [activeTab, setActiveTab] = useState<Tab>('general')\n  const [aiStatus, setAiStatus] = useState<AIStatus | null>(null)\n  const [prompts, setPrompts] = useState<AIPrompt[]>([])\n  const [models, setModels] = useState<AIModel[]>([])\n  const [sources, setSources] = useState<Source[]>([])\n  const [loading, setLoading] = useState(true)\n  const globalAIStatus = useAIStatus()\n\n  // Users tab state\n  const [profiles, setProfiles] = useState<ProfileWithStats[]>([])\n  const [showDeleteModal, setShowDeleteModal] = useState(false)\n  const [deletePreview, setDeletePreview] = useState<DeletionPreview | null>(null)\n  const [deletingId, setDeletingId] = useState<number | null>(null)\n  const [deleting, setDeleting] = useState(false)\n\n  // Danger Zone state\n  const [showResetModal, setShowResetModal] = useState(false)\n  const [resetPreview, setResetPreview] = useState<ResetPreview | null>(null)\n  const [resetStep, setResetStep] = useState<1 | 2>(1)\n  const [resetConfirmText, setResetConfirmText] = useState('')\n  const [resetting, setResetting] = useState(false)\n\n  // API Key state\n  const [apiKey, setApiKey] = useState('')\n  const [testingKey, setTestingKey] = useState(false)\n  const [savingKey, setSavingKey] = useState(false)\n\n  // Editing state for prompts\n  const [editingPromptType, setEditingPromptType] = useState<string | null>(null)\n  const [editForm, setEditForm] = useState<{\n    system_prompt: string\n    user_prompt_template: string\n    model: string\n    is_active: boolean\n  } | null>(null)\n  const [savingPrompt, setSavingPrompt] = useState(false)\n\n  // Expanded prompts for viewing\n  const [expandedPrompts, setExpandedPrompts] = useState<Set<string>>(new Set())\n\n  // Sources state\n  const [togglingSourceId, setTogglingSourceId] = useState<number | null>(null)\n  const [bulkToggling, setBulkToggling] = useState(false)\n\n  // Selectors state\n  const [editingSourceId, setEditingSourceId] = useState<number | null>(null)\n  const [editingSelectorValue, setEditingSelectorValue] = useState('')\n  const [savingSelector, setSavingSelector] = useState(false)\n  const [testingSourceId, setTestingSourceId] = useState<number | null>(null)\n  const [testingAll, setTestingAll] = useState(false)\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  const loadData = async () => {\n    try {\n      const [statusData, promptsData, modelsData, sourcesData, profilesData] = await Promise.all([\n        api.ai.status(),\n        api.ai.prompts.list(),\n        api.ai.models(),\n        api.sources.list(),\n        api.profiles.list(),\n      ])\n      setAiStatus(statusData)\n      setPrompts(promptsData)\n      setModels(modelsData)\n      setSources(sourcesData)\n      setProfiles(profilesData)\n    } catch (error) {\n      console.error('Failed to load settings:', error)\n      toast.error('Failed to load settings')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // API Key handlers\n  const handleTestApiKey = async () => {\n    if (!apiKey.trim()) {\n      toast.error('Please enter an API key')\n      return\n    }\n\n    setTestingKey(true)\n    try {\n      const result = await api.ai.testApiKey(apiKey.trim())\n      if (result.success) {\n        toast.success(result.message)\n      } else {\n        toast.error(result.message)\n      }\n    } catch (error) {\n      console.error('Failed to test API key:', error)\n      toast.error('Failed to test API key')\n    } finally {\n      setTestingKey(false)\n    }\n  }\n\n  const handleSaveApiKey = async () => {\n    if (!apiKey.trim()) {\n      toast.error('Please enter an API key')\n      return\n    }\n\n    setSavingKey(true)\n    try {\n      const result = await api.ai.saveApiKey(apiKey.trim())\n      if (result.success) {\n        toast.success(result.message)\n        setApiKey('')\n        const statusData = await api.ai.status()\n        setAiStatus(statusData)\n        await globalAIStatus.refresh()\n        const modelsData = await api.ai.models()\n        setModels(modelsData)\n      } else {\n        toast.error(result.message)\n      }\n    } catch (error) {\n      console.error('Failed to save API key:', error)\n      toast.error('Failed to save API key')\n    } finally {\n      setSavingKey(false)\n    }\n  }\n\n  // Prompt handlers\n  const handleEditPrompt = (prompt: AIPrompt) => {\n    setEditingPromptType(prompt.prompt_type)\n    setEditForm({\n      system_prompt: prompt.system_prompt,\n      user_prompt_template: prompt.user_prompt_template,\n      model: prompt.model,\n      is_active: prompt.is_active,\n    })\n  }\n\n  const handleCancelEdit = () => {\n    setEditingPromptType(null)\n    setEditForm(null)\n  }\n\n  const handleSavePrompt = async () => {\n    if (!editingPromptType || !editForm) return\n\n    setSavingPrompt(true)\n    try {\n      const updated = await api.ai.prompts.update(editingPromptType, editForm)\n      setPrompts(prompts.map(p =>\n        p.prompt_type === editingPromptType ? updated : p\n      ))\n      toast.success('Prompt saved successfully')\n      setEditingPromptType(null)\n      setEditForm(null)\n    } catch (error) {\n      console.error('Failed to save prompt:', error)\n      let errorMessage = 'Failed to save prompt'\n      if (error instanceof Error) {\n        try {\n          const parsed = JSON.parse(error.message)\n          if (parsed.message) {\n            errorMessage = parsed.message\n          }\n        } catch {\n          // Not JSON\n        }\n      }\n      toast.error(errorMessage)\n    } finally {\n      setSavingPrompt(false)\n    }\n  }\n\n  const toggleExpandPrompt = (promptType: string) => {\n    setExpandedPrompts(prev => {\n      const next = new Set(prev)\n      if (next.has(promptType)) {\n        next.delete(promptType)\n      } else {\n        next.add(promptType)\n      }\n      return next\n    })\n  }\n\n  // Source handlers\n  const handleToggleSource = async (sourceId: number) => {\n    setTogglingSourceId(sourceId)\n    try {\n      const result = await api.sources.toggle(sourceId)\n      setSources(sources.map(s =>\n        s.id === sourceId ? { ...s, is_enabled: result.is_enabled } : s\n      ))\n    } catch (error) {\n      console.error('Failed to toggle source:', error)\n      toast.error('Failed to toggle source')\n    } finally {\n      setTogglingSourceId(null)\n    }\n  }\n\n  const handleBulkToggle = async (enable: boolean) => {\n    setBulkToggling(true)\n    try {\n      await api.sources.bulkToggle(enable)\n      setSources(sources.map(s => ({ ...s, is_enabled: enable })))\n      toast.success(enable ? 'All sources enabled' : 'All sources disabled')\n    } catch (error) {\n      console.error('Failed to bulk toggle sources:', error)\n      toast.error('Failed to update sources')\n    } finally {\n      setBulkToggling(false)\n    }\n  }\n\n  // Selector handlers\n  const handleEditSelector = (source: Source) => {\n    setEditingSourceId(source.id)\n    setEditingSelectorValue(source.result_selector)\n  }\n\n  const handleCancelEditSelector = () => {\n    setEditingSourceId(null)\n    setEditingSelectorValue('')\n  }\n\n  const handleSaveSelector = async () => {\n    if (editingSourceId === null) return\n\n    setSavingSelector(true)\n    try {\n      const result = await api.sources.updateSelector(editingSourceId, editingSelectorValue)\n      setSources(sources.map(s =>\n        s.id === editingSourceId ? { ...s, result_selector: result.result_selector } : s\n      ))\n      toast.success('Selector updated')\n      setEditingSourceId(null)\n      setEditingSelectorValue('')\n    } catch (error) {\n      console.error('Failed to update selector:', error)\n      toast.error('Failed to update selector')\n    } finally {\n      setSavingSelector(false)\n    }\n  }\n\n  const handleTestSource = async (sourceId: number) => {\n    setTestingSourceId(sourceId)\n    try {\n      const result = await api.sources.test(sourceId)\n      if (result.success) {\n        toast.success(result.message)\n        // Refresh sources to update status\n        const sourcesData = await api.sources.list()\n        setSources(sourcesData)\n      } else {\n        toast.error(result.message)\n        const sourcesData = await api.sources.list()\n        setSources(sourcesData)\n      }\n    } catch (error) {\n      console.error('Failed to test source:', error)\n      toast.error('Failed to test source')\n    } finally {\n      setTestingSourceId(null)\n    }\n  }\n\n  const handleTestAllSources = async () => {\n    setTestingAll(true)\n    try {\n      const result = await api.sources.testAll()\n      toast.success(`Tested ${result.tested} sources: ${result.passed} passed, ${result.failed} failed`)\n      // Refresh sources\n      const sourcesData = await api.sources.list()\n      setSources(sourcesData)\n    } catch (error) {\n      console.error('Failed to test all sources:', error)\n      toast.error('Failed to test all sources')\n    } finally {\n      setTestingAll(false)\n    }\n  }\n\n  const getModelName = (modelId: string) => {\n    const model = models.find(m => m.id === modelId)\n    return model?.name || modelId\n  }\n\n  const getSourceStatus = (source: Source): 'working' | 'broken' | 'untested' => {\n    if (!source.last_validated_at) return 'untested'\n    if (source.needs_attention || source.consecutive_failures >= 3) return 'broken'\n    return 'working'\n  }\n\n  const formatRelativeTime = (dateStr: string | null): string => {\n    if (!dateStr) return 'Never'\n    const date = new Date(dateStr)\n    const now = new Date()\n    const diffMs = now.getTime() - date.getTime()\n    const diffMins = Math.floor(diffMs / 60000)\n    if (diffMins < 1) return 'Just now'\n    if (diffMins < 60) return `${diffMins}m ago`\n    const diffHours = Math.floor(diffMins / 60)\n    if (diffHours < 24) return `${diffHours}h ago`\n    const diffDays = Math.floor(diffHours / 24)\n    return `${diffDays}d ago`\n  }\n\n  // Profile deletion handlers\n  const handleDeleteClick = async (profileId: number) => {\n    try {\n      const preview = await api.profiles.deletionPreview(profileId)\n      setDeletePreview(preview)\n      setDeletingId(profileId)\n      setShowDeleteModal(true)\n    } catch (error) {\n      console.error('Failed to load deletion preview:', error)\n      toast.error('Failed to load profile info')\n    }\n  }\n\n  const handleConfirmDelete = async () => {\n    if (!deletingId) return\n\n    setDeleting(true)\n    try {\n      await api.profiles.delete(deletingId)\n      setProfiles(profiles.filter(p => p.id !== deletingId))\n      toast.success('Profile deleted successfully')\n      setShowDeleteModal(false)\n      setDeletePreview(null)\n      setDeletingId(null)\n    } catch (error) {\n      console.error('Failed to delete profile:', error)\n      toast.error('Failed to delete profile')\n    } finally {\n      setDeleting(false)\n    }\n  }\n\n  const handleCancelDelete = () => {\n    setShowDeleteModal(false)\n    setDeletePreview(null)\n    setDeletingId(null)\n  }\n\n  // Database Reset handlers\n  const handleResetClick = async () => {\n    try {\n      const preview = await api.system.resetPreview()\n      setResetPreview(preview)\n      setResetStep(1)\n      setResetConfirmText('')\n      setShowResetModal(true)\n    } catch (error) {\n      console.error('Failed to load reset preview:', error)\n      toast.error('Failed to load reset preview')\n    }\n  }\n\n  const handleResetContinue = () => {\n    setResetStep(2)\n  }\n\n  const handleResetBack = () => {\n    setResetStep(1)\n    setResetConfirmText('')\n  }\n\n  const handleConfirmReset = async () => {\n    if (resetConfirmText !== 'RESET') return\n\n    setResetting(true)\n    try {\n      await api.system.reset('RESET')\n      toast.success('Database reset complete')\n      // Redirect to home/profile creation\n      window.location.href = '/'\n    } catch (error) {\n      console.error('Failed to reset database:', error)\n      toast.error('Failed to reset database')\n    } finally {\n      setResetting(false)\n    }\n  }\n\n  const handleCancelReset = () => {\n    setShowResetModal(false)\n    setResetPreview(null)\n    setResetStep(1)\n    setResetConfirmText('')\n  }\n\n  const formatDate = (dateStr: string): string => {\n    return new Date(dateStr).toLocaleDateString()\n  }\n\n  const enabledCount = sources.filter(s => s.is_enabled).length\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center gap-4 border-b border-border px-4 py-3\">\n        <button\n          onClick={onBack}\n          className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </button>\n        <h1 className=\"text-xl font-medium text-foreground\">Settings</h1>\n      </header>\n\n      {/* Tab navigation */}\n      <div className=\"border-b border-border px-4\">\n        <div className=\"mx-auto max-w-4xl\">\n          <div className=\"flex gap-4 overflow-x-auto\">\n            <button\n              onClick={() => setActiveTab('general')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'general'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <SettingsIcon className=\"h-4 w-4\" />\n                General\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('prompts')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'prompts'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Bot className=\"h-4 w-4\" />\n                AI Prompts\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('sources')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'sources'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Globe className=\"h-4 w-4\" />\n                Sources\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('selectors')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'selectors'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Code className=\"h-4 w-4\" />\n                Selectors\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('users')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'users'\n                  ? 'border-primary text-primary'\n                  : 'border-transparent text-muted-foreground hover:text-foreground'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <Users className=\"h-4 w-4\" />\n                Users\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('danger')}\n              className={cn(\n                'border-b-2 py-3 text-sm font-medium transition-colors whitespace-nowrap',\n                activeTab === 'danger'\n                  ? 'border-destructive text-destructive'\n                  : 'border-transparent text-muted-foreground hover:text-destructive'\n              )}\n            >\n              <span className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                Danger Zone\n              </span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <main className=\"px-4 py-6\">\n        <div className=\"mx-auto max-w-4xl\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : activeTab === 'general' ? (\n            /* General Tab */\n            <div className=\"space-y-6\">\n              {/* OpenRouter API */}\n              <div className=\"rounded-lg border border-border bg-card p-4\">\n                <h2 className=\"mb-4 text-lg font-medium text-foreground\">OpenRouter API</h2>\n\n                <div className=\"mb-4 flex items-center gap-2\">\n                  <div\n                    className={cn(\n                      'h-2 w-2 rounded-full',\n                      aiStatus?.available ? 'bg-green-500' : aiStatus?.configured ? 'bg-yellow-500' : 'bg-red-500'\n                    )}\n                  />\n                  <span className=\"text-sm text-muted-foreground\">\n                    {aiStatus?.available ? 'Connected' : aiStatus?.configured ? 'Invalid key' : 'Not configured'}\n                  </span>\n                </div>\n\n                {aiStatus?.configured && !aiStatus?.valid && (\n                  <div className=\"mb-4 flex items-center gap-2 rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-3\">\n                    <AlertCircle className=\"h-5 w-5 flex-shrink-0 text-yellow-500\" />\n                    <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">\n                      {aiStatus?.error || 'Your API key appears to be invalid or expired. Please update it.'}\n                    </p>\n                  </div>\n                )}\n\n                {aiStatus?.available && (\n                  <div className=\"mb-4 text-sm text-muted-foreground\">\n                    Default model: <span className=\"font-medium text-foreground\">{getModelName(aiStatus.default_model)}</span>\n                  </div>\n                )}\n\n                <div className=\"space-y-3\">\n                  <label className=\"block\">\n                    <span className=\"mb-1 block text-sm font-medium text-foreground\">\n                      {aiStatus?.available ? 'Update API Key' : 'API Key'}\n                    </span>\n                    <input\n                      type=\"password\"\n                      value={apiKey}\n                      onChange={(e) => setApiKey(e.target.value)}\n                      placeholder=\"sk-or-v1-...\"\n                      className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                    />\n                  </label>\n\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={handleTestApiKey}\n                      disabled={testingKey || !apiKey.trim()}\n                      className=\"flex items-center gap-2 rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n                    >\n                      {testingKey ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Check className=\"h-4 w-4\" />\n                      )}\n                      Test Key\n                    </button>\n                    <button\n                      onClick={handleSaveApiKey}\n                      disabled={savingKey || !apiKey.trim()}\n                      className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                    >\n                      {savingKey ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Key className=\"h-4 w-4\" />\n                      )}\n                      Save Key\n                    </button>\n                  </div>\n                </div>\n\n                <p className=\"mt-4 text-sm text-muted-foreground\">\n                  Get your API key from{' '}\n                  <a\n                    href=\"https://openrouter.ai/keys\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-primary hover:underline\"\n                  >\n                    openrouter.ai/keys\n                  </a>\n                </p>\n              </div>\n\n              {/* About */}\n              <div className=\"rounded-lg border border-border bg-card p-4\">\n                <h2 className=\"mb-4 text-lg font-medium text-foreground\">About</h2>\n                <div className=\"space-y-2 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center justify-between\">\n                    <span>Version</span>\n                    <span className=\"font-medium text-foreground\">1.0.0</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span>Source Code</span>\n                    <a\n                      href=\"https://github.com/matthewdeaves/cookie.git\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center gap-1 text-primary hover:underline\"\n                    >\n                      <Github className=\"h-4 w-4\" />\n                      GitHub\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) : activeTab === 'prompts' ? (\n            /* AI Prompts Tab */\n            <div className=\"space-y-4\">\n              <div className=\"flex items-start gap-3 rounded-lg border border-border bg-card p-4\">\n                <AlertCircle className=\"mt-0.5 h-5 w-5 flex-shrink-0 text-primary\" />\n                <div>\n                  <h2 className=\"font-medium text-foreground\">AI Prompts Configuration</h2>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Customize the prompts used for AI features. Each prompt has a system prompt that sets the AI's behavior\n                    and a user prompt template that includes placeholders for dynamic content.\n                  </p>\n                </div>\n              </div>\n\n              {!aiStatus?.available && (\n                <div className=\"flex items-center gap-3 rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-4\">\n                  <AlertCircle className=\"h-5 w-5 text-yellow-500\" />\n                  <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">\n                    Configure your OpenRouter API key in the General tab to enable AI features.\n                  </p>\n                </div>\n              )}\n\n              {prompts.map((prompt) => {\n                const isEditing = editingPromptType === prompt.prompt_type\n                const isExpanded = expandedPrompts.has(prompt.prompt_type)\n\n                return (\n                  <div\n                    key={prompt.prompt_type}\n                    className=\"rounded-lg border border-border bg-card\"\n                  >\n                    <div className=\"flex items-center justify-between p-4\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-medium text-foreground\">{prompt.name}</h3>\n                          {!prompt.is_active && (\n                            <span className=\"rounded bg-muted px-2 py-0.5 text-xs text-muted-foreground\">\n                              Disabled\n                            </span>\n                          )}\n                        </div>\n                        <p className=\"mt-1 text-sm text-muted-foreground\">{prompt.description}</p>\n                        <div className=\"mt-2 flex items-center gap-2\">\n                          <span className=\"rounded bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary\">\n                            {getModelName(prompt.model)}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {!isEditing && (\n                          <>\n                            <button\n                              onClick={() => toggleExpandPrompt(prompt.prompt_type)}\n                              className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground\"\n                              aria-label={isExpanded ? 'Collapse' : 'Expand'}\n                            >\n                              {isExpanded ? <ChevronUp className=\"h-5 w-5\" /> : <ChevronDown className=\"h-5 w-5\" />}\n                            </button>\n                            <button\n                              onClick={() => handleEditPrompt(prompt)}\n                              className=\"rounded-lg bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20\"\n                            >\n                              Edit\n                            </button>\n                          </>\n                        )}\n                      </div>\n                    </div>\n\n                    {isExpanded && !isEditing && (\n                      <div className=\"border-t border-border px-4 py-4\">\n                        <div className=\"space-y-4\">\n                          <div>\n                            <label className=\"mb-1 block text-sm font-medium text-muted-foreground\">System Prompt</label>\n                            <pre className=\"whitespace-pre-wrap rounded-lg bg-muted p-3 text-sm text-foreground\">\n                              {prompt.system_prompt}\n                            </pre>\n                          </div>\n                          <div>\n                            <label className=\"mb-1 block text-sm font-medium text-muted-foreground\">User Prompt Template</label>\n                            <pre className=\"whitespace-pre-wrap rounded-lg bg-muted p-3 text-sm text-foreground\">\n                              {prompt.user_prompt_template}\n                            </pre>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {isEditing && editForm && (\n                      <div className=\"border-t border-border px-4 py-4\">\n                        <div className=\"space-y-4\">\n                          <div>\n                            <label className=\"mb-1 block text-sm font-medium text-foreground\">System Prompt</label>\n                            <textarea\n                              value={editForm.system_prompt}\n                              onChange={(e) => setEditForm({ ...editForm, system_prompt: e.target.value })}\n                              rows={6}\n                              className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                            />\n                          </div>\n                          <div>\n                            <label className=\"mb-1 block text-sm font-medium text-foreground\">User Prompt Template</label>\n                            <textarea\n                              value={editForm.user_prompt_template}\n                              onChange={(e) => setEditForm({ ...editForm, user_prompt_template: e.target.value })}\n                              rows={4}\n                              className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                            />\n                            <p className=\"mt-1 text-xs text-muted-foreground\">\n                              Use {'{placeholders}'} for dynamic content\n                            </p>\n                          </div>\n                          <div className=\"flex gap-4\">\n                            <div className=\"flex-1\">\n                              <label className=\"mb-1 block text-sm font-medium text-foreground\">Model</label>\n                              <select\n                                value={editForm.model}\n                                onChange={(e) => setEditForm({ ...editForm, model: e.target.value })}\n                                className=\"w-full rounded-lg border border-border bg-input-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                              >\n                                {models.map((model) => (\n                                  <option key={model.id} value={model.id}>{model.name}</option>\n                                ))}\n                              </select>\n                            </div>\n                            <div>\n                              <label className=\"mb-1 block text-sm font-medium text-foreground\">Status</label>\n                              <button\n                                onClick={() => setEditForm({ ...editForm, is_active: !editForm.is_active })}\n                                className={cn(\n                                  'rounded-lg px-4 py-2 text-sm font-medium transition-colors',\n                                  editForm.is_active\n                                    ? 'bg-green-500/10 text-green-600 hover:bg-green-500/20 dark:text-green-400'\n                                    : 'bg-muted text-muted-foreground hover:bg-muted/80'\n                                )}\n                              >\n                                {editForm.is_active ? 'Active' : 'Disabled'}\n                              </button>\n                            </div>\n                          </div>\n                          <div className=\"flex justify-end gap-2\">\n                            <button\n                              onClick={handleCancelEdit}\n                              className=\"flex items-center gap-2 rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                            >\n                              <X className=\"h-4 w-4\" />\n                              Cancel\n                            </button>\n                            <button\n                              onClick={handleSavePrompt}\n                              disabled={savingPrompt}\n                              className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                            >\n                              {savingPrompt ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Check className=\"h-4 w-4\" />}\n                              Save Changes\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )\n              })}\n            </div>\n          ) : activeTab === 'sources' ? (\n            /* Sources Tab */\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\">\n                <div>\n                  <h2 className=\"text-lg font-medium text-foreground\">Recipe Sources</h2>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {enabledCount} of {sources.length} sources currently enabled\n                  </p>\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => handleBulkToggle(true)}\n                    disabled={bulkToggling || enabledCount === sources.length}\n                    className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n                  >\n                    Enable All\n                  </button>\n                  <button\n                    onClick={() => handleBulkToggle(false)}\n                    disabled={bulkToggling || enabledCount === 0}\n                    className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n                  >\n                    Disable All\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                {sources.map((source) => (\n                  <div\n                    key={source.id}\n                    className={cn(\n                      'flex items-center justify-between rounded-lg border p-4 transition-colors',\n                      source.is_enabled ? 'border-border bg-card' : 'border-border/50 bg-muted/30'\n                    )}\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium text-foreground\">{source.name}</span>\n                        {source.is_enabled && (\n                          <span className=\"rounded bg-green-500/10 px-2 py-0.5 text-xs font-medium text-green-600 dark:text-green-400\">\n                            Active\n                          </span>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">{source.host}</p>\n                    </div>\n                    <button\n                      onClick={() => handleToggleSource(source.id)}\n                      disabled={togglingSourceId === source.id}\n                      className=\"text-muted-foreground transition-colors hover:text-foreground disabled:opacity-50\"\n                    >\n                      {togglingSourceId === source.id ? (\n                        <Loader2 className=\"h-6 w-6 animate-spin\" />\n                      ) : source.is_enabled ? (\n                        <ToggleRight className=\"h-8 w-8 text-primary\" />\n                      ) : (\n                        <ToggleLeft className=\"h-8 w-8\" />\n                      )}\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          ) : activeTab === 'selectors' ? (\n            /* Selectors Tab */\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\">\n                <div>\n                  <h2 className=\"text-lg font-medium text-foreground\">Search Source Selector Management</h2>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Edit CSS selectors and test source connectivity\n                  </p>\n                </div>\n                <button\n                  onClick={handleTestAllSources}\n                  disabled={testingAll}\n                  className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                >\n                  {testingAll ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Play className=\"h-4 w-4\" />\n                  )}\n                  Test All Sources\n                </button>\n              </div>\n\n              <div className=\"space-y-3\">\n                {sources.map((source) => {\n                  const status = getSourceStatus(source)\n                  const isEditing = editingSourceId === source.id\n                  const isTesting = testingSourceId === source.id\n\n                  return (\n                    <div\n                      key={source.id}\n                      className=\"rounded-lg border border-border bg-card p-4\"\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-medium text-foreground\">{source.name}</span>\n                            {status === 'working' && (\n                              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                            )}\n                            {status === 'broken' && (\n                              <XCircle className=\"h-4 w-4 text-red-500\" />\n                            )}\n                            {status === 'untested' && (\n                              <HelpCircle className=\"h-4 w-4 text-muted-foreground\" />\n                            )}\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">{source.host}</p>\n                          {source.consecutive_failures >= 3 && (\n                            <p className=\"mt-1 text-xs text-red-500\">\n                              Failed {source.consecutive_failures} times - auto-disabled\n                            </p>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-muted-foreground\">\n                            Last tested: {formatRelativeTime(source.last_validated_at)}\n                          </span>\n                          <button\n                            onClick={() => handleTestSource(source.id)}\n                            disabled={isTesting || testingAll}\n                            className=\"flex items-center gap-1 rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted disabled:cursor-not-allowed disabled:opacity-50\"\n                          >\n                            {isTesting ? (\n                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n                            ) : (\n                              <Play className=\"h-4 w-4\" />\n                            )}\n                            Test\n                          </button>\n                        </div>\n                      </div>\n\n                      <div className=\"mt-3\">\n                        <label className=\"mb-1 block text-xs font-medium text-muted-foreground\">CSS Selector</label>\n                        {isEditing ? (\n                          <div className=\"flex gap-2\">\n                            <input\n                              type=\"text\"\n                              value={editingSelectorValue}\n                              onChange={(e) => setEditingSelectorValue(e.target.value)}\n                              className=\"flex-1 rounded-lg border border-border bg-input-background px-3 py-1.5 font-mono text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n                            />\n                            <button\n                              onClick={handleCancelEditSelector}\n                              className=\"rounded-lg border border-border bg-background px-3 py-1.5 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                            >\n                              Cancel\n                            </button>\n                            <button\n                              onClick={handleSaveSelector}\n                              disabled={savingSelector}\n                              className=\"flex items-center gap-1 rounded-lg bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                            >\n                              {savingSelector ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Check className=\"h-4 w-4\" />}\n                              Save\n                            </button>\n                          </div>\n                        ) : (\n                          <div className=\"flex items-center gap-2\">\n                            <code className=\"flex-1 rounded bg-muted px-3 py-1.5 font-mono text-sm text-foreground\">\n                              {source.result_selector || '(none)'}\n                            </code>\n                            <button\n                              onClick={() => handleEditSelector(source)}\n                              className=\"rounded-lg bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20\"\n                            >\n                              Edit\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )\n                })}\n              </div>\n            </div>\n          ) : activeTab === 'users' ? (\n            /* Users Tab */\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h2 className=\"text-lg font-medium text-foreground\">User Management</h2>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Manage user profiles and their data\n                  </p>\n                </div>\n                <span className=\"text-sm text-muted-foreground\">\n                  {profiles.length} profile{profiles.length !== 1 ? 's' : ''}\n                </span>\n              </div>\n\n              <div className=\"space-y-3\">\n                {profiles.map((profile) => {\n                  const isCurrent = profile.id === currentProfileId\n\n                  return (\n                    <div\n                      key={profile.id}\n                      className=\"flex items-center justify-between rounded-lg border border-border bg-card p-4\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        {/* Avatar */}\n                        <div\n                          className=\"h-10 w-10 rounded-full\"\n                          style={{ backgroundColor: profile.avatar_color }}\n                        />\n                        <div>\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-medium text-foreground\">{profile.name}</span>\n                            {isCurrent && (\n                              <span className=\"rounded bg-primary/10 px-2 py-0.5 text-xs text-primary\">\n                                Current\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Created {formatDate(profile.created_at)}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            {profile.stats.favorites} favorites  {profile.stats.collections} collections  {profile.stats.remixes} remixes\n                          </div>\n                        </div>\n                      </div>\n\n                      <button\n                        onClick={() => handleDeleteClick(profile.id)}\n                        disabled={isCurrent}\n                        className={cn(\n                          'rounded p-2 transition-colors',\n                          isCurrent\n                            ? 'cursor-not-allowed text-muted-foreground/50'\n                            : 'text-muted-foreground hover:bg-destructive/10 hover:text-destructive'\n                        )}\n                        title={isCurrent ? 'Cannot delete current profile' : 'Delete profile'}\n                      >\n                        <Trash2 className=\"h-5 w-5\" />\n                      </button>\n                    </div>\n                  )\n                })}\n              </div>\n            </div>\n          ) : activeTab === 'danger' ? (\n            /* Danger Zone Tab */\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center gap-2 text-destructive\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                <h2 className=\"text-lg font-medium\">Danger Zone</h2>\n              </div>\n\n              <p className=\"text-sm text-muted-foreground\">\n                Destructive operations that cannot be undone\n              </p>\n\n              <div className=\"rounded-lg border border-destructive/50 bg-destructive/5 p-6\">\n                <h3 className=\"font-medium text-destructive\">Reset Database</h3>\n                <p className=\"mt-1 text-sm text-muted-foreground\">\n                  Completely reset the application to factory state\n                </p>\n\n                <ul className=\"mt-4 space-y-1 text-sm text-muted-foreground\">\n                  <li> All recipes (scraped and remixed)</li>\n                  <li> All recipe images</li>\n                  <li> All user profiles</li>\n                  <li> All favorites, collections, and view history</li>\n                  <li> All cached AI data</li>\n                </ul>\n\n                <p className=\"mt-4 text-xs text-muted-foreground\">\n                  Search source configurations and AI prompts will be preserved.\n                </p>\n\n                <button\n                  onClick={handleResetClick}\n                  className=\"mt-4 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90\"\n                >\n                  Reset Database\n                </button>\n              </div>\n            </div>\n          ) : null}\n        </div>\n      </main>\n\n      {/* Delete Profile Modal */}\n      {showDeleteModal && deletePreview && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div\n            className=\"absolute inset-0 bg-black/50\"\n            onClick={handleCancelDelete}\n          />\n          <div className=\"relative w-full max-w-md rounded-lg border border-border bg-card p-6 shadow-lg\">\n            <div className=\"flex items-center gap-2 text-destructive\">\n              <AlertTriangle className=\"h-5 w-5\" />\n              <h3 className=\"text-lg font-medium\">Delete Profile?</h3>\n            </div>\n\n            <div className=\"mt-4 space-y-4\">\n              {/* Profile info */}\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className=\"h-12 w-12 rounded-full\"\n                  style={{ backgroundColor: deletePreview.profile.avatar_color }}\n                />\n                <div>\n                  <div className=\"font-medium text-foreground\">{deletePreview.profile.name}</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Created {formatDate(deletePreview.profile.created_at)}\n                  </div>\n                </div>\n              </div>\n\n              {/* Data summary */}\n              <div className=\"rounded-lg border border-border bg-muted/50 p-3\">\n                <div className=\"mb-2 text-sm font-medium text-foreground\">Data to be deleted:</div>\n                <ul className=\"space-y-1 text-sm text-muted-foreground\">\n                  {deletePreview.data_to_delete.remixes > 0 && (\n                    <li> {deletePreview.data_to_delete.remixes} remixed recipe{deletePreview.data_to_delete.remixes !== 1 ? 's' : ''} ({deletePreview.data_to_delete.remix_images} images)</li>\n                  )}\n                  {deletePreview.data_to_delete.favorites > 0 && (\n                    <li> {deletePreview.data_to_delete.favorites} favorite{deletePreview.data_to_delete.favorites !== 1 ? 's' : ''}</li>\n                  )}\n                  {deletePreview.data_to_delete.collections > 0 && (\n                    <li> {deletePreview.data_to_delete.collections} collection{deletePreview.data_to_delete.collections !== 1 ? 's' : ''} ({deletePreview.data_to_delete.collection_items} items)</li>\n                  )}\n                  {deletePreview.data_to_delete.view_history > 0 && (\n                    <li> {deletePreview.data_to_delete.view_history} view history entries</li>\n                  )}\n                  {(deletePreview.data_to_delete.scaling_cache > 0 || deletePreview.data_to_delete.discover_cache > 0) && (\n                    <li> Cached AI data</li>\n                  )}\n                  {deletePreview.data_to_delete.remixes === 0 &&\n                   deletePreview.data_to_delete.favorites === 0 &&\n                   deletePreview.data_to_delete.collections === 0 &&\n                   deletePreview.data_to_delete.view_history === 0 &&\n                   deletePreview.data_to_delete.scaling_cache === 0 &&\n                   deletePreview.data_to_delete.discover_cache === 0 && (\n                    <li> No associated data</li>\n                  )}\n                </ul>\n              </div>\n\n              {/* Warning */}\n              <div className=\"text-sm text-destructive\">\n                This action cannot be undone. All data will be permanently deleted.\n              </div>\n            </div>\n\n            <div className=\"mt-6 flex justify-end gap-3\">\n              <button\n                onClick={handleCancelDelete}\n                className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirmDelete}\n                disabled={deleting}\n                className=\"flex items-center gap-2 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:cursor-not-allowed disabled:opacity-50\"\n              >\n                {deleting ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <Trash2 className=\"h-4 w-4\" />\n                )}\n                Delete Profile\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Database Reset Modal */}\n      {showResetModal && resetPreview && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div\n            className=\"absolute inset-0 bg-black/50\"\n            onClick={handleCancelReset}\n          />\n          <div className=\"relative w-full max-w-md rounded-lg border border-border bg-card p-6 shadow-lg\">\n            {resetStep === 1 ? (\n              <>\n                <div className=\"flex items-center gap-2 text-destructive\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-medium\">Reset Database?</h3>\n                </div>\n\n                <div className=\"mt-4 space-y-4\">\n                  <p className=\"text-sm text-foreground\">\n                    This will permanently delete ALL data from the application:\n                  </p>\n\n                  <div className=\"rounded-lg border border-border bg-muted/50 p-3\">\n                    <ul className=\"space-y-1 text-sm text-muted-foreground\">\n                      <li> {resetPreview.data_counts.profiles} profiles</li>\n                      <li> {resetPreview.data_counts.recipes} recipes ({resetPreview.data_counts.recipe_images} images)</li>\n                      <li> {resetPreview.data_counts.favorites} favorites</li>\n                      <li> {resetPreview.data_counts.collections} collections</li>\n                      <li> {resetPreview.data_counts.view_history} view history entries</li>\n                      <li> {resetPreview.data_counts.ai_suggestions + resetPreview.data_counts.serving_adjustments} cached AI entries</li>\n                    </ul>\n                  </div>\n\n                  <p className=\"text-sm font-medium text-destructive\">\n                    This action cannot be undone.\n                  </p>\n                </div>\n\n                <div className=\"mt-6 flex justify-end gap-3\">\n                  <button\n                    onClick={handleCancelReset}\n                    className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleResetContinue}\n                    className=\"rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90\"\n                  >\n                    I understand, continue\n                  </button>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"flex items-center gap-2 text-destructive\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-medium\">Confirm Reset</h3>\n                </div>\n\n                <div className=\"mt-4 space-y-4\">\n                  <p className=\"text-sm text-foreground\">\n                    Type <code className=\"rounded bg-muted px-1 font-mono\">RESET</code> to confirm:\n                  </p>\n\n                  <input\n                    type=\"text\"\n                    value={resetConfirmText}\n                    onChange={(e) => setResetConfirmText(e.target.value)}\n                    placeholder=\"Type RESET\"\n                    className=\"w-full rounded-lg border border-border bg-background px-3 py-2 font-mono text-sm text-foreground placeholder:text-muted-foreground focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary\"\n                  />\n                </div>\n\n                <div className=\"mt-6 flex justify-end gap-3\">\n                  <button\n                    onClick={handleResetBack}\n                    className=\"rounded-lg border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted\"\n                  >\n                    Back\n                  </button>\n                  <button\n                    onClick={handleConfirmReset}\n                    disabled={resetConfirmText !== 'RESET' || resetting}\n                    className=\"flex items-center gap-2 rounded-lg bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:cursor-not-allowed disabled:opacity-50\"\n                  >\n                    {resetting && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n                    Reset Database\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/api.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (482). Maximum allowed is 50.","line":8,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":489,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (80). Maximum allowed is 50.","line":17,"column":24,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":96,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (82). Maximum allowed is 50.","line":98,"column":22,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":179,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (131). Maximum allowed is 50.","line":209,"column":27,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":339,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (59). Maximum allowed is 50.","line":341,"column":25,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":399,"endColumn":4},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (70). Maximum allowed is 50.","line":401,"column":23,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":470,"endColumn":4}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { api } from '../api/client'\n\n// Mock fetch globally\nconst mockFetch = vi.fn()\nglobalThis.fetch = mockFetch\n\ndescribe('API Client', () => {\n  beforeEach(() => {\n    mockFetch.mockClear()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  describe('profiles', () => {\n    it('lists profiles', async () => {\n      const profiles = [\n        { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us' },\n        { id: 2, name: 'Bob', avatar_color: '#8fae6f', theme: 'dark', unit_preference: 'metric' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(profiles),\n      })\n\n      const result = await api.profiles.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/', expect.objectContaining({\n        headers: { 'Content-Type': 'application/json' },\n      }))\n      expect(result).toEqual(profiles)\n    })\n\n    it('creates a profile', async () => {\n      const newProfile = { name: 'Charlie', avatar_color: '#6b9dad' }\n      const createdProfile = { id: 3, ...newProfile, theme: 'light', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(createdProfile),\n      })\n\n      const result = await api.profiles.create(newProfile)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify(newProfile),\n      }))\n      expect(result).toEqual(createdProfile)\n    })\n\n    it('selects a profile', async () => {\n      const profile = { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(profile),\n      })\n\n      const result = await api.profiles.select(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/select/', expect.objectContaining({\n        method: 'POST',\n      }))\n      expect(result).toEqual(profile)\n    })\n\n    it('updates a profile', async () => {\n      const updatedProfile = { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'dark', unit_preference: 'us' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(updatedProfile),\n      })\n\n      const result = await api.profiles.update(1, { name: 'Alice', avatar_color: '#d97850', theme: 'dark' })\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/', expect.objectContaining({\n        method: 'PUT',\n      }))\n      expect(result.theme).toBe('dark')\n    })\n\n    it('deletes a profile', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.profiles.delete(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/profiles/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('search', () => {\n    it('searches recipes with query', async () => {\n      const searchResponse = {\n        results: [\n          { url: 'https://example.com/recipe1', title: 'Chocolate Cookies', host: 'example.com', image_url: '', description: 'Delicious cookies' },\n          { url: 'https://example.com/recipe2', title: 'Sugar Cookies', host: 'example.com', image_url: '', description: 'Sweet treats' },\n        ],\n        total: 2,\n        page: 1,\n        has_more: false,\n        sites: { 'example.com': 2 },\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=1', expect.any(Object))\n      expect(result.results).toHaveLength(2)\n      expect(result.total).toBe(2)\n      expect(result.has_more).toBe(false)\n    })\n\n    it('searches recipes with source filter', async () => {\n      const searchResponse = {\n        results: [{ url: 'https://allrecipes.com/recipe', title: 'Recipe', host: 'allrecipes.com', image_url: '', description: '' }],\n        total: 1,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 1 },\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies', 'allrecipes.com')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=1&sources=allrecipes.com', expect.any(Object))\n      expect(result.results).toHaveLength(1)\n    })\n\n    it('searches recipes with pagination', async () => {\n      const searchResponse = {\n        results: [],\n        total: 20,\n        page: 3,\n        has_more: false,\n        sites: {},\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('cookies', undefined, 3)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/search/?q=cookies&page=3', expect.any(Object))\n      expect(result.page).toBe(3)\n    })\n\n    it('returns has_more when more results exist', async () => {\n      const searchResponse = {\n        results: Array(6).fill({ url: '', title: '', host: '', image_url: '', description: '' }),\n        total: 50,\n        page: 1,\n        has_more: true,\n        sites: {},\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(searchResponse),\n      })\n\n      const result = await api.recipes.search('pasta')\n\n      expect(result.has_more).toBe(true)\n      expect(result.total).toBe(50)\n    })\n  })\n\n  describe('scrape', () => {\n    it('scrapes a recipe from URL', async () => {\n      const recipe = {\n        id: 1,\n        title: 'Chocolate Cake',\n        host: 'example.com',\n        image_url: 'https://example.com/cake.jpg',\n        image: null,\n        total_time: 60,\n        rating: 4.5,\n        is_remix: false,\n        scraped_at: '2024-01-01T00:00:00Z',\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(recipe),\n      })\n\n      const result = await api.recipes.scrape('https://example.com/chocolate-cake')\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/recipes/scrape/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ url: 'https://example.com/chocolate-cake' }),\n      }))\n      expect(result.title).toBe('Chocolate Cake')\n    })\n  })\n\n  describe('collections', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Test Recipe',\n      host: 'example.com',\n      image_url: 'https://example.com/img.jpg',\n      image: null,\n      total_time: 30,\n      rating: 4.5,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists collections', async () => {\n      const collections = [\n        { id: 1, name: 'Weeknight Dinners', description: 'Quick meals', recipe_count: 5, created_at: '2024-01-01T00:00:00Z', updated_at: '2024-01-01T00:00:00Z' },\n        { id: 2, name: 'Holiday Baking', description: '', recipe_count: 3, created_at: '2024-01-02T00:00:00Z', updated_at: '2024-01-02T00:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collections),\n      })\n\n      const result = await api.collections.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/', expect.objectContaining({\n        headers: { 'Content-Type': 'application/json' },\n      }))\n      expect(result).toHaveLength(2)\n      expect(result[0].name).toBe('Weeknight Dinners')\n    })\n\n    it('creates a collection', async () => {\n      const newCollection = { name: 'Desserts', description: 'Sweet treats' }\n      const createdCollection = { id: 3, ...newCollection, recipe_count: 0, created_at: '2024-01-03T00:00:00Z', updated_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(createdCollection),\n      })\n\n      const result = await api.collections.create(newCollection)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify(newCollection),\n      }))\n      expect(result.name).toBe('Desserts')\n    })\n\n    it('gets a collection with recipes', async () => {\n      const collectionDetail = {\n        id: 1,\n        name: 'Weeknight Dinners',\n        description: 'Quick meals',\n        recipes: [\n          { recipe: mockRecipe, order: 1, added_at: '2024-01-01T00:00:00Z' },\n        ],\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collectionDetail),\n      })\n\n      const result = await api.collections.get(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.any(Object))\n      expect(result.recipes).toHaveLength(1)\n      expect(result.recipes[0].recipe.title).toBe('Test Recipe')\n    })\n\n    it('updates a collection', async () => {\n      const updatedCollection = { id: 1, name: 'Quick Dinners', description: 'Updated desc', recipe_count: 5, created_at: '2024-01-01T00:00:00Z', updated_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(updatedCollection),\n      })\n\n      const result = await api.collections.update(1, { name: 'Quick Dinners', description: 'Updated desc' })\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.objectContaining({\n        method: 'PUT',\n      }))\n      expect(result.name).toBe('Quick Dinners')\n    })\n\n    it('deletes a collection', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.collections.delete(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n\n    it('adds a recipe to a collection', async () => {\n      const collectionItem = { recipe: mockRecipe, order: 2, added_at: '2024-01-03T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(collectionItem),\n      })\n\n      const result = await api.collections.addRecipe(1, 1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/recipes/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Test Recipe')\n    })\n\n    it('removes a recipe from a collection', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.collections.removeRecipe(1, 1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/collections/1/recipes/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('favorites', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Chocolate Cake',\n      host: 'example.com',\n      image_url: 'https://example.com/cake.jpg',\n      image: null,\n      total_time: 60,\n      rating: 4.8,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists favorites', async () => {\n      const favorites = [\n        { recipe: mockRecipe, created_at: '2024-01-01T00:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(favorites),\n      })\n\n      const result = await api.favorites.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/', expect.any(Object))\n      expect(result).toHaveLength(1)\n      expect(result[0].recipe.title).toBe('Chocolate Cake')\n    })\n\n    it('adds a favorite', async () => {\n      const favorite = { recipe: mockRecipe, created_at: '2024-01-01T00:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(favorite),\n      })\n\n      const result = await api.favorites.add(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Chocolate Cake')\n    })\n\n    it('removes a favorite', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.favorites.remove(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/favorites/1/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('history', () => {\n    const mockRecipe = {\n      id: 1,\n      title: 'Pasta Carbonara',\n      host: 'example.com',\n      image_url: 'https://example.com/pasta.jpg',\n      image: null,\n      total_time: 30,\n      rating: 4.7,\n      is_remix: false,\n      scraped_at: '2024-01-01T00:00:00Z',\n    }\n\n    it('lists history', async () => {\n      const history = [\n        { recipe: mockRecipe, viewed_at: '2024-01-01T12:00:00Z' },\n      ]\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(history),\n      })\n\n      const result = await api.history.list()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/?limit=6', expect.any(Object))\n      expect(result).toHaveLength(1)\n      expect(result[0].recipe.title).toBe('Pasta Carbonara')\n    })\n\n    it('lists history with custom limit', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve([]),\n      })\n\n      await api.history.list(10)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/?limit=10', expect.any(Object))\n    })\n\n    it('records a view', async () => {\n      const historyItem = { recipe: mockRecipe, viewed_at: '2024-01-01T12:00:00Z' }\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: () => Promise.resolve(historyItem),\n      })\n\n      const result = await api.history.record(1)\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/', expect.objectContaining({\n        method: 'POST',\n        body: JSON.stringify({ recipe_id: 1 }),\n      }))\n      expect(result.recipe.title).toBe('Pasta Carbonara')\n    })\n\n    it('clears history', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        status: 204,\n        json: () => Promise.resolve(null),\n      })\n\n      await api.history.clear()\n\n      expect(mockFetch).toHaveBeenCalledWith('/api/history/', expect.objectContaining({\n        method: 'DELETE',\n      }))\n    })\n  })\n\n  describe('error handling', () => {\n    it('throws on API error', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 404,\n        text: () => Promise.resolve('Not found'),\n      })\n\n      await expect(api.profiles.get(999)).rejects.toThrow('Not found')\n    })\n\n    it('throws on network error', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'))\n\n      await expect(api.profiles.list()).rejects.toThrow('Network error')\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/components.test.tsx","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (111). Maximum allowed is 50.","line":49,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":159,"endColumn":2},{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (204). Maximum allowed is 50.","line":161,"column":20,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":364,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport ProfileSelector from '../screens/ProfileSelector'\nimport Search from '../screens/Search'\nimport { api } from '../api/client'\nimport type { ProfileStats } from '../api/client'\n\n// Mock the API client\nvi.mock('../api/client', () => ({\n  api: {\n    profiles: {\n      list: vi.fn(),\n      create: vi.fn(),\n      select: vi.fn(),\n    },\n    recipes: {\n      search: vi.fn(),\n      scrape: vi.fn(),\n    },\n    favorites: {\n      list: vi.fn(),\n    },\n    history: {\n      list: vi.fn(),\n    },\n  },\n}))\n\n// Mock sonner toast\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n  },\n  Toaster: () => null,\n}))\n\n// Shared test fixtures\nconst mockStats: ProfileStats = {\n  favorites: 0,\n  collections: 0,\n  collection_items: 0,\n  remixes: 0,\n  view_history: 0,\n  scaling_cache: 0,\n  discover_cache: 0,\n}\n\ndescribe('ProfileSelector', () => {\n  const mockOnProfileSelect = vi.fn()\n\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  it('shows loading state initially', () => {\n    vi.mocked(api.profiles.list).mockImplementation(() => new Promise(() => {}))\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    expect(screen.getByText('Loading...')).toBeInTheDocument()\n  })\n\n  it('renders profiles after loading', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n      { id: 2, name: 'Bob', avatar_color: '#8fae6f', theme: 'dark', unit_preference: 'metric', created_at: '2024-01-01', stats: mockStats },\n    ])\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice')).toBeInTheDocument()\n      expect(screen.getByText('Bob')).toBeInTheDocument()\n    })\n\n    expect(screen.getByText(\"Who's cooking today?\")).toBeInTheDocument()\n  })\n\n  it('calls onProfileSelect when profile is clicked', async () => {\n    const profiles = [\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n    ]\n    vi.mocked(api.profiles.list).mockResolvedValueOnce(profiles)\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Alice')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Alice'))\n\n    expect(mockOnProfileSelect).toHaveBeenCalledWith(profiles[0])\n  })\n\n  it('shows create profile form when add button is clicked', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([])\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Add Profile')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Add Profile'))\n\n    expect(screen.getByText('Create Profile')).toBeInTheDocument()\n    expect(screen.getByPlaceholderText('Enter your name')).toBeInTheDocument()\n  })\n\n  it('creates a new profile when form is submitted', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([])\n    vi.mocked(api.profiles.create).mockResolvedValueOnce({\n      id: 1,\n      name: 'Charlie',\n      avatar_color: '#d97850',\n      theme: 'light',\n      unit_preference: 'metric',\n    })\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Add Profile')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Add Profile'))\n\n    const input = screen.getByPlaceholderText('Enter your name')\n    fireEvent.change(input, { target: { value: 'Charlie' } })\n    fireEvent.click(screen.getByText('Create'))\n\n    await waitFor(() => {\n      expect(api.profiles.create).toHaveBeenCalledWith({\n        name: 'Charlie',\n        avatar_color: '#d97850',\n        theme: 'light',\n        unit_preference: 'metric',\n      })\n    })\n  })\n\n  it('displays profile initials', async () => {\n    vi.mocked(api.profiles.list).mockResolvedValueOnce([\n      { id: 1, name: 'Alice', avatar_color: '#d97850', theme: 'light', unit_preference: 'us', created_at: '2024-01-01', stats: mockStats },\n    ])\n\n    render(<ProfileSelector onProfileSelect={mockOnProfileSelect} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('A')).toBeInTheDocument()\n    })\n  })\n})\n\ndescribe('Search', () => {\n  const mockOnBack = vi.fn()\n  const mockOnImport = vi.fn()\n\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  it('shows search results', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [\n        { url: 'https://example.com/recipe1', title: 'Chocolate Cookies', host: 'example.com', image_url: '', cached_image_url: null, description: 'Delicious', rating_count: null },\n        { url: 'https://example.com/recipe2', title: 'Sugar Cookies', host: 'example.com', image_url: '', cached_image_url: null, description: 'Sweet', rating_count: null },\n      ],\n      total: 2,\n      page: 1,\n      has_more: false,\n      sites: { 'example.com': 2 },\n    })\n\n    render(<Search query=\"cookies\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Chocolate Cookies')).toBeInTheDocument()\n      expect(screen.getByText('Sugar Cookies')).toBeInTheDocument()\n    })\n  })\n\n  it('displays result count', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Test Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 1,\n      page: 1,\n      has_more: false,\n      sites: { 'example.com': 1 },\n    })\n\n    render(<Search query=\"cookies\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('1 result found')).toBeInTheDocument()\n    })\n  })\n\n  it('displays source filter chips', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 10,\n      page: 1,\n      has_more: false,\n      sites: { 'allrecipes.com': 5, 'foodnetwork.com': 5 },\n    })\n\n    render(<Search query=\"pasta\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('All Sources (10)')).toBeInTheDocument()\n      expect(screen.getByText('allrecipes.com (5)')).toBeInTheDocument()\n      expect(screen.getByText('foodnetwork.com (5)')).toBeInTheDocument()\n    })\n  })\n\n  it('filters by source when chip is clicked', async () => {\n    vi.mocked(api.recipes.search)\n      .mockResolvedValueOnce({\n        results: [],\n        total: 10,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 5, 'foodnetwork.com': 5 },\n      })\n      .mockResolvedValueOnce({\n        results: [],\n        total: 5,\n        page: 1,\n        has_more: false,\n        sites: { 'allrecipes.com': 5 },\n      })\n\n    render(<Search query=\"pasta\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('allrecipes.com (5)')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('allrecipes.com (5)'))\n\n    await waitFor(() => {\n      expect(api.recipes.search).toHaveBeenCalledWith('pasta', 'allrecipes.com', 1)\n    })\n  })\n\n  it('shows load more button when has_more is true', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 50,\n      page: 1,\n      has_more: true,\n      sites: {},\n    })\n\n    render(<Search query=\"cookies\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Load More')).toBeInTheDocument()\n    })\n  })\n\n  it('shows end of results when has_more is false', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [{ url: 'https://example.com/recipe', title: 'Recipe', host: 'example.com', image_url: '', cached_image_url: null, description: '', rating_count: null }],\n      total: 1,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    render(<Search query=\"cookies\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('End of results')).toBeInTheDocument()\n    })\n  })\n\n  it('shows URL import card when query is a URL', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    render(<Search query=\"https://example.com/my-recipe\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Import Recipe from URL')).toBeInTheDocument()\n      expect(screen.getByRole('button', { name: 'Import Recipe' })).toBeInTheDocument()\n    })\n  })\n\n  it('calls onImport when import button is clicked', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n    mockOnImport.mockResolvedValueOnce(undefined)\n\n    render(<Search query=\"https://example.com/recipe\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByRole('button', { name: 'Import Recipe' })).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByRole('button', { name: 'Import Recipe' }))\n\n    await waitFor(() => {\n      expect(mockOnImport).toHaveBeenCalledWith('https://example.com/recipe')\n    })\n  })\n\n  it('calls onBack when back button is clicked', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    render(<Search query=\"cookies\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('Back to Home')).toBeInTheDocument()\n    })\n\n    fireEvent.click(screen.getByText('Back to Home'))\n\n    expect(mockOnBack).toHaveBeenCalled()\n  })\n\n  it('shows empty state when no results', async () => {\n    vi.mocked(api.recipes.search).mockResolvedValueOnce({\n      results: [],\n      total: 0,\n      page: 1,\n      has_more: false,\n      sites: {},\n    })\n\n    render(<Search query=\"zzzzzzz\" onBack={mockOnBack} onImport={mockOnImport} />)\n\n    await waitFor(() => {\n      expect(screen.getByText('No recipes found for \"zzzzzzz\"')).toBeInTheDocument()\n    })\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/test/timers.test.ts","messages":[{"ruleId":"max-lines-per-function","severity":1,"message":"Arrow function has too many lines (242). Maximum allowed is 50.","line":80,"column":23,"nodeType":"ArrowFunctionExpression","messageId":"exceed","endLine":321,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'\nimport { renderHook, act } from '@testing-library/react'\nimport { useTimers, detectTimes, formatTimerDisplay } from '../hooks/useTimers'\n\n// Mock crypto.randomUUID\nvi.stubGlobal('crypto', {\n  randomUUID: () => 'test-uuid-' + Math.random().toString(36).slice(2, 11),\n})\n\ndescribe('detectTimes', () => {\n  it('detects minutes', () => {\n    expect(detectTimes('bake for 15 minutes')).toContain(900)\n  })\n\n  it('detects minute variations', () => {\n    expect(detectTimes('cook 5 min')).toContain(300)\n    expect(detectTimes('cook 5min')).toContain(300)\n    expect(detectTimes('cook 5 mins')).toContain(300)\n    expect(detectTimes('wait 10 m')).toContain(600)\n  })\n\n  it('detects hours', () => {\n    expect(detectTimes('bake for 2 hours')).toContain(7200)\n    expect(detectTimes('cook 1 hr')).toContain(3600)\n    expect(detectTimes('simmer 3h')).toContain(10800)\n  })\n\n  it('detects seconds', () => {\n    expect(detectTimes('microwave 30 seconds')).toContain(30)\n    expect(detectTimes('wait 45 sec')).toContain(45)\n    expect(detectTimes('blend 10s')).toContain(10)\n  })\n\n  it('detects multiple times', () => {\n    const times = detectTimes('cook 5 min then bake 30 minutes')\n    expect(times).toContain(300)\n    expect(times).toContain(1800)\n    expect(times).toHaveLength(2)\n  })\n\n  it('returns empty array for no times', () => {\n    expect(detectTimes('mix until smooth')).toEqual([])\n    expect(detectTimes('add flour and sugar')).toEqual([])\n  })\n\n  it('handles complex instruction text', () => {\n    const times = detectTimes(\n      'Preheat oven to 350F. Bake for 25 minutes, then let rest 10 minutes before serving.'\n    )\n    expect(times).toContain(1500) // 25 minutes\n    expect(times).toContain(600) // 10 minutes\n  })\n\n  it('ignores zero values', () => {\n    expect(detectTimes('0 minutes')).toEqual([])\n  })\n})\n\ndescribe('formatTimerDisplay', () => {\n  it('formats seconds only', () => {\n    expect(formatTimerDisplay(45)).toBe('0:45')\n  })\n\n  it('formats minutes and seconds', () => {\n    expect(formatTimerDisplay(90)).toBe('1:30')\n    expect(formatTimerDisplay(300)).toBe('5:00')\n  })\n\n  it('formats hours, minutes, and seconds', () => {\n    expect(formatTimerDisplay(3661)).toBe('1:01:01')\n    expect(formatTimerDisplay(7200)).toBe('2:00:00')\n  })\n\n  it('pads with zeros correctly', () => {\n    expect(formatTimerDisplay(65)).toBe('1:05')\n    expect(formatTimerDisplay(3605)).toBe('1:00:05')\n  })\n})\n\ndescribe('useTimers', () => {\n  beforeEach(() => {\n    vi.useFakeTimers()\n  })\n\n  afterEach(() => {\n    vi.useRealTimers()\n  })\n\n  it('adds timer and auto-starts by default', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test Timer', 300)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Test Timer')\n    expect(result.current.timers[0].duration).toBe(300)\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(true)\n  })\n\n  it('adds timer without auto-start when specified', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test Timer', 300, false)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Test Timer')\n    expect(result.current.timers[0].duration).toBe(300)\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('returns timer id from addTimer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    let timerId: string = ''\n    act(() => {\n      timerId = result.current.addTimer('Test Timer', 300)\n    })\n\n    expect(timerId).toBeTruthy()\n    expect(result.current.timers[0].id).toBe(timerId)\n  })\n\n  it('starts and pauses timer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n    expect(result.current.timers[0].isRunning).toBe(false)\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(true)\n\n    act(() => {\n      result.current.pauseTimer(timerId)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('toggles timer state', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n    expect(result.current.timers[0].isRunning).toBe(false)\n\n    // Toggle on\n    act(() => {\n      result.current.toggleTimer(timerId)\n    })\n    expect(result.current.timers[0].isRunning).toBe(true)\n\n    // Toggle off\n    act(() => {\n      result.current.toggleTimer(timerId)\n    })\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('resets timer to initial duration', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 300, false)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    // Start and advance time\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(295)\n\n    // Reset\n    act(() => {\n      result.current.resetTimer(timerId)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(300)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('deletes timer', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Timer 1', 300)\n      result.current.addTimer('Timer 2', 600)\n    })\n\n    expect(result.current.timers).toHaveLength(2)\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.deleteTimer(timerId)\n    })\n\n    expect(result.current.timers).toHaveLength(1)\n    expect(result.current.timers[0].label).toBe('Timer 2')\n  })\n\n  it('decrements remaining time when running', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 10)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    // Advance 5 seconds\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(5)\n  })\n\n  it('calls onComplete when timer finishes', () => {\n    const onComplete = vi.fn()\n    const { result } = renderHook(() => useTimers(onComplete))\n\n    act(() => {\n      result.current.addTimer('Test', 3)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    // Advance past completion\n    act(() => {\n      vi.advanceTimersByTime(4000)\n    })\n\n    expect(onComplete).toHaveBeenCalledTimes(1)\n    expect(onComplete).toHaveBeenCalledWith(\n      expect.objectContaining({\n        label: 'Test',\n        remaining: 0,\n        isRunning: false,\n      })\n    )\n  })\n\n  it('stops timer at zero', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Test', 2)\n    })\n\n    const timerId = result.current.timers[0].id\n\n    act(() => {\n      result.current.startTimer(timerId)\n    })\n\n    act(() => {\n      vi.advanceTimersByTime(5000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(0)\n    expect(result.current.timers[0].isRunning).toBe(false)\n  })\n\n  it('supports multiple simultaneous timers', () => {\n    const { result } = renderHook(() => useTimers())\n\n    act(() => {\n      result.current.addTimer('Timer 1', 100)\n      result.current.addTimer('Timer 2', 200)\n    })\n\n    const timer1Id = result.current.timers[0].id\n    const timer2Id = result.current.timers[1].id\n\n    act(() => {\n      result.current.startTimer(timer1Id)\n      result.current.startTimer(timer2Id)\n    })\n\n    expect(result.current.timers[0].isRunning).toBe(true)\n    expect(result.current.timers[1].isRunning).toBe(true)\n\n    act(() => {\n      vi.advanceTimersByTime(10000)\n    })\n\n    expect(result.current.timers[0].remaining).toBe(90)\n    expect(result.current.timers[1].remaining).toBe(190)\n  })\n})\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/cookie/cookie/frontend/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
